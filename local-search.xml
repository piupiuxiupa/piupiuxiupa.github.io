<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Moltbot(Clawdbot) åœ¨ macOS ç³»ç»Ÿä¸­çš„éƒ¨ç½²æŒ‡å—</title>
    <link href="/2026/01/29/moltbot-configure/"/>
    <url>/2026/01/29/moltbot-configure/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ç³»ç»Ÿè¦æ±‚"><a href="#1-ç³»ç»Ÿè¦æ±‚" class="headerlink" title="1. ç³»ç»Ÿè¦æ±‚"></a>1. ç³»ç»Ÿè¦æ±‚</h2><ul><li>macOS 10.15 (Catalina) æˆ–æ›´é«˜ç‰ˆæœ¬</li><li>Node.js 18.x æˆ–æ›´é«˜ç‰ˆæœ¬</li><li>npm åŒ…ç®¡ç†å™¨</li><li>ç¨³å®šçš„äº’è”ç½‘è¿æ¥</li></ul><h2 id="2-å®‰è£…-Clawdbot"><a href="#2-å®‰è£…-Clawdbot" class="headerlink" title="2. å®‰è£… Clawdbot"></a>2. å®‰è£… Clawdbot</h2><h3 id="2-1-å®‰è£…-Node-js"><a href="#2-1-å®‰è£…-Node-js" class="headerlink" title="2.1 å®‰è£… Node.js"></a>2.1 å®‰è£… Node.js</h3><p>é¦–å…ˆç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£… Node.jsï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å·²å®‰è£… Node.js</span><br>node --version<br>npm --version<br><br><span class="hljs-comment"># å¦‚æœæœªå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€å®‰è£…ï¼š</span><br><span class="hljs-comment"># æ–¹å¼1ï¼šä½¿ç”¨ Homebrew</span><br>brew install node<br><br><span class="hljs-comment"># æ–¹å¼2ï¼šä»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…</span><br><span class="hljs-comment"># https://nodejs.org/</span><br></code></pre></td></tr></table></figure><h3 id="2-2-å…¨å±€å®‰è£…-Clawdbot"><a href="#2-2-å…¨å±€å®‰è£…-Clawdbot" class="headerlink" title="2.2 å…¨å±€å®‰è£… Clawdbot"></a>2.2 å…¨å±€å®‰è£… Clawdbot</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…¨å±€å®‰è£… Clawdbot</span><br>npm install -g clawdbot<br><span class="hljs-comment">## æˆ–è€…</span><br>curl -fsSL https://molt.bot/install.sh | bash<br><br><span class="hljs-comment"># éªŒè¯å®‰è£…</span><br>clawdbot --version<br></code></pre></td></tr></table></figure><h2 id="3-é…ç½®-Clawdbot"><a href="#3-é…ç½®-Clawdbot" class="headerlink" title="3. é…ç½® Clawdbot"></a>3. é…ç½® Clawdbot</h2><h3 id="3-1-è¿è¡Œé…ç½®å‘å¯¼"><a href="#3-1-è¿è¡Œé…ç½®å‘å¯¼" class="headerlink" title="3.1 è¿è¡Œé…ç½®å‘å¯¼"></a>3.1 è¿è¡Œé…ç½®å‘å¯¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿è¡Œäº¤äº’å¼é…ç½®å‘å¯¼</span><br>clawdbot configure<br></code></pre></td></tr></table></figure><h3 id="3-2-é…ç½®é€šé“ï¼ˆChannelsï¼‰"><a href="#3-2-é…ç½®é€šé“ï¼ˆChannelsï¼‰" class="headerlink" title="3.2 é…ç½®é€šé“ï¼ˆChannelsï¼‰"></a>3.2 é…ç½®é€šé“ï¼ˆChannelsï¼‰</h3><p>æ ¹æ®æ‚¨çš„éœ€è¦é…ç½®é€šä¿¡æ¸ é“ï¼Œå¦‚ Telegramã€WhatsApp ç­‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é…ç½® Telegram æœºå™¨äºº</span><br>clawdbot channels login --channel telegram<br><br><span class="hljs-comment"># é…ç½® WhatsApp</span><br>clawdbot channels login --channel whatsapp<br></code></pre></td></tr></table></figure><h2 id="4-å®‰è£…å’Œç®¡ç†-Skills"><a href="#4-å®‰è£…å’Œç®¡ç†-Skills" class="headerlink" title="4. å®‰è£…å’Œç®¡ç† Skills"></a>4. å®‰è£…å’Œç®¡ç† Skills</h2><p><a href="https://clawdhub.com/">MoltHub</a></p><h3 id="4-1-ä½¿ç”¨-ClawdHub-æœç´¢å’Œå®‰è£…-Skills"><a href="#4-1-ä½¿ç”¨-ClawdHub-æœç´¢å’Œå®‰è£…-Skills" class="headerlink" title="4.1 ä½¿ç”¨ ClawdHub æœç´¢å’Œå®‰è£… Skills"></a>4.1 ä½¿ç”¨ ClawdHub æœç´¢å’Œå®‰è£… Skills</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…</span><br>npm i -g clawdhub<br><br><span class="hljs-comment"># æœç´¢å¯ç”¨çš„ Skills</span><br>npx clawdhub search [å…³é”®è¯]<br><br><span class="hljs-comment"># å®‰è£…ç‰¹å®š Skill</span><br>npx clawdhub install [skill-name]<br><br><span class="hljs-comment"># æŸ¥çœ‹å·²å®‰è£…çš„ Skills</span><br>npx clawdhub list<br><br><span class="hljs-comment"># æ›´æ–°æ‰€æœ‰ Skills</span><br>npx clawdhub update<br></code></pre></td></tr></table></figure><h3 id="4-2-æ‰‹åŠ¨å®‰è£…-Skills"><a href="#4-2-æ‰‹åŠ¨å®‰è£…-Skills" class="headerlink" title="4.2 æ‰‹åŠ¨å®‰è£… Skills"></a>4.2 æ‰‹åŠ¨å®‰è£… Skills</h3><p>æ‚¨ä¹Ÿå¯ä»¥ä» GitHub æˆ–å…¶ä»–æ¥æºæ‰‹åŠ¨å®‰è£… Skillsï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥å·¥ä½œç›®å½•</span><br><span class="hljs-built_in">cd</span> ~/clawd<br><br><span class="hljs-comment"># åˆ›å»º Skills ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰</span><br><span class="hljs-built_in">mkdir</span> -p skills<br><br><span class="hljs-comment"># å°† Skill æ–‡ä»¶å¤¹å¤åˆ¶åˆ° skills ç›®å½•</span><br><span class="hljs-built_in">cp</span> -r /path/to/skill ./skills/<br></code></pre></td></tr></table></figure><h3 id="4-3-é…ç½®-API-å¯†é’¥"><a href="#4-3-é…ç½®-API-å¯†é’¥" class="headerlink" title="4.3 é…ç½® API å¯†é’¥"></a>4.3 é…ç½® API å¯†é’¥</h3><p>å¯¹äºéœ€è¦ API å¯†é’¥çš„ Skillsï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span><br>nano ~/.clawdbot/clawdbot.json<br><br><span class="hljs-comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  API å¯†é’¥</span><br>&#123;<br>  ...<br>  skills: &#123;<br>    entries: &#123;<br>      <span class="hljs-string">&quot;skill-name&quot;</span>: &#123;<br>        enabled: <span class="hljs-literal">true</span>,<br>        <span class="hljs-comment"># ENV_API_KEY å¯¹åº”skillséœ€è¦çš„ç¯å¢ƒå˜é‡å</span><br>        apiKey: <span class="hljs-string">&quot;ENV_API_KEY&quot;</span>,<br>        <span class="hljs-built_in">env</span>: &#123;<br>          ENV_API_KEY: <span class="hljs-string">&quot;YOUR-API-KEY&quot;</span><br>        &#125;,<br>      &#125;,<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-4-éªŒè¯-Skills-å®‰è£…"><a href="#4-4-éªŒè¯-Skills-å®‰è£…" class="headerlink" title="4.4 éªŒè¯ Skills å®‰è£…"></a>4.4 éªŒè¯ Skills å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ£€æŸ¥æ‰€æœ‰ Skills çš„çŠ¶æ€</span><br>clawdbot skills check<br><br><span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®š Skill ä¿¡æ¯</span><br>clawdbot skills info [skill-name]<br></code></pre></td></tr></table></figure><h2 id="5-å¯åŠ¨å’Œæµ‹è¯•-Clawdbot"><a href="#5-å¯åŠ¨å’Œæµ‹è¯•-Clawdbot" class="headerlink" title="5. å¯åŠ¨å’Œæµ‹è¯• Clawdbot"></a>5. å¯åŠ¨å’Œæµ‹è¯• Clawdbot</h2><h3 id="5-1-å¯åŠ¨-Gateway"><a href="#5-1-å¯åŠ¨-Gateway" class="headerlink" title="5.1 å¯åŠ¨ Gateway"></a>5.1 å¯åŠ¨ Gateway</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨clawdbot</span><br>clawdbot onboard<br><br><span class="hljs-comment"># å¯åŠ¨ Clawdbot Gateway</span><br>clawdbot gateway<br></code></pre></td></tr></table></figure><h3 id="5-2-æµ‹è¯•åŠŸèƒ½"><a href="#5-2-æµ‹è¯•åŠŸèƒ½" class="headerlink" title="5.2 æµ‹è¯•åŠŸèƒ½"></a>5.2 æµ‹è¯•åŠŸèƒ½</h3><p>å¯åŠ¨åï¼Œé€šè¿‡æ‚¨é…ç½®çš„é€šä¿¡æ¸ é“ï¼ˆå¦‚ Telegram æˆ– WhatsAppï¼‰ä¸ Clawdbot äº¤æµï¼Œç¡®è®¤ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚</p><h2 id="6-ä¿æŒåå°è¿è¡Œ"><a href="#6-ä¿æŒåå°è¿è¡Œ" class="headerlink" title="6. ä¿æŒåå°è¿è¡Œ"></a>6. ä¿æŒåå°è¿è¡Œ</h2><h3 id="6-1-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-PM2ï¼ˆæ¨èï¼‰"><a href="#6-1-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-PM2ï¼ˆæ¨èï¼‰" class="headerlink" title="6.1 æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰"></a>6.1 æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰</h3><h4 id="å®‰è£…-PM2"><a href="#å®‰è£…-PM2" class="headerlink" title="å®‰è£… PM2"></a>å®‰è£… PM2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…¨å±€å®‰è£… PM2</span><br>npm install -g pm2<br><br><span class="hljs-comment"># å¯åŠ¨ Clawdbot å¹¶å‘½åè¿›ç¨‹</span><br>pm2 start clawdbot --name <span class="hljs-string">&quot;clawdbot&quot;</span> -- gateway<br><br><span class="hljs-comment"># è®¾ç½®å¼€æœºè‡ªå¯</span><br>pm2 startup<br>pm2 save<br><br><span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€</span><br>pm2 status<br><br><span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿—</span><br>pm2 logs clawdbot<br></code></pre></td></tr></table></figure><h4 id="PM2-å¸¸ç”¨å‘½ä»¤"><a href="#PM2-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="PM2 å¸¸ç”¨å‘½ä»¤"></a>PM2 å¸¸ç”¨å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é‡å¯è¿›ç¨‹</span><br>pm2 restart clawdbot<br><br><span class="hljs-comment"># åœæ­¢è¿›ç¨‹</span><br>pm2 stop clawdbot<br><br><span class="hljs-comment"># åˆ é™¤è¿›ç¨‹</span><br>pm2 delete clawdbot<br><br><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜å’Œ CPU ä½¿ç”¨æƒ…å†µ</span><br>pm2 monit<br></code></pre></td></tr></table></figure><h3 id="6-2-æ–¹æ³•äºŒï¼šä½¿ç”¨-Launchdï¼ˆmacOS-åŸç”Ÿï¼‰"><a href="#6-2-æ–¹æ³•äºŒï¼šä½¿ç”¨-Launchdï¼ˆmacOS-åŸç”Ÿï¼‰" class="headerlink" title="6.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ Launchdï¼ˆmacOS åŸç”Ÿï¼‰"></a>6.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ Launchdï¼ˆmacOS åŸç”Ÿï¼‰</h3><p>åˆ›å»ºä¸€ä¸ª Launchd é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»º plist æ–‡ä»¶</span><br>nano ~/Library/LaunchAgents/com.user.clawdbot.plist<br></code></pre></td></tr></table></figure><p>å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼ˆæ›¿æ¢è·¯å¾„ä¸ºæ‚¨çš„å®é™…è·¯å¾„ï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">plist</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="hljs-string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plist</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Label<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.user.clawdbot<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>ProgramArguments<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/opt/homebrew/bin/clawdbot<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>gateway<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>WorkingDirectory<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/Users/[YOUR_NAME]/clawd<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>RunAtLoad<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>KeepAlive<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>StandardOutPath<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/Users/[YOUR_NAME]/clawdbot.log<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>StandardErrorPath<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/Users/[YOUR_NAME]/clawdbot_error.log<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>EnvironmentVariables<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>PATH<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plist</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŠ è½½æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åŠ è½½æœåŠ¡</span><br>launchctl load ~/Library/LaunchAgents/com.user.clawdbot.plist<br><br><span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span><br>launchctl start com.user.clawdbot<br><br><span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><br>launchctl list | grep clawdbot<br><br><span class="hljs-comment"># åœæ­¢æœåŠ¡</span><br>launchctl stop com.user.clawdbot<br><br><span class="hljs-comment"># å¸è½½æœåŠ¡</span><br>launchctl unload ~/Library/LaunchAgents/com.user.clawdbot.plist<br></code></pre></td></tr></table></figure><h3 id="6-3-æ–¹æ³•ä¸‰ï¼šä½¿ç”¨-nohup"><a href="#6-3-æ–¹æ³•ä¸‰ï¼šä½¿ç”¨-nohup" class="headerlink" title="6.3 æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ nohup"></a>6.3 æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ nohup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨åå°å¯åŠ¨ Clawdbot</span><br><span class="hljs-built_in">nohup</span> clawdbot gateway &gt; ~/clawdbot.log 2&gt;&amp;1 &amp;<br><br><span class="hljs-comment"># è·å–è¿›ç¨‹ ID</span><br><span class="hljs-built_in">echo</span> $! &gt; ~/clawdbot.pid<br><br><span class="hljs-comment"># æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œ</span><br>ps aux | grep clawdbot<br><br><span class="hljs-comment"># åœæ­¢è¿›ç¨‹</span><br><span class="hljs-built_in">kill</span> $(<span class="hljs-built_in">cat</span> ~/clawdbot.pid)<br></code></pre></td></tr></table></figure><h3 id="6-4-æ–¹æ³•å››ï¼šä½¿ç”¨-tmux"><a href="#6-4-æ–¹æ³•å››ï¼šä½¿ç”¨-tmux" class="headerlink" title="6.4 æ–¹æ³•å››ï¼šä½¿ç”¨ tmux"></a>6.4 æ–¹æ³•å››ï¼šä½¿ç”¨ tmux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºå¹¶å¯åŠ¨ tmux ä¼šè¯</span><br>tmux new-session -d -s clawdbot <span class="hljs-string">&#x27;clawdbot gateway&#x27;</span><br><br><span class="hljs-comment"># é‡æ–°è¿æ¥åˆ°ä¼šè¯</span><br>tmux attach -t clawdbot<br><br><span class="hljs-comment"># åˆ†ç¦»ä¼šè¯ï¼ˆä¿æŒè¿è¡Œï¼‰</span><br><span class="hljs-comment"># åœ¨ tmux ä¼šè¯ä¸­æŒ‰ Ctrl+b ç„¶åæŒ‰ d</span><br><br><span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰ä¼šè¯</span><br>tmux <span class="hljs-built_in">ls</span><br><br><span class="hljs-comment"># åœæ­¢ä¼šè¯</span><br>tmux kill-session -t clawdbot<br></code></pre></td></tr></table></figure><h2 id="7-ç›‘æ§å’Œç»´æŠ¤"><a href="#7-ç›‘æ§å’Œç»´æŠ¤" class="headerlink" title="7. ç›‘æ§å’Œç»´æŠ¤"></a>7. ç›‘æ§å’Œç»´æŠ¤</h2><h3 id="7-1-æ—¥å¿—ç®¡ç†"><a href="#7-1-æ—¥å¿—ç®¡ç†" class="headerlink" title="7.1 æ—¥å¿—ç®¡ç†"></a>7.1 æ—¥å¿—ç®¡ç†</h3><p>æ— è®ºä½¿ç”¨å“ªç§åå°è¿è¡Œæ–¹æ³•ï¼Œéƒ½å»ºè®®å®šæœŸæ£€æŸ¥æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¦‚æœä½¿ç”¨ PM2</span><br>pm2 logs clawdbot --lines 100<br><br><span class="hljs-comment"># å¦‚æœä½¿ç”¨ Launchdï¼ŒæŸ¥çœ‹æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶</span><br><span class="hljs-built_in">tail</span> -f ~/clawdbot.log<br></code></pre></td></tr></table></figure><h3 id="7-2-æ›´æ–°-Clawdbot"><a href="#7-2-æ›´æ–°-Clawdbot" class="headerlink" title="7.2 æ›´æ–° Clawdbot"></a>7.2 æ›´æ–° Clawdbot</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ›´æ–° Clawdbot</span><br>npm update -g clawdbot<br><br><span class="hljs-comment"># é‡å¯æœåŠ¡ï¼ˆå¦‚æœæ˜¯ PM2 ç®¡ç†ï¼‰</span><br>pm2 restart clawdbot<br></code></pre></td></tr></table></figure><h3 id="7-3-å¤‡ä»½é…ç½®"><a href="#7-3-å¤‡ä»½é…ç½®" class="headerlink" title="7.3 å¤‡ä»½é…ç½®"></a>7.3 å¤‡ä»½é…ç½®</h3><p>å®šæœŸå¤‡ä»½æ‚¨çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¤‡ä»½é…ç½®</span><br><span class="hljs-built_in">cp</span> -r ~/.clawdbot ~/clawdbot_backup_$(<span class="hljs-built_in">date</span> +%Y%m%d)<br></code></pre></td></tr></table></figure><h2 id="8-æ•…éšœæ’é™¤"><a href="#8-æ•…éšœæ’é™¤" class="headerlink" title="8. æ•…éšœæ’é™¤"></a>8. æ•…éšœæ’é™¤</h2><h3 id="8-1-å¸¸è§é—®é¢˜"><a href="#8-1-å¸¸è§é—®é¢˜" class="headerlink" title="8.1 å¸¸è§é—®é¢˜"></a>8.1 å¸¸è§é—®é¢˜</h3><ol><li><strong>æƒé™é—®é¢˜</strong>ï¼šç¡®ä¿è¿è¡Œ Clawdbot çš„ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™</li><li><strong>ç«¯å£å ç”¨</strong>ï¼šé»˜è®¤ç«¯å£ 18789ï¼Œå¦‚æœè¢«å ç”¨ï¼Œä½¿ç”¨ <code>--port</code> å‚æ•°æŒ‡å®šå…¶ä»–ç«¯å£</li><li><strong>API å¯†é’¥</strong>ï¼šç¡®ä¿æ‰€æœ‰éœ€è¦çš„ API å¯†é’¥éƒ½å·²æ­£ç¡®é…ç½®</li><li><strong>ä¾èµ–é—®é¢˜</strong>ï¼šæœ‰çš„æ—¶å€™npmå®‰è£…ç¼ºå°‘ä¾èµ–ï¼Œéœ€è¦æ‰‹åŠ¨è¡¥é½ï¼Œåœ¨å®‰è£…<code>clawdhub</code>æ—¶æ²¡æœ‰å®‰è£…ä¾èµ–<code>undici</code>ï¼Œ<code>cd /opt/homebrew/lib/node_modules/clawdhub &amp;&amp; npm install undici</code></li></ol><h3 id="8-2-è°ƒè¯•æŠ€å·§"><a href="#8-2-è°ƒè¯•æŠ€å·§" class="headerlink" title="8.2 è°ƒè¯•æŠ€å·§"></a>8.2 è°ƒè¯•æŠ€å·§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿è¡Œè¯Šæ–­</span><br>clawdbot doctor<br><br><span class="hljs-comment"># æ£€æŸ¥å¥åº·çŠ¶æ€</span><br>clawdbot health<br><br><span class="hljs-comment"># æŸ¥çœ‹çŠ¶æ€</span><br>clawdbot status<br></code></pre></td></tr></table></figure><h2 id="9-æ€§èƒ½ä¼˜åŒ–"><a href="#9-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="9. æ€§èƒ½ä¼˜åŒ–"></a>9. æ€§èƒ½ä¼˜åŒ–</h2><ul><li>å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶</li><li>ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>æ ¹æ®éœ€è¦è°ƒæ•´æ¨¡å‹è®¾ç½®</li><li>åªå¯ç”¨å¿…è¦çš„ Skills ä»¥å‡å°‘èµ„æºæ¶ˆè€—</li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="Telegram-æœºå™¨äººé…ç½®"><a href="#Telegram-æœºå™¨äººé…ç½®" class="headerlink" title="Telegram æœºå™¨äººé…ç½®"></a>Telegram æœºå™¨äººé…ç½®</h3><ol><li>æœç´¢BotFather</li><li>å‘é€<code>/newbot</code></li><li>ä¼šè®©ä½ è¾“å…¥æœºå™¨äººçš„åå­—ï¼Œéšä¾¿å®šä¹‰ï¼Œæ¯”å¦‚ï¼š<code>clawdbot</code></li><li>è¾“å…¥æœºå™¨äººç”¨æˆ·åï¼Œæ¯”å¦‚ï¼š<code>xxxbot</code>ï¼Œè¿™é‡Œå¿…é¡»ä»¥botç»“å°¾ï¼Œç”¨æˆ·åæ˜¯å”¯ä¸€idï¼Œå¯èƒ½ä¼šå› ä¸ºå ç”¨éœ€è¦é‡æ–°è¾“å…¥</li><li>åˆ›å»ºå®Œåä¼šæ”¶åˆ°HTTP APIçš„å¯†é’¥</li><li>å‘é€<code>/setprivacy</code>ï¼Œç„¶åå‘é€ä½ åˆšæ‰åˆ›å»ºçš„æœºå™¨äººçš„ç”¨æˆ·åid</li><li>æ­¤æ—¶è¾“å…¥æ¡†ä¼šæ˜¾ç¤ºé€‰é¡¹ï¼Œé€‰æ‹©<code>Disable</code></li><li>åˆ›å»ºå®Œåå¯ä»¥åœ¨æœç´¢é€šè¿‡<code>@xxxbot</code>æ‰¾åˆ°å¯¹åº”æœºå™¨äººæ·»åŠ </li><li>ç¬¬ä¸€æ¬¡éœ€è¦ä¸»åŠ¨è·Ÿæœºå™¨äººå¯¹è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>Pairing code</code></li><li>è¿è¡Œ<code>clawdbot pairing approve telegram &lt;code&gt;</code></li></ol>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>LLM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LLM-app-frame</title>
    <link href="/2025/11/17/LLM-app-frame/"/>
    <url>/2025/11/17/LLM-app-frame/</url>
    
    <content type="html"><![CDATA[<h2 id="Python-å¸¸ç”¨æ¡†æ¶"><a href="#Python-å¸¸ç”¨æ¡†æ¶" class="headerlink" title="Python å¸¸ç”¨æ¡†æ¶"></a>Python å¸¸ç”¨æ¡†æ¶</h2><ul><li>Langchain</li><li>LlamaIndex</li></ul><h2 id="åŸºäºRAGæ¶æ„çš„å¼€å‘"><a href="#åŸºäºRAGæ¶æ„çš„å¼€å‘" class="headerlink" title="åŸºäºRAGæ¶æ„çš„å¼€å‘"></a>åŸºäºRAGæ¶æ„çš„å¼€å‘</h2><ul><li>å¤§æ¨¡å‹çŸ¥è¯†å†»ç»“</li><li>å¤§æ¨¡å‹å¹»è§‰</li></ul><h2 id="åŸºäºAgentæ¶æ„çš„å¼€å‘"><a href="#åŸºäºAgentæ¶æ„çš„å¼€å‘" class="headerlink" title="åŸºäºAgentæ¶æ„çš„å¼€å‘"></a>åŸºäºAgentæ¶æ„çš„å¼€å‘</h2><h2 id="æ¨¡å‹è°ƒç”¨çš„åˆ†ç±»"><a href="#æ¨¡å‹è°ƒç”¨çš„åˆ†ç±»" class="headerlink" title="æ¨¡å‹è°ƒç”¨çš„åˆ†ç±»"></a>æ¨¡å‹è°ƒç”¨çš„åˆ†ç±»</h2><ol><li><p>æŒ‰ç…§æ¨¡å‹åŠŸèƒ½ä¸åŒï¼š</p><ul><li>éå¯¹è¯æ¨¡å‹</li><li>å¯¹è¯æ¨¡å‹</li><li>åµŒå…¥æ¨¡å‹</li></ul></li><li><p>æŒ‰ç…§æ¨¡å‹è°ƒç”¨æ—¶å‚æ•°ä¹¦å†™ä½ç½®</p><ul><li>ç¡¬ç¼–ç æ–¹å¼ï¼Œå°†å‚æ•°å†™åœ¨ä»£ç ä¸­</li><li>ä½¿ç”¨ç¯å¢ƒå˜é‡çš„æ–¹å¼</li><li>ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼</li></ul></li><li><p>å…·ä½“APIçš„è°ƒç”¨</p><ul><li>ä½¿ç”¨LangChainæä¾›çš„API</li><li>ä½¿ç”¨OpenAI å®˜æ–¹çš„API</li><li>ä½¿ç”¨å…¶ä»–å¹³å°æä¾›çš„API</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># éå¯¹è¯æ¨¡å‹</span><br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-comment"># å¯¹è¯æ¨¡å‹</span><br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br></code></pre></td></tr></table></figure><h2 id="å‚æ•°è®¾ç½®"><a href="#å‚æ•°è®¾ç½®" class="headerlink" title="å‚æ•°è®¾ç½®"></a>å‚æ•°è®¾ç½®</h2><ul><li><p>model_name</p><ul><li>æ¨¡å‹åç§°ï¼Œå¦‚â€gpt-3.5-turboâ€ã€â€gpt-4â€ç­‰</li></ul></li><li><p>base_url</p><ul><li>æ¨¡å‹APIçš„åŸºç¡€URLï¼Œå¦‚â€<a href="https://api.openai.com/v1">https://api.openai.com/v1</a>â€œ</li></ul></li><li><p>api_key</p><ul><li>æ¨¡å‹APIçš„å¯†é’¥ï¼Œç”¨äºèº«ä»½éªŒè¯</li></ul></li><li><p>temperature</p><ul><li>æ¸©åº¦ï¼Œæ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§ï¼Œå–å€¼èŒƒå›´ä¸º0ï½1<ul><li>å€¼è¶Šä½ï¼Œè¾“å‡ºè¶Šç¡®å®šã€ä¿å®ˆï¼Œé€‚åˆäº‹å®å›ç­”</li><li>å€¼è¶Šé«˜ï¼Œè¾“å‡ºè¶Šå¤šæ ·ã€æœ‰åˆ›æ„ï¼Œé€‚åˆåˆ›æ„å†™ä½œ</li></ul></li><li>ç²¾ç¡®æ¨¡å¼<ul><li>0.5æˆ–æ›´ä½ï¼Œç”Ÿæˆçš„æ–‡æœ¬æ›´åŠ å®‰å…¨å¯é </li></ul></li><li>å¹³è¡¡æ¨¡å¼<ul><li>é€šå¸¸æ˜¯0.8ï¼Œç”Ÿæˆçš„æ–‡æœ¬é€šå¸¸æœ‰ä¸€å®šçš„å¤šæ ·æ€§ï¼Œåˆèƒ½ä¿æŒè¾ƒå¥½çš„è¿è´¯æ€§å’Œå‡†ç¡®æ€§</li></ul></li><li>åˆ›æ„æ¨¡å¼<ul><li>é€šå¸¸æ˜¯1ï¼Œç”Ÿæˆçš„æ–‡æœ¬æ›´æœ‰åˆ›æ„ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“å‡ºç°è¯­æ³•é”™è¯¯æˆ–ä¸åˆé€»è¾‘çš„å†…å®¹</li></ul></li></ul></li><li><p>max_tokens</p><ul><li>é™åˆ¶ç”Ÿæˆæ–‡æœ¬çš„æœ€å¤§é•¿åº¦ï¼Œé˜²æ­¢è¾“å‡ºè¿‡é•¿</li><li>è®¾ç½®å»ºè®®<ul><li>çŸ­å›å¤ï¼š128-256</li><li>å¸¸è§„å¯¹è¯ã€å¤šè½®å¯¹è¯ï¼š512-1024</li><li>é•¿å†…å®¹ç”Ÿæˆï¼š1024-4096</li></ul></li><li>token<ul><li>å¤§æ¨¡å‹å¤„ç†æ–‡æœ¬çš„æœ€å°å•ä½ï¼Œç›¸å½“äºè‡ªç„¶è¯­è¨€ä¸­çš„è¯æˆ–å­—ï¼Œè¾“å‡ºæ—¶é€ä¸ªtokenä¾æ¬¡ç”Ÿæˆ</li><li>ä¸€èˆ¬æ”¶è´¹æ ‡å‡†1ä¸ªtokençº¦ç­‰äº1-1.8ä¸ªæ±‰å­—æˆ–3-4ä¸ªè‹±æ–‡å­—æ¯</li><li><a href="https://platform.openai.com/tokenizer">tokenå­—ç¬¦è½¬åŒ–å·¥å…·</a></li></ul></li></ul></li></ul><h2 id="å¯¹è¯æ¨¡å‹çš„message"><a href="#å¯¹è¯æ¨¡å‹çš„message" class="headerlink" title="å¯¹è¯æ¨¡å‹çš„message"></a>å¯¹è¯æ¨¡å‹çš„message</h2><ul><li>SystemMessage<ul><li>è®¾å®šAIè¡Œä¸ºè§„åˆ™æˆ–èƒŒæ™¯ä¿¡æ¯ã€‚æ¯”å¦‚è®¾å®šAIçš„åˆå§‹çŠ¶æ€ã€è¡Œä¸ºæ¨¡å¼æˆ–å¯¹è¯çš„æ€»ä½“ç›®æ ‡ã€‚æ¯”å¦‚ï¼šâ€œä½œä¸ºä¸€ä¸ªä»£ç ä¸“å®¶â€ï¼Œæˆ–è€…â€œè¿”å›JSONæ ¼å¼â€ã€‚é€šå¸¸æ˜¯è¾“å…¥æ¶ˆæ¯åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä¼ é€’</li></ul></li><li>HumanMessage<ul><li>è¡¨ç¤ºæ¥è‡ªç”¨æˆ·è¾“å…¥</li></ul></li><li>AIMessage<ul><li>å­˜å‚¨AIå›å¤çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯è°ƒç”¨å·¥å…·çš„è¯·æ±‚</li></ul></li><li>ChatMessage<ul><li>å¯ä»¥è‡ªå®šä¹‰è§’è‰²çš„é€šç”¨æ¶ˆæ¯ç±»å‹</li></ul></li><li>FunctionMessage&#x2F;ToolMessage<ul><li>å‡½æ•°è°ƒç”¨&#x2F;å·¥å…·æ¶ˆæ¯ï¼Œç”¨äºå‡½æ•°è°ƒç”¨ç»“æœçš„æ¶ˆæ¯ç±»å‹</li></ul></li></ul><h2 id="æ¨¡å‹è°ƒç”¨çš„æ–¹æ³•"><a href="#æ¨¡å‹è°ƒç”¨çš„æ–¹æ³•" class="headerlink" title="æ¨¡å‹è°ƒç”¨çš„æ–¹æ³•"></a>æ¨¡å‹è°ƒç”¨çš„æ–¹æ³•</h2><ul><li>invoke<ul><li>å¤„ç†å•æ¡è¾“å…¥ï¼Œç­‰å¾…LLMå®Œå…¨æ¨ç†å®Œæˆåå†è¿”å›è°ƒç”¨ç»“æœ</li></ul></li><li>stream<ul><li>æµå¼å“åº”ï¼Œé€å­—è¾“å‡ºLLMçš„å“åº”ç»“æœ</li></ul></li><li>batch<ul><li>å¤„ç†æ‰¹é‡è¾“å…¥<br>æœ‰ç›¸åº”çš„å¼‚æ­¥æ–¹æ³•ï¼Œä¸asyncioå’Œawaitè¯­æ³•ä¸€èµ·ä½¿ç”¨å®ç°å¹¶å‘</li></ul></li><li>astream<ul><li>å¼‚æ­¥æµå¼å“åº”</li></ul></li><li>ainvoke<ul><li>å¼‚æ­¥å¤„ç†å•æ¡è¾“å…¥</li></ul></li><li>abatch<ul><li>å¼‚æ­¥å¤„ç†æ‰¹é‡è¾“å…¥</li></ul></li><li>astream_log<ul><li>å¼‚æ­¥æµå¼è¿”å›ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠæœ€ç»ˆç»“æœ</li></ul></li></ul><h2 id="æç¤ºè¯æ¨¡æ¿"><a href="#æç¤ºè¯æ¨¡æ¿" class="headerlink" title="æç¤ºè¯æ¨¡æ¿"></a>æç¤ºè¯æ¨¡æ¿</h2><ul><li>PromptTemplate<ul><li>ç”¨äºç”Ÿæˆå­—ç¬¦ä¸²æç¤º</li></ul></li><li>ChatPromptTemplate<ul><li>èŠå¤©æç¤ºæ¨¡æ¿ï¼Œç”¨äºç»„åˆå„ç§è§’è‰²çš„æ¶ˆæ¯æ¨¡æ¿ï¼Œä¼ å…¥èŠå¤©æ¨¡å‹</li></ul></li><li>XxxMessagePromptTemplate<ul><li>æ¶ˆæ¯æ¨¡æ¿è¯æ¨¡æ¿ï¼ŒåŒ…æ‹¬ï¼šSystemMessagePromptTemplateã€HumanMessagePromptTemplateã€AIMessagePromptTemplateã€ChatMessagePromptTemplateç­‰</li></ul></li><li>FewShotPromptTemplate<ul><li>æ ·æœ¬æç¤ºè¯æ¨¡æ¿ï¼Œé€šè¿‡ç¤ºä¾‹æ¥æ•™æ¨¡å‹å¦‚ä½•å›ç­”</li></ul></li><li>PipelinePrompt<ul><li>ç®¡é“æç¤ºè¯æ¨¡æ¿ï¼Œå°†å¤šä¸ªæç¤ºè¯æ¨¡æ¿ç»„åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨</li></ul></li><li>è‡ªå®šä¹‰æ¨¡æ¿<ul><li>å…è®¸åŸºäºå…¶ä»–æ¨¡æ¿ç±»æ¥å®šåˆ¶è‡ªå·±çš„æç¤ºè¯æ¨¡æ¿</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><br>prompt_template = PromptTemplate.from_template(<br>    template=<span class="hljs-string">&quot;è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š&#123;question&#125;&quot;</span>,<br>)<br>prompt_template.<span class="hljs-built_in">format</span>(question=<span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>) <span class="hljs-comment"># è¿”å›å€¼ç±»å‹ä¸ºå­—ç¬¦ä¸²</span><br>prompt_template.invoke(<span class="hljs-built_in">input</span>=&#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>&#125;) <span class="hljs-comment"># è¿”å›å€¼ç±»å‹ä¸ºPromptValue</span><br><br>prompt_template = PromptTemplate.from_template(<br>    template=<span class="hljs-string">&quot;è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š&#123;question&#125;, å¹¶ä¿æŒå›ç­”çš„ä¸“ä¸šå’Œå‡†ç¡®æ€§, è¿”å›æ ¼å¼&#123;format&#125;&quot;</span>,<br>    partial_variables=&#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;AIèƒ½å¤Ÿåšä»€ä¹ˆ&quot;</span>,&#125;,<br>)<br>prompt_template.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">format</span>=<span class="hljs-string">&quot;JSON&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="ChatPromptTemplate"><a href="#ChatPromptTemplate" class="headerlink" title="ChatPromptTemplate"></a>ChatPromptTemplate</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><br>chat_prompt_template = ChatPromptTemplate.from_messages(<br>    messages=[<br>        (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ª&#123;role&#125;ï¼Œåå­—å«&#123;name&#125;&quot;</span>),<br>        (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;question&#125;&quot;</span>),<br>    ],<br>    <span class="hljs-comment">#input_variables=[&quot;role&quot;, &quot;name&quot;, &quot;question&quot;],</span><br>) <br><span class="hljs-comment">## è¿”å›ç±»å‹ä¸ºChatPromptValue</span><br>chat_prompt_template.invoke(<span class="hljs-built_in">input</span>=&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;ä¸“ä¸šçš„ä»£ç åŠ©æ‰‹&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;AIåŠ©æ‰‹&quot;</span>, <span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>&#125;)  <br><span class="hljs-comment">## è¿”å›ç±»å‹ä¸ºList</span><br>chat_prompt_template.format_messages(role=<span class="hljs-string">&quot;ä¸“ä¸šçš„ä»£ç åŠ©æ‰‹&quot;</span>, name=<span class="hljs-string">&quot;AIåŠ©æ‰‹&quot;</span>, question=<span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>)<br><br><span class="hljs-comment">## å®ç°ChatPromptValueã€Listã€å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢</span><br>chat_prompt_template.to_string()<br>chat_prompt_template.to_messages()<br></code></pre></td></tr></table></figure><h2 id="æ’å…¥æ¶ˆæ¯åˆ—è¡¨"><a href="#æ’å…¥æ¶ˆæ¯åˆ—è¡¨" class="headerlink" title="æ’å…¥æ¶ˆæ¯åˆ—è¡¨"></a>æ’å…¥æ¶ˆæ¯åˆ—è¡¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å½“ChatPromptTemplateæ¨¡æ¿ä¸­çš„æ¶ˆæ¯ç±»å‹å’Œä¸ªæ•°ä¸ç¡®å®šçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨MessagePlaceholder</span><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.prompts.chat <span class="hljs-keyword">import</span> MessagePlaceholder<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, AIMessage<br><br>chat_prompt_template = ChatPromptTemplate.from_messages(<br>    messages=[<br>        (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ª&#123;role&#125;ï¼Œåå­—å«&#123;name&#125;&quot;</span>),<br>        MessagePlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>),<br>        (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;question&#125;&quot;</span>),<br>    ],<br>)<br><br>chat_prompt_template.invoke(&#123;<br>  <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;ä¸“ä¸šçš„ä»£ç åŠ©æ‰‹&quot;</span>, <br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;AIåŠ©æ‰‹&quot;</span>, <br>  <span class="hljs-comment"># &quot;messages&quot;: [(&quot;human&quot;, &quot;ä½ æ˜¯è°&quot;)],</span><br>  <span class="hljs-string">&quot;history&quot;</span>: [HumanMessage(content=<span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>), AIMessage(content=<span class="hljs-string">&quot;æˆ‘æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç åŠ©æ‰‹&quot;</span>)],<br>  <span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;æˆ‘åˆšæ‰çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span><br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="å°‘é‡ç¤ºä¾‹æç¤ºè¯æ¨¡æ¿"><a href="#å°‘é‡ç¤ºä¾‹æç¤ºè¯æ¨¡æ¿" class="headerlink" title="å°‘é‡ç¤ºä¾‹æç¤ºè¯æ¨¡æ¿"></a>å°‘é‡ç¤ºä¾‹æç¤ºè¯æ¨¡æ¿</h2><p>FewShotPromptTemplateä¸PromptTemplateä¸€èµ·ä½¿ç”¨<br>FewShotChatMessagePromptTemplate ä¸ChatPromptTemplateä¸€èµ·ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">example_prompt_template = FewShotPromptTemplate(<br>    example_prompt=PromptTemplate.from_template(<br>        template=<span class="hljs-string">&quot;é—®é¢˜ï¼š&#123;question&#125;\nå›ç­”ï¼š&#123;answer&#125;&quot;</span>,<br>    ),<br>    examples=[<br>        &#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;ä½ æ˜¯è°&quot;</span>, <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;æˆ‘æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç åŠ©æ‰‹&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;ä½ èƒ½åšä»€ä¹ˆ&quot;</span>, <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;æˆ‘å¯ä»¥å›ç­”ä»£ç ç›¸å…³çš„é—®é¢˜&quot;</span>&#125;,<br>    ],<br>    suffix=<span class="hljs-string">&quot;é—®é¢˜ï¼š&#123;question&#125;\nå›ç­”ï¼š&quot;</span>,<br>    input_variables=[<span class="hljs-string">&quot;question&quot;</span>],<br>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> FewShotChatMessagePromptTemplate<br>example_prompt_template = FewShotChatMessagePromptTemplate(<br>    example_prompt=ChatPromptTemplate.from_messages(<br>        messages=[<br>            (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;question&#125; æ˜¯å¤šå°‘ï¼Ÿ&quot;</span>),<br>            (<span class="hljs-string">&quot;ai&quot;</span>, <span class="hljs-string">&quot;&#123;answer&#125;&quot;</span>),<br>        ],<br>    ),<br>    examples=[<br>        &#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;2 ğŸŒˆ 2&quot;</span>, <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;4&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;question&quot;</span>: <span class="hljs-string">&quot;2 ğŸŒˆ 3&quot;</span>, <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;8&quot;</span>&#125;,<br>    ],<br>)<br>final_prompt_template = ChatPromptTemplate.from_messages(<br>    messages=[<br>        (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªæ•°å­¦ä¸“ä¸šçš„åŠ©æ‰‹&quot;</span>),<br>        example_prompt_template,<br>        (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;question&#125;&quot;</span>),<br>    ],<br>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LLM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL Notes</title>
    <link href="/2025/11/06/SQL-Notes/"/>
    <url>/2025/11/06/SQL-Notes/</url>
    
    <content type="html"><![CDATA[<h2 id="SQL-Notes"><a href="#SQL-Notes" class="headerlink" title="SQL Notes"></a>SQL Notes</h2><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name;<br><br><span class="hljs-comment">-- åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br>LIMIT num <span class="hljs-keyword">OFFSET</span> <span class="hljs-keyword">offset</span>;<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>,<br>           <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id) <span class="hljs-keyword">AS</span> rn<br>    <span class="hljs-keyword">FROM</span> your_table<br>) t<br><span class="hljs-keyword">WHERE</span> rn <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">11</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- åˆ†ç»„æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> column1, column2, ...<br><span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> column1, column2, ...;<br><br><span class="hljs-comment">-- èšåˆæŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> column1, aggregate_function(column2)<br><span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> column1;<br><br><span class="hljs-comment">-- æ’åºæŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> column1, column2, ... <span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>;<br><br><span class="hljs-comment">-- è”è¡¨æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table1<br><span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> table1.id <span class="hljs-operator">=</span> table2.id;<br><br><span class="hljs-comment">-- æŸ¥è¯¢æ—¶é—´åŒºé—´</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">WHERE</span> date_column <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">&#x27;start_date&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">&#x27;end_date&#x27;</span>;<br><span class="hljs-comment">-- ä¹Ÿå¯ä»¥ç”¨å¤§äºå°äºå·æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">WHERE</span> date_column <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;start_date&#x27;</span> <span class="hljs-keyword">AND</span> date_column <span class="hljs-operator">&lt;</span> <span class="hljs-string">&#x27;end_date&#x27;</span>;<br><br><span class="hljs-comment">-- æŸ¥è¯¢å‡ å¤©å‰çš„æ•°æ®</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">WHERE</span> date_column <span class="hljs-operator">&gt;=</span> DATE_SUB(CURDATE(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">7</span> <span class="hljs-keyword">DAY</span>);<br><span class="hljs-comment">-- ä¹Ÿå¯ç”¨å‡å·æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">WHERE</span> date_column <span class="hljs-operator">&gt;=</span> CURDATE() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-number">7</span> <span class="hljs-keyword">DAY</span>;<br><br><span class="hljs-comment">-- å»é‡æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> column1, column2, ...<br><span class="hljs-keyword">FROM</span> table_name;<br><span class="hljs-comment">-- distinctåªèƒ½æ˜¾ç¤ºæŒ‡å®šåˆ—æˆ–è€…æ‰€æœ‰åˆ—è¿›è¡Œå»é‡</span><br><span class="hljs-comment">-- å¯ä»¥ç”¨row_number()å‡½æ•°é’ˆå¯¹éƒ¨åˆ†åˆ—è¿›è¡Œå»é‡åï¼Œå†ç­›é€‰å‡ºéœ€è¦çš„åˆ—çš„æ•°æ®</span><br><span class="hljs-keyword">SELECT</span> column1, column2, ...<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> column1, column2, ...,<br>           <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> column1, column2, ... <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> column1, column2, ...) <span class="hljs-keyword">AS</span> row_num<br>    <span class="hljs-keyword">FROM</span> table_name<br>) <span class="hljs-keyword">AS</span> subquery<br><span class="hljs-keyword">WHERE</span> row_num <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- åˆ†ç»„æŸ¥è¯¢åç­›é€‰</span><br><span class="hljs-keyword">SELECT</span> column1, aggregate_function(column2)<br><span class="hljs-keyword">FROM</span> table_name<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> column1<br><span class="hljs-keyword">HAVING</span> aggregate_function(column2) <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">value</span>;<br><br><span class="hljs-comment">-- å¤æ‚åµŒå¥—æŸ¥è¯¢</span><br><span class="hljs-keyword">SELECT</span> t.login_id, t.url_path, t.module_name, a.display_name<br><span class="hljs-keyword">FROM</span> <br>(<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> login_id , url_path ,<br><span class="hljs-keyword">case</span><br><span class="hljs-keyword">when</span> url_path <span class="hljs-keyword">like</span> &quot;/searchv1/%&quot; <span class="hljs-keyword">THEN</span> CONCAT(SUBSTRING_INDEX(module_name, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">1</span>), <span class="hljs-string">&#x27;(æ—§)&#x27;</span>)<br><span class="hljs-keyword">when</span> url_path <span class="hljs-keyword">like</span> &quot;/searchv2/%&quot; <span class="hljs-keyword">THEN</span> SUBSTRING_INDEX(module_name, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">else</span> module_name<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">as</span> module_name<br><span class="hljs-keyword">FROM</span> test.module_info<br><span class="hljs-keyword">WHERE</span> <br>        event_time <span class="hljs-operator">&gt;=</span> &quot;2025-10-23 00:00:00&quot;  <span class="hljs-keyword">AND</span> <br>login_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">AND</span> login_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br><span class="hljs-keyword">SELECT</span> loginName <span class="hljs-keyword">FROM</span> `test`.`user_info`<br><span class="hljs-keyword">WHERE</span> state <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> `deptCode` <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11111&#x27;</span> <span class="hljs-keyword">AND</span> loginName <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> login_id<br>) <span class="hljs-keyword">AS</span> t<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <br>(<br><span class="hljs-keyword">SELECT</span> `test`.`user_info`.`loginName` <span class="hljs-keyword">AS</span> `login_name`,<br>   CONCAT(`test`.`user_info`.`realName`, <span class="hljs-string">&#x27;(&#x27;</span>, `test`.`user_info`.`deptName`, <span class="hljs-string">&#x27;)&#x27;</span>) <span class="hljs-keyword">AS</span> `display_name`<br><span class="hljs-keyword">FROM</span><br>   `test`.`user_info`<br><span class="hljs-keyword">WHERE</span><br>   `test`.`user_info`.`state` <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>) <span class="hljs-keyword">AS</span> a<br><span class="hljs-keyword">ON</span> t.login_id <span class="hljs-operator">=</span> a.login_name<br><span class="hljs-keyword">WHERE</span> a.display_name <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t.login_id<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨æŸ¥è¯¢æ—¶å»ºè®®æ˜ç¡®æŒ‡å®šéœ€è¦æŸ¥è¯¢çš„åˆ—ï¼Œé¿å…æŸ¥è¯¢æ‰€æœ‰åˆ—ï¼ˆ<code>SELECT *</code>ï¼‰ï¼Œå› ä¸ºè¿™ä¼šå¢åŠ æŸ¥è¯¢çš„è´Ÿæ‹…</p></blockquote><h3 id="è¡¨æ“ä½œ"><a href="#è¡¨æ“ä½œ" class="headerlink" title="è¡¨æ“ä½œ"></a>è¡¨æ“ä½œ</h3><p>è¡¨è®¾è®¡ç»†èŠ‚ï¼š</p><ul><li>è¡¨ç¤ºçŠ¶æ€ç”¨TINYINTèŠ‚çº¦ç©ºé—´</li><li>è¡¨ç¤ºæ—¶é—´ç”¨DATETIMEç±»å‹</li><li>dorisæ•°æ®åº“è¡¨ç”¨ä¸»é”®è¡¨ç±»å‹æ—¶ï¼ŒSTRINGå±æ€§åˆ—ä¸èƒ½ä½œä¸ºé”®</li><li>å†—ä½™å­—æ®µè®°å½•æ›´æ–°æ—¶é—´ã€åˆ›å»ºæ—¶é—´ã€æ“ä½œæ¥æºï¼Œæ¯”å¦‚ï¼š<code>UPDATE_TIME</code>ã€<code>CREATE_TIME</code>ã€<code>OPERATOR</code></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- mysql</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table_name (<br>    column1 datatype,<br>    column2 datatype,<br>    <span class="hljs-comment">-- æ’å…¥æ•°æ®æ—¶è§¦å‘</span><br>    create_time datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">current_timestamp</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">insert</span>    <span class="hljs-built_in">current_timestamp</span>,<br>    <span class="hljs-comment">-- æ›´æ–°æ•°æ®æ—¶è§¦å‘</span><br>    update_time datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">current_timestamp</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">current_timestamp</span>,<br>    ...<br>);<br></code></pre></td></tr></table></figure><p>Doris çš„å»ºè¡¨è¯­å¥ä¸­å¯ä»¥æŒ‡å®šå»ºè¡¨å±æ€§ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>åˆ†æ¡¶æ•° (buckets)ï¼šå†³å®šæ•°æ®åœ¨è¡¨ä¸­çš„åˆ†å¸ƒï¼›</li><li>å­˜å‚¨ä»‹è´¨ (storage_medium)ï¼šæ§åˆ¶æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œå¦‚ä½¿ç”¨ HDDã€SSD æˆ–è¿œç¨‹å…±äº«å­˜å‚¨ï¼›</li><li>å‰¯æœ¬æ•° (replication_num)ï¼šæ§åˆ¶æ•°æ®å‰¯æœ¬çš„æ•°é‡ï¼Œä»¥ä¿è¯æ•°æ®çš„å†—ä½™å’Œå¯é æ€§ï¼›</li><li>å†·çƒ­åˆ†ç¦»å­˜å‚¨ç­–ç•¥ (storage_policy) ï¼šæ§åˆ¶æ•°æ®çš„å†·çƒ­åˆ†ç¦»å­˜å‚¨çš„è¿ç§»ç­–ç•¥ï¼›</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- doriså»ºè¡¨</span><br><span class="hljs-comment">-- ä¸mysqlä¸åŒï¼Œdoriséœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©ä¸åŒçš„è¡¨ç±»å‹</span><br><span class="hljs-comment">-- æ˜ç»†è¡¨ï¼ˆDuplicate Key Tableï¼‰ï¼šå…è®¸æŒ‡å®šçš„ Key åˆ—é‡å¤ï¼ŒDoirs å­˜å‚¨å±‚ä¿ç•™æ‰€æœ‰å†™å…¥çš„æ•°æ®ï¼Œé€‚ç”¨äºå¿…é¡»ä¿ç•™æ‰€æœ‰åŸå§‹æ•°æ®è®°å½•çš„æƒ…å†µï¼›</span><br><br><span class="hljs-comment">-- ä¸»é”®è¡¨ï¼ˆUnique Key Tableï¼‰ï¼šæ¯ä¸€è¡Œçš„ Key å€¼å”¯ä¸€ï¼Œå¯ç¡®ä¿ç»™å®šçš„ Key åˆ—ä¸ä¼šå­˜åœ¨é‡å¤è¡Œï¼ŒDoris å­˜å‚¨å±‚å¯¹æ¯ä¸ª key åªä¿ç•™æœ€æ–°å†™å…¥çš„æ•°æ®ï¼Œé€‚ç”¨äºæ•°æ®æ›´æ–°çš„æƒ…å†µï¼›</span><br><br><span class="hljs-comment">-- èšåˆè¡¨ï¼ˆAggregate Key Tableï¼‰ï¼šå¯æ ¹æ® Key åˆ—èšåˆæ•°æ®ï¼ŒDoris å­˜å‚¨å±‚ä¿ç•™èšåˆåçš„æ•°æ®ï¼Œä»è€Œå¯ä»¥å‡å°‘å­˜å‚¨ç©ºé—´å’Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼›é€šå¸¸ç”¨äºéœ€è¦æ±‡æ€»æˆ–èšåˆä¿¡æ¯ï¼ˆå¦‚æ€»æ•°æˆ–å¹³å‡å€¼ï¼‰çš„æƒ…å†µã€‚</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> example_tbl_unique<br>(<br>    user_id LARGEINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    user_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    city <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    age <span class="hljs-type">SMALLINT</span>,<br>    sex TINYINT,<br>    <span class="hljs-comment">-- dorisä¸æ”¯æŒ ON UPDATE CURRENT_TIMESTAMPï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°</span><br>    UPDATE_TIME DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    CREATE_TIME DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    OPERATOR <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)<br>)<br><span class="hljs-keyword">UNIQUE</span> KEY(user_id, user_name)<br>DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(user_id) BUCKETS <span class="hljs-number">10</span><br>PROPERTIES (<br>    &quot;enable_unique_key_merge_on_write&quot; <span class="hljs-operator">=</span> &quot;true&quot;<br>);<br><br><span class="hljs-comment">-- ä¿®æ”¹è¡¨ç»“æ„</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name<br>MODIFY column_name datatype;<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> user_info <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> status_tiny TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">&#x27;çŠ¶æ€&#x27;</span>;<br><br><span class="hljs-comment">-- åœ¨æŸåˆ—ä¹‹åæ·»åŠ åˆ—</span><br><span class="hljs-comment">-- dorisçš„TINYINTç±»å‹æŒ‡å®šé»˜è®¤å€¼çš„æ—¶å€™éœ€è¦åŠ å•å¼•å·ï¼Œä¸èƒ½ç›´æ¥å†™æ•°å­—</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> user_info <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> status_tiny TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;çŠ¶æ€&#x27;</span> AFTER user_name;<br><br><br><span class="hljs-keyword">UPDATE</span> user_info <span class="hljs-keyword">SET</span> status_tiny <span class="hljs-operator">=</span> <span class="hljs-built_in">CAST</span>(status <span class="hljs-keyword">AS</span> TINYINT);<br><br><span class="hljs-comment">-- åˆ é™¤åˆ—</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> user_info <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> status;<br><br><span class="hljs-comment">-- é‡å‘½ååˆ—</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> user_info RENAME <span class="hljs-keyword">COLUMN</span> status_tiny status; <br><br><span class="hljs-comment">-- åˆ é™¤æ—§è¡¨ï¼Œé‡å‘½åæ–°è¡¨ä¸ºæ—§è¡¨å</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> example;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> example_new RENAME example;<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><p>dorisçš„insertä¼šè§¦å‘åˆ—é»˜è®¤å€¼ï¼Œupdateä¸ä¼šè§¦å‘åˆ—é»˜è®¤å€¼ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šå€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å¯¼å…¥æ—§æ•°æ®</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example_new <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> example;<br><br><span class="hljs-comment">-- æ›´æ–°æ•°æ®</span><br><span class="hljs-keyword">UPDATE</span> example_new <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br></code></pre></td></tr></table></figure><h3 id="æƒé™ä¿®æ”¹"><a href="#æƒé™ä¿®æ”¹" class="headerlink" title="æƒé™ä¿®æ”¹"></a>æƒé™ä¿®æ”¹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- dorisæˆæƒéœ€è¦å•ç‹¬æŒ‡å®š</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>; <br><span class="hljs-keyword">GRANT</span> CREATE_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> DROP_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> ALTER_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> SELECT_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> LOAD_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><br><span class="hljs-comment">-- å›æ”¶æƒé™</span><br><span class="hljs-keyword">REVOKE</span> CREATE_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">REVOKE</span> DROP_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">REVOKE</span> ALTER_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">REVOKE</span> SELECT_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-keyword">REVOKE</span> LOAD_PRIV <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><br><br><span class="hljs-comment">-- mysqlæˆæƒæ‰€æœ‰æƒé™</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> test.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;username&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>database</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux Kernel Tuning</title>
    <link href="/2025/05/14/linux-kernel-tuning/"/>
    <url>/2025/05/14/linux-kernel-tuning/</url>
    
    <content type="html"><![CDATA[<h2 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h2><ul><li>è¿›ç¨‹æŒ‡æ ‡<ul><li>ç¨‹åºä¸è¿›ç¨‹</li><li>è¿›ç¨‹ä¸çº¿ç¨‹</li><li>è¿›ç¨‹ä¼˜å…ˆçº§å’Œniceçº§åˆ«<ul><li>niceçº§åˆ«ä¿®æ”¹è¿›ç¨‹çš„é™æ€ä¼˜å…ˆçº§ï¼Œç”±ä½åˆ°é«˜ï¼Œä»19åˆ°-20</li></ul></li></ul></li><li>å†…å­˜æŒ‡æ ‡<ul><li>Linuxåœ¨è´Ÿè½½æ¯”è¾ƒå¤§ï¼ˆå†…å­˜å¾ˆç´§å¼ ï¼‰çš„æ—¶å€™ä¸€èˆ¬ä¼šçœ‹åˆ°ä¸¤ä¸ªè¿›ç¨‹ï¼škswapd0å’Œkswapd1</li><li>kswapdè¿›ç¨‹å¦‚æœé¢‘ç¹è¢«å”¤é†’ä¼šè¿‡åº¦æ¶ˆè€—CPUï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡è®¾ç½®å¤§é¡µå†…å­˜ï¼ˆHugePagesï¼‰æ¥è§£å†³</li></ul></li><li>æ–‡ä»¶ç³»ç»ŸæŒ‡æ ‡<ul><li>EXT3&#x2F;EXT4&#x2F;XFSæ–‡ä»¶ç³»ç»Ÿç‰¹æ€§</li><li>ä¸»æµçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯EXT4å’ŒXFS</li><li>æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©<ul><li>webç±»åº”ç”¨<ul><li>è¯»æ“ä½œé¢‘ç¹ï¼Œå†™æ“ä½œä¸€èˆ¬ï¼Œä¸¤è€…çš†å¯</li></ul></li><li>æ•°æ®åº“ç±»<ul><li>å†™æ“ä½œé¢‘ç¹çš„ç»“æ„åŒ–æ•°æ®åº“ç±»åº”ç”¨ï¼Œxfsæœ€ä½³</li></ul></li><li>æ™®é€šåº”ç”¨ç±»åœºæ™¯</li></ul></li><li>ç£ç›˜å­˜å‚¨ä½¿ç”¨raidæŠ€æœ¯ï¼Œä¼˜å…ˆä½¿ç”¨ç¡¬raid<ul><li>å†™é¢‘ç¹ï¼Œæ•°æ®å®‰å…¨æ€§è¦æ±‚ä¸€èˆ¬ï¼Œå¯ç”¨raid0</li><li>å®‰å…¨æ€§è¦æ±‚é«˜ï¼Œå¯ç”¨raid1æˆ–raid10</li></ul></li><li>åˆç†åˆ†åŒºæœ‰åŠ©äºæé«˜æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½</li></ul></li><li>ç£ç›˜I&#x2F;OæŒ‡æ ‡<ul><li>ç”µæ¢¯ç®—æ³•</li><li>å½“è¿›ç¨‹å°è¯•æ”¹å˜æ•°æ®æ—¶ï¼Œä¼šé¦–å…ˆä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ç£ç›˜å’Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¸ä¸€è‡´äº†ï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±å«è„ç¼“å†²</li></ul></li><li>ç½‘ç»œæŒ‡æ ‡<ul><li>æ‹“æ‰‘ç»“æ„</li><li>ç¡¬ä»¶ç½‘å¡</li><li>å†…æ ¸ç½‘ç»œå‚æ•°</li></ul></li></ul><h2 id="è°ƒä¼˜åˆ†æå·¥å…·"><a href="#è°ƒä¼˜åˆ†æå·¥å…·" class="headerlink" title="è°ƒä¼˜åˆ†æå·¥å…·"></a>è°ƒä¼˜åˆ†æå·¥å…·</h2><h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><ul><li>vmstat<ul><li><code>-n</code> åªæ˜¾ç¤ºä¸€æ¬¡è¡¨å¤´</li><li><code>vmstat -n 1 5</code> æ¯1ç§’æ˜¾ç¤ºä¸€æ¬¡ï¼Œå…±æ˜¾ç¤º5æ¬¡</li><li>proc é˜Ÿåˆ—å’Œç­‰å¾…çŠ¶æ€<ul><li>r è¡¨ç¤ºè¿è¡Œå’Œç­‰å¾…CPUæ—¶é—´ç‰‡çš„è¿›ç¨‹æ•°ï¼Œå¦‚æœé•¿æœŸå¤§äºç³»ç»ŸCPUçš„ä¸ªæ•°ï¼Œè¯´æ˜CPUä¸è¶³ï¼Œéœ€è¦å¢åŠ CPUã€‚</li><li>b è¡¨ç¤ºåœ¨ç­‰å¾…èµ„æºçš„è¿›ç¨‹æ•°ï¼Œå¦‚æ­£åœ¨ç­‰å¾…I&#x2F;Oã€å†…å­˜äº¤æ¢ç­‰ã€‚</li></ul></li><li>memory<ul><li>swpdåˆ—è¡¨ç¤ºåˆ‡æ¢åˆ°å†…å­˜äº¤æ¢åŒºçš„å†…å­˜æ•°é‡ï¼Œä»¥KBä¸ºå•ä½</li><li>freeåˆ—è¡¨ç¤ºå½“å‰ç©ºé—²çš„ç‰©ç†å†…å­˜æ•°é‡ï¼Œä»¥KBä¸ºå•ä½</li><li>buffåˆ—è¡¨ç¤ºbuffers cacheçš„å†…å­˜æ•°é‡ï¼Œä¸€èˆ¬å¯¹å—è®¾å¤‡çš„è¯»å†™æ‰éœ€è¦ç¼“å†²</li><li>cacheåˆ—è¡¨ç¤ºpage cachedçš„å†…å­˜æ•°é‡ï¼Œä¸€èˆ¬ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿcachedï¼Œé¢‘ç¹è®¿é—®çš„æ–‡ä»¶éƒ½ä¼šè¢«cached</li></ul></li><li>swap<ul><li>siåˆ—è¡¨ç¤ºç”±ç£ç›˜è°ƒå…¥å†…å­˜ï¼Œä¹Ÿå°±æ˜¯å†…å­˜è¿›å…¥å†…å­˜äº¤æ¢åŒºçš„æ•°é‡</li><li>soåˆ—è¡¨ç¤ºç”±å†…å­˜è°ƒå…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯å†…å­˜äº¤æ¢åŒºè¿›å…¥å†…å­˜çš„æ•°é‡</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œsiã€soçš„å€¼éƒ½ä¸º0ï¼Œå¦‚æœsiã€soçš„å€¼é•¿æœŸä¸ä¸º0ï¼Œåˆ™è¡¨ç¤ºç³»ç»Ÿå†…å­˜ä¸è¶³</li></ul></li><li>io<ul><li>biåˆ—è¡¨ç¤ºä»å—è®¾å¤‡è¯»å…¥æ•°æ®çš„æ€»é‡ï¼ˆå³è¯»ç£ç›˜ï¼‰â€‹ï¼ŒKB&#x2F;s</li><li>boåˆ—è¡¨ç¤ºå†™å…¥åˆ°å—è®¾å¤‡çš„æ•°æ®æ€»é‡ï¼ˆå³å†™ç£ç›˜ï¼‰â€‹ï¼ŒKB&#x2F;s</li></ul></li><li>system<ul><li>in è¡¨ç¤ºåœ¨æŸä¸€æ—¶é—´é—´éš”ä¸­è§‚æµ‹åˆ°çš„æ¯ç§’è®¾å¤‡ä¸­æ–­æ•°</li><li>cs åˆ—è¡¨ç¤ºæ¯ç§’äº§ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°</li></ul></li><li>cpu<ul><li>usåˆ—æ˜¾ç¤ºäº†ç”¨æˆ·è¿›ç¨‹æ¶ˆè€—çš„CPUæ—¶é—´ç™¾åˆ†æ¯”</li><li>syåˆ—æ˜¾ç¤ºäº†å†…æ ¸è¿›ç¨‹æ¶ˆè€—çš„CPUæ—¶é—´ç™¾åˆ†æ¯”</li><li>idåˆ—æ˜¾ç¤ºäº†CPUå¤„åœ¨ç©ºé—²çŠ¶æ€çš„æ—¶é—´ç™¾åˆ†æ¯”</li><li>waåˆ—æ˜¾ç¤ºäº†I&#x2F;Oç­‰å¾…æ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”<blockquote><p>é‡ç‚¹æ³¨æ„procsé¡¹råˆ—çš„å€¼å’ŒCPUé¡¹usã€syå’Œidåˆ—çš„å€¼</p></blockquote></li></ul></li></ul></li><li>uptime<ul><li>1minå†…ã€5minå†…ã€15minå†…</li><li>load averageè¿™ä¸ªè¾“å‡ºå€¼ï¼Œè¿™3ä¸ªå€¼ä¸€èˆ¬ä¸èƒ½å¤§äºç³»ç»ŸCPUçš„ä¸ªæ•°</li></ul></li><li>mpstat<ul><li>å¯ä»¥æŸ¥çœ‹å¤šæ ¸CPUä¸­æ¯ä¸ªè®¡ç®—æ ¸çš„ç»Ÿè®¡æ•°æ®</li><li><code>mpstat -P ALL 1 5</code> æ¯1ç§’æ˜¾ç¤ºä¸€æ¬¡ï¼Œå…±æ˜¾ç¤º5æ¬¡</li></ul></li></ul><h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><ul><li>free<ul><li>Used + free + buff&#x2F;cache &#x3D; total</li><li>availableæ˜¯åœ¨buff&#x2F;cacheåŸºç¡€ä¸Šå‡å»äº†sharedä»¥åŠbufferå†…å­˜æŸè€—å‰©ä¸‹çš„å†…å­˜èµ„æº</li><li>æŸ¥çœ‹å†…å­˜æ˜¯å¦å……è¶³ï¼Œåªéœ€è¦å…³æ³¨availableä¸€åˆ—å³å¯</li></ul></li><li>smem<ul><li>RSSï¼ˆResident Set Sizeï¼‰â€‹ï¼šä½¿ç”¨topå‘½ä»¤å¯ä»¥æŸ¥è¯¢åˆ°ï¼Œæ˜¯æœ€å¸¸ç”¨çš„å†…å­˜æŒ‡æ ‡ï¼Œè¡¨ç¤ºè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°</li><li>PSSï¼ˆProportional Set Sizeï¼‰â€‹ï¼šæ‰€æœ‰ä½¿ç”¨æŸå…±äº«åº“çš„ç¨‹åºå‡åˆ†è¯¥å…±äº«åº“å ç”¨çš„å†…å­˜</li><li>USSï¼ˆUnique Set Sizeï¼‰â€‹ï¼šè¿›ç¨‹ç‹¬è‡ªå ç”¨çš„å†…å­˜ï¼Œå®ƒåªè®¡ç®—äº†è¿›ç¨‹ç‹¬è‡ªå ç”¨çš„å†…å­˜å¤§å°ï¼Œä¸åŒ…å«ä»»ä½•å…±äº«çš„éƒ¨åˆ†</li><li><code>smem -k -s uss</code> -kå‚æ•°ç”¨æ¥æ˜¾ç¤ºå†…å­˜å•ä½ï¼Œ-så¯¹ussåˆ—æ’åºï¼Œ -pç™¾åˆ†æ¯”å½¢å¼æ˜¾ç¤º</li><li><code>smem -u -k</code> æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li><code>smem -k -P prometheus</code> æ˜¾ç¤ºprometheusè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</li></ul></li></ul><h3 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h3><ul><li>iotop<ul><li><code>-u</code> æŒ‡å®šç”¨æˆ·å</li><li><code>-p</code> æŒ‡å®šè¿›ç¨‹id</li><li><code>-P</code> åªæ˜¾ç¤ºè¿›ç¨‹ï¼Œé»˜è®¤æ˜¾ç¤ºæ‰€æœ‰çš„çº¿ç¨‹</li><li><code>-k</code> å­—èŠ‚æ˜¾ç¤º</li><li><code>-t</code> æ¯ä¸€è¡Œå‰æ·»åŠ ä¸€ä¸ªå½“å‰æ—¶é—´</li></ul></li><li>iostat<ul><li><code>iostat-d 3 5</code> å‘½ä»¤ç»„åˆæŸ¥çœ‹ç³»ç»Ÿç£ç›˜çš„ä½¿ç”¨çŠ¶å†µ</li><li>ç¬¬ä¸€é¡¹æ˜¯ç³»ç»Ÿä»å¯åŠ¨ä»¥æ¥åˆ°ç»Ÿè®¡æ—¶çš„æ‰€æœ‰ä¼ è¾“ä¿¡æ¯ï¼Œä»ç¬¬äºŒæ¬¡è¾“å‡ºçš„æ•°æ®æ‰ä»£è¡¨åœ¨æ£€æµ‹çš„æ—¶é—´æ®µå†…ç³»ç»Ÿçš„ä¼ è¾“å€¼</li><li>å¦‚æœKB_wrtn&#x2F;så€¼å¾ˆå¤§ï¼Œè¡¨ç¤ºç£ç›˜çš„å†™æ“ä½œå¾ˆé¢‘ç¹ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–ç£ç›˜æˆ–è€…ä¼˜åŒ–ç¨‹åº</li><li>å¦‚æœKB_read&#x2F;så€¼å¾ˆå¤§ï¼Œè¡¨ç¤ºç£ç›˜ç›´æ¥è¯»å–æ“ä½œå¾ˆå¤šï¼Œå¯ä»¥å°†è¯»å–çš„æ•°æ®æ”¾å…¥å†…å­˜ä¸­è¿›è¡Œæ“ä½œ</li><li><code>-x</code> æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯</li></ul></li></ul><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><ul><li>ping</li><li>traceroute<ul><li><code>traceroute -i eth0 -s 192.168.1.1 -w 10 www.baidu.com 100</code></li><li>å®šeth0ç½‘ç»œæ¥å£å‘é€æ•°æ®åŒ…ï¼ŒåŒæ—¶æŒ‡å®šæœ¬åœ°å‘é€æ•°æ®åŒ…çš„IPä¸º192.168.1.1ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º10sï¼Œæœ€åè®¾ç½®å‘é€æ•°æ®åŒ…çš„å¤§å°ä¸º100Byte</li><li>ç”±äºtracerouteæ˜¯åˆ©ç”¨ICMPè¿æ¥çš„ï¼Œæœ‰äº›ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚é˜²ç«å¢™ï¼‰å¯èƒ½ä¼šå±è”½ICMPé€šè¿‡çš„æƒé™ï¼Œå› æ­¤ä¹Ÿä¼šå‡ºç°èŠ‚ç‚¹æ²¡æœ‰å›åº”çš„çŠ¶æ€</li></ul></li><li>mtr<ul><li><code>mtr www.baidu.com</code></li></ul></li></ul><h3 id="ç»¼åˆå·¥å…·"><a href="#ç»¼åˆå·¥å…·" class="headerlink" title="ç»¼åˆå·¥å…·"></a>ç»¼åˆå·¥å…·</h3><ul><li>htop</li></ul><h2 id="åˆ†ææ€§èƒ½ç“¶é¢ˆ"><a href="#åˆ†ææ€§èƒ½ç“¶é¢ˆ" class="headerlink" title="åˆ†ææ€§èƒ½ç“¶é¢ˆ"></a>åˆ†ææ€§èƒ½ç“¶é¢ˆ</h2><p>å‡ºç°CPUç“¶é¢ˆæœ‰ä¸¤ç§åŸå› ï¼šä¸€ç§æ˜¯åº”ç”¨ç¨‹åºbugå¯¼è‡´CPUèµ„æºè€—å°½ï¼›å¦ä¸€ç§æ˜¯CPUèµ„æºç¡®å®ä¸è¶³ã€‚å®é™…åº”ç”¨ä¸­ï¼Œç¬¬ä¸€ç§æƒ…å†µæ›´å¸¸è§ï¼Œæ­¤æ—¶éœ€è¦ä»åº”ç”¨ç¨‹åºè§’åº¦æ¥æ’æŸ¥é—®é¢˜ã€‚è€Œå¦‚æœå‡ºç°çš„æ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œå°±è¦è€ƒè™‘å¢åŠ CPUèµ„æºäº†ã€‚</p><p>é€šè¿‡å†…å­˜ç›‘æ§å·¥å…·freeã€topã€smemç­‰è·å–å†…å­˜æŒ‡æ ‡ã€‚å¦‚æœå‘ç°å¯ç”¨å†…å­˜ï¼ˆavailableï¼‰æŒç»­å‡å°‘ï¼Œç³»ç»Ÿè¿›ç¨‹ä¸­kswapdè¿›ç¨‹é¢‘ç¹å‡ºç°ï¼ŒåŒæ—¶Swapäº¤æ¢ç©ºé—´å ç”¨ç‡æŒç»­å¢é«˜ï¼Œé‚£ä¹ˆåŸºæœ¬å¯ä»¥åˆ¤æ–­æ˜¯ç³»ç»Ÿå†…å­˜èµ„æºä¸è¶³äº†</p><p>é€šè¿‡ç£ç›˜I&#x2F;Oç›‘æ§å‘½ä»¤ï¼Œå¦‚iostatã€iotopç­‰ï¼Œå‘ç°%iowaitæŒç»­è¶…è¿‡80%ï¼Œå¹¶ä¸”CPUçš„I&#x2F;Oç­‰å¾…ä¹Ÿéå¸¸é«˜ã€‚åº”ç”¨ç³»ç»Ÿè¯»ã€å†™æ“ä½œå“åº”æ—¶é—´å¾ˆé•¿ï¼Œæˆ–ç½‘ç»œåˆ©ç”¨ç‡ï¼ˆç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼‰éå¸¸ä½ã€‚ç£ç›˜è¯·æ±‚é˜Ÿåˆ—ï¼ˆ&#x2F;sys&#x2F;block&#x2F;sda&#x2F;queue&#x2F;nr_requestsï¼‰å˜æ»¡ï¼Œå¤„ç†è¯·æ±‚æ—¶é—´å˜é•¿</p><p>ç½‘ç»œç“¶é¢ˆè¡¨ç°å¾—æ¯”è¾ƒç›´æ¥ï¼Œä¾‹å¦‚ï¼Œè¿æ¥æœåŠ¡å™¨å˜æ…¢ï¼Œä½†æœåŠ¡å™¨æ­£å¸¸ï¼Œå¤§éƒ¨åˆ†è¿æ¥è¯·æ±‚è¶…æ—¶ï¼Œç½‘ç»œä¼ è¾“å¸¦å®½ä¸Šä¸å»ç­‰ï¼ŒæœåŠ¡å™¨çš„CPUã€å†…å­˜ã€ç£ç›˜I&#x2F;Oéƒ½è¡¨ç°æ­£å¸¸ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿä¸Šé¢çš„ä¸šåŠ¡ç³»ç»Ÿè®¿é—®å´å¾ˆç¼“æ…¢ï¼Œè¿™éƒ½æ˜¯å…¸å‹çš„ç½‘ç»œå¸¦å®½ç“¶é¢ˆ</p><h2 id="è°ƒä¼˜"><a href="#è°ƒä¼˜" class="headerlink" title="è°ƒä¼˜"></a>è°ƒä¼˜</h2><h3 id="ç³»ç»Ÿå®‰è£…å’Œåˆ†åŒºä¼˜åŒ–"><a href="#ç³»ç»Ÿå®‰è£…å’Œåˆ†åŒºä¼˜åŒ–" class="headerlink" title="ç³»ç»Ÿå®‰è£…å’Œåˆ†åŒºä¼˜åŒ–"></a>ç³»ç»Ÿå®‰è£…å’Œåˆ†åŒºä¼˜åŒ–</h3><ol><li><p>ç£ç›˜ä¸RAID</p><p> å®é™…åº”ç”¨é¢†åŸŸä¸­ä½¿ç”¨æœ€å¤šçš„RAIDç­‰çº§æ˜¯RAID0ã€RAID1ã€RAID5ã€RAID10</p><table><thead><tr><th>çº§åˆ«</th><th>è¯»å†™æ€§èƒ½</th><th>å®‰å…¨æ€§</th><th>ç£ç›˜åˆ©ç”¨ç‡</th><th>æˆæœ¬</th><th>åœºæ™¯</th></tr></thead><tbody><tr><td>RAID0</td><td>æœ€å¥½</td><td>æœ€å·®</td><td>æœ€é«˜</td><td>æœ€ä½</td><td>å¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜ï¼Œå¤§æ–‡ä»¶å†™çš„ç³»ç»Ÿ</td></tr><tr><td>RAID1</td><td>è¯»å’Œå•ä¸ªç£ç›˜æ— åˆ†åˆ«ï¼Œå†™åˆ™åŒæ—¶å†™</td><td>æœ€é«˜</td><td>ä½ 50%</td><td>è¾ƒé«˜</td><td>é€‚ç”¨å­˜æ”¾é‡è¦æ•°æ®ï¼Œå¦‚æ•°æ®åº“ç±»åº”ç”¨</td></tr><tr><td>RAID5</td><td>è¯»ï¼šraid5&#x3D;raid0<br>å†™ï¼šraid5å°äºå•ä¸ªç£ç›˜å†™</td><td>raid5&lt;raid1</td><td>raid5&gt;raid1</td><td>ä¸­ç­‰</td><td>å­˜å‚¨æ€§èƒ½ã€å®‰å…¨æ€§ã€æˆæœ¬å…¼é¡¾</td></tr><tr><td>RAID10</td><td>è¯»ï¼šraid10&#x3D;raid0<br>å†™ï¼šraid10&#x3D;raid1</td><td>raid10&#x3D;raid1</td><td>raid10&#x3D;raid1 50%</td><td>è¾ƒé«˜</td><td>é›†åˆäº†raid1å’Œraid0çš„ä¼˜ç‚¹ï¼Œä½†ç£ç›˜åˆ©ç”¨ç‡50%</td></tr></tbody></table><p> éƒ¨ç½²çº¿ä¸ŠæœåŠ¡å™¨çš„æ—¶å€™ï¼Œæœ€å¥½é…ç½®ä¸¤ç»„RAIDï¼Œä¸€ç»„æ˜¯ç³»ç»Ÿç›˜RAIDï¼Œå¯¹ç³»ç»Ÿç›˜ï¼ˆå®‰è£…æ“ä½œç³»ç»Ÿçš„ç£ç›˜ï¼‰æ¨èé…ç½®ä¸ºRAID1ï¼Œå¦ä¸€ç»„æ˜¯æ•°æ®ç›˜RAIDï¼Œå¯¹æ•°æ®ç›˜ï¼ˆå­˜æ”¾åº”ç”¨ç¨‹åºã€å„ç§æ•°æ®ï¼‰æ¨èé‡‡ç”¨RAID1ã€RAID5æˆ–è€…RAID10</p></li><li><p>ç³»ç»Ÿç‰ˆæœ¬é€‰æ‹©</p><p> æ¨ècentoså‘å‹ç‰ˆæœ¬</p></li><li><p>åˆ†åŒºä¸swap</p><p> ç³»ç»Ÿåˆ†åŒº raid1</p><p> æ•°æ®åˆ†åŒº raid1 raid5</p><p> é»˜è®¤å®‰è£…ä¼šä½¿ç”¨LVMï¼ˆé€»è¾‘å·ç®¡ç†ï¼‰è¿›è¡Œåˆ†åŒºç®¡ç†ã€‚ä½œä¸ºçº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œå¼ºçƒˆä¸æ¨èä½¿ç”¨LVMï¼Œå› ä¸ºLVMçš„åŠ¨æ€æ‰©å®¹åŠŸèƒ½ï¼Œå¯¹ç°åœ¨å¤§ç¡¬ç›˜æ—¶ä»£æ¥è¯´ï¼ŒåŸºæœ¬æ²¡ä»€ä¹ˆç”¨å¤„äº†ã€‚</p><p> ä¸€èˆ¬å¯ä»¥ä¸€æ¬¡æ€§è§„åˆ’å¥½ç¡¬ç›˜çš„æœ€å¤§ä½¿ç”¨ç©ºé—´ï¼Œç›¸åï¼Œä½¿ç”¨LVMå¸¦æ¥çš„è´Ÿé¢å½±å“æ›´å¤§ï¼Œé¦–å…ˆï¼Œå®ƒå½±å“ç£ç›˜è¯»å†™æ€§èƒ½ï¼Œå…¶æ¬¡ï¼Œå®ƒä¸ä¾¿äºåæœŸçš„è¿ç»´ã€‚å› ä¸ºLVMçš„ç£ç›˜åˆ†åŒºä¸€æ—¦æ•…éšœï¼Œæ•°æ®åŸºæœ¬æ— æ³•æ¢å¤ã€‚</p><p> swap å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢å†…å­˜ä¸å¤Ÿæ—¶è§¦å‘oomï¼Œè™½ç„¶æŸäº›ä¸šåŠ¡ç³»ç»Ÿï¼Œå¦‚redisã€elasticsearchå¯èƒ½ä½¿ç”¨swapä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®&#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappinessï¼Œè°ƒæ•´swapä½¿ç”¨æ¦‚ç‡</p><p> ç‰©ç†å†…å­˜åœ¨16GBä»¥ä¸‹çš„ï¼ŒSwapè®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„2å€å³å¯ï¼›è€Œç‰©ç†å†…å­˜å¤§äº16GBçš„è¯ï¼Œä¸€èˆ¬æ¨èswapè®¾ç½®8GBå·¦å³å³å¯ã€‚</p><blockquote><p>ä½†åœ¨å·¥ä½œä¸­å¤§éƒ¨åˆ†è§åˆ°çš„æ˜¯ä½¿ç”¨lvmï¼Œä»¥åŠå»æ‰swapã€‚</p></blockquote></li></ol><h3 id="ç³»ç»Ÿèµ„æºå‚æ•°ä¼˜åŒ–"><a href="#ç³»ç»Ÿèµ„æºå‚æ•°ä¼˜åŒ–" class="headerlink" title="ç³»ç»Ÿèµ„æºå‚æ•°ä¼˜åŒ–"></a>ç³»ç»Ÿèµ„æºå‚æ•°ä¼˜åŒ–</h3><p>ulimit -aå¯ä»¥çœ‹åˆ°æ‰€æœ‰ç³»ç»Ÿèµ„æºå‚æ•°ï¼Œè¿™é‡Œé¢éœ€è¦é‡ç‚¹è®¾ç½®çš„æ˜¯open fileså’Œmax user processes</p><hr><p>å†å²å‘½ä»¤è®°å½•ï¼Œå°†ä»£ç åŠ å…¥åˆ°&#x2F;etc&#x2F;profileä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#history</span><br>USER_IP=`<span class="hljs-built_in">who</span> -u am i 2&gt;/dev/null| awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span> | sed -e <span class="hljs-string">&#x27;s/[()]//g&#x27;</span><br>HISTDIR=/usr/share/.history<br><span class="hljs-keyword">if</span> [ -z ÅUSER IP ]<br><span class="hljs-keyword">then</span><br>USER IP=`hostname<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ ! -d SHISTDIR ]<br><span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HISTDIR</span><br><span class="hljs-built_in">chmod</span> 777 <span class="hljs-variable">$HISTDIR</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$HISTDIR</span>/<span class="hljs-variable">$&#123;LOGNAME&#125;</span> ]<br><span class="hljs-keyword">then</span><br><span class="hljs-built_in">mkdir</span> -p SHISTDIR/<span class="hljs-variable">$&#123;LOGNAME&#125;</span><br><span class="hljs-built_in">chmod</span> 300 SHISTDIR/<span class="hljs-variable">$&#123;LOGNAME&#125;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">export</span> HISTSIZE=4000<br>DT=`<span class="hljs-built_in">date</span> +%Y%m%d_%H%M%S`<br><span class="hljs-built_in">export</span> HISTFILE=<span class="hljs-string">&quot;<span class="hljs-variable">$HISTDIR</span>/<span class="hljs-variable">$&#123;LOGNAME&#125;</span>/<span class="hljs-variable">$&#123;USER_IP&#125;</span>.history.<span class="hljs-variable">$DT</span>&quot;</span><br><span class="hljs-built_in">export</span> HISTTIMEFORMAT=<span class="hljs-string">&quot;[%Y.%m.%d %H:%M:%S]&quot;</span><br><span class="hljs-built_in">chmod</span> 600 <span class="hljs-variable">$HISTDIR</span>/<span class="hljs-variable">$&#123;LOGNAME&#125;</span>/*.<span class="hljs-built_in">history</span>* 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p>å°†æ¯ä¸ªç”¨æˆ·çš„shellå‘½ä»¤æ‰§è¡Œå†å²ä»¥æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨&#x2F;usr&#x2F;share&#x2F;.historyç›®å½•ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸ªæ–‡ä»¶ä»¥IPåœ°å€åŠ shellå‘½ä»¤æ“ä½œæ—¶é—´çš„æ ¼å¼å‘½å</p><hr><h3 id="å†…æ ¸å‚æ•°è°ƒä¼˜"><a href="#å†…æ ¸å‚æ•°è°ƒä¼˜" class="headerlink" title="å†…æ ¸å‚æ•°è°ƒä¼˜"></a>å†…æ ¸å‚æ•°è°ƒä¼˜</h3><p>Linuxæä¾›äº†&#x2F;procè¿™æ ·ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡å®ƒåœ¨Linuxå†…æ ¸ç©ºé—´å’Œç”¨æˆ·é—´ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚åœ¨&#x2F;procæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å°†å¯¹è™šæ‹Ÿæ–‡ä»¶çš„è¯»å†™ä½œä¸ºä¸å†…æ ¸ä¸­å®ä½“è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ‰‹æ®µï¼Œä½†æ˜¯ä¸æ™®é€šæ–‡ä»¶ä¸åŒçš„æ˜¯ï¼Œè¿™äº›è™šæ‹Ÿæ–‡ä»¶çš„å†…å®¹éƒ½æ˜¯åŠ¨æ€åˆ›å»ºçš„ã€‚è¿™äº›æ–‡ä»¶è™½ç„¶ä½¿ç”¨æŸ¥çœ‹å‘½ä»¤æŸ¥çœ‹æ—¶ä¼šè¿”å›å¤§é‡ä¿¡æ¯ï¼Œä½†æ–‡ä»¶æœ¬èº«çš„å¤§å°å´æ˜¾ç¤ºä¸º0å­—èŠ‚ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯é©»ç•™åœ¨å†…å­˜ä¸­çš„æ–‡ä»¶</p><ul><li>&#x2F;proc&#x2F;sys&#x2F;netæ˜¯è·Ÿç½‘ç»œç›¸å…³çš„å†…æ ¸å‚æ•°ã€‚</li><li>&#x2F;proc&#x2F;sys&#x2F;kernelæ˜¯è·Ÿå†…æ ¸ç›¸å…³çš„å†…æ ¸å‚æ•°ã€‚</li><li>&#x2F;proc&#x2F;sys&#x2F;vmæ˜¯è·Ÿå†…å­˜ç›¸å…³çš„å†…æ ¸å‚æ•°ã€‚</li><li>&#x2F;proc&#x2F;sys&#x2F;fsæ˜¯è·Ÿæ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„å†…æ ¸å‚æ•°ã€‚</li></ul><p>å¼€å¯Linuxä»£ç†è½¬å‘åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å†…æ ¸å‚æ•°ip_forwardå¯¹åº”åœ¨&#x2F;procä¸‹çš„æ–‡ä»¶&#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹</span><br><span class="hljs-built_in">cat</span> /proc/sys/net/ipv4/ip_forward<br><span class="hljs-comment"># ä¿®æ”¹</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/ip_forward<br></code></pre></td></tr></table></figure><p>echoå‘½ä»¤ä¸èƒ½æ£€æŸ¥å‚æ•°çš„ä¸€è‡´æ€§ï¼›å…¶æ¬¡ï¼Œechoæ–¹å¼ä¿®æ”¹çš„å†…æ ¸å‚æ•°åœ¨é‡å¯ç³»ç»Ÿä¹‹åï¼Œæ‰€æœ‰çš„å†…æ ¸ä¿®æ”¹éƒ½ä¼šä¸¢å¤±</p><p>ä½¿ç”¨ sysctlä¿®æ”¹å†…æ ¸å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹</span><br>sysctl kernel.msgmnb<br>sysctl net.ipv4.tcp_syn_retries<br><span class="hljs-comment"># å†™å…¥ï¼Œä½†æ˜¯é‡å¯åä¹Ÿä¼šå¤±æ•ˆ</span><br>sysctl -w kernel.msgmnb=40960<br></code></pre></td></tr></table></figure><p>æ°¸ä¹…ä¿®æ”¹ç¼–è¾‘sysctl.confæ–‡ä»¶ï¼Œæ·»åŠ <code>sysctl kernel.msgmnb=40960</code>ï¼Œç„¶å <code>sysctl -p</code> ç«‹å³ç”Ÿæ•ˆé…ç½®</p><h3 id="ç½‘ç»œå†…æ ¸å‚æ•°ä¼˜åŒ–"><a href="#ç½‘ç»œå†…æ ¸å‚æ•°ä¼˜åŒ–" class="headerlink" title="ç½‘ç»œå†…æ ¸å‚æ•°ä¼˜åŒ–"></a>ç½‘ç»œå†…æ ¸å‚æ•°ä¼˜åŒ–</h3><ul><li><p><code>/proc/sys/net/ipv4/tcp_syn_retries</code></p><ul><li>è¡¨ç¤ºå¯¹äºä¸€ä¸ªæ–°å»ºè¿æ¥ï¼Œå†…æ ¸è¦å‘é€å¤šå°‘ä¸ªSYNè¿æ¥è¯·æ±‚æ‰å†³å®šæ”¾å¼ƒ</li><li>é»˜è®¤å€¼æ˜¯5ï¼Œå»ºè®®è®¾ç½®ä¸º2</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_keepalive_time</code></p><ul><li>è¡¨ç¤ºå½“keepaliveå¯ç”¨çš„æ—¶å€™ï¼ŒTCPå‘é€keepaliveæ¶ˆæ¯çš„é¢‘åº¦</li><li>é»˜è®¤å€¼æ˜¯7200sï¼Œå»ºè®®ä¿®æ”¹ä¸º300s</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_orphan_retries</code></p><ul><li>å‚æ•°è¡¨ç¤ºå­¤å„¿SocketåºŸå¼ƒå‰é‡è¯•çš„æ¬¡æ•°ï¼Œé‡è´Ÿè½½WebæœåŠ¡å™¨å»ºè®®è°ƒå°</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_syncookies</code></p><ul><li>è¡¨ç¤ºå¼€å¯SYN Cookiesã€‚å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œå¯ç”¨Cookiesæ¥å¤„ç†ï¼Œå¯é˜²èŒƒå°‘é‡SYNæ”»å‡»</li><li>é»˜è®¤å€¼æ˜¯0</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code></p><ul><li>è¡¨ç¤ºè®¾ç½®SYNé˜Ÿåˆ—æœ€å¤§é•¿åº¦</li><li>é»˜è®¤å€¼ä¸º1024ï¼ŒåŠ å¤§é˜Ÿåˆ—é•¿åº¦ä¸º8192ï¼Œå¯ä»¥å®¹çº³æ›´å¤šç­‰å¾…è¿æ¥çš„ç½‘ç»œè¿æ¥æ•°</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_synack_retries</code></p><ul><li>ç”¨æ¥é™ä½æœåŠ¡å™¨SYN+ACKæŠ¥æ–‡é‡è¯•æ¬¡æ•°ï¼Œå°½å¿«é‡Šæ”¾ç­‰å¾…èµ„æº</li><li>é»˜è®¤æ˜¯5æ¬¡</li><li>æ­¤å‚æ•°æ˜¯å†³å®šå†…æ ¸åœ¨æ”¾å¼ƒè¿æ¥ä¹‹å‰æ‰€é€å‡ºçš„SYN+ACKçš„æ•°ç›®</li></ul><blockquote><p>é’ˆå¯¹SYNæ”»å‡»ï¼Œå¯ä»¥å¯ç”¨SYN Cookieã€è®¾ç½®SYNé˜Ÿåˆ—æœ€å¤§é•¿åº¦ä»¥åŠè®¾ç½®SYN+ACKæœ€å¤§é‡è¯•æ¬¡æ•°ã€‚è®¾ç½®tcp_syncookiesä¸º1å°±æ˜¯å¯ç”¨äº†SYN Cookie</p></blockquote></li><li><p><code>/proc/sys/net/ipv4/tcp_tw_recycle</code></p><ul><li>è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶</li><li>é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºå…³é—­</li><li>æ™®é€šWebæœåŠ¡å™¨å»ºè®®è®¾ç½®ä¸º<code>echo 1&gt;/proc/sys/net/ipv4/tcp_tw_recycle</code></li></ul><blockquote><p>ä» Linux å†…æ ¸ 4.12 å¼€å§‹ï¼Œtcp_tw_recycle å‚æ•°å·²ç»è¢«å½»åº•ç§»é™¤</p><p>æŸ¥çœ‹TIME-WAITæ•°é‡<br>netstat -nat | awk â€˜{print $6}â€™ | sort | uniq -c | sort -rn</p></blockquote></li><li><p><code>/proc/sys/net/ipv4/tcp_tw_reuse</code></p><ul><li>è¡¨ç¤ºå¼€å¯é‡ç”¨ï¼Œå…è®¸å°†TIME-WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥</li><li>æ­¤å€¼é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºå…³é—­ï¼›å¯ç”¨è¯¥resuseçš„åŒæ—¶ï¼Œå¿…é¡»åŒæ—¶å¯ç”¨å¿«é€Ÿå›æ”¶recycleï¼ˆå³tcp_tw_recycleä¸º1ï¼‰â€‹ã€‚</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_fin_timeout</code></p><ul><li>è¡¨ç¤ºå¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥åœ¨å›æ”¶å‰å¿…é¡»ç­‰å¾…çš„æœ€å°æ—¶é—´</li><li>æ™®é€šwebæœåŠ¡å™¨å»ºè®®è®¾ç½®ä¸º15ç§’</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_keepalive_probes</code></p><ul><li>ç”¨æ¥å‡å°‘è¶…æ—¶å‰çš„æ¢æµ‹æ¬¡æ•°ï¼Œæ™®é€šWebæœåŠ¡å™¨å»ºè®®è®¾ç½®ä¸º 5</li></ul></li><li><p><code>/proc/sys/net/core/netdev_max_backlog</code></p><ul><li>ç”¨æ¥è®¾ç½®æ¯ä¸ªç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿç‡æ¯”å†…æ ¸å¤„ç†è¿™äº›åŒ…çš„é€Ÿç‡å¿«æ—¶ï¼Œå…è®¸é€åˆ°é˜Ÿåˆ—çš„æ•°æ®åŒ…çš„æœ€å¤§æ•°ç›®</li><li>é»˜è®¤å€¼1000ï¼Œå»ºè®®3000</li></ul></li><li><p><code>/proc/sys/net/core/rmem_maxã€wmem_max</code></p><ul><li>å¯ä»¥æé«˜TCPçš„æœ€å¤§ç¼“å†²åŒºå¤§å°ã€‚</li><li>rmem_maxï¼šè¡¨ç¤ºæ¥æ”¶å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„æœ€å¤§å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰â€‹ã€‚</li><li>wmem_maxï¼šè¡¨ç¤ºå‘é€å¥—æ¥å­—ç¼“å†²åŒºå¤§å°çš„æœ€å¤§å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰â€‹ã€‚</li><li>å»ºè®®è®¾ç½®16777216</li></ul></li><li><p><code>/proc/sys/net/ipv4/tcp_rmemã€tcp_wmem</code></p><ul><li>å¯ä»¥æé«˜Linuxå†…æ ¸è‡ªåŠ¨å¯¹Socketç¼“å†²åŒºè¿›è¡Œä¼˜åŒ–çš„èƒ½åŠ›</li><li>tcp_rmemï¼šç”¨æ¥é…ç½®è¯»ç¼“å†²çš„å¤§å°ï¼Œç¬¬1ä¸ªå€¼ä¸ºæœ€å°å€¼ï¼Œç¬¬2ä¸ªå€¼ä¸ºé»˜è®¤å€¼ï¼Œç¬¬3ä¸ªå€¼ä¸ºæœ€å¤§å€¼</li><li>tcp_wmemï¼šç”¨æ¥é…ç½®å†™ç¼“å†²çš„å¤§å°ï¼Œç¬¬1ä¸ªå€¼ä¸ºæœ€å°å€¼ï¼Œç¬¬2ä¸ªå€¼ä¸ºé»˜è®¤å€¼ï¼Œç¬¬3ä¸ªå€¼ä¸ºæœ€å¤§å€¼</li><li>å¦‚ï¼š<code>echo &quot;4096 87380 16777216&quot; &gt; /proc/sys/net/ipv4/tcp_rmem</code></li></ul></li><li><p><code>/proc/sys/net/core/somaxconn</code></p><ul><li>å‚æ•°ç”¨æ¥è®¾ç½®Socketç›‘å¬ï¼ˆlistenï¼‰çš„backlogä¸Šé™</li><li>backlogå°±æ˜¯Socketçš„ç›‘å¬é˜Ÿåˆ—ï¼Œå½“ä¸€ä¸ªè¯·æ±‚ï¼ˆrequestï¼‰å°šæœªè¢«å¤„ç†æˆ–å»ºç«‹æ—¶ï¼Œå®ƒä¼šè¿›å…¥backlogã€‚è€ŒSocket serverå¯ä»¥ä¸€æ¬¡æ€§å¤„ç†backlogä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¤„ç†åçš„è¯·æ±‚ä¸å†ä½äºç›‘å¬é˜Ÿåˆ—ä¸­ã€‚å½“Serverå¤„ç†è¯·æ±‚è¾ƒæ…¢ï¼Œä»¥è‡³äºç›‘å¬é˜Ÿåˆ—è¢«å¡«æ»¡åï¼Œæ–°æ¥çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ã€‚</li><li>é»˜è®¤å€¼ä¸º128, å»ºè®®4096</li></ul></li></ul><h3 id="ç³»ç»ŸKernelå‚æ•°ä¼˜åŒ–"><a href="#ç³»ç»ŸKernelå‚æ•°ä¼˜åŒ–" class="headerlink" title="ç³»ç»ŸKernelå‚æ•°ä¼˜åŒ–"></a>ç³»ç»ŸKernelå‚æ•°ä¼˜åŒ–</h3><ul><li><code>/proc/sys/kernel/panic</code><ul><li>è®¾ç½®å¦‚æœå‘ç”Ÿå†…æ ¸ä¸¥é‡é”™è¯¯ï¼Œåˆ™å†…æ ¸åœ¨é‡æ–°å¼•å¯¼ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½s</li><li>é»˜è®¤ä¸º0ï¼Œ è¡¨ç¤ºåœ¨å‘ç”Ÿå†…æ ¸ä¸¥é‡é”™è¯¯æ—¶ç¦æ­¢é‡æ–°å¼•å¯¼</li><li>å»ºè®®ä¸º1ï¼Œä¹Ÿå°±æ˜¯å†…æ ¸æ•…éšœå1sè‡ªåŠ¨é‡å¯</li></ul></li><li><code>/proc/sys/kernel/pid_max</code><ul><li>å‚æ•°ç”¨æ¥è®¾ç½®Linuxä¸‹è¿›ç¨‹æ•°é‡çš„æœ€å¤§å€¼ã€‚</li><li>é»˜è®¤å€¼æ˜¯32768ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯å¤Ÿç”¨çš„ï¼Œå½“ä»»åŠ¡é‡æ—¶ï¼Œä¼šä¸å¤Ÿç”¨ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜æ— æ³•åˆ†é…çš„é”™è¯¯</li></ul></li><li><code>/proc/sys/kernel/ctrl-alt-del</code><ul><li>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;ctrl-alt-delæ–‡ä»¶æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶å€¼ï¼Œè¯¥å€¼æ§åˆ¶ç³»ç»Ÿåœ¨æ¥æ”¶åˆ°ã€ˆCtrl+Alt+Deleteã€‰ç»„åˆé”®æ—¶å¦‚ä½•ååº”</li><li>0å€¼ï¼Œè¡¨ç¤ºæ•è·ã€ˆCtrl+Alt+Deleteã€‰ï¼Œå¹¶å°†å…¶é€è‡³initç¨‹åºã€‚è¿™å°†å…è®¸ç³»ç»Ÿå¯ä»¥å®‰å…¨åœ°å…³é—­å’Œé‡å¯ï¼Œå°±å¥½åƒè¾“å…¥shutdownå‘½ä»¤ä¸€æ ·</li><li>1å€¼ï¼Œè¡¨ç¤ºä¸æ•è·ã€ˆCtrl+Alt+Deleteã€‰</li></ul></li><li><code>/proc/sys/kernel/core_pattern</code><ul><li>å‚æ•°ç”¨æ¥è®¾ç½®coreæ–‡ä»¶ä¿å­˜ä½ç½®æˆ–æ–‡ä»¶åï¼Œåªæœ‰æ–‡ä»¶åæ—¶ï¼Œåˆ™ä¿å­˜åœ¨åº”ç”¨ç¨‹åºè¿è¡Œçš„ç›®å½•ä¸‹</li><li><code>echo &quot;core.%e.%p&quot; &gt; /proc/sys/kernel/core_pattern</code></li><li>%eè¡¨ç¤ºç¨‹åºåï¼Œ%pè¡¨ç¤ºè¿›ç¨‹idã€‚</li></ul></li></ul><h3 id="å†…å­˜å†…æ ¸å‚æ•°"><a href="#å†…å­˜å†…æ ¸å‚æ•°" class="headerlink" title="å†…å­˜å†…æ ¸å‚æ•°"></a>å†…å­˜å†…æ ¸å‚æ•°</h3><h3 id="æ–‡ä»¶ç³»ç»Ÿå†…æ ¸å‚æ•°"><a href="#æ–‡ä»¶ç³»ç»Ÿå†…æ ¸å‚æ•°" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿå†…æ ¸å‚æ•°"></a>æ–‡ä»¶ç³»ç»Ÿå†…æ ¸å‚æ•°</h3><p>ä¼˜åŒ–å‚è€ƒé…ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">net.ipv4.tcp_fin_timeout</span> = <span class="hljs-number">10</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_time</span> = <span class="hljs-number">120</span><br><span class="hljs-attr">net.ipv4.ip_local_port_range</span> = <span class="hljs-number">1024</span> <span class="hljs-number">65535</span><br><span class="hljs-attr">net.ipv4.tcp_max_tw_buckets</span> = <span class="hljs-number">80000</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_time</span> = <span class="hljs-number">120</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_intvl</span> = <span class="hljs-number">15</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_probes</span> = <span class="hljs-number">5</span><br><br><span class="hljs-attr">net.ipv4.conf.lo.arp_ignore</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">net.ipv4.conf.lo.arp_announce</span> = <span class="hljs-number">2</span><br><span class="hljs-attr">net.ipv4.conf.all.arp_ignore</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">net.ipv4.conf.all.arp_announce</span> = <span class="hljs-number">2</span><br><br><span class="hljs-attr">net.ipv4.tcp_tw_reuse</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">net.ipv4.tcp_tw_recycle</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">net.ipv4.tcp_fin_timeout</span> = <span class="hljs-number">10</span><br><br><span class="hljs-attr">net.ipv4.tcp_max_syn_backlog</span> = <span class="hljs-number">20000</span><br><span class="hljs-attr">net.core.netdev_max_backlog</span> = <span class="hljs-number">32768</span><br><span class="hljs-attr">net.core.somaxconn</span> = <span class="hljs-number">32768</span><br><br><span class="hljs-attr">net.core.wmem_default</span> = <span class="hljs-number">8388608</span><br><span class="hljs-attr">net.core.rmem_default</span> = <span class="hljs-number">8388608</span><br><span class="hljs-attr">net.core.rmem_max</span> = <span class="hljs-number">16777216</span><br><span class="hljs-attr">net.core.wmem_max</span> = <span class="hljs-number">16777216</span><br><br><span class="hljs-attr">net.ipv4.tcp_timestamps</span> = <span class="hljs-number">0</span><br><span class="hljs-attr">net.ipv4.tcp_synack_retries</span> = <span class="hljs-number">2</span><br><span class="hljs-attr">net.ipv4.tcp_syn_retries</span> = <span class="hljs-number">2</span><br><br><span class="hljs-attr">net.ipv4.tcp_mem</span> = <span class="hljs-number">94500000</span> <span class="hljs-number">915000000</span> <span class="hljs-number">927000000</span><br><span class="hljs-attr">net.ipv4.tcp_max_orphans</span> = <span class="hljs-number">3276800</span><br><br><span class="hljs-attr">net.ipv4.ip_local_port_range</span> = <span class="hljs-number">1024</span> <span class="hljs-number">65535</span><br><span class="hljs-attr">net.ipv4.tcp_max_tw_buckets</span> = <span class="hljs-number">5000000</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_time</span> = <span class="hljs-number">60</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_intvl</span> = <span class="hljs-number">15</span><br><span class="hljs-attr">net.ipv4.tcp_keepalive_probes</span> = <span class="hljs-number">5</span><br><span class="hljs-attr">net.nf_conntrack_max</span> = <span class="hljs-number">2097152</span><br></code></pre></td></tr></table></figure><h4 id="å›æ”¶Cache"><a href="#å›æ”¶Cache" class="headerlink" title="å›æ”¶Cache"></a>å›æ”¶Cache</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é‡Šæ”¾å‰éœ€è¦ä½¿ç”¨syncå°†æœªå†™çš„ç³»ç»Ÿç¼“å†²åŒºå†™åˆ°ç£ç›˜ä¸­</span><br><br><span class="hljs-comment"># å›æ”¶page cache</span><br><span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/vm/drop_caches<br><span class="hljs-comment"># é‡Šæ”¾æ–‡ä»¶èŠ‚ç‚¹inodesç¼“å­˜å’Œç›®å½•é¡¹ç¼“å­˜</span><br><span class="hljs-built_in">echo</span> 2 &gt; /proc/sys/vm/drop_caches<br><span class="hljs-comment"># é‡Šæ”¾Page Cacheã€æ–‡ä»¶èŠ‚ç‚¹inodesç¼“å­˜å’Œç›®å½•é¡¹ç¼“å­˜</span><br><span class="hljs-built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç»Ÿè®¡æ‰€æœ‰ç”¨æˆ·åˆ›å»ºçš„è¿›ç¨‹æ•°</span><br><br>ps h -Led -o user | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -rn<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix é…ç½®é‚®ä»¶å‘Šè­¦</title>
    <link href="/2025/04/23/zabbix-alter-by-email/"/>
    <url>/2025/04/23/zabbix-alter-by-email/</url>
    
    <content type="html"><![CDATA[<blockquote><p>zabbix ç‰ˆæœ¬6.4.21</p><p>ä»¥ç›‘æ§æ¸©åº¦ä¸ºä¾‹</p></blockquote><h2 id="é…ç½®ç›‘æ§é¡¹"><a href="#é…ç½®ç›‘æ§é¡¹" class="headerlink" title="é…ç½®ç›‘æ§é¡¹"></a>é…ç½®ç›‘æ§é¡¹</h2><ol><li><p>åœ¨agentç«¯é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># /etc/zabbix/zabbix_agentd.conf</span><br><span class="hljs-attr">UserParameter</span>=get_temp_cpu[*],sensors|grep <span class="hljs-string">&quot;Package id $1&quot;</span>|cut -c <span class="hljs-number">17</span>-<span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><p> ä¿å­˜åé‡å¯zabbix-agent</p></li><li><p>åœ¨Webé¡µé¢æ·»åŠ ç›‘æ§é¡¹</p><p> æ•°æ®é‡‡é›† -&gt; ä¸»æœº -&gt; ç›‘æ§é¡¹ -&gt;  åˆ›å»ºç›‘æ§é¡¹</p><p> é”®å€¼å°±æ˜¯åœ¨agenté…ç½®æ–‡ä»¶ä¸­çš„get_temp_cpu</p><p> <img src="/../images/zabbix_alert/monitor_item.png" alt="monitor_item"></p></li></ol><h2 id="é…ç½®è§¦å‘å™¨"><a href="#é…ç½®è§¦å‘å™¨" class="headerlink" title="é…ç½®è§¦å‘å™¨"></a>é…ç½®è§¦å‘å™¨</h2><p>æ•°æ®é‡‡é›† -&gt; ä¸»æœº -&gt; è§¦å‘å™¨ -&gt;  åˆ›å»ºè§¦å‘å™¨</p><p><img src="/../images/zabbix_alert/trigger.png" alt="trigger"></p><p>è¡¨è¾¾å¼å¯ä»¥é€šè¿‡é¡µé¢ä¸­<strong>è¡¨è¾¾å¼æ„é€ å™¨</strong>æ¥ç”Ÿæˆ</p><p><img src="/../images/zabbix_alert/config_trigger.png" alt="trigger"></p><p>é€šè¿‡é¡µé¢é€‰æ‹©åä¼šè‡ªåŠ¨ç”Ÿæˆè¡¨è¾¾å¼ï¼Œç„¶åç‚¹å‡»æµ‹è¯•æŒ‰é’®ï¼Œæµ‹è¯•æ˜¯å¦èƒ½è§¦å‘</p><p><img src="/../images/zabbix_alert/config_trigger2.png" alt="trigger"></p><h2 id="é…ç½®é‚®ç®±å‘Šè­¦"><a href="#é…ç½®é‚®ç®±å‘Šè­¦" class="headerlink" title="é…ç½®é‚®ç®±å‘Šè­¦"></a>é…ç½®é‚®ç®±å‘Šè­¦</h2><h3 id="é…ç½®è§¦å‘å™¨åŠ¨ä½œ"><a href="#é…ç½®è§¦å‘å™¨åŠ¨ä½œ" class="headerlink" title="é…ç½®è§¦å‘å™¨åŠ¨ä½œ"></a>é…ç½®è§¦å‘å™¨åŠ¨ä½œ</h3><p>å‘Šè­¦ -&gt; åŠ¨ä½œ -&gt; è§¦å‘å™¨åŠ¨ä½œ -&gt; åˆ›å»ºåŠ¨ä½œ</p><p><img src="/../images/zabbix_alert/trigger_action.png" alt="trigger_action"></p><p>ç„¶åç‚¹å‡»æ“ä½œ</p><p>è¿™é‡Œæ“ä½œæ˜¯æŒ‡å‘Šè­¦æ—¶è¦åšçš„è¡Œä¸ºï¼Œæ¢å¤æ“ä½œæ˜¯æŒ‡é—®é¢˜æ¢å¤åçš„è¡Œä¸º</p><p>ç‚¹å‡»ç¼–è¾‘ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢</p><p>å…¶ä¸­æ­¥éª¤ <code>1-0</code> æ˜¯æŒ‡ä»å‘Šè­¦åˆ°æ¢å¤çš„è¿‡ç¨‹ï¼Œ æ­¥éª¤æŒç»­æ—¶é—´æ˜¯æŒ‡è¿™ä¸ªè¿‡ç¨‹ä¸­é—´éš”å¤šå°‘æ—¶é—´æ“ä½œä¸€æ¬¡ï¼Œæ¯”å¦‚1800ç§’å‘é€é‚®ä»¶ä¸€æ¬¡ã€‚</p><p>ä¸‹é¢å¯ä»¥è‡ªå®šä¹‰å‘é€çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ ¹æ®åª’ä»‹ä¸­é…ç½®çš„æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆï¼Œåª’ä»‹é…ç½®åœ¨åé¢ã€‚</p><p><img src="/../images/zabbix_alert/config_action.png" alt="trigger_action"></p><h3 id="é…ç½®åª’ä»‹"><a href="#é…ç½®åª’ä»‹" class="headerlink" title="é…ç½®åª’ä»‹"></a>é…ç½®åª’ä»‹</h3><p>å‘Šè­¦ -&gt; åª’ä»‹ -&gt; åˆ›å»ºåª’ä»‹ç±»å‹</p><p><img src="/../images/zabbix_alert/media.png" alt="media"></p><p>æ ¹æ®è‡ªå·±çš„é‚®ç®±è¿›è¡Œé…ç½®</p><p>ä¸€èˆ¬æœåŠ¡å™¨åœ°å€å’Œç«¯å£ä¼šåœ¨ä½ ä½¿ç”¨çš„é‚®ç®±è®¾ç½®ä¸­èƒ½çœ‹åˆ°</p><p>ç”¨æˆ·åç§°å³é‚®ç®±åœ°å€</p><p>é€šå¸¸éœ€è¦è‡ªå·±å»å¼€å¯é‚®ç®±çš„SMTPåŠŸèƒ½ï¼Œç„¶åç”Ÿæˆæˆæƒç ï¼Œå¡«å…¥ä¸‹é¢çš„å¯†ç ä¸­ã€‚</p><p><img src="/../images/zabbix_alert/config_media.png" alt="media"></p><p>åœ¨æ¶ˆæ¯æ¨¡æ¿ä¸­é…ç½®å¯¹åº”ç±»å‹çš„æ¶ˆæ¯æ¨¡æ¿ï¼Œæˆ‘è¿™é‡Œé…ç½®äº†ä¸¤ä¸ªï¼Œä¸€ä¸ªåœ¨å‘Šè­¦æ—¶å‘é€ï¼Œä¸€ä¸ªåœ¨å‘Šè­¦æ¢å¤æ—¶å‘é€é€šçŸ¥ã€‚</p><p>ç‚¹å‡»æ·»åŠ ä¼šè‡ªåŠ¨ç”Ÿæˆé€šç”¨æ¨¡æ¿ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„htmlè¯­æ³•çš„æ¢è¡Œï¼Œå¦‚æœå»æ‰htmlæ ‡ç­¾ï¼Œä¼šå¯¼è‡´é‚®ä»¶å†…å®¹æ˜¾ç¤ºæˆä¸€è¡Œã€‚</p><p><img src="/../images/zabbix_alert/message_model.png" alt="media"></p><p>å¦‚æœè§¦å‘å™¨æœ‰å¤šä¸ªå€¼å¯ä»¥é€šè¿‡å¦‚ä¸‹å½¢å¼è·å–</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>&#123;ITEM.NAME1&#125; = &#123;ITEM.VALUE1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>&#123;ITEM.NAME2&#125; = &#123;ITEM.VALUE2&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®ç”¨æˆ·"><a href="#é…ç½®ç”¨æˆ·" class="headerlink" title="é…ç½®ç”¨æˆ·"></a>é…ç½®ç”¨æˆ·</h3><p>å‘Šè­¦ -&gt; ç”¨æˆ·</p><p>è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨é»˜è®¤çš„Adminè¿›è¡Œé‚®ä»¶å‘é€</p><p><img src="/../images/zabbix_alert/config_user.png" alt="choose_user"></p><p>åœ¨æŠ¥è­¦åª’ä»‹ä¸­æ·»åŠ æ”¶ä»¶äººï¼Œå¡«å†™emailåœ°å€å³å¯</p><p><img src="/../images/zabbix_alert/config_email.png" alt="config_email"></p>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Stress Test Tools</title>
    <link href="/2025/04/08/stress-test-tool/"/>
    <url>/2025/04/08/stress-test-tool/</url>
    
    <content type="html"><![CDATA[<h2 id="æŸ¥çœ‹ç£ç›˜ç±»å‹"><a href="#æŸ¥çœ‹ç£ç›˜ç±»å‹" class="headerlink" title="æŸ¥çœ‹ç£ç›˜ç±»å‹"></a>æŸ¥çœ‹ç£ç›˜ç±»å‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1 HDD, 0 SSD</span><br><span class="hljs-built_in">cat</span> /sys/block/sdX/queue/rotational<br>lsblk -d -o name,rota,model<br></code></pre></td></tr></table></figure><h2 id="fio"><a href="#fio" class="headerlink" title="fio"></a>fio</h2><p>Linuxç£ç›˜IOæµ‹è¯•å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é¡ºåºè¯»å–</span><br>fio --name=seqread --filename=testfile --rw=<span class="hljs-built_in">read</span> --bs=1M --size=2G --numjobs=1 --iodepth=1 --runtime=60 --time_based --direct=1 --group_reporting<br><span class="hljs-comment"># é¡ºåºå†™å…¥</span><br>fio --name=seqwrite --filename=testfile --rw=write --bs=1M --size=2G --numjobs=1 --iodepth=1 --runtime=60 --direct=1 --time_based --group_reporting<br><br><span class="hljs-comment"># éšæœºè¯»å–</span><br>fio --name=randread --filename=testfile --rw=randread --bs=4k --size=2G --numjobs=4 --iodepth=16 --runtime=60 --direct=1 --time_based --group_reporting<br><span class="hljs-comment"># éšæœºå†™å…¥</span><br>fio --name=randwrite --filename=testfile --rw=randwrite --bs=4k --size=2G --numjobs=4 --iodepth=16 --runtime=60 --direct=1 --time_based --group_reporting<br><br><span class="hljs-comment"># é«˜å¹¶å‘éšæœºè¯»å†™</span><br>fio --name=randrw --filename=testfile --rw=randrw --rwmixread=70 --bs=4k --size=2G --numjobs=8 --iodepth=16 --direct=1 --runtime=60 --time_based --group_reporting<br></code></pre></td></tr></table></figure><p>â€“bs&#x3D;4kï¼šæ¯æ¬¡ I&#x2F;O 4KB</p><p>â€“rw&#x3D;ï¼šè¯»å†™æ¨¡å¼ï¼ˆreadã€writeã€randreadã€randwriteã€randrwï¼‰</p><p>â€“numjobs&#x3D;4ï¼šå¹¶å‘çº¿ç¨‹æ•°</p><p>â€“direct&#x3D;1ï¼šç»•è¿‡ç¼“å­˜ï¼Œç›´æ¥è®¿é—®è®¾å¤‡</p><p>â€“ioengine&#x3D;libaioï¼šä½¿ç”¨å¼‚æ­¥ I&#x2F;O å¼•æ“ æˆ–â€“ioengine&#x3D;io_uring ï¼ˆ5.1 å†…æ ¸ä»¥ä¸Šï¼‰æ›´èƒ½åæ˜ ssdç›˜çš„çœŸå®æ€§èƒ½</p><p>â€“runtime&#x3D;30sï¼šæµ‹è¯•æŒç»­ 30 ç§’</p><h2 id="DiskSpd"><a href="#DiskSpd" class="headerlink" title="DiskSpd"></a>DiskSpd</h2><p>Windowsçš„ç£ç›˜IOæµ‹è¯•å·¥å…·</p><p><a href="https://github.com/microsoft/diskspd">https://github.com/microsoft/diskspd</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">diskspd.exe -c64M -b64K -t1 -o32 -si64K -w50 -S D:\test<br></code></pre></td></tr></table></figure><h2 id="prime95"><a href="#prime95" class="headerlink" title="prime95"></a>prime95</h2><p>windows CPUæµ‹è¯•å·¥å…·</p><p><a href="https://prime95.net/download/">https://prime95.net/download/</a></p><h2 id="iperf3"><a href="#iperf3" class="headerlink" title="iperf3"></a>iperf3</h2><p>ç½‘ç»œæµ‹è¯•å·¥å…·ï¼Œlinuxå’Œwindowséƒ½å¯ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æœåŠ¡å™¨ç«¯</span><br>iperf3 -s<br><span class="hljs-comment"># è®¾ç½®ç›‘æ§æ—¶é—´é—´éš”ä¸º 10 ç§’ï¼Œç›‘æ§ç«¯å£ä¸º 5201</span><br>iperf3 -s -i 10 -p 5201<br><span class="hljs-comment"># å®¢æˆ·ç«¯</span><br>iperf3 -c <span class="hljs-variable">$IP</span> -R<br><span class="hljs-comment"># æŒ‡å®š-cæµ‹é€ŸæœåŠ¡å™¨IPï¼Œ-pæŒ‡å®šç«¯å£ä¸º5201ï¼Œ-tæµ‹é€Ÿæ—¶é—´5sï¼Œ-PæŒ‡å®šå‘é€è¿æ¥æ•°10ï¼Œ-Rè¡¨ç¤ºä¸‹è½½æµ‹é€Ÿ</span><br>iperf3 -c <span class="hljs-variable">$IP</span> -p 5201 -t 5 -P 10 -R<br><span class="hljs-comment"># æŒ‡å®š-cæµ‹é€ŸæœåŠ¡å™¨IPï¼Œ-tæµ‹é€Ÿæ—¶é—´20sï¼Œ-iæŒ‡å®šç›‘æ§æ—¶é—´é—´éš”ä¸º5s</span><br>iperf3 -c 43.248.136.69 -t 20 -i 5<br><span class="hljs-comment"># æŒ‡å®š-cæµ‹é€ŸæœåŠ¡å™¨IPï¼Œ-iæŒ‡å®šç›‘æ§æ—¶é—´é—´éš”ä¸º7sï¼Œ-næŒ‡å®šå‘é€æ•°æ®é‡ä¸º5G</span><br>iperf3 -c 43.248.136.69 -i 7 -n 5G<br><span class="hljs-comment"># æŒ‡å®š-cæµ‹é€ŸæœåŠ¡å™¨IPï¼Œ-iæŒ‡å®šç›‘æ§æ—¶é—´é—´éš”ä¸º2sï¼Œ-FæŒ‡å®šè¦ä¼ è¾“çš„æ–‡ä»¶ï¼Œ-tæŒ‡å®šæµ‹é€Ÿæ—¶é—´20s</span><br>iperf3 -c 43.248.136.69 -i 2 -F Python-3.7.1rc2.tgz -t 20<br></code></pre></td></tr></table></figure><h2 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h2><p>Linux ç£ç›˜ç›‘æ§å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¯ 1 ç§’é‡‡æ ·ä¸€æ¬¡ï¼ŒæŒç»­ 5 ç§’</span><br>iostat -xd sda 1 5<br></code></pre></td></tr></table></figure><h2 id="nmon-ç›‘æ§"><a href="#nmon-ç›‘æ§" class="headerlink" title="nmon ç›‘æ§"></a>nmon ç›‘æ§</h2><p>Linux ç³»ç»Ÿèµ„æºç›‘æ§å·¥å…·ã€‚</p><p>å¯ä»¥æ”¶é›†æœåŠ¡å™¨ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶è¾“å‡ºæˆç‰¹å®šæ–‡ä»¶ï¼Œä¸”å¯åˆ©ç”¨excelåˆ†æå·¥å…·è¿›è¡Œæ•°æ®ç»Ÿè®¡åˆ†æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¯ 5 ç§’é‡‡æ ·ä¸€æ¬¡ï¼ŒæŒç»­ 120 ç§’</span><br>nmon -f -s 5 -c 120 -m /tmp/nmon.out<br></code></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>c</td><td>å¸¦æ¡å½¢å›¾çš„ CPU åˆ©ç”¨ç‡ç»Ÿè®¡ä¿¡æ¯ï¼ˆCPU æ ¸å¿ƒçº¿ç¨‹ï¼‰</td></tr><tr><td>m</td><td>å†…å­˜å’Œäº¤æ¢ç»Ÿè®¡</td></tr><tr><td>d</td><td>ç£ç›˜ I&#x2F;O ç¹å¿™ç™¾åˆ†æ¯” &amp; æ¯ç§’è¯»\å†™æ•°æ®é‡ KB&#x2F;s å›¾</td></tr><tr><td>r</td><td>èµ„æºï¼šæœºå™¨ç±»å‹ï¼Œåç§°ï¼Œç¼“å­˜è¯¦ç»†ä¿¡æ¯å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä»¥åŠ Distro + LPAR</td></tr><tr><td>t</td><td>top è¿›ç¨‹ï¼Œ1 åŸºç¡€ã€3 æ€§èƒ½ã€4 å¤§å°ã€5 I&#x2F;O ä»… root ç”¨æˆ·å¯ç”¨</td></tr><tr><td>n</td><td>ç½‘ç»œç»Ÿè®¡ä¿¡æ¯å’Œé”™è¯¯ï¼ˆå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™æ¶ˆå¤±ï¼‰</td></tr><tr><td>j</td><td>æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ—¥è®°æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td>k</td><td>å†…æ ¸ç»Ÿè®¡ä¿¡æ¯è¿è¡Œé˜Ÿåˆ—ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ´¾ç”Ÿï¼Œå¹³å‡è´Ÿè½½å’Œæ­£å¸¸è¿è¡Œæ—¶é—´</td></tr><tr><td>U</td><td>CPU ä½¿ç”¨ç‡ç»Ÿè®¡ä¿¡æ¯ user, user_nice, system, idle, iowait, irq, softirq, steal, guest, guest_nice</td></tr><tr><td>u</td><td>è¿›ç¨‹è¯¦ç»†ä¿¡æ¯</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vim</title>
    <link href="/2025/04/03/vim/"/>
    <url>/2025/04/03/vim/</url>
    
    <content type="html"><![CDATA[<h2 id="Normalæ¨¡å¼"><a href="#Normalæ¨¡å¼" class="headerlink" title="Normalæ¨¡å¼"></a>Normalæ¨¡å¼</h2><p>w ä»å‰åˆ°åå…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å¤´ã€‚</p><p>b ä»ååˆ°å‰å…‰æ ‡ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå•è¯çš„å¼€å¤´ã€‚</p><p>e ä»å‰åˆ°åå…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„ç»“å°¾ã€‚</p><p>0 å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„å¼€å¤´ã€‚</p><p>$ å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„ç»“å°¾ã€‚</p><p>^ å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦ã€‚</p><p>f{char} è®©vimæŸ¥æ‰¾ä¸‹ä¸€å¤„æŒ‡å®šå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼ŒæŒ‰<code>;</code>æŸ¥æ‰¾ä¸‹ä¸€å¤„ï¼Œ<code>,</code>è¿”å›ä¸Šä¸€å¤„</p><p>ctrl a å¯¹æ•°å­—åŠ ï¼Œå…‰æ ‡ä¸åœ¨æ•°å­—ä¸Šæ—¶ä¼šåœ¨å½“å‰è¡Œæ­£å‘æŸ¥æ‰¾ä¸€ä¸ªæ•°å­—</p><p>ctrl x å¯¹æ•°å­—å‡</p><blockquote><p>vim ä¼šæŠŠ0å¼€å¤´çš„æ•°å­—å½“åš8è¿›åˆ¶å¤„ç†ï¼Œ0xå¼€å¤´çš„æ•°å­—å½“åš16è¿›åˆ¶å¤„ç†ã€‚</p><p>å¦‚æœæƒ³æŠŠæ‰€æœ‰æ•°å­—éƒ½å½“ä½œåè¿›åˆ¶ set nrformats&#x3D;</p></blockquote><h3 id="æ“ä½œç¬¦-åŠ¨ä½œå‘½ä»¤-æ“ä½œ"><a href="#æ“ä½œç¬¦-åŠ¨ä½œå‘½ä»¤-æ“ä½œ" class="headerlink" title="æ“ä½œç¬¦ + åŠ¨ä½œå‘½ä»¤ &#x3D; æ“ä½œ"></a>æ“ä½œç¬¦ + åŠ¨ä½œå‘½ä»¤ &#x3D; æ“ä½œ</h3><p>cw åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°å½“å‰è¯ç»“å°¾å¤„çš„æ–‡æœ¬ï¼Œå¹¶ä¸”æ¢åˆ°æ’å…¥æ¨¡å¼ã€‚</p><p>dw åˆ é™¤å…‰æ ‡ä¸‹çš„å•è¯ã€‚</p><p>dG åˆ é™¤å…‰æ ‡åˆ°æ–‡ä»¶æœ«å°¾çš„æ–‡æœ¬ã€‚</p><p>D åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾çš„æ–‡æœ¬ã€‚</p><p>dap åˆ é™¤æ•´ä¸ªæ®µè½</p><p>gul å°†å½“å‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™</p><p>gUl å°†å½“å‰å­—ç¬¦è½¬ä¸ºå¤§å†™</p><p>gUap å°†æ•´ä¸ªæ®µè½è½¬æ¢ä¸ºå¤§å†™</p><p>gUaw å°†æ•´ä¸ªå•è¯è½¬æ¢ä¸ºå¤§å†™</p><p>v  é«˜äº®æ˜¾ç¤ºå¯è§†é€‰åŒºã€‚</p><p>ctrl+v å—å¯è§†æ¨¡å¼ï¼ˆåˆ—é€‰æ‹©æ¨¡å¼ï¼‰ã€‚</p><p>shift+v è¡Œå¯è§†æ¨¡å¼ã€‚</p><p>vG é«˜äº®æ˜¾ç¤ºå…‰æ ‡åˆ°æ–‡ä»¶æœ«å°¾çš„æ–‡æœ¬ã€‚</p><p>ctrl+n å‘ä¸‹è¡¥å…¨</p><p>ctrl+p å‘ä¸Šè¡¥å…¨</p><p>&gt; å‘å³ç¼©è¿›</p><p>&lt; å‘å·¦ç¼©è¿›</p><p>zz å°†å…‰æ ‡æ‰€åœ¨è¡Œç§»åŠ¨åˆ°çª—å£ä¸­é—´ã€‚</p><p>vim -u NONE -N   <code>-u NONE</code>ä½¿vimå¯åŠ¨æ—¶ä¸åŠ è½½è‡ªå®šä¹‰çš„vimrc, <code>-N</code>ä¸è¿›å…¥viå…¼å®¹æ¨¡å¼ã€‚</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title=". å‘½ä»¤"></a><code>.</code> å‘½ä»¤</h2><p><code>.</code>å¯ä»¥é‡å¤ä¸Šæ¬¡çš„ä¿®æ”¹ã€‚</p><p>f{char} è®©vimæŸ¥æ‰¾ä¸‹ä¸€å¤„æŒ‡å®šå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼ŒæŒ‰<code>;</code>æŸ¥æ‰¾ä¸‹ä¸€å¤„ï¼Œ<code>,</code>è¿”å›ä¸Šä¸€å¤„</p><p>* å¯ä»¥æŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹çš„å•è¯ï¼ŒæŒ‰næŸ¥æ‰¾ä¸‹ä¸€ä¸ª, :set hls é«˜äº®</p><p>å¦‚æœæƒ³æ§åˆ¶<code>u</code>æ’¤é”€çš„ç²’åº¦å¯ä»¥åœ¨æƒ³æˆªæ­¢çš„åœ°æ–¹ESCï¼Œæ’¤é”€ä»¥ä¸€æ¬¡ä¿®æ”¹æ“ä½œä¸ºå•ä½ï¼Œå³è¿›å…¥ç¼–è¾‘æ¨¡å¼åï¼Œä¿®æ”¹å®Œæ¯•ï¼ŒESCé€€å‡ºç¼–è¾‘æ¨¡å¼ã€‚</p><h2 id="Insertæ¨¡å¼"><a href="#Insertæ¨¡å¼" class="headerlink" title="Insertæ¨¡å¼"></a>Insertæ¨¡å¼</h2><p>ctrl+[ å›åˆ°æ­£å¸¸æ¨¡å¼ï¼Œç­‰ä»·äºESC</p><p>ctrl+h åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦</p><p>ctrl+w åˆ é™¤å‰ä¸€ä¸ªå•è¯</p><p>ctrl+u åˆ é™¤è‡³è¡Œé¦–</p><p>ctrl+o è¿™ä¸ªæ“ä½œä¼šä¸´æ—¶è®©ä½ å¯ä»¥ä½¿ç”¨æ­£å¸¸æ¨¡å¼ä¸‹çš„å‘½ä»¤ï¼Œå®Œæˆåè‡ªåŠ¨è¿›å…¥æ’å…¥æ¨¡å¼</p>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue Notes</title>
    <link href="/2025/03/30/vue-notes/"/>
    <url>/2025/03/30/vue-notes/</url>
    
    <content type="html"><![CDATA[<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">value</span>) <span class="hljs-comment">// åœ¨scriptæ ‡ç­¾ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // åŒå¤§æ‹¬å·ç»‘å®šå˜é‡<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="äº‹ä»¶ç›‘å¬"><a href="#äº‹ä»¶ç›‘å¬" class="headerlink" title="äº‹ä»¶ç›‘å¬"></a>äº‹ä»¶ç›‘å¬</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // ç‚¹å‡»äº‹ä»¶<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  // é¼ æ ‡ç§»å…¥äº‹ä»¶<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">mouseenter</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  // é¼ æ ‡ç§»å‡ºäº‹ä»¶<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">mouseleave</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" class="headerlink" title="åŒå‘ç»‘å®š"></a>åŒå‘ç»‘å®š</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">    <span class="hljs-comment">// ä¿®æ”¹å˜é‡çš„å€¼</span></span><br><span class="language-javascript">    <span class="hljs-comment">// ç‚¹å‡»äº‹ä»¶åï¼Œè¾“å…¥æ¡†çš„å€¼ä¼šè‡ªåŠ¨ä¿®æ”¹ä¸º888</span></span><br><span class="language-javascript">    str.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;888&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // è¾“å…¥æ¡†çš„å€¼ä¼šè‡ªåŠ¨ç»‘å®šåˆ°strå˜é‡ä¸Š<br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åŠ¨æ€ç»‘å®š"><a href="#åŠ¨æ€ç»‘å®š" class="headerlink" title="åŠ¨æ€ç»‘å®š"></a>åŠ¨æ€ç»‘å®š</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;completed&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">    str.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;item&#x27;</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // åŠ¨æ€ç»‘å®šclass<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">value</span>)</span><br><span class="language-javascript">    str.<span class="hljs-property">value</span> = !str.<span class="hljs-property">value</span></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // åŠ¨æ€ç»‘å®šclass<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;[str ? &#x27;completed&#x27; : &#x27;item&#x27;]&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åˆ—è¡¨æ¸²æŸ“"><a href="#åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="åˆ—è¡¨æ¸²æŸ“"></a>åˆ—è¡¨æ¸²æŸ“</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([</span><br><span class="language-javascript">    &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">age</span>: <span class="hljs-number">18</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;æå››&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">age</span>: <span class="hljs-number">20</span></span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ç‹äº”&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">age</span>: <span class="hljs-number">22</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">])</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // åˆ—è¡¨æ¸²æŸ“<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in list&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item.id&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;&#123; item.name + index &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;&#123; item.age + index &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ç›‘å¬å™¨"><a href="#ç›‘å¬å™¨" class="headerlink" title="ç›‘å¬å™¨"></a>ç›‘å¬å™¨</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;&#x27;</span>)      </span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">newValue, oldValue</span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newValue, oldValue)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-comment">// ç›‘å¬å˜é‡çš„å˜åŒ–</span></span><br><span class="language-javascript"><span class="hljs-title function_">watch</span>(str, add)  </span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; str &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ç›‘å¬å¯¹è±¡"><a href="#ç›‘å¬å¯¹è±¡" class="headerlink" title="ç›‘å¬å¯¹è±¡"></a>ç›‘å¬å¯¹è±¡</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref, watch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">ref</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span></span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">newValue, oldValue</span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newValue, oldValue)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-comment">// ç›‘å¬å¯¹è±¡çš„å˜åŒ–</span></span><br><span class="language-javascript"><span class="hljs-title function_">watch</span>(obj, add, &#123;<span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;obj.name&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>&#123;&#123; obj.name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> bool = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // æ¡ä»¶æ¸²æŸ“<br>  // v-show ä¼šåˆ›å»ºdivï¼Œä½†æ˜¯ä¼šæ ¹æ®boolçš„å€¼æ¥æ˜¾ç¤ºæˆ–è€…éšè—div<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&quot;bool&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello vue<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  // v-if ä¼šæ ¹æ®boolçš„å€¼æ¥åˆ¤æ–­æ˜¯å¦åˆ›å»ºdiv<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;bool&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello vue<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><p>ä¸€ä¸ªvueæ–‡ä»¶å¯ä»¥çœ‹åšä¸€ä¸ªç»„ä»¶</p><ol><li><p>çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ å€¼</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123;defineProps&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">&#x27;text&#x27;</span>])</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  // ç»„ä»¶<br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;button&#x27;</span>&gt;</span><br>    &#123;&#123; props.text &#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.button</span>&#123;</span><br><span class="language-css">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">background-color</span>: red;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p> å¼•å…¥ç»„ä»¶</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// å‡è®¾æ–‡ä»¶å«myButton.vueï¼Œåœ¨componentsç›®å½•ä¸‹</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> myButton <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/myButton.vue&#x27;</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    // çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ å€¼<br>    <span class="hljs-tag">&lt;<span class="hljs-name">myButton</span> <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;hello&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>å­ç»„ä»¶å¾€çˆ¶ç»„ä»¶ä¼ å€¼</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123;defineProps, defineEmits&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">&#x27;text&#x27;</span>])</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;ok&#x27;</span>]) </span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;ok&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;button&#x27;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;send&quot;</span>&gt;</span><br>    &#123;&#123; props.text &#125;&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-class">.button</span>&#123;</span><br><span class="language-css">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">background-color</span>: red;    </span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p> çˆ¶ç»„ä»¶æ¥æ”¶å­ç»„ä»¶çš„å€¼</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">// å‡è®¾æ–‡ä»¶å«myButton.vueï¼Œåœ¨componentsç›®å½•ä¸‹</span></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> myButton <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/myButton.vue&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">str</span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    // ç»™å­ç»„ä»¶ä¼ å€¼<br>    <span class="hljs-tag">&lt;<span class="hljs-name">myButton</span> @<span class="hljs-attr">ok</span>=<span class="hljs-string">&quot;add&quot;</span> <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;Hi&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;</span><br><span class="language-javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> value = <span class="hljs-title function_">ref</span>(<span class="hljs-string">&#x27;&#x27;</span>)</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([])</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getList</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">axios</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https:// example.com&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;GET&quot;</span>,</span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">  list.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">list</span></span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res, <span class="hljs-string">&quot;Data from backend&quot;</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">axios</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https://xxx.com&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">value</span>: value.<span class="hljs-property">value</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">flag</span>: <span class="hljs-literal">false</span></span><br><span class="language-javascript">    &#125;   </span><br><span class="language-javascript">  &#125;)</span><br><span class="language-javascript">  <span class="hljs-title function_">getList</span>()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">id</span>)&#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">await</span> <span class="hljs-title function_">axios</span>(&#123;</span><br><span class="language-javascript">      <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;https://example.com/update&quot;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">        id,</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    <span class="hljs-title function_">getList</span>()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="language-javascript"><span class="hljs-title function_">getData</span>()</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in list&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;[item.flag ? &#x27;completed&#x27; : &#x27;item&#x27; ]&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;update(item.id)&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;item.flag&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123; item.value &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Free Notes</title>
    <link href="/2025/03/27/Free-Notes/"/>
    <url>/2025/03/27/Free-Notes/</url>
    
    <content type="html"><![CDATA[<h2 id="æ”¶é›†cpu-ç£ç›˜ä¿¡æ¯"><a href="#æ”¶é›†cpu-ç£ç›˜ä¿¡æ¯" class="headerlink" title="æ”¶é›†cpu ç£ç›˜ä¿¡æ¯"></a>æ”¶é›†cpu ç£ç›˜ä¿¡æ¯</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk -db -e 7 -o SIZE -n | awk <span class="hljs-string">&#x27;&#123;s+=$1&#125; END&#123;printf &quot;%.1fTB&quot;, s/1024/1024/1024/1024&#125;&#x27;</span><br><br><span class="hljs-comment"># CPUä¿¡æ¯ï¼šSocket(s) æ’æ§½æ•°ï¼ŒCore(s) per socket æ¯ä¸ªæ’æ§½æ ¸å¿ƒæ•°ï¼ŒThread(s) per core æ¯ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="hljs-comment"># CPUåï¼š</span><br>lscpu | grep <span class="hljs-string">&#x27;Model name&#x27;</span><br><span class="hljs-comment"># ç‰©ç†æ ¸å¿ƒæ•°ï¼š</span><br>lscpu | grep -i <span class="hljs-string">&#x27;socket&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span> | <span class="hljs-built_in">paste</span> -s -d <span class="hljs-string">&#x27;*&#x27;</span> | bc<br><span class="hljs-comment"># æ€»çº¿ç¨‹æ•°ï¼ˆé€»è¾‘æ ¸å¿ƒæ•°ï¼‰ï¼š</span><br>lscpu | grep  <span class="hljs-string">&#x27;^CPU(s):&#x27;</span>|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br><br><span class="hljs-comment"># æŸ¥çœ‹ç½‘å£ä¿¡æ¯</span><br>ethtool eth0 <br><br><span class="hljs-comment"># æŸ¥çœ‹GPU</span><br>lspci<br></code></pre></td></tr></table></figure><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æŸ¥çœ‹ç½‘ç»œæ¥å£ä¿¡æ¯</span><br><span class="hljs-built_in">Get-NetAdapter</span> | <span class="hljs-built_in">Select-Object</span> Name, InterfaceDescription, LinkSpeed<br><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä¿¡æ¯</span><br><span class="hljs-built_in">Get-CimInstance</span> Win32_ComputerSystem | <span class="hljs-built_in">Select-Object</span> <span class="hljs-selector-tag">@</span>&#123;Name=<span class="hljs-string">&quot;TotalMemory(GB)&quot;</span>;Expression=&#123;[<span class="hljs-type">math</span>]::Round(<span class="hljs-variable">$_</span>.TotalPhysicalMemory / <span class="hljs-number">1</span>GB, <span class="hljs-number">2</span>)&#125;&#125;<br><span class="hljs-comment"># æŸ¥çœ‹æ¯æ¡å†…å­˜ä¿¡æ¯</span><br><span class="hljs-built_in">Get-CimInstance</span> Win32_PhysicalMemory | <span class="hljs-built_in">Select-Object</span> Manufacturer, <span class="hljs-selector-tag">@</span>&#123;Name=<span class="hljs-string">&quot;Size(GB)&quot;</span>;Expression=&#123;[<span class="hljs-type">math</span>]::Round(<span class="hljs-variable">$_</span>.Capacity / <span class="hljs-number">1</span>GB, <span class="hljs-number">2</span>)&#125;&#125;, Speed<br><span class="hljs-comment"># æŸ¥çœ‹CPUä¿¡æ¯</span><br><span class="hljs-built_in">Get-CimInstance</span> Win32_Processor | <span class="hljs-built_in">Select-Object</span> Name, NumberOfCores, NumberOfLogicalProcessors<br><span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</span><br><span class="hljs-built_in">Get-PhysicalDisk</span> | <span class="hljs-built_in">Select-Object</span> FriendlyName, MediaType, <span class="hljs-selector-tag">@</span>&#123;Name=<span class="hljs-string">&quot;Size(GB)&quot;</span>;Expression=&#123;[<span class="hljs-type">math</span>]::Round(<span class="hljs-variable">$_</span>.Size / <span class="hljs-number">1</span>GB, <span class="hljs-number">2</span>)&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="Windows-é…ç½®winrm"><a href="#Windows-é…ç½®winrm" class="headerlink" title="Windows é…ç½®winrm"></a>Windows é…ç½®winrm</h2><ul><li>pythonåŸºç¡€ç¯å¢ƒ</li><li>é˜²ç«å¢™æ”¾å¼€5985ç«¯å£</li></ul><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ps1"><span class="hljs-comment"># æŸ¥çœ‹powershellç‰ˆæœ¬</span><br><span class="hljs-built_in">get-host</span><br><span class="hljs-comment"># æŸ¥çœ‹æ‰§è¡Œç­–ç•¥</span><br><span class="hljs-built_in">get-executionpolicy</span><br><span class="hljs-comment"># ä¿®æ”¹æ‰§è¡Œç­–ç•¥</span><br><span class="hljs-built_in">set-executionpolicy</span> remotesigned<br><span class="hljs-comment"># å¯åŠ¨winrmæœåŠ¡</span><br>winrm quickconfig<br><span class="hljs-comment"># åˆ—å‡ºè¯¥è®¡ç®—æœºä¸Šçš„æ‰€æœ‰ WinRM ä¾¦å¬ç¨‹åº</span><br>winrm enumerate winrm/config/listener<br><span class="hljs-comment"># ä¿®æ”¹é…ç½®</span><br><span class="hljs-comment"># å…è®¸åŸºæœ¬èº«ä»½éªŒè¯</span><br>winrm <span class="hljs-built_in">set</span> winrm/config/service/auth <span class="hljs-string">&#x27;@&#123;Basic=&quot;true&quot;&#125;&#x27;</span> <br><span class="hljs-comment"># å…è®¸éåŠ å¯†é€šä¿¡</span><br>winrm <span class="hljs-built_in">set</span> winrm/config/service <span class="hljs-string">&#x27;@&#123;AllowUnencrypted=&quot;true&quot;&#125;&#x27;</span> <br><span class="hljs-comment"># å…è®¸è¿œç¨‹è®¿é—®</span><br><span class="hljs-built_in">Set-Item</span> WSMan:\localhost\Client\TrustedHosts <span class="hljs-literal">-Value</span> <span class="hljs-string">&quot;*&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-comment"># æ‰“å¼€é˜²ç«å¢™ç«¯å£</span><br><span class="hljs-built_in">New-NetFirewallRule</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;WinRM&quot;</span> <span class="hljs-literal">-DisplayName</span> <span class="hljs-string">&quot;WinRM&quot;</span> <span class="hljs-literal">-Enabled</span> True <span class="hljs-literal">-Protocol</span> TCP <span class="hljs-literal">-Action</span> Allow <span class="hljs-literal">-LocalPort</span> <span class="hljs-number">5985</span><br></code></pre></td></tr></table></figure><h2 id="windows-è®¾ç½®å¯†ç "><a href="#windows-è®¾ç½®å¯†ç " class="headerlink" title="windows è®¾ç½®å¯†ç "></a>windows è®¾ç½®å¯†ç </h2><p>å¦‚æœé€šè¿‡ç•Œé¢è®¾ç½®å¯†ç ï¼Œå¯†ç ä¼šè¢«æ˜¾ç¤ºä¸º*ï¼Œä¸å¥½åˆ†è¾¨æ˜¯å¦åŒ…å«ç©ºæ ¼æˆ–å›è½¦ï¼Œè®¾ç½®çš„æ—¶å€™å¯ä»¥ç‚¹å‡»æ˜¾ç¤ºæŸ¥çœ‹ä¸‹ã€‚<br>å¦‚æœé€šè¿‡cmdæ¥è®¾ç½®ï¼Œå¦‚:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æ­¤å¤„ä¸linuxä¸åŒï¼Œ&#x27;&#x27;ä¹Ÿä¼šè¢«è§†ä¸ºå¯†ç çš„ä¸€éƒ¨åˆ†</span><br>net user administrator <span class="hljs-string">&#x27;as^df!@ii&#x27;</span><br><span class="hljs-comment"># ^ æ˜¯windowså‘½ä»¤è¡Œçš„è½¬ä¹‰ç¬¦ï¼Œ^d å…¶å®æ˜¯ d</span><br><span class="hljs-built_in">echo</span> ^d  <span class="hljs-comment"># ä¼šè¾“å‡º d</span><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜å’Œè¿œç¨‹ç™»é™†"><a href="#åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜å’Œè¿œç¨‹ç™»é™†" class="headerlink" title="åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜å’Œè¿œç¨‹ç™»é™†"></a>åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®ç®¡ç†å‘˜å’Œè¿œç¨‹ç™»é™†</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net user newuser password123 /add<br>net localgroup <span class="hljs-string">&quot;Administrators&quot;</span> newuser /add<br>net localgroup <span class="hljs-string">&quot;Remote Desktop Users&quot;</span> newuser /add<br></code></pre></td></tr></table></figure><h2 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible æ‰§è¡Œ winåˆ†ç»„ä¸‹æ‰€æœ‰30.21çš„æœºå™¨ -&gt; `ansible <span class="hljs-string">&#x27;win:&amp;*.30.21&#x27;</span> -m win_ping`<br><span class="hljs-comment"># ç”¨ansibleæ¨¡å—åˆ›å»ºç”¨æˆ·æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²å­˜åœ¨ï¼Œä¹Ÿä¼šæ˜¯æ–°å»ºç”¨æˆ·ï¼Œç”±äºåŸæ¥çš„ç”¨æˆ·ç›®å½•å·²å­˜åœ¨ï¼Œä¼šå¯¼è‡´ç™»é™†æ—¶åŸæ¥çš„ç”¨æˆ·ç›®å½•å˜ä¸ºç”¨æˆ·å+æœºå™¨å</span><br>ansible 172.22.30.135 -m win_user -a <span class="hljs-string">&quot;name=NewUser password=&#x27;11qfZY\$\$1111&#x27;&quot;</span><br></code></pre></td></tr></table></figure><h2 id="æ¯”è¾ƒä¸¤åˆ—ä¸åŒ"><a href="#æ¯”è¾ƒä¸¤åˆ—ä¸åŒ" class="headerlink" title="æ¯”è¾ƒä¸¤åˆ—ä¸åŒ"></a>æ¯”è¾ƒä¸¤åˆ—ä¸åŒ</h2><p>comm -3 &lt;(sort -u list) &lt;(sort -u list2)</p><h2 id="mysql-æˆæƒè¿œç¨‹ç™»å½•åŠé”™è¯¯é—®é¢˜å¤„ç†"><a href="#mysql-æˆæƒè¿œç¨‹ç™»å½•åŠé”™è¯¯é—®é¢˜å¤„ç†" class="headerlink" title="mysql æˆæƒè¿œç¨‹ç™»å½•åŠé”™è¯¯é—®é¢˜å¤„ç†"></a>mysql æˆæƒè¿œç¨‹ç™»å½•åŠé”™è¯¯é—®é¢˜å¤„ç†</h2><p><a href="https://blog.csdn.net/hanhanwanghaha/article/details/105599321">å‚è€ƒé“¾æ¥</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;bind-address = 0.0.0.0&quot;</span> &gt;&gt; /etc/my.cnf<br>service mysqld restart<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>;<br><span class="hljs-comment">-- åº“.è¡¨    *.* æ‰€æœ‰åº“æ‰€æœ‰è¡¨</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;<br>flush privileges;<br></code></pre></td></tr></table></figure><h2 id="sambaæŒ‚è½½å‚æ•°ä¼˜åŒ–"><a href="#sambaæŒ‚è½½å‚æ•°ä¼˜åŒ–" class="headerlink" title="sambaæŒ‚è½½å‚æ•°ä¼˜åŒ–"></a>sambaæŒ‚è½½å‚æ•°ä¼˜åŒ–</h2><p>æŸå¤©æœåŠ¡å™¨ä¸Š<code>df -h</code>å‘ç°ä¼šå¡å¾ˆä¹…æ‰æ˜¾ç¤º</p><p>é€šå¸¸å¦‚æœæœ‰ç½‘ç»œæŒ‚è½½ï¼Œå¦‚nfsã€sambaï¼Œä¼šæœ‰æ˜¾ç¤ºå¡ä½çš„æƒ…å†µ</p><p>å¦‚æœåªæ˜¯æƒ³çœ‹ä¸‹æœ¬åœ°æŒ‚è½½çš„æƒ…å†µï¼Œå¯ä»¥<code>df -hl</code>ï¼Œå°±ä¸ä¼šæ˜¾ç¤ºç½‘ç»œæŒ‚è½½çš„ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸ä¼šå¡å¾ˆä¹…</p><p>å¦‚æœåªæ˜¯æƒ³çœ‹æŸä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ï¼Œå¯ä»¥<code>df -t cifs -h</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨straceå‘ç°dfä¼šåœ¨æŸäº›ç½‘ç»œæŒ‚è½½è·¯å¾„å¡ä½</span><br>strace <span class="hljs-built_in">df</span> -h<br><span class="hljs-comment"># è®°å½•ä¸‹è¿™äº›è·¯å¾„ï¼Œåˆ°å¯¹åº”çš„è·¯å¾„</span><br>time <span class="hljs-built_in">ls</span><br><span class="hljs-comment"># æˆ–è€…</span><br><span class="hljs-built_in">df</span> -h <span class="hljs-variable">$path</span> <span class="hljs-comment"># å…·ä½“è·¯å¾„ï¼Œ ä¼šå‘ç°è¿è¡Œæ¯”å…¶ä»–è·¯å¾„æ…¢</span><br></code></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥æ’æŸ¥æŒ‚è½½ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å› ä¸ºç”¨çš„sambaï¼Œæ‰€ä»¥æ˜¯cifsæ–‡ä»¶ç³»ç»Ÿ</span><br>mount | grep cifs<br><span class="hljs-built_in">cat</span> /proc/mounts | grep cifs<br>findmnt -t cifs<br><br><span class="hljs-comment"># æ’æŸ¥åå‘ç°ç–‘ä¼¼æŒ‚è½½è·¯å¾„ä¸‹æ–‡ä»¶æ•°é‡è¿‡å¤šï¼Œå¯¼è‡´è·å–æ–‡ä»¶å¾ˆæ…¢</span><br><span class="hljs-comment"># å¸è½½åé‡æ–°æŒ‚è½½</span><br>mount -t cifs //192.168.1.1/sharefile /mnt -o user=public,password=public,dir_mode=0777,file_mode=0777,noperm,vers=3.0,nodfs<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹sambaé…ç½®æ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Some other performace tuning options</span><br><span class="hljs-comment"># disable links and symbol links</span><br>    follow <span class="hljs-attr">symlinks</span> = <span class="hljs-literal">no</span><br>    wide <span class="hljs-attr">links</span> = <span class="hljs-literal">no</span><br><span class="hljs-comment"># enable some read/write tuning</span><br>    use <span class="hljs-attr">sendfile</span> = <span class="hljs-literal">yes</span><br>    read <span class="hljs-attr">raw</span> = <span class="hljs-literal">yes</span><br>    write <span class="hljs-attr">raw</span> = <span class="hljs-literal">yes</span><br>    aio read <span class="hljs-attr">size</span> = <span class="hljs-number">16384</span><br>    aio write <span class="hljs-attr">size</span> = <span class="hljs-number">16384</span><br>    write cache <span class="hljs-attr">size</span> = <span class="hljs-number">262144</span><br>    max <span class="hljs-attr">xmit</span> = <span class="hljs-number">65536</span><br>    large <span class="hljs-attr">readwrite</span> = <span class="hljs-literal">yes</span><br>    getwd <span class="hljs-attr">cache</span> = <span class="hljs-literal">yes</span><br><span class="hljs-comment"># disable locking, because only 2 share can be written.</span><br>    strict <span class="hljs-attr">locking</span> = <span class="hljs-literal">no</span><br>    fake <span class="hljs-attr">oplocks</span> = <span class="hljs-literal">yes</span><br>    <span class="hljs-attr">oplocks</span> = <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><p>é‡è½½é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbcontrol smbd reload-config<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Pandas Intro</title>
    <link href="/2025/03/27/pandas-intro/"/>
    <url>/2025/03/27/pandas-intro/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install pandas<br></code></pre></td></tr></table></figure><h2 id="Pandas-åŸºç¡€æ“ä½œ"><a href="#Pandas-åŸºç¡€æ“ä½œ" class="headerlink" title="Pandas åŸºç¡€æ“ä½œ"></a>Pandas åŸºç¡€æ“ä½œ</h2><ol><li><p>å­—å…¸ç”Ÿæˆè¡¨æ ¼æ•°æ®</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">dict_sample=&#123;<br>    <span class="hljs-string">&quot;A&quot;</span>: [<span class="hljs-number">11</span>,<span class="hljs-number">22</span>,<span class="hljs-number">33</span>,<span class="hljs-number">44</span>]<br>    <span class="hljs-string">&quot;B&quot;</span>: [<span class="hljs-number">22</span>,<span class="hljs-number">33</span>,<span class="hljs-number">44</span>,<span class="hljs-number">55</span>]<br>    <span class="hljs-string">&quot;C&quot;</span>: [<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>]<br>&#125;<br>df = pd.DataFrame(dict_sample)<br>display(df)<br></code></pre></td></tr></table></figure></li><li><p>è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¡Œç´¢å¼•</span><br>df.index<br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment"># RangeIndex(start=0, stop=4, step=1)</span><br><span class="hljs-comment"># åˆ—ç´¢å¼•</span><br>df.columns<br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment"># Index([&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;], dtype=&#x27;object&#x27;)</span><br><span class="hljs-comment"># è½¬åŒ–ä¸ºåˆ—è¡¨</span><br>df.columns.tolist()<br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment"># [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;]</span><br>df.index.tolist()   <br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment"># [0, 1, 2, 3]</span><br></code></pre></td></tr></table></figure></li><li><p>æŒ‡å®šè¡Œç´¢å¼•åˆ—ç´¢å¼•</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é‡æ–°èµ‹å€¼è¡Œç´¢å¼•</span><br>df.index = [<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>]<br><span class="hljs-comment"># é‡æ–°èµ‹å€¼åˆ—ç´¢å¼•</span><br>df.columns = [<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;C&#x27;</span>]<br><span class="hljs-comment"># å•ç‹¬æ”¹å˜æŸä¸€åˆ—åˆ—å</span><br>df = df.rename(columns=&#123;<span class="hljs-string">&#x27;A&#x27;</span>:<span class="hljs-string">&#x27;a&#x27;</span>&#125;)<br><span class="hljs-comment"># ç›´æ¥ä¿®æ”¹åŸæ•°æ®ï¼Œä¸è¿”å›æ–°å¯¹è±¡</span><br>df.rename(columns=&#123;<span class="hljs-string">&#x27;A&#x27;</span>:<span class="hljs-string">&#x27;a&#x27;</span>&#125;,inplace=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># è½¬æ¢å›å­—å…¸</span><br>df_dict = df.to_dict()<br><br><span class="hljs-comment">## å•ç‹¬æŒ‡å®šè¡Œç´¢å¼•</span><br>df = pd.DataFrame(dict_sample,index=[<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>])<br></code></pre></td></tr></table></figure></li><li><p>å››ç§é€‰å–æ•°æ®çš„æ–¹æ³•</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é€‰å–æŸä¸€åˆ—ï¼Œä¸”è¿”å›ä¸ºSeriesç±»å‹</span><br>df[<span class="hljs-string">&#x27;A&#x27;</span>]<br><span class="hljs-comment"># é€‰å–æŸä¸€åˆ—ï¼Œä¸”è¿”å›ä¸ºDataFrameç±»å‹</span><br>df[[<span class="hljs-string">&#x27;A&#x27;</span>]]<br><span class="hljs-comment"># loc æ ¹æ®ç´¢å¼•é€‰å–æ•°æ®</span><br>df.loc[<span class="hljs-string">&#x27;a&#x27;</span>ï¼Œ:]<br><span class="hljs-comment"># é€‰å–æŸå‡ è¡Œï¼Œ ä¸”è¿”å›ä¸ºDataFrameç±»å‹</span><br>df.loc[[<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>]ï¼Œ:]<br><span class="hljs-comment"># iloc æ ¹æ®ä½ç½®é€‰å–æ•°æ®ï¼Œä»0å¼€å§‹ç¼–å·</span><br>df.iloc[<span class="hljs-number">0</span>,ï¼š]<br><span class="hljs-comment"># é€‰å–æŸå‡ è¡ŒæŸå‡ åˆ—</span><br>df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], :]<br>df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]]<br>df.iloc[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>,<span class="hljs-number">0</span>:<span class="hljs-number">2</span>]<br><span class="hljs-comment"># é€‰å–æŸè¡ŒæŸåˆ—çš„ä¸€ä¸ªå…ƒç´ </span><br>df.at[<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;A&#x27;</span>]<br></code></pre></td></tr></table></figure></li></ol><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><ol><li><p>å¤–éƒ¨æ•°æ®è¯»å–</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¯»å–csvæ–‡ä»¶</span><br><span class="hljs-comment"># å¸¸ç”¨å‚æ•°ï¼šindex_col ç´¢å¼•è¡Œï¼› sep åˆ†éš”ç¬¦ï¼›</span><br>df = pd.read_csv(<span class="hljs-string">&#x27;data.csv&#x27;</span>)  <br></code></pre></td></tr></table></figure></li><li><p>æ‰“å°é¢„è§ˆ</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ‰“å°å‰å‡ è¡Œæ•°æ®</span><br>df.head()<br><span class="hljs-comment"># æ‰“å°åå‡ è¡Œæ•°æ®</span><br>df.tail()<br><span class="hljs-comment"># æ‰“å°éšæœºå‡ è¡Œæ•°æ®</span><br>df.sample()<br></code></pre></td></tr></table></figure></li><li><p>åŸºæœ¬ä¿¡æ¯é¢„è§ˆ</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸºæœ¬ä¿¡æ¯é¢„è§ˆ</span><br>df.info()   <br>df.describe()<br>df.dtypes<br>df.shape<br></code></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡æ€§ä¿¡æ¯</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç»Ÿè®¡æ€§ä¿¡æ¯</span><br>df.count()<br>df.mean()<br>df[<span class="hljs-string">&#x27;A&#x27;</span>].unique()<br><span class="hljs-comment"># æ ¹æ®åˆ—çš„å€¼åˆ†ç±»ï¼Œå¯¹æ¯ä¸ªç±»å‹è¿›è¡Œè®¡æ•°</span><br>df[[<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>]].groupby([<span class="hljs-string">&#x27;A&#x27;</span>]).count()<br></code></pre></td></tr></table></figure></li><li><p>ç´¢å¼•è®¾ç½®</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç´¢å¼•è®¾ç½®</span><br><span class="hljs-comment"># å°†è¡Œç´¢å¼•å˜ä¸ºåˆ—</span><br>df.reset_index()   <br><span class="hljs-comment"># set_index ä¸ reset_index ç›¸å</span><br>df.set_index([<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>])<br></code></pre></td></tr></table></figure></li><li><p>æ’åº</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ’åº</span><br><span class="hljs-comment"># æ ¹æ®æŸä¸€åˆ—æ’åº</span><br>df.sort_values(by=<span class="hljs-string">&#x27;A&#x27;</span>,ascending=<span class="hljs-literal">True</span>)      <br><span class="hljs-comment"># æ ¹æ®å¤šåˆ—æ’åº</span><br>df.sort_values(by=[<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>],ascending=[<span class="hljs-literal">True</span>,<span class="hljs-literal">False</span>])<br></code></pre></td></tr></table></figure></li><li><p>æ‹¼æ¥</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ‹¼æ¥</span><br><span class="hljs-comment"># æ¨ªå‘æ‹¼æ¥</span><br>df1 = pd.DataFrame(&#123;<span class="hljs-string">&#x27;A&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-string">&#x27;B&#x27;</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]&#125;)<br>df2 = pd.DataFrame(&#123;<span class="hljs-string">&#x27;A&#x27;</span>: [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], <span class="hljs-string">&#x27;B&#x27;</span>: [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>]&#125;)  <br>pd.concat([df1, df2], axis=<span class="hljs-number">1</span>)   <br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment">#    A  B  A  B</span><br><span class="hljs-comment"># 0  1  3  5  7</span><br><span class="hljs-comment"># 1  2  4  6  8 </span><br><span class="hljs-comment"># çºµå‘æ‹¼æ¥</span><br>pd.concat([df1, df2], axis=<span class="hljs-number">0</span>)<br><span class="hljs-comment"># è¾“å‡ºç»“æœï¼š</span><br><span class="hljs-comment">#    A  B</span><br><span class="hljs-comment"># 0  1  3</span><br><span class="hljs-comment"># 1  2  4</span><br><span class="hljs-comment"># 0  5  7</span><br><span class="hljs-comment"># 1  6  8</span><br><br><span class="hljs-comment"># merge åˆå¹¶</span><br><span class="hljs-comment"># å·¦è¿æ¥</span><br>df1 = pd.DataFrame(&#123;<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>], <span class="hljs-string">&#x27;value&#x27;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]&#125;)<br>df2 = pd.DataFrame(&#123;<span class="hljs-string">&#x27;key&#x27;</span>: [<span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>], <span class="hljs-string">&#x27;value&#x27;</span>: [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]&#125;)    <br>pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>, how=<span class="hljs-string">&#x27;left&#x27;</span>)    <br><span class="hljs-comment"># å³è¿æ¥</span><br>pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>, how=<span class="hljs-string">&#x27;right&#x27;</span>)<br><span class="hljs-comment"># å†…è¿æ¥</span><br>pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>, how=<span class="hljs-string">&#x27;inner&#x27;</span>)   <br><span class="hljs-comment"># å¤–è¿æ¥</span><br>pd.merge(df1, df2, on=<span class="hljs-string">&#x27;key&#x27;</span>, how=<span class="hljs-string">&#x27;outer&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Anaconda Install &amp; Use</title>
    <link href="/2025/03/27/anaconda/"/>
    <url>/2025/03/27/anaconda/</url>
    
    <content type="html"><![CDATA[<h1 id="Anaconda-å®‰è£…"><a href="#Anaconda-å®‰è£…" class="headerlink" title="Anaconda å®‰è£…"></a>Anaconda å®‰è£…</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://repo.anaconda.com/archive/Anaconda3-2023.07-2-Linux-x86_64.sh<br>bash Anaconda3-2023.07-2-Linux-x86_64.sh<br><span class="hljs-built_in">source</span> ~/.bashrc<br><span class="hljs-comment"># é…ç½®å›½å†…æº</span><br><span class="hljs-built_in">cat</span> &gt;&gt; ~/.condarc &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">channels:</span><br><span class="hljs-string">  - conda-forge</span><br><span class="hljs-string">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="hljs-string">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="hljs-string">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="hljs-string">  - defaults</span><br><span class="hljs-string">show_channel_urls: true</span><br><span class="hljs-string">EOF</span><br><br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r<br>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2<br>conda config --add channels conda-forge<br><br>conda config --<span class="hljs-built_in">set</span> show_channel_urls <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda --version<br>conda init<br>conda activate base<br>conda config --show<br>conda config --show channels<br>conda clean -a<br>conda update conda<br>conda deactivate<br>conda create -n py310 python=3.10<br>conda list <br>conda info<br>conda <span class="hljs-built_in">env</span> list<br>conda <span class="hljs-built_in">env</span> <span class="hljs-built_in">export</span> -n myenv &gt; myenv.yml<br>conda <span class="hljs-built_in">env</span> create -f myenv.yml<br>conda list --<span class="hljs-built_in">export</span> &gt; conda_requirements.txt<br>conda install --file conda_requirements.txt<br>conda config --add channels conda-forge<br></code></pre></td></tr></table></figure><h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><h3 id="gcc-æºç å®‰è£…"><a href="#gcc-æºç å®‰è£…" class="headerlink" title="gcc æºç å®‰è£…"></a>gcc æºç å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://ftp.gnu.org/gnu/gcc/gcc-11.2.0/gcc-11.2.0.tar.gz<br>tar -zxvf gcc-11.2.0.tar.gz<br><span class="hljs-built_in">cd</span> gcc-11.2.0<br><span class="hljs-comment"># ä¸‹è½½å¿…è¦çš„ä¾èµ–</span><br>./contrib/download_prerequisites<br><span class="hljs-built_in">mkdir</span> build<br><span class="hljs-built_in">cd</span> build<br>../configure --enable-languages=c,c++ --disable-multilib --prefix=/usr/local/gcc-13.2.0<br><span class="hljs-comment"># ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒæ¥åŠ é€Ÿç¼–è¯‘</span><br>make -j$(<span class="hljs-built_in">nproc</span>) <br>make install<br><span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡ï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©</span><br><span class="hljs-built_in">export</span> PATH=/usr/local/gcc-13.2.0/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/usr/local/gcc-13.2.0/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">source</span> ~/.bashrc<br></code></pre></td></tr></table></figure><h3 id="pythonå°è£…æˆsoæ–‡ä»¶"><a href="#pythonå°è£…æˆsoæ–‡ä»¶" class="headerlink" title="pythonå°è£…æˆsoæ–‡ä»¶"></a>pythonå°è£…æˆsoæ–‡ä»¶</h3><h4 id="å®‰è£…cython"><a href="#å®‰è£…cython" class="headerlink" title="å®‰è£…cython"></a>å®‰è£…cython</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install cython<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºç¼–å†™æºç æ–‡ä»¶åŠsetup"><a href="#åˆ›å»ºç¼–å†™æºç æ–‡ä»¶åŠsetup" class="headerlink" title="åˆ›å»ºç¼–å†™æºç æ–‡ä»¶åŠsetup"></a>åˆ›å»ºç¼–å†™æºç æ–‡ä»¶åŠsetup</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># example.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a + b<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a * b<br><br><span class="hljs-comment"># setup.py</span><br><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup<br><span class="hljs-keyword">from</span> Cython.Build <span class="hljs-keyword">import</span> cythonize<br><br>setup(<br>    ext_modules=cythonize(<span class="hljs-string">&quot;example.py&quot;</span>)<br>)<br></code></pre></td></tr></table></figure><h4 id="è¿è¡Œsetup"><a href="#è¿è¡Œsetup" class="headerlink" title="è¿è¡Œsetup"></a>è¿è¡Œsetup</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python setup.py build_ext --inplace<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠŸåä¼šæœ‰ä¸€ä¸ªç±»ä¼¼<code>example.cpython-310-x86_64-linux-gnu.so</code>çš„æ–‡ä»¶</p><ul><li>.so æ–‡ä»¶å¿…é¡»åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹ï¼Œæˆ–è€…åœ¨ PYTHONPATH ä¸­ã€‚</li><li>å¦‚æœä½ æƒ³æ”¾åœ¨å…¶ä»–ç›®å½•ä¸‹ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ sys.pathï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br>sys.path.append(<span class="hljs-string">&#x27;/path/to/your/so/file&#x27;</span>)<br><br><span class="hljs-keyword">import</span> example<br><span class="hljs-built_in">print</span>(example.add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 8</span><br></code></pre></td></tr></table></figure><h4 id="åœ¨pythonä¸­å¯¼å…¥soæ–‡ä»¶"><a href="#åœ¨pythonä¸­å¯¼å…¥soæ–‡ä»¶" class="headerlink" title="åœ¨pythonä¸­å¯¼å…¥soæ–‡ä»¶"></a>åœ¨pythonä¸­å¯¼å…¥soæ–‡ä»¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> example<br><br><span class="hljs-built_in">print</span>(example.add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>))      <span class="hljs-comment"># è¾“å‡º: 8</span><br><span class="hljs-built_in">print</span>(example.multiply(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment"># è¾“å‡º: 15</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>linux</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker cannot pull images</title>
    <link href="/2025/03/07/docker-cannot-pull-images/"/>
    <url>/2025/03/07/docker-cannot-pull-images/</url>
    
    <content type="html"><![CDATA[<h1 id="Mac-Docker-é•œåƒç½‘ç»œé—®é¢˜"><a href="#Mac-Docker-é•œåƒç½‘ç»œé—®é¢˜" class="headerlink" title="Mac Docker é•œåƒç½‘ç»œé—®é¢˜"></a>Mac Docker é•œåƒç½‘ç»œé—®é¢˜</h1><p>å›½å†…ç¯å¢ƒæ— æ³•æ‹‰å–dockeré•œåƒï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šæ–¹æ³•ã€‚</p><p>æœ‰ä¿®æ”¹ dockeré•œåƒæºçš„ï¼Œæœ‰å¾€é…ç½®æ–‡ä»¶åŠ ä»£ç†æˆ–è€…åŠ dnsçš„ã€‚</p><p>ä¸ªäººå¸¸ç”¨æ–¹æ³•æ˜¯ç”¨å–µå–µï¼Œä»¥å‰ä¹Ÿåªéœ€è¦æŒ‚å–µå–µå³å¯ï¼Œæœ€è¿‘å‘ç°åªç”¨å®ƒä¹Ÿæ²¡ç”¨äº†ã€‚</p><p>ä¸çŸ¥é“æ˜¯å› ä¸ºæ¢äº†macæœ‰ä»€ä¹ˆä¸åŒï¼Œè¿˜æ˜¯å› ä¸ºæŸäº›wallçš„é™åˆ¶åŠ å¼ºäº†ã€‚</p><p>ç„¶åå°è¯•ä¿®æ”¹äº†dnsè§£æï¼ŒæˆåŠŸäº†ï¼Œdnsåœ°å€ä½¿ç”¨</p><h2 id="Mac-ç»ˆç«¯é…ç½®ä»£ç†"><a href="#Mac-ç»ˆç«¯é…ç½®ä»£ç†" class="headerlink" title="Mac ç»ˆç«¯é…ç½®ä»£ç†"></a>Mac ç»ˆç«¯é…ç½®ä»£ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> proxy=<span class="hljs-string">&#x27;export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890&#x27;</span><br><span class="hljs-built_in">alias</span> unproxy=<span class="hljs-string">&#x27;unset https_proxy http_proxy all_proxy&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="Macä¿®æ”¹DNS"><a href="#Macä¿®æ”¹DNS" class="headerlink" title="Macä¿®æ”¹DNS"></a>Macä¿®æ”¹DNS</h2><ul><li>å¯ä»¥é€šè¿‡macç•Œé¢çš„ç½‘ç»œæ¥ä¿®æ”¹</li><li>ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä¿®æ”¹</li></ul><p>ä¸ªäººä¸€èˆ¬éœ€è¦ä¿®æ”¹çš„åœºæ™¯åªåœ¨terminalä¸­ï¼Œæ‰€ä»¥å°†å‘½ä»¤åšæˆaliasæ¥å¿«æ·ä½¿ç”¨ã€‚</p><p>ä¿®æ”¹dnså‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹ç½‘ç»œæ¥å£</span><br>networksetup -listallnetworkservice<br><br>networksetup -setdnsservers Wi-Fi 8.8.8.8 114.114.114.114<br><br><span class="hljs-comment"># æŸ¥çœ‹wi-fiæ¥å£çš„dnsé…ç½®</span><br>networksetup -getdnsservers Wi-Fi<br><br><span class="hljs-comment"># æˆ–ç”¨scutilæŸ¥çœ‹dnsé…ç½®</span><br>scutil --dns<br><br><span class="hljs-comment"># æ¸…ç©ºdnsé…ç½®ï¼Œå³æ¢å¤é»˜è®¤</span><br>networksetup -setdnsservers Wi-Fi empty<br><br><span class="hljs-comment"># åˆ·æ–°dnsç¼“å­˜</span><br>dscacheutil -flushcache<br></code></pre></td></tr></table></figure><h2 id="DNSæ¨è"><a href="#DNSæ¨è" class="headerlink" title="DNSæ¨è"></a>DNSæ¨è</h2><p>è°·æ­ŒDNS: 8.8.8.8  â€“ ä¸ªäººå°è¯•ä¸‹æ¥æ¯”è¾ƒæ¨è</p><p>è…¾è®¯DNS : 119.29.29.29</p><p>AliDNS é˜¿é‡Œ<br>é¦–é€‰ï¼š 223.5.5.5 å¤‡ç”¨ï¼š 223.6.6.6</p><p>114 DNS<br>å¸¸è§„å…¬å…± DNS (å¹²å‡€æ— åŠ«æŒ)</p><p>é¦–é€‰ï¼š 114.114.114.114</p><p>å¤‡é€‰ï¼š 114.114.115.115</p><p>æ‹¦æˆªé’“é±¼ç—…æ¯’æœ¨é©¬ç½‘ç«™ (ä¿æŠ¤ä¸Šç½‘å®‰å…¨)</p><p>é¦–é€‰ï¼š 114.114.114.119</p><p>å¤‡ç”¨ï¼š 114.114.115.119</p><p>æ‹¦æˆªè‰²æƒ…ç½‘ç«™ (ä¿æŠ¤å„¿ç«¥)</p><p>é¦–é€‰ï¼š 114.114.114.110</p><p>å¤‡ç”¨ï¼š 114.114.115.110</p>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitlab download files</title>
    <link href="/2025/03/06/gitlab-download-files/"/>
    <url>/2025/03/06/gitlab-download-files/</url>
    
    <content type="html"><![CDATA[<h1 id="Gitlab-ä¸‹è½½æ–‡ä»¶"><a href="#Gitlab-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="Gitlab ä¸‹è½½æ–‡ä»¶"></a>Gitlab ä¸‹è½½æ–‡ä»¶</h1><p>èƒŒæ™¯ï¼šæœ‰éœ€æ±‚ä» gitlab ä¸‹è½½æ–‡ä»¶ï¼Œä½†æ˜¯åˆä¸æƒ³ä¸‹è½½æ•´ä¸ªé¡¹ç›®ï¼Œè€Œæ˜¯åªæƒ³ä¸‹è½½æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚<br>     gitlab ä¸Šæœ‰äº›é¡¹ç›®èƒ½è¾¾åˆ°å‡  G åˆ°å‡ å G ä¸ç­‰ï¼Œå…¨éƒ¨ä¸‹è½½è€—æ—¶ã€‚<br>     å†…ç½‘åŠå…¬ç¯å¢ƒä¸‹æ— æƒé™ä¼ å…¥ä¸‰æ–¹å¼€æºå·¥å…·ï¼Œæ‰€ä»¥åªèƒ½é‡å¤é€ è½®å­ï¼Œå†™äº†ä¸ª shell ç‰ˆçš„ä¸´æ—¶ä½¿ç”¨ã€‚</p><p>ä¸»è¦ç”¨åˆ°ä¸‰ä¸ªæ¥å£ï¼š</p><ul><li><code>api/v4/projects?search=$&#123;proj_name&#125;</code> æŸ¥è¯¢é¡¹ç›®ä¿¡æ¯æ¥å£</li><li><code>api/v4/projects/$&#123;proj_id&#125;/repository/tree?ref=$&#123;branch&#125;&amp;path=$&#123;path&#125;</code> æŸ¥è¯¢ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯æ¥å£</li><li><code>api/v4/projects/$&#123;proj_id&#125;/repository/files/$&#123;path&#125;/raw?ref=$&#123;branch&#125;</code> ä¸‹è½½æ–‡ä»¶æ¥å£</li></ul><p>å¤§æ¦‚æ€è·¯ï¼š</p><ol><li>å…ˆé€šè¿‡ <code>api/v4/projects?search=$&#123;proj_name&#125;</code> æŸ¥è¯¢é¡¹ç›®ä¿¡æ¯æ¥å£ï¼Œè·å–é¡¹ç›® id</li><li>é€šè¿‡ <code>api/v4/projects/$&#123;proj_id&#125;/repository/tree?ref=$&#123;branch&#125;&amp;path=$&#123;path&#125;</code> æŸ¥è¯¢ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯æ¥å£ï¼Œè·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶è·¯å¾„</li><li>éå†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œé€šè¿‡ <code>api/v4/projects/$&#123;proj_id&#125;/repository/files/$&#123;path&#125;/raw?ref=$&#123;branch&#125;</code> ä¸‹è½½æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>:&lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span><br>API from gitlab version 17.4<br>EOF<br><br><span class="hljs-keyword">function</span> get_params &#123;<br>    proj_name=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$url</span>&quot;</span> | awk -F<span class="hljs-string">&#x27;/-/&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs <span class="hljs-built_in">basename</span>`<br>    branch=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$url</span>&quot;</span> | awk -F<span class="hljs-string">&#x27;/-/&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F/ <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>    version_path=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$url</span>&quot;</span> | awk -F<span class="hljs-string">&quot;/-/&quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | awk -F <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;branch&#125;</span>&quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>    gitlab_url=`<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$url</span>&quot;</span> | sed -E <span class="hljs-string">&#x27;s|^(https?://[^/]+).*|\1|&#x27;</span>`<br>&#125;<br><br><span class="hljs-keyword">function</span> encode_to_url &#123;<br>    orl_name=<span class="hljs-variable">$&#123;1##*/&#125;</span><br>    file_name=<span class="hljs-variable">$&#123;orl_name%.*&#125;</span><br>    file_postfix=<span class="hljs-variable">$&#123;orl_name##*.&#125;</span><br><br>    <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;file_postfix&#125;</span>&quot;</span> = <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;file_name&#125;</span>&quot;</span> &amp;&amp; file_postfix=<span class="hljs-string">&quot;&quot;</span><br><br>    file_name=`<span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;file_name&#125;</span>&quot;</span> | <span class="hljs-built_in">od</span> -An -tx1 | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> % | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&quot;\n&quot;</span>`<br><br>    <span class="hljs-built_in">test</span> -z <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;file_postfix&#125;</span>&quot;</span> &amp;&amp; file_name_plus=<span class="hljs-variable">$&#123;file_name&#125;</span> || file_name_plus=<span class="hljs-variable">$&#123;file_name&#125;</span>.<span class="hljs-variable">$&#123;file_postfix&#125;</span><br><br>&#125;<br><br><span class="hljs-keyword">function</span> get_files &#123;<br>    proj_id=$(curl -s -H <span class="hljs-string">&quot;PRIVATE-TOKEN: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;gitlab_url&#125;</span>/api/v4/projects?search=<span class="hljs-variable">$&#123;proj_name&#125;</span>&quot;</span> \<br>        | jq -r --arg proj_name <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;proj_name&#125;</span>&quot;</span> <span class="hljs-string">&#x27;.[] | select(.name==$proj_name) | .id&#x27;</span>)<br><br>    path_list=$(curl -s -H <span class="hljs-string">&quot;PRIVATE-TOKEN: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> \<br>        <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;gitlab_url&#125;</span>/api/v4/projects/<span class="hljs-variable">$&#123;proj_id&#125;</span>/repository/tree?ref=<span class="hljs-variable">$&#123;branch&#125;</span>&amp;path=<span class="hljs-variable">$&#123;version_path#/*&#125;</span>&quot;</span> | jq -r <span class="hljs-string">&quot;.[].path&quot;</span>)<br><br>    version_path=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;version_path#/*&#125;</span> | sed <span class="hljs-string">&#x27;s#/#%2F#g&#x27;</span>`<br>    IFS=$<span class="hljs-string">&#x27;\n&#x27;</span><br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;path_list&#125;</span><br>    <span class="hljs-keyword">do</span><br>        encode_to_url <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;item&#125;</span>&quot;</span><br>        download_files<br>    <span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-keyword">function</span> download_files &#123;<br>    file_url=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;gitlab_url&#125;</span>/api/v4/projects/<span class="hljs-variable">$&#123;proj_id&#125;</span>/repository/files/<span class="hljs-variable">$&#123;version_path&#125;</span>%2F<span class="hljs-variable">$&#123;file_name_plus&#125;</span>/raw?ref=<span class="hljs-variable">$&#123;branch&#125;</span>&quot;</span><br>    curl -sSL -H <span class="hljs-string">&quot;PRIVATE-TOKEN: <span class="hljs-variable">$&#123;TOKEN&#125;</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;file_url&#125;</span>&quot;</span> -o <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;orl_name&#125;</span>&quot;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> options &#123;<br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">test</span> <span class="hljs-variable">$#</span> -gt 0<br>    <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-keyword">in</span><br>            -u|--url)<br>                url=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span><br>                ;;<br>            -t|--token)<br>                TOKEN=<span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span><br>                ;;<br>            *) Usage ;;<br>        <span class="hljs-keyword">esac</span><br>        <span class="hljs-built_in">shift</span> 2<br>    <span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">Usage</span></span>()&#123;<br>    <span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">$&#123;0##*/&#125; in order to download files from gitlab</span><br><span class="hljs-string">    Usage:</span><br><span class="hljs-string">        -u|--url       gitlab url.</span><br><span class="hljs-string">        -t|--token     gitlab token.</span><br><span class="hljs-string">EOF</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br>    TOKEN=<span class="hljs-string">&quot;&quot;</span><br>    options <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>    get_params<br>    get_files<br>&#125;<br><br>main <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><br><span class="hljs-built_in">exit</span> 0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python jinja2</title>
    <link href="/2025/03/05/python-jinja2/"/>
    <url>/2025/03/05/python-jinja2/</url>
    
    <content type="html"><![CDATA[<h1 id="jinjia2-æ¨¡æ¿å¼•æ“"><a href="#jinjia2-æ¨¡æ¿å¼•æ“" class="headerlink" title="jinjia2 æ¨¡æ¿å¼•æ“"></a>jinjia2 æ¨¡æ¿å¼•æ“</h1><p>jinjia2 å¯ç”¨äºç”Ÿæˆ htmlã€xmlã€yaml ç­‰æ ¼å¼çš„æ–‡ä»¶</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template<br>template = Template(<span class="hljs-string">&#x27;Hello &#123;&#123; name &#125;&#125;!&#x27;</span>)<br>template.render(name=<span class="hljs-string">&#x27;John Doe&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h2><p>æ¨¡æ¿åŒ…å«<code>å˜é‡</code>æˆ–<code>è¡¨è¾¾å¼</code> ï¼Œè¿™ä¸¤è€…åœ¨æ¨¡æ¿æ±‚å€¼çš„æ—¶å€™ä¼šè¢«æ›¿æ¢ä¸ºå€¼ã€‚æ¨¡æ¿ä¸­è¿˜æœ‰æ ‡ç­¾ï¼Œæ§åˆ¶æ¨¡æ¿çš„é€»è¾‘ã€‚æ¨¡æ¿è¯­æ³•çš„å¤§é‡çµæ„Ÿæ¥è‡ªäº Django å’Œ Python ã€‚</p><p>ä¸¤ç±»åˆ†éš”ç¬¦ï¼š</p><ul><li><code>&#123;&#123;  &#125;&#125;</code></li><li><code>&#123;%  %&#125;</code></li></ul><blockquote><p>åœ¨å‰æˆ–ååŠ ä¸Š-å¯ä»¥ç”¨äºå»æ‰ç©ºæ ¼æˆ–ç©ºè¡Œï¼Œå¦‚ <code>&#123;&#123;- -&#125;&#125;</code> <code>&#123;&#123;%-  -%&#125;&#125;</code></p></blockquote><h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><ul><li><p>safe æ¸²æŸ“æ—¶å€¼ä¸è½¬ä¹‰</p></li><li><p>capitialize æŠŠå€¼çš„é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ï¼Œå…¶ä»–å­—æ¯è½¬æ¢ä¸ºå°å†™</p></li><li><p>lower æŠŠå€¼è½¬æ¢æˆå°å†™å½¢å¼</p></li><li><p>upper æŠŠå€¼è½¬æ¢æˆå¤§å†™å½¢å¼</p></li><li><p>title æŠŠå€¼ä¸­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½è½¬æ¢æˆå¤§å†™</p></li><li><p>trim æŠŠå€¼çš„é¦–å°¾ç©ºæ ¼å»æ‰</p></li><li><p>striptags æ¸²æŸ“ä¹‹å‰æŠŠå€¼ä¸­æ‰€æœ‰çš„HTMLæ ‡ç­¾éƒ½åˆ æ‰</p></li><li><p>join æ‹¼æ¥å¤šä¸ªå€¼ä¸ºå­—ç¬¦ä¸²</p></li><li><p>replace æ›¿æ¢å­—ç¬¦ä¸²çš„å€¼</p></li><li><p>round é»˜è®¤å¯¹æ•°å­—è¿›è¡Œå››èˆäº”å…¥ï¼Œä¹Ÿå¯ä»¥ç”¨å‚æ•°è¿›è¡Œæ§åˆ¶</p></li><li><p>int æŠŠå€¼è½¬æ¢æˆæ•´å‹</p></li></ul><h2 id="æ¨¡æ¿ç»§æ‰¿"><a href="#æ¨¡æ¿ç»§æ‰¿" class="headerlink" title="æ¨¡æ¿ç»§æ‰¿"></a>æ¨¡æ¿ç»§æ‰¿</h2><h3 id="åŸºç¡€æ¨¡æ¿"><a href="#åŸºç¡€æ¨¡æ¿" class="headerlink" title="åŸºç¡€æ¨¡æ¿"></a>åŸºç¡€æ¨¡æ¿</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;head&gt;<br>    &#123;% block head %&#125;<br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;style.css&quot;</span> /&gt;<br>    &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125; - My Webpage&lt;/title&gt;<br>    &#123;% endblock %&#125;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;&#123;% block content %&#125;&#123;% endblock %&#125;&lt;/div&gt;<br>    &lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;<br>        &#123;% block footer %&#125;<br>        &amp;copy; Copyright <span class="hljs-number">2008</span> by &lt;a href=<span class="hljs-string">&quot;http://domain.invalid/&quot;</span>&gt;you&lt;/a&gt;.<br>        &#123;% endblock %&#125;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br></code></pre></td></tr></table></figure><h3 id="å­æ¨¡æ¿"><a href="#å­æ¨¡æ¿" class="headerlink" title="å­æ¨¡æ¿"></a>å­æ¨¡æ¿</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% extends <span class="hljs-string">&quot;base.html&quot;</span> %&#125;<br>&#123;% block title %&#125;Index&#123;% endblock %&#125;<br>&#123;% block head %&#125;<br>    &#123;&#123; <span class="hljs-built_in">super</span>() &#125;&#125;<br>    &lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;<br>        .important &#123; color: <span class="hljs-comment">#336699; &#125;</span><br>    &lt;/style&gt;<br>&#123;% endblock %&#125;<br>&#123;% block content %&#125;<br>    &lt;h1&gt;Index&lt;/h1&gt;<br>    &lt;p <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;important&quot;</span>&gt;<br>      Welcome on my awesome homepage.<br>    &lt;/p&gt;<br>&#123;% endblock %&#125;<br></code></pre></td></tr></table></figure><h2 id="æ§åˆ¶ç»“æ„"><a href="#æ§åˆ¶ç»“æ„" class="headerlink" title="æ§åˆ¶ç»“æ„"></a>æ§åˆ¶ç»“æ„</h2><h3 id="for-å¾ªç¯"><a href="#for-å¾ªç¯" class="headerlink" title="for å¾ªç¯"></a>for å¾ªç¯</h3><p>åœ¨ä¸€ä¸ª for å¾ªç¯å—ä¸­ä½ å¯ä»¥è®¿é—®è¿™äº›ç‰¹æ®Šçš„å˜é‡:</p><ul><li><p>loop.index å½“å‰å¾ªç¯è¿­ä»£çš„æ¬¡æ•°ï¼ˆä» 1 å¼€å§‹ï¼‰</p></li><li><p>loop.index0 å½“å‰å¾ªç¯è¿­ä»£çš„æ¬¡æ•°ï¼ˆä» 0 å¼€å§‹ï¼‰</p></li><li><p>loop.revindex åˆ°å¾ªç¯ç»“æŸéœ€è¦è¿­ä»£çš„æ¬¡æ•°ï¼ˆä» 1 å¼€å§‹ï¼‰</p></li><li><p>loop.revindex0 åˆ°å¾ªç¯ç»“æŸéœ€è¦è¿­ä»£çš„æ¬¡æ•°ï¼ˆä» 0 å¼€å§‹ï¼‰</p></li><li><p>loop.first å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œä¸º True ã€‚</p></li><li><p>loop.last å¦‚æœæ˜¯æœ€åä¸€æ¬¡è¿­ä»£ï¼Œä¸º True ã€‚</p></li><li><p>loop.length åºåˆ—ä¸­çš„é¡¹ç›®æ•°ã€‚</p></li><li><p>loop.cycle åœ¨ä¸€ä¸²åºåˆ—é—´æœŸå–å€¼çš„è¾…åŠ©å‡½æ•°ã€‚</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span> %&#125;<br>    &#123;&#123; item &#125;&#125;<br>&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure><h3 id="if-æ¡ä»¶åˆ¤æ–­"><a href="#if-æ¡ä»¶åˆ¤æ–­" class="headerlink" title="if æ¡ä»¶åˆ¤æ–­"></a>if æ¡ä»¶åˆ¤æ–­</h3><ul><li><p><code>==</code> æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</p></li><li><p><code>!=</code> æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„ä¸ç­‰å¼ã€‚</p></li><li><p><code>&gt;</code> å¦‚æœå·¦ä¾§å¤§äºå³ä¾§ï¼Œåˆ™ä¸ºtrueã€‚</p></li><li><p><code>&gt;=</code> å¦‚æœå·¦ä¾§å¤§äºæˆ–ç­‰äºå³ä¾§ï¼Œåˆ™ä¸ºtrueã€‚</p></li><li><p><code>&lt;</code> å¦‚æœå·¦ä¾§å°äºå³ä¾§ï¼Œåˆ™ä¸ºtrueã€‚</p></li><li><p><code>&lt;=</code> å¦‚æœå·¦ä¾§å°äºæˆ–ç­‰äºå³ä¾§ï¼Œåˆ™ä¸ºtrue</p></li><li><p>and å¦‚æœå·¦å³æ“ä½œæ•°ä¸ºçœŸï¼Œåˆ™è¿”å›trueã€‚</p></li><li><p>or å¦‚æœå·¦æ“ä½œæ•°æˆ–å³æ“ä½œæ•°ä¸ºçœŸï¼Œåˆ™è¿”å›trueã€‚</p></li><li><p>not éï¼Œnot x ï¼šå¦‚æœ x ä¸º Trueï¼Œè¿”å› False ã€‚å¦‚æœ x ä¸º Falseï¼Œå®ƒè¿”å› Trueã€‚</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">if</span> path != <span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">and</span> path <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> none %&#125;<br>&#123;% endif %&#125;<br></code></pre></td></tr></table></figure><h2 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h2><p>å¯ä»¥çœ‹åš jinjia2 ä¸­çš„å‡½æ•°ï¼Œç”¨äºå–ä»£é‡å¤çš„å·¥ä½œ</p>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell script ssh &amp; linux cmd tips</title>
    <link href="/2025/03/05/shell-script-ssh/"/>
    <url>/2025/03/05/shell-script-ssh/</url>
    
    <content type="html"><![CDATA[<h1 id="è„šæœ¬æ‰¹é‡sshç™»å½•"><a href="#è„šæœ¬æ‰¹é‡sshç™»å½•" class="headerlink" title="è„šæœ¬æ‰¹é‡sshç™»å½•"></a>è„šæœ¬æ‰¹é‡sshç™»å½•</h1><ul><li>å¯ä»¥é€šè¿‡ expect å®ç°</li><li>å¯ä»¥é€šè¿‡ sshpass å®ç°</li></ul><h2 id="expect-è„šæœ¬"><a href="#expect-è„šæœ¬" class="headerlink" title="expect è„šæœ¬"></a>expect è„šæœ¬</h2><p>åç»­è¡¥å……</p><h2 id="sshpass-è„šæœ¬"><a href="#sshpass-è„šæœ¬" class="headerlink" title="sshpass è„šæœ¬"></a>sshpass è„šæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">while</span> IFS=<span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-built_in">read</span> -r ip <span class="hljs-built_in">uname</span> passwd<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ssh <span class="hljs-variable">$ip</span> <span class="hljs-variable">$uname</span> <span class="hljs-variable">$password</span>&quot;</span><br>    sshpass -p <span class="hljs-string">&quot;<span class="hljs-variable">$passwd</span>&quot;</span> ssh -o StrictHostKeyChecking=no -n <span class="hljs-string">&quot;<span class="hljs-variable">$uname</span>@<span class="hljs-variable">$ip</span>&quot;</span> &lt; /dev/null<br>    <span class="hljs-built_in">sleep</span> 1<br><span class="hljs-keyword">done</span> &lt; info.txt<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„äº‹é¡¹</strong></p><p>ssh ä¼šåœ¨ç™»å½•åè¯»å–æ‰€æœ‰æ ‡å‡†è¾“å…¥ï¼Œå› æ­¤ä¼šå¯¼è‡´å¾ªç¯ read åé¢çš„å†…å®¹è¢« ssh åæ‰ï¼Œå¯¼è‡´åªä¼šç™»å½•ä¸€æ¬¡</p><p>å› æ­¤éœ€è¦ç”¨ ssh -né€‰é¡¹æˆ–è€…åœ¨æœ€åä½¿ç”¨ &lt; &#x2F;dev&#x2F;null</p></blockquote><h2 id="linux-command-tips"><a href="#linux-command-tips" class="headerlink" title="linux command tips"></a>linux command tips</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># rpm -q åªèƒ½æŒ‰å¼€å¤´æŸ¥è¯¢ï¼Œ å¦‚ rpm -q zabbix-agent åªèƒ½æŸ¥åˆ°zabbix-agentåŒ…ï¼ŒæŸ¥ä¸åˆ° pcp-export-zabbix-agentè¿™æ ·çš„åŒ…</span><br>ps -Fu zabbix <span class="hljs-comment"># æŒ‰ç”¨æˆ·æŸ¥æ‰¾è¿›ç¨‹</span><br><span class="hljs-built_in">cp</span> /tmp/test.sh&#123;,.bak&#125; <span class="hljs-comment"># å¤åˆ¶æ–‡ä»¶å¹¶é‡å‘½åï¼Œè¿™æ ·ä¸ç”¨å†å¤šæ•²ä¸€æ®µè·¯å¾„</span><br><br><span class="hljs-comment">## è¿™æ®µsedåŸºæœ¬å›Šæ‹¬å¸¸ç”¨å†™æ³•ï¼Œ-i.bak ä¿®æ”¹çš„åŒæ—¶ç”Ÿæˆä¸€ä¸ª.bakåç¼€çš„æœªä¿®æ”¹ç‰ˆæ–‡ä»¶ï¼Œ-e åæ¥ sed è¡¨è¾¾å¼ï¼Œ\1è¡¨ç¤ºç¬¬ä¸€ä¸ªæ‹¬å·å†…åŒ¹é…çš„å†…å®¹</span><br>sed -i.bak -e <span class="hljs-string">&quot;s/\(Server=\|ServerActive=\)[^ ]*/\1192.168.4.4/g&quot;</span> \<br>    -e <span class="hljs-string">&quot;s/\(^Hostname=\)[^.]*/\1&quot;</span>$(ip a | grep inet | grep brd | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>| <span class="hljs-built_in">head</span> -1 | <span class="hljs-built_in">cut</span> -d/ -f1)<span class="hljs-string">&quot;/g&quot;</span> \<br>    -e <span class="hljs-string">&quot;/# HostMetadata=/a HostMetadata=Linux&quot;</span> \<br>    -e <span class="hljs-string">&quot;/# HostMetadataItem=/a HostMetadataItem=Linux&quot;</span> \<br>    /etc/zabbix/zabbix_agentd.conf<br><br><span class="hljs-comment"># testå‘½ä»¤åšé€†åˆ¤æ–­ä¼šå‡ºç°é€€å‡ºçŠ¶æ€ç ä¸ºé0çš„æƒ…å†µï¼Œæ¯”å¦‚</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">test</span> $? -ne 0 &amp;&amp; &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;failed&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125; <br><span class="hljs-comment"># ç”±äºlså‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œtest $? -ne 0 ä¸ºå‡ï¼Œtestå‘½ä»¤æœ¬èº«è¿”å›éé›¶å€¼</span><br><span class="hljs-comment"># å¦‚æœè¿™ä¸ªè¯­å¥ä½œä¸ºæ•´ä¸ªè„šæœ¬çš„æœ€åä¸€å¥ï¼Œä¼šå¯¼è‡´å³ä½¿è„šæœ¬å®é™…æ‰§è¡ŒæˆåŠŸï¼Œä½†æœ€åè„šæœ¬çš„é€€å‡ºç ä¹Ÿä¸ºé0</span><br><span class="hljs-comment"># æ”¹æˆé¡ºé€»è¾‘å³å¯</span><br><span class="hljs-built_in">test</span> $? -eq 0 || &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;failed&quot;</span>; <span class="hljs-built_in">exit</span> 1; &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å¤šçº¿ç¨‹ç¼–ç¨‹</title>
    <link href="/2025/01/03/python-multithread/"/>
    <url>/2025/01/03/python-multithread/</url>
    
    <content type="html"><![CDATA[<h1 id="Python-å¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#Python-å¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="Python å¤šçº¿ç¨‹ç¼–ç¨‹"></a>Python å¤šçº¿ç¨‹ç¼–ç¨‹</h1><h2 id="çº¿ç¨‹åˆ†é…å…¬å¼"><a href="#çº¿ç¨‹åˆ†é…å…¬å¼" class="headerlink" title="çº¿ç¨‹åˆ†é…å…¬å¼"></a>çº¿ç¨‹åˆ†é…å…¬å¼</h2><p><code>concurrent.futures.ThreadPoolExecutor</code> é»˜è®¤çº¿ç¨‹æ•° <code>min(32, (os.cpu_count() or 1) + 4)</code></p><ul><li>è®¡ç®—å¯†é›†å‹<ul><li>çº¿ç¨‹æ•° â‰ˆ CPU æ ¸å¿ƒæ•°ï¼Œé¿å…è¿‡å¤šçº¿ç¨‹å¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</li></ul></li><li>I&#x2F;O å¯†é›†å‹<ul><li>çº¿ç¨‹æ•°å¯ä»¥é€‚å½“å¢å¤§ï¼Œå…·ä½“æ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ I&#x2F;Oï¼‰è°ƒæ•´</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-keyword">with</span> ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-built_in">print</span>(executor._max_workers)  <span class="hljs-comment"># è¾“å‡ºé»˜è®¤çº¿ç¨‹æ•°</span><br></code></pre></td></tr></table></figure><h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><br><span class="hljs-keyword">with</span> ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:<br>    <span class="hljs-comment"># æäº¤ä»»åŠ¡</span><br>    future1 = executor.submit(<span class="hljs-built_in">pow</span>, <span class="hljs-number">323</span>, <span class="hljs-number">1235</span>)<br>    future2 = executor.submit(<span class="hljs-built_in">pow</span>, <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># è·å–ä»»åŠ¡ç»“æœ</span><br>    <span class="hljs-built_in">print</span>(future1.result())<br>    <span class="hljs-built_in">print</span>(future2.result())<br><br>    <span class="hljs-comment"># è¿”å›ç»“æœè¿­ä»£å™¨</span><br>    res = executor.<span class="hljs-built_in">map</span>(<span class="hljs-built_in">pow</span>, [<span class="hljs-number">323</span>, <span class="hljs-number">1235</span>], [<span class="hljs-number">1235</span>, <span class="hljs-number">1235</span>])<br></code></pre></td></tr></table></figure><h2 id="map-å‡½æ•°-lambda-å‡½æ•°"><a href="#map-å‡½æ•°-lambda-å‡½æ•°" class="headerlink" title="map å‡½æ•° &amp; lambda å‡½æ•°"></a>map å‡½æ•° &amp; lambda å‡½æ•°</h2><h3 id="lambda-å‡½æ•°"><a href="#lambda-å‡½æ•°" class="headerlink" title="lambda å‡½æ•°"></a>lambda å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åµŒå¥— lambda å‡½æ•°</span><br><span class="hljs-comment"># lambda å‡½æ•°è§£åŒ…å‚æ•°</span><br><span class="hljs-keyword">lambda</span> item: (<span class="hljs-keyword">lambda</span> route, flag: func(<span class="hljs-string">&quot;&quot;</span>, route, flag))(*item)<br><br><span class="hljs-comment"># itemä¹Ÿå¯ä»¥æ˜¯å­—å…¸ç­‰å¯è¿­ä»£å¯¹è±¡</span><br><span class="hljs-comment"># ç¤ºä¾‹ï¼šè§£åŒ…å­—å…¸</span><br>kwargs = &#123;<span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;y&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;z&quot;</span>: <span class="hljs-number">3</span>&#125;<br>result = (<span class="hljs-keyword">lambda</span> x, y, z: x + y + z)(**kwargs)  <span class="hljs-comment"># ä½¿ç”¨ ** è§£åŒ…å­—å…¸</span><br><span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># è¾“å‡º: 6</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">key1, key2</span>):<br>    <span class="hljs-keyword">return</span> key1 + key2<br>result = (<span class="hljs-keyword">lambda</span> key1, key2: func(key1, key2))(**item)<br><br><span class="hljs-comment"># ç¤ºä¾‹ï¼šåŒæ—¶è§£åŒ…åˆ—è¡¨å’Œå­—å…¸</span><br>args = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]<br>kwargs = &#123;<span class="hljs-string">&quot;z&quot;</span>: <span class="hljs-number">3</span>&#125;<br>result = (<span class="hljs-keyword">lambda</span> x, y, z: x + y + z)(*args, **kwargs)<br><span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># è¾“å‡º: 6</span><br><br><span class="hljs-comment"># ç¤ºä¾‹ï¼šåµŒå¥—è§£åŒ…</span><br>nested = [&#123;<span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;y&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;z&quot;</span>: <span class="hljs-number">3</span>&#125;, &#123;<span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&quot;y&quot;</span>: <span class="hljs-number">5</span>, <span class="hljs-string">&quot;z&quot;</span>: <span class="hljs-number">6</span>&#125;]<br>result = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> item: (<span class="hljs-keyword">lambda</span> x, y, z: x + y + z)(**item), nested))<br><span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># è¾“å‡º: [6, 15]</span><br></code></pre></td></tr></table></figure><h3 id="map-å‡½æ•°"><a href="#map-å‡½æ•°" class="headerlink" title="map å‡½æ•°"></a>map å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">map</span>(func, iterables)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x + y<br><br>list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>list2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br><br><span class="hljs-comment"># ä½¿ç”¨ map å°†ä¸¤ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ä¼ å…¥ add å‡½æ•°</span><br>result = <span class="hljs-built_in">map</span>(add, list1, list2)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(result))  <span class="hljs-comment"># è¾“å‡º: [5, 7, 9]</span><br><br>list1 = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>]<br>list2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><br><span class="hljs-comment"># ä½¿ç”¨ lambda è¡¨è¾¾å¼ç›´æ¥ä¼ é€’ä¸¤ä¸ªå€¼</span><br>result = <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x, y: x * y, list1, list2)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(result))  <span class="hljs-comment"># è¾“å‡º: [10, 40, 90]</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">concat</span>(<span class="hljs-params">prefix, word</span>):<br>    <span class="hljs-keyword">return</span> prefix + word<br><br><span class="hljs-comment"># ç¬¬ä¸€ä¸ªå‚æ•°å›ºå®šä¸º &quot;&quot;, ç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆ—è¡¨</span><br>words = [<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;cherry&quot;</span>]<br><br><span class="hljs-comment"># ä½¿ç”¨ map å‡½æ•°</span><br>result = <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> word: concat(<span class="hljs-string">&quot;&quot;</span>, word), words)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(result))  <span class="hljs-comment"># è¾“å‡º: [&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;cherry&#x27;]</span><br><br><span class="hljs-comment"># ä½¿ç”¨ itertools.repeat</span><br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> repeat<br><br><span class="hljs-comment"># å®šä¹‰åˆ—è¡¨</span><br>words = [<span class="hljs-string">&quot;apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;cherry&quot;</span>]<br><br><span class="hljs-comment"># ä½¿ç”¨ repeat å°† &quot;&quot; ä½œä¸ºå›ºå®šå€¼ä¼ é€’</span><br>result = <span class="hljs-built_in">map</span>(concat, repeat(<span class="hljs-string">&quot;&quot;</span>), words)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(result))  <span class="hljs-comment"># è¾“å‡º: [&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;cherry&#x27;]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å¼‚æ­¥</title>
    <link href="/2024/12/27/python-async/"/>
    <url>/2024/12/27/python-async/</url>
    
    <content type="html"><![CDATA[<h1 id="Python-å¼‚æ­¥ç¼–ç¨‹"><a href="#Python-å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="Python å¼‚æ­¥ç¼–ç¨‹"></a>Python å¼‚æ­¥ç¼–ç¨‹</h1><p>ä½¿ç”¨ async å’Œ await æ—¶ï¼Œawait ä¼šä½¿å½“å‰çš„åç¨‹æš‚åœå¹¶ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_task</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Task <span class="hljs-subst">&#123;i&#125;</span> started&quot;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Task <span class="hljs-subst">&#123;i&#125;</span> completed&quot;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-keyword">await</span> async_task(i)<br><br><span class="hljs-comment"># è¿è¡Œåç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ol><li>Task 0 started ä¼šæ‰“å°å‡ºæ¥ã€‚</li><li>await asyncio.sleep(1) ä¼šæš‚åœå½“å‰åç¨‹ 1 ç§’ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤å›äº‹ä»¶å¾ªç¯ã€‚</li><li>åœ¨è¿™ 1 ç§’é’Ÿå†…ï¼Œäº‹ä»¶å¾ªç¯å¯èƒ½ä¼šè¿è¡Œå…¶ä»–ä»»åŠ¡ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li><li>1 ç§’åï¼ŒTask 0 completed ä¼šæ‰“å°å‡ºæ¥ï¼Œç„¶åå¾ªç¯è¿›å…¥ä¸‹ä¸€æ¬¡è¿­ä»£ï¼ŒTask 1 å¼€å§‹ã€‚</li></ol><h2 id="å¼‚æ­¥å¹¶è¡Œä»»åŠ¡"><a href="#å¼‚æ­¥å¹¶è¡Œä»»åŠ¡" class="headerlink" title="å¼‚æ­¥å¹¶è¡Œä»»åŠ¡"></a>å¼‚æ­¥å¹¶è¡Œä»»åŠ¡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    tasks = [async_task(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]<br>    <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br></code></pre></td></tr></table></figure><ol><li>è¿”å›å€¼ï¼šæ¯ä¸ªå¼‚æ­¥ä»»åŠ¡çš„è¿”å›å€¼ä¼šæŒ‰ä»»åŠ¡çš„é¡ºåºæ’åˆ—åœ¨ gather() è¿”å›çš„åˆ—è¡¨ä¸­ã€‚</li><li>æ•è·å¼‚å¸¸ï¼šasyncio.gather() é»˜è®¤ä¼šåœ¨æŸä¸ªä»»åŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶å–æ¶ˆå…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œã€‚å¦‚æœæƒ³æ•è·æ‰€æœ‰ä»»åŠ¡çš„å¼‚å¸¸å¹¶ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥å°† return_exceptions&#x3D;True ä¼ é€’ç»™ gather()ã€‚</li></ol><p>async def å®šä¹‰çš„å‡½æ•°è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œåªæœ‰é€šè¿‡ await æˆ–é€šè¿‡äº‹ä»¶å¾ªç¯è¿è¡Œå®ƒæ—¶ï¼Œå®ƒæ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚</p><ul><li>async_task(i) è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œä»»åŠ¡ï¼Œåªæ˜¯ç”Ÿæˆäº†ä¸€ä¸ªåç¨‹ã€‚</li><li>await asyncio.gather(*tasks) æ‰æ˜¯å®é™…è°ƒåº¦è¿™äº›åç¨‹å¹¶å¼€å§‹æ‰§è¡Œå®ƒä»¬çš„ä»£ç ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_task</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Task <span class="hljs-subst">&#123;i&#125;</span> started&quot;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Result from Task <span class="hljs-subst">&#123;i&#125;</span>&quot;</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># åˆ›å»ºåç¨‹å¯¹è±¡åˆ—è¡¨ï¼Œä½†è¿™äº›åç¨‹å¯¹è±¡å¹¶æ²¡æœ‰å¼€å§‹æ‰§è¡Œ</span><br>    tasks = [async_task(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Tasks created&quot;</span>)<br><br>    <span class="hljs-comment"># é€šè¿‡ asyncio.gather æ¥è¿è¡Œæ‰€æœ‰åç¨‹å¯¹è±¡å¹¶ç­‰å¾…å®ƒä»¬çš„ç»“æœ</span><br>    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;All results:&quot;</span>, results)<br><br><span class="hljs-comment"># è¿è¡Œåç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><h2 id="aiohttp"><a href="#aiohttp" class="headerlink" title="aiohttp"></a>aiohttp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-comment"># å¼‚æ­¥å‡½æ•°ï¼Œå‘é€ HTTP è¯·æ±‚</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url) <span class="hljs-keyword">as</span> response:<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.text()<br><br><span class="hljs-comment"># è°ƒç”¨å¼‚æ­¥å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    url = <span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span><br>    result = <span class="hljs-keyword">await</span> fetch(url)<br>    <span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># å¯åŠ¨äº‹ä»¶å¾ªç¯</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    asyncio.run(main())<br></code></pre></td></tr></table></figure><blockquote><p>aiohttp çš„ headersã€URL å‚æ•°ã€cookies ä¸­çš„ é”® å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹</p><p>aiohttp ä¸æ¥å— None ç±»å‹çš„æ•°æ®</p></blockquote><h2 id="aiofiles"><a href="#aiofiles" class="headerlink" title="aiofiles"></a>aiofiles</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiofiles<br><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-comment"># å¼‚æ­¥å†™æ–‡ä»¶</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">write_file</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiofiles.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, mode=<span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">await</span> f.write(<span class="hljs-string">&quot;Hello, aiofiles!&quot;</span>)<br><br><span class="hljs-comment"># å¼‚æ­¥è¯»æ–‡ä»¶</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiofiles.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;example.txt&#x27;</span>, mode=<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        content = <span class="hljs-keyword">await</span> f.read()<br>        <span class="hljs-built_in">print</span>(content)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">await</span> write_file()  <span class="hljs-comment"># å†™å…¥æ–‡ä»¶</span><br>    <span class="hljs-keyword">await</span> read_file()   <span class="hljs-comment"># è¯»å–æ–‡ä»¶</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    asyncio.run(main())<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8s ConfigMap</title>
    <link href="/2024/12/23/k8s-configmap/"/>
    <url>/2024/12/23/k8s-configmap/</url>
    
    <content type="html"><![CDATA[<h1 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h1><h2 id="åŸºäºä¸€ä¸ªç›®å½•æ¥åˆ›å»º-ConfigMap"><a href="#åŸºäºä¸€ä¸ªç›®å½•æ¥åˆ›å»º-ConfigMap" class="headerlink" title="åŸºäºä¸€ä¸ªç›®å½•æ¥åˆ›å»º ConfigMap"></a>åŸºäºä¸€ä¸ªç›®å½•æ¥åˆ›å»º ConfigMap</h2><p>åŸºäºç›®å½•æ¥åˆ›å»º ConfigMap æ—¶ï¼Œkubectl è¯†åˆ«ç›®å½•ä¸‹æ–‡ä»¶åå¯ä»¥ä½œä¸ºåˆæ³•é”®åçš„æ–‡ä»¶ï¼Œ å¹¶å°†è¿™äº›æ–‡ä»¶æ‰“åŒ…åˆ°æ–°çš„ ConfigMap ä¸­ã€‚æ™®é€šæ–‡ä»¶ä¹‹å¤–çš„æ‰€æœ‰ç›®å½•é¡¹éƒ½ä¼šè¢«å¿½ç•¥ ï¼ˆä¾‹å¦‚ï¼šå­ç›®å½•ã€ç¬¦å·é“¾æ¥ã€è®¾å¤‡ã€ç®¡é“ç­‰ç­‰ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p configure-pod-container/configmap/<br><br><span class="hljs-comment"># å°†ç¤ºä¾‹æ–‡ä»¶ä¸‹è½½åˆ° `configure-pod-container/configmap/` ç›®å½•</span><br>wget https://kubernetes.io/examples/configmap/game.properties -O configure-pod-container/configmap/game.properties<br>wget https://kubernetes.io/examples/configmap/ui.properties -O configure-pod-container/configmap/ui.properties<br><br><span class="hljs-comment"># åˆ›å»º ConfigMap</span><br>kubectl create configmap game-config --from-file=configure-pod-container/configmap/<br><br><span class="hljs-comment"># æŸ¥çœ‹ ConfigMap è¯¦æƒ…</span><br>kubectl describe configmaps game-config<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-number">2022-02-18T18:52:05Z</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">game-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">resourceVersion:</span> <span class="hljs-string">&quot;516&quot;</span><br>  <span class="hljs-attr">uid:</span> <span class="hljs-string">b4952dc3-d670-11e5-8cd0-68f728db1985</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">game.properties:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    enemies=aliens</span><br><span class="hljs-string">    lives=3</span><br><span class="hljs-string">    enemies.cheat=true</span><br><span class="hljs-string">    enemies.cheat.level=noGoodRotten</span><br><span class="hljs-string">    secret.code.passphrase=UUDDLRLRBABAS</span><br><span class="hljs-string">    secret.code.allowed=true</span><br><span class="hljs-string">    secret.code.lives=30    </span><br><span class="hljs-string"></span>  <span class="hljs-attr">ui.properties:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    color.good=purple</span><br><span class="hljs-string">    color.bad=yellow</span><br><span class="hljs-string">    allow.textmode=true</span><br><span class="hljs-string">    how.nice.to.look=fairlyNice    </span><br></code></pre></td></tr></table></figure><h2 id="åŸºäºæ–‡ä»¶åˆ›å»º-ConfigMap"><a href="#åŸºäºæ–‡ä»¶åˆ›å»º-ConfigMap" class="headerlink" title="åŸºäºæ–‡ä»¶åˆ›å»º ConfigMap"></a>åŸºäºæ–‡ä»¶åˆ›å»º ConfigMap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl create configmap game-config-2 --from-file=configure-pod-container/configmap/game.properties<br><br>kubectl create configmap game-config-2 --from-file=configure-pod-container/configmap/game.properties --from-file=configure-pod-container/configmap/ui.properties<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ â€“from-env-file é€‰é¡¹åŸºäº env æ–‡ä»¶åˆ›å»º ConfigMap</strong></p><p>æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œæ ¼å¼ä¸º VAR&#x3D;VALã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Env æ–‡ä»¶åŒ…å«ç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚å…¶ä¸­é€‚ç”¨ä»¥ä¸‹è¯­æ³•è§„åˆ™:</span><br><span class="hljs-comment"># è¿™äº›è¯­æ³•è§„åˆ™é€‚ç”¨ï¼š</span><br><span class="hljs-comment">#   Env æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¿…é¡»ä¸º VAR=VAL æ ¼å¼ã€‚</span><br><span class="hljs-comment">#   ä»¥ï¼ƒå¼€å¤´çš„è¡Œï¼ˆå³æ³¨é‡Šï¼‰å°†è¢«å¿½ç•¥ã€‚</span><br><span class="hljs-comment">#   ç©ºè¡Œå°†è¢«å¿½ç•¥ã€‚</span><br><span class="hljs-comment">#   å¼•å·ä¸ä¼šè¢«ç‰¹æ®Šå¤„ç†ï¼ˆå³å®ƒä»¬å°†æˆä¸º ConfigMap å€¼çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚</span><br><br><span class="hljs-comment"># å°†ç¤ºä¾‹æ–‡ä»¶ä¸‹è½½åˆ° `configure-pod-container/configmap/` ç›®å½•</span><br>wget https://kubernetes.io/examples/configmap/game-env-file.properties -O configure-pod-container/configmap/game-env-file.properties<br>wget https://kubernetes.io/examples/configmap/ui-env-file.properties -O configure-pod-container/configmap/ui-env-file.properties<br><br><span class="hljs-comment"># Env æ–‡ä»¶ `game-env-file.properties` å¦‚ä¸‹æ‰€ç¤º</span><br><span class="hljs-built_in">cat</span> configure-pod-container/configmap/game-env-file.properties<br>enemies=aliens<br>lives=3<br>allowed=<span class="hljs-string">&quot;true&quot;</span><br><span class="hljs-comment"># æ­¤æ³¨é‡Šå’Œä¸Šæ–¹çš„ç©ºè¡Œå°†è¢«å¿½ç•¥</span><br><br>kubectl create configmap game-config-env-file \<br>       --from-env-file=configure-pod-container/configmap/game-env-file.properties<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-ConfigMap-æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨-ConfigMap-æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨ ConfigMap æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨ ConfigMap æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡</h2><h3 id="ä½¿ç”¨å•ä¸ª-ConfigMap-ä¸­çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨å•ä¸ª-ConfigMap-ä¸­çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨å•ä¸ª ConfigMap ä¸­çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨å•ä¸ª ConfigMap ä¸­çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl create configmap special-config --from-literal=special.how=very<br></code></pre></td></tr></table></figure><p>å°† ConfigMap ä¸­å®šä¹‰çš„ special.how èµ‹å€¼ç»™ Pod è§„çº¦ä¸­çš„ SPECIAL_LEVEL_KEY ç¯å¢ƒå˜é‡ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">dapi-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">registry.k8s.io/busybox</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env&quot;</span> ]<br>      <span class="hljs-attr">env:</span><br>        <span class="hljs-comment"># å®šä¹‰ç¯å¢ƒå˜é‡</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SPECIAL_LEVEL_KEY</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">configMapKeyRef:</span><br>              <span class="hljs-comment"># ConfigMap åŒ…å«ä½ è¦èµ‹ç»™ SPECIAL_LEVEL_KEY çš„å€¼</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>              <span class="hljs-comment"># æŒ‡å®šä¸å–å€¼ç›¸å…³çš„é”®å</span><br>              <span class="hljs-attr">key:</span> <span class="hljs-string">special.how</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ¥è‡ªå¤šä¸ª-ConfigMap-çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨æ¥è‡ªå¤šä¸ª-ConfigMap-çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨æ¥è‡ªå¤šä¸ª ConfigMap çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡"></a>ä½¿ç”¨æ¥è‡ªå¤šä¸ª ConfigMap çš„æ•°æ®å®šä¹‰å®¹å™¨ç¯å¢ƒå˜é‡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">special.how:</span> <span class="hljs-string">very</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">env-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">log_level:</span> <span class="hljs-string">INFO</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">dapi-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">registry.k8s.io/busybox</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env&quot;</span> ]<br>      <span class="hljs-attr">env:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SPECIAL_LEVEL_KEY</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">configMapKeyRef:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>              <span class="hljs-attr">key:</span> <span class="hljs-string">special.how</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">LOG_LEVEL</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">configMapKeyRef:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">env-config</span><br>              <span class="hljs-attr">key:</span> <span class="hljs-string">log_level</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><h3 id="å°†-ConfigMap-ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡"><a href="#å°†-ConfigMap-ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡" class="headerlink" title="å°† ConfigMap ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡"></a>å°† ConfigMap ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹é…ç½®ä¸ºå®¹å™¨ç¯å¢ƒå˜é‡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">SPECIAL_LEVEL:</span> <span class="hljs-string">very</span><br>  <span class="hljs-attr">SPECIAL_TYPE:</span> <span class="hljs-string">charm</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">dapi-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">registry.k8s.io/busybox</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;env&quot;</span> ]<br>      <span class="hljs-attr">envFrom:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><h3 id="å°†-ConfigMap-æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·ä¸­"><a href="#å°†-ConfigMap-æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·ä¸­" class="headerlink" title="å°† ConfigMap æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·ä¸­"></a>å°† ConfigMap æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·ä¸­</h3><p>å¦‚åŸºäºæ–‡ä»¶åˆ›å»º ConfigMap ä¸­æ‰€è¿°ï¼Œå½“ä½ ä½¿ç”¨ â€“from-file åˆ›å»º ConfigMap æ—¶ï¼Œæ–‡ä»¶åæˆä¸ºå­˜å‚¨åœ¨ ConfigMap çš„ data éƒ¨åˆ†ä¸­çš„é”®ï¼Œ æ–‡ä»¶å†…å®¹æˆä¸ºé”®å¯¹åº”çš„å€¼ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">SPECIAL_LEVEL:</span> <span class="hljs-string">very</span><br>  <span class="hljs-attr">SPECIAL_TYPE:</span> <span class="hljs-string">charm</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">dapi-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">registry.k8s.io/busybox</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;ls /etc/config/&quot;</span> ]<br>      <span class="hljs-attr">volumeMounts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/config</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>      <span class="hljs-attr">configMap:</span><br>        <span class="hljs-comment"># æä¾›åŒ…å«è¦æ·»åŠ åˆ°å®¹å™¨ä¸­çš„æ–‡ä»¶çš„ ConfigMap çš„åç§°</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><p>Pod è¿è¡Œæ—¶ï¼Œå‘½ä»¤ ls &#x2F;etc&#x2F;config&#x2F; äº§ç”Ÿä¸‹é¢çš„è¾“å‡º:</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">SPECIAL<span class="hljs-emphasis">_LEVEL</span><br><span class="hljs-emphasis">SPECIAL_</span>TYPE<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœè¯¥å®¹å™¨é•œåƒçš„ &#x2F;etc&#x2F;config ç›®å½•ä¸­æœ‰ä¸€äº›æ–‡ä»¶ï¼Œå·æŒ‚è½½å°†è¦†ç›–è¿™äº›æ–‡ä»¶ã€‚</p></blockquote><h3 id="å°†-ConfigMap-æ•°æ®æ·»åŠ åˆ°å·ä¸­çš„ç‰¹å®šè·¯å¾„"><a href="#å°†-ConfigMap-æ•°æ®æ·»åŠ åˆ°å·ä¸­çš„ç‰¹å®šè·¯å¾„" class="headerlink" title="å°† ConfigMap æ•°æ®æ·»åŠ åˆ°å·ä¸­çš„ç‰¹å®šè·¯å¾„"></a>å°† ConfigMap æ•°æ®æ·»åŠ åˆ°å·ä¸­çš„ç‰¹å®šè·¯å¾„</h3><p>ä½¿ç”¨ path å­—æ®µä¸ºç‰¹å®šçš„ ConfigMap é¡¹ç›®æŒ‡å®šé¢„æœŸçš„æ–‡ä»¶è·¯å¾„ã€‚ åœ¨è¿™é‡Œï¼ŒConfigMap ä¸­é”® SPECIAL_LEVEL çš„å†…å®¹å°†æŒ‚è½½åœ¨ config-volume å·ä¸­ &#x2F;etc&#x2F;config&#x2F;keys æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">dapi-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">registry.k8s.io/busybox</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cat /etc/config/keys&quot;</span> ]<br>      <span class="hljs-attr">volumeMounts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/config</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>      <span class="hljs-attr">configMap:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">special-config</span><br>        <span class="hljs-attr">items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">SPECIAL_LEVEL</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">keys</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-subPath"><a href="#ä½¿ç”¨-subPath" class="headerlink" title="ä½¿ç”¨ subPath"></a>ä½¿ç”¨ subPath</h2><p>volumeMounts[*].subPath å±æ€§å¯ç”¨äºæŒ‡å®šæ‰€å¼•ç”¨çš„å·å†…çš„å­è·¯å¾„ï¼Œè€Œä¸æ˜¯å…¶æ ¹è·¯å¾„ã€‚</p><p>ä½¿ç”¨ subPath å­—æ®µå°† ConfigMap ä¸­çš„ç‰¹å®šé¡¹ç›®æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„ç‰¹å®šè·¯å¾„ã€‚ åœ¨è¿™é‡Œï¼ŒConfigMap ä¸­é”® game.properties çš„å†…å®¹å°†æŒ‚è½½åœ¨ config-volume å·ä¸­ &#x2F;usr&#x2F;game.properties æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">subpath-test-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test-container</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>      <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>      <span class="hljs-attr">command:</span> [ <span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cd /usr &amp;&amp; ls &amp;&amp; cat /usr/keys&quot;</span> ]<br>      <span class="hljs-attr">volumeMounts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/game.properties</span><br>        <span class="hljs-attr">subPath:</span> <span class="hljs-string">game.properties</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/ui.properties</span><br>        <span class="hljs-attr">subPath:</span> <span class="hljs-string">ui.properties</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config-volume</span><br>      <span class="hljs-attr">configMap:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">game-config</span><br>  <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><blockquote><p>ä»¥subPathæ–¹å¼æŒ‚è½½æ—¶ï¼Œconfigmapæ›´æ–°ï¼Œå®¹å™¨ä¸ä¼šæ›´æ–°</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Helm åˆæ¢</title>
    <link href="/2024/12/20/helm-intro/"/>
    <url>/2024/12/20/helm-intro/</url>
    
    <content type="html"><![CDATA[<h1 id="helm-åˆæ¢"><a href="#helm-åˆæ¢" class="headerlink" title="helm åˆæ¢"></a>helm åˆæ¢</h1><blockquote><p><a href="https://helm.sh/zh/docs/intro/using_helm/">https://helm.sh/zh/docs/intro/using_helm/</a></p></blockquote><h2 id="ä¸‰å¤§æ¦‚å¿µ"><a href="#ä¸‰å¤§æ¦‚å¿µ" class="headerlink" title="ä¸‰å¤§æ¦‚å¿µ"></a>ä¸‰å¤§æ¦‚å¿µ</h2><p>Chart ä»£è¡¨ç€ Helm åŒ…ã€‚å®ƒåŒ…å«åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå·¥å…·æˆ–æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰èµ„æºå®šä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ Homebrew formulaï¼ŒApt dpkgï¼Œæˆ– Yum RPM åœ¨Kubernetes ä¸­çš„ç­‰ä»·ç‰©ã€‚</p><p>Repositoryï¼ˆä»“åº“ï¼‰ æ˜¯ç”¨æ¥å­˜æ”¾å’Œå…±äº« charts çš„åœ°æ–¹ã€‚å®ƒå°±åƒ Perl çš„ CPAN æ¡£æ¡ˆåº“ç½‘ç»œ æˆ–æ˜¯ Fedora çš„ è½¯ä»¶åŒ…ä»“åº“ï¼Œåªä¸è¿‡å®ƒæ˜¯ä¾› Kubernetes åŒ…æ‰€ä½¿ç”¨çš„ã€‚</p><p>Release æ˜¯è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ chart çš„å®ä¾‹ã€‚ä¸€ä¸ª chart é€šå¸¸å¯ä»¥åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­å®‰è£…å¤šæ¬¡ã€‚æ¯ä¸€æ¬¡å®‰è£…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ releaseã€‚ä»¥ MySQL chartä¸ºä¾‹ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„é›†ç¾¤ä¸­è¿è¡Œä¸¤ä¸ªæ•°æ®åº“ï¼Œä½ å¯ä»¥å®‰è£…è¯¥chartä¸¤æ¬¡ã€‚æ¯ä¸€ä¸ªæ•°æ®åº“éƒ½ä¼šæ‹¥æœ‰å®ƒè‡ªå·±çš„ release å’Œ release nameã€‚</p><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰é…ç½®çš„ä»“åº“åœ°å€</span><br>helm repo list<br><span class="hljs-comment"># åˆ é™¤é»˜è®¤ä»“åº“ï¼Œé»˜è®¤åœ¨å›½å¤–pullå¾ˆæ…¢</span><br>helm repo remove stable<br><span class="hljs-comment"># æ·»åŠ å‡ ä¸ªå¸¸ç”¨çš„ä»“åº“,å¯è‡ªå®šä¹‰åå­—</span><br>helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br>helm repo add kaiyuanshe http://mirror.kaiyuanshe.cn/kubernetes/charts<br>helm repo add azure http://mirror.azure.cn/kubernetes/charts<br>helm repo add dandydev https://dandydeveloper.github.io/charts<br>helm repo add bitnami https://charts.bitnami.com/bitnami<br></code></pre></td></tr></table></figure><h2 id="æœç´¢-chart"><a href="#æœç´¢-chart" class="headerlink" title="æœç´¢ chart"></a>æœç´¢ chart</h2><p>Helm å¯ä»¥ä»ä¸¤ç§æ¥æºä¸­è¿›è¡Œæœç´¢ï¼š</p><p><code>helm search hub</code> ä» Artifact Hub ä¸­æŸ¥æ‰¾å¹¶åˆ—å‡º helm chartsã€‚ Artifact Hubä¸­å­˜æ”¾äº†å¤§é‡ä¸åŒçš„ä»“åº“ã€‚</p><p><code>helm search repo</code> ä»ä½ æ·»åŠ ï¼ˆä½¿ç”¨ helm repo addï¼‰åˆ°æœ¬åœ° helm å®¢æˆ·ç«¯ä¸­çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚è¯¥å‘½ä»¤åŸºäºæœ¬åœ°æ•°æ®è¿›è¡Œæœç´¢ï¼Œæ— éœ€è¿æ¥äº’è”ç½‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm search hub wordpress<br><br>helm repo update <br>helm search repo redis<br><span class="hljs-comment"># æ‹‰å–chartåŒ…åˆ°æœ¬åœ°</span><br>helm pull bitnami/redis-cluster --version 8.1.2<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…å‰ä¿®æ”¹é…ç½®"><a href="#å®‰è£…å‰ä¿®æ”¹é…ç½®" class="headerlink" title="å®‰è£…å‰ä¿®æ”¹é…ç½®"></a>å®‰è£…å‰ä¿®æ”¹é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">helm show values bitnami/wordpress<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…-helm-åŒ…"><a href="#å®‰è£…-helm-åŒ…" class="headerlink" title="å®‰è£… helm åŒ…"></a>å®‰è£… helm åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…redis-haé›†ç¾¤ï¼Œå–åredis-haï¼Œéœ€è¦æŒ‡å®šæŒå­˜å‚¨ç±»</span><br>helm install redis-cluster bitnami/redis-cluster --<span class="hljs-built_in">set</span> global.storageClass=nfs,global.redis.password=xiagao --version 8.1.2<br><br><span class="hljs-comment"># è¿½è¸ª release çš„çŠ¶æ€ï¼Œæˆ–æ˜¯é‡æ–°è¯»å–é…ç½®ä¿¡æ¯</span><br>helm status redis-cluster<br><br><span class="hljs-comment"># å¸è½½</span><br>helm uninstall redis-cluster<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastAPI Notes 2</title>
    <link href="/2024/12/11/fastapi-notes-2/"/>
    <url>/2024/12/11/fastapi-notes-2/</url>
    
    <content type="html"><![CDATA[<h1 id="FastAPI-Notes-2"><a href="#FastAPI-Notes-2" class="headerlink" title="FastAPI Notes 2"></a>FastAPI Notes 2</h1><h2 id="å…³é—­äº¤äº’å¼æ–‡æ¡£è®¿é—®"><a href="#å…³é—­äº¤äº’å¼æ–‡æ¡£è®¿é—®" class="headerlink" title="å…³é—­äº¤äº’å¼æ–‡æ¡£è®¿é—®"></a>å…³é—­äº¤äº’å¼æ–‡æ¡£è®¿é—®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br>app = FastAPI(<br>    docs_url=<span class="hljs-literal">None</span>, <br>    redoc_url=<span class="hljs-literal">None</span>,<br>    <span class="hljs-comment"># æˆ–ç›´æ¥è®¾ç½®</span><br>    openapi_url=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><h2 id="å…¨å±€å¼‚å¸¸é”™è¯¯æ•è·"><a href="#å…¨å±€å¼‚å¸¸é”™è¯¯æ•è·" class="headerlink" title="å…¨å±€å¼‚å¸¸é”™è¯¯æ•è·"></a>å…¨å±€å¼‚å¸¸é”™è¯¯æ•è·</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> starlette.respnses <span class="hljs-keyword">import</span> JSONResponse<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">exception_not_found</span>(<span class="hljs-params">request, exc</span>):<br>    <span class="hljs-keyword">return</span> JSONResponse(&#123;<br>        <span class="hljs-string">&quot;code&quot;</span>: exc.status_code,<br>        <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;not found&quot;</span>,<br>        &#125;, status_code=exc.status_code)<br><br>exception_handlers = &#123;<br>    <span class="hljs-number">404</span>: exception_not_found,<br>    &#125;<br><br>app = FastAPI(<br>    exception_handlers=exception_handlers)<br></code></pre></td></tr></table></figure><h2 id="å¤šåº”ç”¨æŒ‚è½½"><a href="#å¤šåº”ç”¨æŒ‚è½½" class="headerlink" title="å¤šåº”ç”¨æŒ‚è½½"></a>å¤šåº”ç”¨æŒ‚è½½</h2><h3 id="ä¸»ä»åº”ç”¨æŒ‚è½½"><a href="#ä¸»ä»åº”ç”¨æŒ‚è½½" class="headerlink" title="ä¸»ä»åº”ç”¨æŒ‚è½½"></a>ä¸»ä»åº”ç”¨æŒ‚è½½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.repsponses <span class="hljs-keyword">import</span> JSONResponse<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä¸»åº”ç”¨&quot;</span>)<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/index&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> JSONResponse(&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;ä¸»åº”ç”¨&quot;</span>&#125;)<br><br>subapp = FastAPI(title=<span class="hljs-string">&quot;å­åº”ç”¨&quot;</span>)<br><span class="hljs-meta">@subapp.get(<span class="hljs-params"><span class="hljs-string">&quot;/index&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> JSONResponse(&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;å­åº”ç”¨&quot;</span>&#125;)<br><br>app.mount(path=<span class="hljs-string">&quot;/subapp&quot;</span>, app=subapp, name=<span class="hljs-string">&quot;å­åº”ç”¨&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>ä¸»åº”ç”¨äº¤äº’å¼æ–‡æ¡£åœ°å€ä¸º<a href="http://127.0.0.1:8000/docs%E3%80%82">http://127.0.0.1:8000/docsã€‚</a></li><li>å­åº”ç”¨äº¤äº’å¼æ–‡æ¡£åœ°å€ä¸º<a href="http://127.0.0.1:8000/subapp/docs">http://127.0.0.1:8000/subapp/docs</a></li></ul><h3 id="æŒ‚è½½å…¶ä»–WSGIåº”ç”¨"><a href="#æŒ‚è½½å…¶ä»–WSGIåº”ç”¨" class="headerlink" title="æŒ‚è½½å…¶ä»–WSGIåº”ç”¨"></a>æŒ‚è½½å…¶ä»–WSGIåº”ç”¨</h3><p>å¯ä»¥ç”¨æ¥æŒ‚è½½å¦‚Flaskã€Djangoç­‰åº”ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ›å»ºfastapiä¸»åº”ç”¨</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><br>app = FastAPI()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/index&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> JSONResponse(&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;fastapiåº”ç”¨&quot;</span>&#125;)<br><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> fastapi.middleware.wsgi <span class="hljs-keyword">import</span> WSGIMiddleware<br>flask_app = Flask(__name__)<br><span class="hljs-meta">@flask_app.route(<span class="hljs-params"><span class="hljs-string">&quot;/index&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flask_main</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;flaskåº”ç”¨&quot;</span>&#125;<br><br>app.mount(path=<span class="hljs-string">&quot;/flaskapp&quot;</span>, app=WSGIMiddleware(flask_app), name=<span class="hljs-string">&quot;flaskåº”ç”¨&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰é…ç½®swagger-ui"><a href="#è‡ªå®šä¹‰é…ç½®swagger-ui" class="headerlink" title="è‡ªå®šä¹‰é…ç½®swagger_ui"></a>è‡ªå®šä¹‰é…ç½®swagger_ui</h2><p>ç”±äºç›¸å…³çš„swagger-ui.csså’Œswagger-ui-bundle.jsèµ„æºæ˜¯ä»ç¬¬ä¸‰æ–¹çš„CDNæœåŠ¡å•†ä¸ŠåŠ è½½çš„ï¼Œç¬¬ä¸‰æ–¹çš„CDNæœåŠ¡å‡ºç°é—®é¢˜å°±ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸åŠ è½½å¯è§†åŒ–APIæ–‡æ¡£ç•Œé¢çš„æƒ…å†µã€‚ä¸ºäº†é¿å…å‡ºç°è¿™ç§æƒ…å†µï¼Œä»¥åŠåœ¨æ— ç½‘ç»œæƒ…å†µä¸‹ä¹Ÿèƒ½æ­£å¸¸è®¿é—®APIäº¤äº’å¼æ–‡æ¡£ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ï¼ˆæˆ–æ”¹é€ ï¼‰å¹¶æ¸²æŸ“HTMLæ¨¡æ¿ä¸­çš„ä¸€äº›å˜é‡ï¼Œè®©swagger-ui.csså’Œswagger-ui-bundle.jsç­‰é™æ€èµ„æºä»æœ¬åœ°è¿›è¡ŒåŠ è½½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.openapi.docs <span class="hljs-keyword">import</span> get_swagger_ui_html, get_redoc_html, get_swagger_ui_oauth2_redirect_html<br><span class="hljs-keyword">from</span> fastapi.staticfiles <span class="hljs-keyword">import</span> StaticFiles<br><span class="hljs-keyword">import</span> pathlib<br><br>app = FastAPI(docs_url=<span class="hljs-literal">None</span>, redoc_url=<span class="hljs-literal">None</span>)<br>app.mount(<br>    path=<span class="hljs-string">&quot;/static&quot;</span>,<br>    app=StaticFiles(directory=<span class="hljs-string">f&quot;pathlib.Path.cwd()/static&quot;</span>),<br>    name=<span class="hljs-string">&quot;static&quot;</span><br>)<br><br><span class="hljs-comment"># å‡½æ•°å‚æ•°ç¼ºä¸€ä¸å¯ï¼Œå¦åˆ™ä¼šè®¿é—®ä¸äº†</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/docs&quot;</span>, include_in_schema=<span class="hljs-literal">False</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_swagger_ui_html</span>():<br>    <span class="hljs-keyword">return</span> get_swagger_ui_html(<br>        openapi_url=app.openapi_url,<br>        title=app.title + <span class="hljs-string">&quot; - Swagger UI&quot;</span>,<br>        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,<br>        swagger_js_url=<span class="hljs-string">&quot;/static/swagger-ui-bundle.js&quot;</span>,<br>        swagger_css_url=<span class="hljs-string">&quot;/static/swagger-ui.css&quot;</span>,<br>        swagger_favicon_url=<span class="hljs-string">&quot;/static/favicon.png&quot;</span>,<br>    )<br></code></pre></td></tr></table></figure><h2 id="Bodyå‚æ•°"><a href="#Bodyå‚æ•°" class="headerlink" title="Bodyå‚æ•°"></a>Bodyå‚æ•°</h2><h3 id="å¼•å…¥Pydanticæ¨¡å‹å£°æ˜è¯·æ±‚ä½“"><a href="#å¼•å…¥Pydanticæ¨¡å‹å£°æ˜è¯·æ±‚ä½“" class="headerlink" title="å¼•å…¥Pydanticæ¨¡å‹å£°æ˜è¯·æ±‚ä½“"></a>å¼•å…¥Pydanticæ¨¡å‹å£°æ˜è¯·æ±‚ä½“</h3><p>å°†è¯·æ±‚ä½“å‚æ•°è¯†åˆ«ä¸ºJSONæ ¼å¼å­—ç¬¦ä¸²ï¼Œå¹¶è‡ªåŠ¨å°†å­—æ®µè½¬æ¢ä¸ºç›¸åº”çš„æ•°æ®ç±»å‹ã€‚</p><p>è‡ªåŠ¨è¿›è¡Œå‚æ•°è§„åˆ™çš„æ ¡éªŒã€‚å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œåˆ™å“åº”æŠ¥æ–‡å†…å®¹ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶å‡†ç¡®æŒ‡å‡ºé”™è¯¯æ•°æ®çš„ä½ç½®å’Œä¿¡æ¯ã€‚</p><p>ä¸ºæ¨¡å‹ç”ŸæˆJSON Schemaå®šä¹‰ï¼Œå¹¶æ˜¾ç¤ºåœ¨APIäº¤äº’å¼æ–‡æ¡£ä¸­ï¼ŒSchemaä¼šæˆä¸ºOpenAPI Schemaçš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ç›´æ¥è®¿é—®æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">1</span>, max_length=<span class="hljs-number">20</span>, title=<span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span>, description=<span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span>, example=<span class="hljs-string">&quot;admin&quot;</span>)<br>    password: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">8</span>, max_length=<span class="hljs-number">20</span>)<br>    age: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># æŠŠæ¨¡å‹ç»‘å®šåˆ°è§†å›¾å‡½æ•°ä¸­</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure><h3 id="ç”¨Bodyå£°æ˜è¯·æ±‚ä½“"><a href="#ç”¨Bodyå£°æ˜è¯·æ±‚ä½“" class="headerlink" title="ç”¨Bodyå£°æ˜è¯·æ±‚ä½“"></a>ç”¨Bodyå£°æ˜è¯·æ±‚ä½“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params"></span><br><span class="hljs-params">    username: <span class="hljs-built_in">str</span> = Body(<span class="hljs-params">..., min_length=<span class="hljs-number">1</span>, max_length=<span class="hljs-number">20</span></span>),</span><br><span class="hljs-params">    password: <span class="hljs-built_in">str</span> = Body(<span class="hljs-params">..., min_length=<span class="hljs-number">8</span>, max_length=<span class="hljs-number">20</span></span>),</span><br><span class="hljs-params">    age: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = Body(<span class="hljs-params"><span class="hljs-literal">None</span>, gt=<span class="hljs-number">0</span>, lt=<span class="hljs-number">100</span></span>),</span><br><span class="hljs-params">    </span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;username&quot;</span>: username, <span class="hljs-string">&quot;password&quot;</span>: password, <span class="hljs-string">&quot;age&quot;</span>: age&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Bodyçš„embedå‚æ•°"><a href="#Bodyçš„embedå‚æ•°" class="headerlink" title="Bodyçš„embedå‚æ•°"></a>Bodyçš„embedå‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br>    age: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: User = Body(<span class="hljs-params">..., embed=<span class="hljs-literal">True</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure><h2 id="åå°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ"><a href="#åå°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ" class="headerlink" title="åå°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ"></a>åå°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ</h2><p>è¿™ç§åå°æ‰§è¡Œçš„ä»»åŠ¡æœ¬è´¨æ˜¯åœ¨å½“å‰æœåŠ¡è¿›ç¨‹ä¸­å®Œæˆçš„ï¼Œè‹¥å½“å‰æœåŠ¡è¿›ç¨‹è¢«å…³é—­ï¼Œåˆ™ä»»åŠ¡ä¹Ÿä¼šè¢«ç»ˆæ­¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ›å»ºåå°ä»»åŠ¡å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">background_task</span>(<span class="hljs-params">n</span>):<br>    time.sleep(n)<br><span class="hljs-comment"># å®šä¹‰åå°ä»»åŠ¡</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> BackgroundTasks<br><span class="hljs-meta">@app.api_route(<span class="hljs-params">path=<span class="hljs-string">&quot;/task&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_task</span>(<span class="hljs-params">background_tasks: BackgroundTasks</span>):<br>    background_tasks.add_task(background_task, <span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="åº”ç”¨å¯åŠ¨å’Œå…³é—­äº‹ä»¶"><a href="#åº”ç”¨å¯åŠ¨å’Œå…³é—­äº‹ä»¶" class="headerlink" title="åº”ç”¨å¯åŠ¨å’Œå…³é—­äº‹ä»¶"></a>åº”ç”¨å¯åŠ¨å’Œå…³é—­äº‹ä»¶</h2><p>startupå’Œshutdownäº‹ä»¶æ˜¯FastAPIæä¾›çš„è¿›è¡ŒæœåŠ¡å¯åŠ¨å’Œå…³é—­æ—¶æ‰§è¡Œçš„äº‹ä»¶å›è°ƒé€šçŸ¥å¤„ç†æœºåˆ¶</p><ol><li>startupäº‹ä»¶</li></ol><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>è®¾ç½®å’Œè¯»å–åº”ç”¨é…ç½®å‚æ•°ã€‚</li><li>é€šè¿‡å¯¹æ•°æ®åº“åˆå§‹åŒ–æŠŠåˆå§‹åŒ–çš„å¯¹è±¡å­˜å‚¨åˆ°appå¯¹è±¡ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li>åˆå§‹åŒ–ç¬¬ä¸‰æ–¹æ’ä»¶</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">app = FastAPI()<br><span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">&quot;startup&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup_event</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åº”ç”¨å¯åŠ¨&quot;</span>)<br></code></pre></td></tr></table></figure><ol start="2"><li>shutdownäº‹ä»¶</li></ol><p>å½“æœåŠ¡å…³é—­å¹¶è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡shutdownäº‹ä»¶è¿›è¡Œç›¸å…³èµ„æºé‡Šæ”¾å¤„ç†</p><p>åªæœ‰å½“æ‰€æœ‰è¿æ¥éƒ½å·²å…³é—­ï¼Œå¹¶ä¸”ä»»ä½•æ­£åœ¨è¿›è¡Œçš„åå°ä»»åŠ¡éƒ½å·²å®Œæˆæ—¶ï¼Œæ‰ä¼šè°ƒç”¨å…³é—­å¤„ç†äº‹ä»¶ã€‚å¦‚æœæœåŠ¡è¢«å¼ºåˆ¶è¿›è¡Œkillæ“ä½œï¼Œåˆ™å›è°ƒå‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">&quot;shutdown&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown_event</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åº”ç”¨å…³é—­&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="HTTPException-å¼‚å¸¸å¤„ç†"><a href="#HTTPException-å¼‚å¸¸å¤„ç†" class="headerlink" title="HTTPException å¼‚å¸¸å¤„ç†"></a>HTTPException å¼‚å¸¸å¤„ç†</h2><p>é€šè¿‡@app.exception_handler(HTTPException)è¿›è¡Œä¸€ä¸ªå…¨å±€å¼‚å¸¸çš„æ•è·å¤„ç†ã€‚å½“æ‰‹åŠ¨æŠ›å‡ºHTTPExceptionå¼‚å¸¸æ—¶ï¼ŒFastAPIä¼šå¯¹æ­¤ç±»å¼‚å¸¸è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œå¹¶è¿›å…¥http_exception_handler()å‡½æ•°ã€‚åœ¨è¯¥å‡½æ•°å†…éƒ¨ä¼šå¯¹å¼‚å¸¸ä¿¡æ¯è¿›è¡Œæå–å¤„ç†ï¼Œç„¶åé€šè¿‡JSONResponseè¿›è¡Œå“åº”æŠ¥æ–‡å°è£…è¾“å‡ºå¹¶è¿”å›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> HTTPException, FastAPI, Request<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Query<br>app = FastAPI()<br><br><span class="hljs-meta">@app.exception_handler(<span class="hljs-params">HTTPException</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">http_exception_handler</span>(<span class="hljs-params">request: Request, exc: HTTPException</span>):<br>    <span class="hljs-keyword">return</span> JSONResponse(<br>        content=exc.detail,<br>        status_code=exc.status_code,<br>        headers=exc.headers)<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®å’Œç¯å¢ƒå˜é‡"><a href="#è®¾ç½®å’Œç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®å’Œç¯å¢ƒå˜é‡"></a>è®¾ç½®å’Œç¯å¢ƒå˜é‡</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># .envæ–‡ä»¶è®¾ç½®</span><br><span class="hljs-attr">ADMIN_EMAIL</span>=<span class="hljs-string">&quot;deadpool@example.com&quot;</span><br><span class="hljs-attr">APP_NAME</span>=<span class="hljs-string">&quot;ChimichangApp&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br><span class="hljs-keyword">from</span> pydantic_settings <span class="hljs-keyword">import</span> BaseSettings<br><span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):<br>    app_name: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;Awesome API&quot;</span><br>    admin_email: <span class="hljs-built_in">str</span><br>    items_per_user: <span class="hljs-built_in">int</span> = <span class="hljs-number">50</span><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        env_file = <span class="hljs-string">&quot;.env&quot;</span><br><br><span class="hljs-meta">@lru_cache</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_settings</span>():<br>    load_dotenv()<br>    <span class="hljs-keyword">return</span> Settings()<br></code></pre></td></tr></table></figure><h2 id="ä¸­é—´ä»¶è®°å½•è¯·æ±‚æ—¥å¿—"><a href="#ä¸­é—´ä»¶è®°å½•è¯·æ±‚æ—¥å¿—" class="headerlink" title="ä¸­é—´ä»¶è®°å½•è¯·æ±‚æ—¥å¿—"></a>ä¸­é—´ä»¶è®°å½•è¯·æ±‚æ—¥å¿—</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request<br><span class="hljs-keyword">import</span> time<br><br>app = FastAPI()<br><br><span class="hljs-comment"># å®šä¹‰ä¸­é—´ä»¶å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_request_info</span>(<span class="hljs-params">request: Request, call_next</span>):<br>    start_time = time.time()<br>    <span class="hljs-comment"># è·å–å®¢æˆ·ç«¯IPåœ°å€ï¼ˆè€ƒè™‘åå‘ä»£ç†æƒ…å†µï¼‰</span><br>    x_forwarded_for = request.headers.get(<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>)<br>    <span class="hljs-keyword">if</span> x_forwarded_for:<br>        client_ip = x_forwarded_for.split(<span class="hljs-string">&quot;,&quot;</span>)[<span class="hljs-number">0</span>].strip()<br>    <span class="hljs-keyword">else</span>:<br>        client_ip = request.client.host<br><br>    <span class="hljs-comment"># è·å–è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚GETã€POSTç­‰ï¼‰</span><br>    request_method = request.method<br>    <span class="hljs-comment"># è·å–è¯·æ±‚è·¯å¾„</span><br>    request_path = request.url.path<br>    <span class="hljs-comment"># è·å–ç”¨æˆ·ä»£ç†ä¿¡æ¯</span><br>    user_agent = request.headers.get(<span class="hljs-string">&quot;user-agent&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        response = <span class="hljs-keyword">await</span> call_next(request)<br>    <span class="hljs-keyword">finally</span>:<br>        process_time = (time.time() - start_time) * <span class="hljs-number">1000</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[Request Log] - IP: <span class="hljs-subst">&#123;client_ip&#125;</span>, Method: <span class="hljs-subst">&#123;request_method&#125;</span>, Path: <span class="hljs-subst">&#123;request_path&#125;</span>, User-Agent: <span class="hljs-subst">&#123;user_agent&#125;</span>, Process Time: <span class="hljs-subst">&#123;process_time:<span class="hljs-number">.2</span>f&#125;</span>ms&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> response<br><br><span class="hljs-comment"># æ·»åŠ ä¸­é—´ä»¶åˆ°åº”ç”¨</span><br>app.middleware(<span class="hljs-string">&quot;http&quot;</span>)(log_request_info)<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„è·¯ç”±ç”¨äºæµ‹è¯•</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_root</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, World!&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><h3 id="UploadFile"><a href="#UploadFile" class="headerlink" title="UploadFile"></a>UploadFile</h3><p>UploadFile æ˜¯ä¸€ä¸ªå¼‚æ­¥å¯¹è±¡ï¼Œå®ƒçš„æ–‡ä»¶å†…å®¹æ˜¯é€šè¿‡ read() æ–¹æ³•é€æ­¥è¯»å–çš„ã€‚ä¸€æ—¦ä½ è°ƒç”¨ read() æ–¹æ³•å¹¶è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶æŒ‡é’ˆä¼šè¢«ç§»åŠ¨ï¼Œåç»­çš„è¯»å–ä¼šå‘ç”Ÿé”™è¯¯æˆ–æ— æ³•è¯»å–åˆ°ä»»ä½•å†…å®¹ã€‚è¿™æ„å‘³ç€å¦‚æœä½ åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨äº† read() å¹¶è¯»å–äº†æ–‡ä»¶çš„å†…å®¹ï¼Œé‚£ä¹ˆåœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨ read() æ—¶ï¼Œæ–‡ä»¶æŒ‡é’ˆå·²ç»åˆ°è¾¾æ–‡ä»¶çš„æœ«å°¾ï¼Œæ— æ³•å†æ¬¡è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p><p>å› æ­¤å¯ä»¥ä½¿ç”¨å˜é‡å¯¹è¯»å–çš„å†…å®¹è¿›è¡Œä¿å­˜æ¥å¤šæ¬¡ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å¤šæ¬¡è°ƒç”¨ read() æ–¹æ³•ã€‚</p><h3 id="æ¥æ”¶æ–‡ä»¶ä¸Šä¼ "><a href="#æ¥æ”¶æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ¥æ”¶æ–‡ä»¶ä¸Šä¼ "></a>æ¥æ”¶æ–‡ä»¶ä¸Šä¼ </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File, UploadFile<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload-multiple/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_multiple_files</span>(<span class="hljs-params">files: <span class="hljs-type">List</span>[UploadFile] = File(<span class="hljs-params">...</span>)</span>):<br>    file_details = []<br>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>        content = <span class="hljs-keyword">await</span> file.read()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Filename: <span class="hljs-subst">&#123;file.filename&#125;</span>, Content-Type: <span class="hljs-subst">&#123;file.content_type&#125;</span>&quot;</span>)<br>        file_details.append(&#123;<span class="hljs-string">&quot;filename&quot;</span>: file.filename, <span class="hljs-string">&quot;content_type&quot;</span>: file.content_type&#125;)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;files&quot;</span>: file_details&#125;<br><br><span class="hljs-comment">## ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File, UploadFile<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/save-file/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_file</span>(<span class="hljs-params">file: UploadFile = File(<span class="hljs-params">...</span>)</span>):<br>    file_location = <span class="hljs-string">f&quot;uploads/<span class="hljs-subst">&#123;file.filename&#125;</span>&quot;</span>  <span class="hljs-comment"># æ–‡ä»¶ä¿å­˜è·¯å¾„</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_location, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> buffer:<br>        buffer.write(<span class="hljs-keyword">await</span> file.read())  <span class="hljs-comment"># ä¿å­˜æ–‡ä»¶å†…å®¹</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">f&quot;File &#x27;<span class="hljs-subst">&#123;file.filename&#125;</span>&#x27; saved at &#x27;<span class="hljs-subst">&#123;file_location&#125;</span>&#x27;&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°"><a href="#é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°" class="headerlink" title="é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°"></a>é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request, HTTPException<br><span class="hljs-keyword">from</span> starlette.middleware.trustedhost <span class="hljs-keyword">import</span> TrustedHostMiddleware<br><span class="hljs-keyword">from</span> starlette.middleware.exceptions <span class="hljs-keyword">import</span> ExceptionMiddleware<br><span class="hljs-keyword">from</span> starlette.middleware.gzip <span class="hljs-keyword">import</span> GZipMiddleware<br><br>app = FastAPI()<br><br><span class="hljs-comment"># è®¾ç½®æ–‡ä»¶å¤§å°é™åˆ¶</span><br><span class="hljs-meta">@app.middleware(<span class="hljs-params"><span class="hljs-string">&quot;http&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">limit_upload_size</span>(<span class="hljs-params">request: Request, call_next</span>):<br>    max_size = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>  <span class="hljs-comment"># æœ€å¤§æ–‡ä»¶å¤§å°ï¼š1MB</span><br>    content_length = request.headers.get(<span class="hljs-string">&quot;Content-Length&quot;</span>)<br>    <span class="hljs-keyword">if</span> content_length <span class="hljs-keyword">and</span> <span class="hljs-built_in">int</span>(content_length) &gt; max_size:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">413</span>, detail=<span class="hljs-string">&quot;File too large&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> call_next(request)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pymysqlä¸è¿æ¥æ± </title>
    <link href="/2024/12/09/pymysql-pool/"/>
    <url>/2024/12/09/pymysql-pool/</url>
    
    <content type="html"><![CDATA[<h1 id="pymysql-ä¸è¿æ¥æ± "><a href="#pymysql-ä¸è¿æ¥æ± " class="headerlink" title="pymysql ä¸è¿æ¥æ± "></a>pymysql ä¸è¿æ¥æ± </h1><h2 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># 1. è¿æ¥åˆ° MySQL æ•°æ®åº“</span><br>connection = pymysql.connect(<br>    host=<span class="hljs-string">&#x27;localhost&#x27;</span>,         <span class="hljs-comment"># æ•°æ®åº“åœ°å€</span><br>    user=<span class="hljs-string">&#x27;root&#x27;</span>,              <span class="hljs-comment"># æ•°æ®åº“ç”¨æˆ·å</span><br>    password=<span class="hljs-string">&#x27;your_password&#x27;</span>, <span class="hljs-comment"># æ•°æ®åº“å¯†ç </span><br>    database=<span class="hljs-string">&#x27;test_db&#x27;</span>,       <span class="hljs-comment"># æ•°æ®åº“åç§°ï¼ˆéœ€äº‹å…ˆåˆ›å»ºå¥½ï¼‰</span><br>    charset=<span class="hljs-string">&#x27;utf8mb4&#x27;</span>,        <span class="hljs-comment"># è®¾ç½®å­—ç¬¦é›†</span><br>    cursorclass=pymysql.cursors.DictCursor  <span class="hljs-comment"># è¿”å›ç»“æœä¸ºå­—å…¸æ ¼å¼</span><br>)<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># 2. åˆ›å»ºæ¸¸æ ‡å¯¹è±¡</span><br>    <span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cursor:<br>        <span class="hljs-comment"># åˆ›å»ºè¡¨</span><br>        create_table_query = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        CREATE TABLE IF NOT EXISTS users (</span><br><span class="hljs-string">            id INT AUTO_INCREMENT PRIMARY KEY,</span><br><span class="hljs-string">            name VARCHAR(100) NOT NULL,</span><br><span class="hljs-string">            age INT NOT NULL,</span><br><span class="hljs-string">            email VARCHAR(100)</span><br><span class="hljs-string">        );</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        cursor.execute(create_table_query)<br><br>        <span class="hljs-comment"># æ’å…¥æ•°æ®</span><br>        insert_query = <span class="hljs-string">&quot;INSERT INTO users (name, age, email) VALUES (%s, %s, %s)&quot;</span><br>        cursor.execute(insert_query, (<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;alice@example.com&quot;</span>))<br>        cursor.execute(insert_query, (<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&quot;bob@example.com&quot;</span>))<br><br>        <span class="hljs-comment"># æäº¤äº‹åŠ¡</span><br>        connection.commit()<br><br>        <span class="hljs-comment"># æŸ¥è¯¢æ•°æ®</span><br>        select_query = <span class="hljs-string">&quot;SELECT * FROM users&quot;</span><br>        cursor.execute(select_query)<br>        results = cursor.fetchall()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æŸ¥è¯¢ç»“æœ:&quot;</span>)<br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> results:<br>            <span class="hljs-built_in">print</span>(row)<br><br>        <span class="hljs-comment"># æ›´æ–°æ•°æ®</span><br>        update_query = <span class="hljs-string">&quot;UPDATE users SET age = %s WHERE name = %s&quot;</span><br>        cursor.execute(update_query, (<span class="hljs-number">28</span>, <span class="hljs-string">&quot;Alice&quot;</span>))<br>        connection.commit()<br><br>        <span class="hljs-comment"># åˆ é™¤æ•°æ®</span><br>        delete_query = <span class="hljs-string">&quot;DELETE FROM users WHERE name = %s&quot;</span><br>        cursor.execute(delete_query, (<span class="hljs-string">&quot;Bob&quot;</span>,))<br>        connection.commit()<br><br><span class="hljs-keyword">finally</span>:<br>    <span class="hljs-comment"># 3. å…³é—­æ•°æ®åº“è¿æ¥</span><br>    connection.close()<br></code></pre></td></tr></table></figure><h2 id="è¿æ¥æ± "><a href="#è¿æ¥æ± " class="headerlink" title="è¿æ¥æ± "></a>è¿æ¥æ± </h2><p>åœ¨ä½¿ç”¨ pymysql è¿æ¥ MySQL æ—¶ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ è¿æ¥æ±  æ¥æé«˜æ•°æ®åº“æ“ä½œæ•ˆç‡ï¼Œé¿å…é¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥å¸¦æ¥çš„å¼€é”€ã€‚</p><ol><li><p>å®‰è£…ä¾èµ–</p><p> ä¸ºäº†ä½¿ç”¨è¿æ¥æ± ï¼Œå¯ä»¥é€šè¿‡ DBUtils åº“çš„ PooledDB æ¨¡å—å®ç°è¿æ¥æ± ç®¡ç†ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install DBUtils<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ DBUtils.PooledDB å®ç°è¿æ¥æ± </p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> DBUtils.PooledDB <span class="hljs-keyword">import</span> PooledDB<br><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># åˆ›å»ºè¿æ¥æ± </span><br>pool = PooledDB(<br>    creator=pymysql,          <span class="hljs-comment"># ä½¿ç”¨ pymysql ä½œä¸ºè¿æ¥å™¨</span><br>    maxconnections=<span class="hljs-number">5</span>,         <span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°</span><br>    mincached=<span class="hljs-number">2</span>,              <span class="hljs-comment"># åˆå§‹åŒ–æ—¶åˆ›å»ºçš„è¿æ¥æ•°</span><br>    maxcached=<span class="hljs-number">3</span>,              <span class="hljs-comment"># è¿æ¥æ± ä¸­æœ€å¤šå¯ç¼“å­˜çš„è¿æ¥æ•°</span><br>    blocking=<span class="hljs-literal">True</span>,            <span class="hljs-comment"># è¾¾åˆ°æœ€å¤§è¿æ¥æ•°åæ˜¯å¦é˜»å¡ï¼ŒTrue ä¸ºé˜»å¡</span><br>    ping=<span class="hljs-number">0</span>,                   <span class="hljs-comment"># æ£€æµ‹è¿æ¥æ˜¯å¦å¯ç”¨ï¼Œ0 è¡¨ç¤ºä»ä¸æ£€æµ‹</span><br>    host=<span class="hljs-string">&quot;localhost&quot;</span>,         <span class="hljs-comment"># MySQL ä¸»æœºåœ°å€</span><br>    user=<span class="hljs-string">&quot;root&quot;</span>,              <span class="hljs-comment"># ç”¨æˆ·å</span><br>    password=<span class="hljs-string">&quot;your_password&quot;</span>, <span class="hljs-comment"># å¯†ç </span><br>    database=<span class="hljs-string">&quot;test_db&quot;</span>,       <span class="hljs-comment"># æ•°æ®åº“å</span><br>    charset=<span class="hljs-string">&quot;utf8mb4&quot;</span>         <span class="hljs-comment"># å­—ç¬¦é›†</span><br>)<br><br><span class="hljs-comment"># ä»è¿æ¥æ± è·å–è¿æ¥</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_connection</span>():<br>    <span class="hljs-keyword">return</span> pool.connection()<br><br><span class="hljs-comment"># ä½¿ç”¨è¿æ¥æ± è¿æ¥æ•°æ®åº“</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_query</span>(<span class="hljs-params">query, params=<span class="hljs-literal">None</span></span>):<br>    conn = get_connection()   <span class="hljs-comment"># ä»è¿æ¥æ± è·å–è¿æ¥</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:<br>            cursor.execute(query, params)<br>            <span class="hljs-keyword">if</span> query.strip().upper().startswith(<span class="hljs-string">&quot;SELECT&quot;</span>):<br>                result = cursor.fetchall()  <span class="hljs-comment"># æŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ç»“æœ</span><br>                <span class="hljs-keyword">return</span> result<br>            <span class="hljs-keyword">else</span>:<br>                conn.commit()  <span class="hljs-comment"># éæŸ¥è¯¢è¯­å¥ï¼Œæäº¤äº‹åŠ¡</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error:&quot;</span>, e)<br>        conn.rollback()  <span class="hljs-comment"># å›æ»šäº‹åŠ¡</span><br>    <span class="hljs-keyword">finally</span>:<br>        conn.close()  <span class="hljs-comment"># å°†è¿æ¥è¿”å›åˆ°è¿æ¥æ± </span><br><br><span class="hljs-comment"># ç¤ºä¾‹ï¼šæ’å…¥æ•°æ®</span><br>execute_query(<br>    <span class="hljs-string">&quot;INSERT INTO users (name, age, email) VALUES (%s, %s, %s)&quot;</span>,<br>    (<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;alice@example.com&quot;</span>)<br>)<br><br><span class="hljs-comment"># ç¤ºä¾‹ï¼šæŸ¥è¯¢æ•°æ®</span><br>results = execute_query(<span class="hljs-string">&quot;SELECT * FROM users&quot;</span>)<br><span class="hljs-built_in">print</span>(results)<br></code></pre></td></tr></table></figure></li><li><p>å‚æ•°è¯´æ˜</p><p> è¿æ¥æ± å‚æ•°</p><ul><li>creatorï¼šæŒ‡å®šä½¿ç”¨çš„æ•°æ®åº“è¿æ¥æ¨¡å—ï¼Œè¿™é‡Œä¸º pymysqlã€‚</li><li>maxconnectionsï¼šè¿æ¥æ± å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶è¿æ¥æ•°ã€‚</li><li>mincachedï¼šåˆå§‹åŒ–æ—¶åˆ›å»ºçš„è¿æ¥æ•°ã€‚</li><li>maxcachedï¼šæ± ä¸­å…è®¸çš„æœ€å¤§ç©ºé—²è¿æ¥æ•°ã€‚</li><li>blockingï¼šå¦‚æœè¿æ¥æ•°å·²è¾¾åˆ°æœ€å¤§å€¼ï¼Œæ˜¯å¦é˜»å¡ç­‰å¾…å¯ç”¨è¿æ¥ã€‚True è¡¨ç¤ºé˜»å¡ã€‚</li><li>pingï¼šæ§åˆ¶æ˜¯å¦åœ¨è·å–è¿æ¥æ—¶æ£€æŸ¥è¿æ¥çš„å¯ç”¨æ€§<ul><li>0ï¼šä»ä¸æ£€æŸ¥ï¼›</li><li>1ï¼šæ‰§è¡Œ ping æ£€æµ‹ï¼›</li><li>2ï¼šæ£€æŸ¥ socketï¼›</li><li>4ï¼šæ£€æŸ¥æ–­å¼€æƒ…å†µï¼›</li><li>å¯ä»¥ç»„åˆå€¼å¦‚ 3 è¡¨ç¤º ping + socket æ£€æŸ¥</li></ul></li></ul><p> MySQL è¿æ¥å‚æ•°</p><ul><li>hostï¼šMySQL æ•°æ®åº“åœ°å€ï¼ˆä¾‹å¦‚ localhost æˆ– IP åœ°å€ï¼‰ã€‚</li><li>userï¼šMySQL ç”¨æˆ·åã€‚</li><li>passwordï¼šMySQL å¯†ç ã€‚</li><li>databaseï¼šæŒ‡å®šè¿æ¥çš„æ•°æ®åº“åã€‚</li><li>charsetï¼šè®¾ç½®å­—ç¬¦é›†ï¼Œæ¨èä½¿ç”¨ utf8mb4ã€‚</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>openpyxl</title>
    <link href="/2024/12/09/openpyxl/"/>
    <url>/2024/12/09/openpyxl/</url>
    
    <content type="html"><![CDATA[<h1 id="openpyxl"><a href="#openpyxl" class="headerlink" title="openpyxl"></a>openpyxl</h1><h2 id="1-å®‰è£…-OpenPyXL"><a href="#1-å®‰è£…-OpenPyXL" class="headerlink" title="1. å®‰è£… OpenPyXL"></a>1. å®‰è£… OpenPyXL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install openpyxl<br></code></pre></td></tr></table></figure><h2 id="2-åŸºæœ¬æ“ä½œ"><a href="#2-åŸºæœ¬æ“ä½œ" class="headerlink" title="2. åŸºæœ¬æ“ä½œ"></a>2. åŸºæœ¬æ“ä½œ</h2><h3 id="2-1-åˆ›å»º-Excel-æ–‡ä»¶"><a href="#2-1-åˆ›å»º-Excel-æ–‡ä»¶" class="headerlink" title="2.1 åˆ›å»º Excel æ–‡ä»¶"></a>2.1 åˆ›å»º Excel æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> Workbook<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œç°¿</span><br>wb = Workbook()<br><br><span class="hljs-comment"># æ¿€æ´»é»˜è®¤å·¥ä½œè¡¨</span><br>ws = wb.active<br>ws.title = <span class="hljs-string">&quot;Sheet1&quot;</span>  <span class="hljs-comment"># é‡å‘½åå·¥ä½œè¡¨</span><br><br><span class="hljs-comment"># å†™å…¥æ•°æ®</span><br>ws[<span class="hljs-string">&quot;A1&quot;</span>] = <span class="hljs-string">&quot;Hello&quot;</span><br>ws[<span class="hljs-string">&quot;B1&quot;</span>] = <span class="hljs-number">123</span><br><br><span class="hljs-comment"># ä¿å­˜æ–‡ä»¶</span><br>wb.save(<span class="hljs-string">&quot;example.xlsx&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="2-2-è¯»å–-Excel-æ–‡ä»¶"><a href="#2-2-è¯»å–-Excel-æ–‡ä»¶" class="headerlink" title="2.2 è¯»å– Excel æ–‡ä»¶"></a>2.2 è¯»å– Excel æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook<br><br><span class="hljs-comment"># åŠ è½½å·²æœ‰çš„å·¥ä½œç°¿</span><br>wb = load_workbook(<span class="hljs-string">&quot;example.xlsx&quot;</span>)<br><br><span class="hljs-comment"># è·å–é»˜è®¤çš„å·¥ä½œè¡¨</span><br>ws = wb.active<br><br><span class="hljs-comment"># è¯»å–å•å…ƒæ ¼æ•°æ®</span><br><span class="hljs-built_in">print</span>(ws[<span class="hljs-string">&quot;A1&quot;</span>].value)  <span class="hljs-comment"># è¾“å‡º: Hello</span><br><span class="hljs-built_in">print</span>(ws[<span class="hljs-string">&quot;B1&quot;</span>].value)  <span class="hljs-comment"># è¾“å‡º: 123</span><br><br><span class="hljs-comment"># ä½¿ç”¨è¡Œåˆ—ç´¢å¼•è¯»å–æ•°æ®</span><br><span class="hljs-built_in">print</span>(ws.cell(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">2</span>).value)  <span class="hljs-comment"># è¾“å‡º: 123</span><br></code></pre></td></tr></table></figure><h3 id="2-3-ä¿®æ”¹-Excel-æ–‡ä»¶"><a href="#2-3-ä¿®æ”¹-Excel-æ–‡ä»¶" class="headerlink" title="2.3 ä¿®æ”¹ Excel æ–‡ä»¶"></a>2.3 ä¿®æ”¹ Excel æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook<br><br><span class="hljs-comment"># åŠ è½½å·²æœ‰å·¥ä½œç°¿</span><br>wb = load_workbook(<span class="hljs-string">&quot;example.xlsx&quot;</span>)<br>ws = wb.active<br><br><span class="hljs-comment"># ä¿®æ”¹å•å…ƒæ ¼æ•°æ®</span><br>ws[<span class="hljs-string">&quot;A2&quot;</span>] = <span class="hljs-string">&quot;World&quot;</span><br>ws[<span class="hljs-string">&quot;B2&quot;</span>] = <span class="hljs-number">456</span><br><br><span class="hljs-comment"># ä¿å­˜ä¿®æ”¹</span><br>wb.save(<span class="hljs-string">&quot;example_modified.xlsx&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="3-è¿›é˜¶æ“ä½œ"><a href="#3-è¿›é˜¶æ“ä½œ" class="headerlink" title="3. è¿›é˜¶æ“ä½œ"></a>3. è¿›é˜¶æ“ä½œ</h2><h3 id="3-1-æ“ä½œå¤šä¸ªå·¥ä½œè¡¨"><a href="#3-1-æ“ä½œå¤šä¸ªå·¥ä½œè¡¨" class="headerlink" title="3.1 æ“ä½œå¤šä¸ªå·¥ä½œè¡¨"></a>3.1 æ“ä½œå¤šä¸ªå·¥ä½œè¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ›å»ºå¤šä¸ªå·¥ä½œè¡¨</span><br>ws1 = wb.create_sheet(<span class="hljs-string">&quot;Sheet2&quot;</span>)  <span class="hljs-comment"># åˆ›å»ºæ–°å·¥ä½œè¡¨</span><br>ws2 = wb.create_sheet(<span class="hljs-string">&quot;Sheet3&quot;</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># å°†å·¥ä½œè¡¨æ’å…¥åˆ°ç¬¬1ä¸ªä½ç½®</span><br><br><span class="hljs-comment"># è·å–å·¥ä½œè¡¨</span><br><span class="hljs-built_in">print</span>(wb.sheetnames)  <span class="hljs-comment"># è¾“å‡ºæ‰€æœ‰å·¥ä½œè¡¨å</span><br><br><span class="hljs-comment"># åˆ é™¤å·¥ä½œè¡¨</span><br>wb.remove(ws1)<br></code></pre></td></tr></table></figure><h3 id="3-2-è¿­ä»£è¯»å–æ•°æ®"><a href="#3-2-è¿­ä»£è¯»å–æ•°æ®" class="headerlink" title="3.2 è¿­ä»£è¯»å–æ•°æ®"></a>3.2 è¿­ä»£è¯»å–æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æŒ‰è¡Œè¿­ä»£</span><br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.iter_rows(min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">2</span>, min_col=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">2</span>):<br>    <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> row:<br>        <span class="hljs-built_in">print</span>(cell.value)<br><br><span class="hljs-comment"># æŒ‰åˆ—è¿­ä»£</span><br><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> ws.iter_cols(min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">2</span>, min_col=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">2</span>):<br>    <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> col:<br>        <span class="hljs-built_in">print</span>(cell.value)<br></code></pre></td></tr></table></figure><h3 id="3-3-åˆå¹¶å’Œæ‹†åˆ†å•å…ƒæ ¼"><a href="#3-3-åˆå¹¶å’Œæ‹†åˆ†å•å…ƒæ ¼" class="headerlink" title="3.3 åˆå¹¶å’Œæ‹†åˆ†å•å…ƒæ ¼"></a>3.3 åˆå¹¶å’Œæ‹†åˆ†å•å…ƒæ ¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆå¹¶å•å…ƒæ ¼</span><br>ws.merge_cells(<span class="hljs-string">&quot;A1:C1&quot;</span>)  <span class="hljs-comment"># åˆå¹¶A1åˆ°C1</span><br>ws[<span class="hljs-string">&quot;A1&quot;</span>] = <span class="hljs-string">&quot;Merged Cells&quot;</span><br><br><span class="hljs-comment"># æ‹†åˆ†å•å…ƒæ ¼</span><br>ws.unmerge_cells(<span class="hljs-string">&quot;A1:C1&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-4-è®¾ç½®å•å…ƒæ ¼æ ·å¼"><a href="#3-4-è®¾ç½®å•å…ƒæ ¼æ ·å¼" class="headerlink" title="3.4 è®¾ç½®å•å…ƒæ ¼æ ·å¼"></a>3.4 è®¾ç½®å•å…ƒæ ¼æ ·å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> openpyxl.styles <span class="hljs-keyword">import</span> Font, Alignment, PatternFill<br><br><span class="hljs-comment"># è®¾ç½®å­—ä½“æ ·å¼</span><br>ws[<span class="hljs-string">&quot;A1&quot;</span>].font = Font(name=<span class="hljs-string">&quot;Arial&quot;</span>, size=<span class="hljs-number">14</span>, bold=<span class="hljs-literal">True</span>, italic=<span class="hljs-literal">True</span>, color=<span class="hljs-string">&quot;FF0000&quot;</span>)<br><br><span class="hljs-comment"># è®¾ç½®å¯¹é½æ–¹å¼</span><br>ws[<span class="hljs-string">&quot;A1&quot;</span>].alignment = Alignment(horizontal=<span class="hljs-string">&quot;center&quot;</span>, vertical=<span class="hljs-string">&quot;center&quot;</span>)<br><br><span class="hljs-comment"># è®¾ç½®èƒŒæ™¯é¢œè‰²</span><br>ws[<span class="hljs-string">&quot;A1&quot;</span>].fill = PatternFill(fill_type=<span class="hljs-string">&quot;solid&quot;</span>, start_color=<span class="hljs-string">&quot;FFFF00&quot;</span>, end_color=<span class="hljs-string">&quot;FFFF00&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-5-æ’å…¥å›¾è¡¨"><a href="#3-5-æ’å…¥å›¾è¡¨" class="headerlink" title="3.5 æ’å…¥å›¾è¡¨"></a>3.5 æ’å…¥å›¾è¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl.chart <span class="hljs-keyword">import</span> BarChart, Reference<br><br><span class="hljs-comment"># å‡†å¤‡æ•°æ®</span><br>ws.append([<span class="hljs-string">&quot;Year&quot;</span>, <span class="hljs-string">&quot;Sales&quot;</span>])<br>ws.append([<span class="hljs-number">2021</span>, <span class="hljs-number">100</span>])<br>ws.append([<span class="hljs-number">2022</span>, <span class="hljs-number">200</span>])<br>ws.append([<span class="hljs-number">2023</span>, <span class="hljs-number">300</span>])<br><br><span class="hljs-comment"># åˆ›å»ºå›¾è¡¨</span><br>chart = BarChart()<br>data = Reference(ws, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">4</span>)<br>chart.add_data(data, titles_from_data=<span class="hljs-literal">True</span>)<br>ws.add_chart(chart, <span class="hljs-string">&quot;E5&quot;</span>)  <span class="hljs-comment"># å°†å›¾è¡¨æ’å…¥åˆ°E5å•å…ƒæ ¼</span><br></code></pre></td></tr></table></figure><h2 id="4-é«˜çº§åŠŸèƒ½"><a href="#4-é«˜çº§åŠŸèƒ½" class="headerlink" title="4. é«˜çº§åŠŸèƒ½"></a>4. é«˜çº§åŠŸèƒ½</h2><h3 id="4-1-ä½¿ç”¨å…¬å¼"><a href="#4-1-ä½¿ç”¨å…¬å¼" class="headerlink" title="4.1 ä½¿ç”¨å…¬å¼"></a>4.1 ä½¿ç”¨å…¬å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ws[<span class="hljs-string">&quot;A3&quot;</span>] = <span class="hljs-string">&quot;=SUM(B1:B2)&quot;</span>  <span class="hljs-comment"># æ’å…¥SUMå…¬å¼</span><br></code></pre></td></tr></table></figure><h3 id="4-2-æ•°æ®éªŒè¯"><a href="#4-2-æ•°æ®éªŒè¯" class="headerlink" title="4.2 æ•°æ®éªŒè¯"></a>4.2 æ•°æ®éªŒè¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl.worksheet.datavalidation <span class="hljs-keyword">import</span> DataValidation<br><br><span class="hljs-comment"># åˆ›å»ºæ•°æ®éªŒè¯è§„åˆ™</span><br>dv = DataValidation(<span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;list&quot;</span>, formula1=<span class="hljs-string">&#x27;&quot;Option1,Option2,Option3&quot;&#x27;</span>, allow_blank=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># åº”ç”¨æ•°æ®éªŒè¯åˆ°å•å…ƒæ ¼</span><br>ws.add_data_validation(dv)<br>dv.add(ws[<span class="hljs-string">&quot;A1&quot;</span>])<br></code></pre></td></tr></table></figure><h3 id="4-3-æ“ä½œè¶…å¤§æ–‡ä»¶"><a href="#4-3-æ“ä½œè¶…å¤§æ–‡ä»¶" class="headerlink" title="4.3 æ“ä½œè¶…å¤§æ–‡ä»¶"></a>4.3 æ“ä½œè¶…å¤§æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">openpyxl æ”¯æŒåªåŠ è½½éƒ¨åˆ†æ•°æ®ï¼Œé€‚ç”¨äºå¤„ç†å¤§æ–‡ä»¶ã€‚<br><br>wb = load_workbook(<span class="hljs-string">&quot;large_file.xlsx&quot;</span>, read_only=<span class="hljs-literal">True</span>)<br>ws = wb.active<br><br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.iter_rows(values_only=<span class="hljs-literal">True</span>):<br>    <span class="hljs-built_in">print</span>(row)<br></code></pre></td></tr></table></figure><h2 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h2><h3 id="5-1-åªåŠ è½½æ•°æ®ï¼Œä¸åŠ è½½å…¬å¼çš„è®¡ç®—ç»“æœ"><a href="#5-1-åªåŠ è½½æ•°æ®ï¼Œä¸åŠ è½½å…¬å¼çš„è®¡ç®—ç»“æœ" class="headerlink" title="5.1 åªåŠ è½½æ•°æ®ï¼Œä¸åŠ è½½å…¬å¼çš„è®¡ç®—ç»“æœ"></a>5.1 åªåŠ è½½æ•°æ®ï¼Œä¸åŠ è½½å…¬å¼çš„è®¡ç®—ç»“æœ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">wb = load_workbook(<span class="hljs-string">&quot;example.xlsx&quot;</span>, data_only=<span class="hljs-literal">True</span>)<br>ws = wb.active<br><span class="hljs-built_in">print</span>(ws[<span class="hljs-string">&quot;A3&quot;</span>].value)  <span class="hljs-comment"># è¾“å‡ºå…¬å¼è®¡ç®—åçš„ç»“æœï¼Œè€Œä¸æ˜¯å…¬å¼</span><br></code></pre></td></tr></table></figure><h3 id="5-2-ä¿æŠ¤å·¥ä½œè¡¨"><a href="#5-2-ä¿æŠ¤å·¥ä½œè¡¨" class="headerlink" title="5.2 ä¿æŠ¤å·¥ä½œè¡¨"></a>5.2 ä¿æŠ¤å·¥ä½œè¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ws.protection.sheet = <span class="hljs-literal">True</span>  <span class="hljs-comment"># å¯ç”¨ä¿æŠ¤</span><br>ws.protection.password = <span class="hljs-string">&quot;mypassword&quot;</span>  <span class="hljs-comment"># è®¾ç½®å¯†ç </span><br></code></pre></td></tr></table></figure><h3 id="5-3-è®¾ç½®åˆ—å®½å’Œè¡Œé«˜"><a href="#5-3-è®¾ç½®åˆ—å®½å’Œè¡Œé«˜" class="headerlink" title="5.3 è®¾ç½®åˆ—å®½å’Œè¡Œé«˜"></a>5.3 è®¾ç½®åˆ—å®½å’Œè¡Œé«˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ws.column_dimensions[<span class="hljs-string">&quot;A&quot;</span>].width = <span class="hljs-number">20</span>  <span class="hljs-comment"># è®¾ç½®åˆ—å®½</span><br>ws.row_dimensions[<span class="hljs-number">1.</span>height = <span class="hljs-number">30</span>  <span class="hljs-comment"># è®¾ç½®è¡Œé«˜</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jq å¸¸ç”¨æ“ä½œä»‹ç»</title>
    <link href="/2024/12/06/jq/"/>
    <url>/2024/12/06/jq/</url>
    
    <content type="html"><![CDATA[<h1 id="jq-å‘½ä»¤åŸºæœ¬ç”¨æ³•"><a href="#jq-å‘½ä»¤åŸºæœ¬ç”¨æ³•" class="headerlink" title="jq å‘½ä»¤åŸºæœ¬ç”¨æ³•"></a>jq å‘½ä»¤åŸºæœ¬ç”¨æ³•</h1><p>jq æ˜¯ä¸€ä¸ªè½»é‡çº§ä¸”åŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œ JSON å¤„ç†å·¥å…·ï¼Œå…è®¸ç”¨æˆ·çµæ´»åœ°è§£æã€è¿‡æ»¤ã€æ ¼å¼åŒ–å’Œè½¬æ¢ JSON æ•°æ®ã€‚</p><p>éšç€å¾®æœåŠ¡æ¶æ„çš„å…´èµ·ä»¥åŠ JSON æ•°æ®æ ¼å¼çš„å¹¿æ³›ä½¿ç”¨ï¼Œjq å‘½ä»¤çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿåœ¨å˜é«˜ã€‚</p><blockquote><p><a href="https://github.com/Kas-tle/java2bedrock.sh/blob/main/converter.sh">https://github.com/Kas-tle/java2bedrock.sh/blob/main/converter.sh</a></p><p>ç”¨åˆ°äº†å¤§é‡ jq å‘½ä»¤ï¼Œå¯ä»¥å­¦ä¹ å€Ÿé‰´ã€‚</p><p>Top 10 open source and public projects attracting the most first-time contributors in 2024 on GitHub</p></blockquote><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><p>jq [é€‰é¡¹] &lt;è¿‡æ»¤è¡¨è¾¾å¼&gt; [æ–‡ä»¶å]</p><h2 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h2><ol><li><p>æ ¼å¼åŒ–è¾“å‡º</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ ¼å¼åŒ– JSON æ•°æ®ä¸ºå¯è¯»æ ¼å¼ </span><br>jq <span class="hljs-string">&#x27;.&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>æå–å­—æ®µå€¼</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æå– nameå­—æ®µå€¼</span><br>jq <span class="hljs-string">&#x27;.name&#x27;</span> data.json<br><span class="hljs-comment"># æå–å¤šä¸ªå­—æ®µå€¼</span><br>jq <span class="hljs-string">&#x27;.name, .age&#x27;</span> data.json<br>jq <span class="hljs-string">&#x27;.[] | &#123;name: .name, city: .city&#125;&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>æå–åµŒå¥—å­—æ®µ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æå– skills æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼</span><br>jq <span class="hljs-string">&#x27;.skills[0]&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤æ•°ç»„</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¾“å‡ºæ•°ç»„ä¸­çš„æ‰€æœ‰å€¼ã€‚</span><br>jq <span class="hljs-string">&#x27;.skills[]&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li></ol><h2 id="å¤æ‚æ“ä½œ"><a href="#å¤æ‚æ“ä½œ" class="headerlink" title="å¤æ‚æ“ä½œ"></a>å¤æ‚æ“ä½œ</h2><ol><li><p>æ¡ä»¶ç­›é€‰</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¾“å‡º age å¤§äº 25 çš„æ•°æ®</span><br>jq <span class="hljs-string">&#x27;select(.age &gt; 25)&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>è®¡ç®—å­—æ®µ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è®¡ç®— age å­—æ®µçš„ä¸¤å€</span><br>jq <span class="hljs-string">&#x27;.age * 2&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ JSON æ•°æ®</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°† age å­—æ®µçš„å€¼ä¿®æ”¹ä¸º 35</span><br>jq <span class="hljs-string">&#x27;.age = 35&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ æ–°å­—æ®µ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç»™ JSON æ•°æ®æ·»åŠ  city å­—æ®µ</span><br>jq <span class="hljs-string">&#x27;. + &#123;city: &quot;New York&quot;&#125;&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>ç»“åˆç®¡é“å‘½ä»¤</p><ul><li>ä»å‘½ä»¤è¡Œè·å–æ•°æ®å¹¶å¤„ç†ï¼š</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½œç”¨ï¼šä» API è·å–æ•°æ®å¹¶ç­›é€‰ä»·æ ¼å¤§äº 100 çš„é¡¹ç›®</span><br>curl -s https://api.example.com/data | jq <span class="hljs-string">&#x27;.items[] | select(.price &gt; 100)&#x27;</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="å¸¸ç”¨é€‰é¡¹"><a href="#å¸¸ç”¨é€‰é¡¹" class="headerlink" title="å¸¸ç”¨é€‰é¡¹"></a>å¸¸ç”¨é€‰é¡¹</h2><ul><li><p>-rï¼šå»æ‰è¾“å‡ºä¸­çš„å¼•å·</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">jq -r <span class="hljs-string">&#x27;.name&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li><li><p>-cï¼šå‹ç¼©æ ¼å¼è¾“å‡º</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">jq -c <span class="hljs-string">&#x27;.&#x27;</span> data.json<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GitLab å¸¸ç”¨æ“ä½œä¸é—®é¢˜è®°å½•</title>
    <link href="/2024/11/29/GitLab-Base/"/>
    <url>/2024/11/29/GitLab-Base/</url>
    
    <content type="html"><![CDATA[<h1 id="GitLab-å¸¸ç”¨æ“ä½œä¸é—®é¢˜è®°å½•"><a href="#GitLab-å¸¸ç”¨æ“ä½œä¸é—®é¢˜è®°å½•" class="headerlink" title="GitLab å¸¸ç”¨æ“ä½œä¸é—®é¢˜è®°å½•"></a>GitLab å¸¸ç”¨æ“ä½œä¸é—®é¢˜è®°å½•</h1><h2 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>gitlab-rails console<br><br>user = User.find_by_username(<span class="hljs-string">&#x27;root&#x27;</span>)<br><br>user.password = <span class="hljs-string">&#x27;NewSecurePassword&#x27;</span><br><br>user.password_confirmation = <span class="hljs-string">&#x27;NewSecurePassword&#x27;</span><br><br>user.save!<br></code></pre></td></tr></table></figure><h2 id="External-url"><a href="#External-url" class="headerlink" title="External url"></a>External url</h2><p>å½±å“åˆ°ç‚¹å‡»å…‹éš†æŒ‰é’®æ˜¾ç¤ºçš„åœ°å€</p><p>æ‰“å¼€ GitLab çš„ä¸»é…ç½®æ–‡ä»¶ï¼š&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb</p><p>ä¿®æ”¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini">external_url &#x27;http://your.gitlab.domain&#x27;<br></code></pre></td></tr></table></figure><p>é‡æ–°é…ç½® gitlab å¹¶é‡å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> gitlab-ctl reconfigure<br><br><span class="hljs-built_in">sudo</span> gitlab-ctl restart<br></code></pre></td></tr></table></figure><ol start="3"><li><p>æ£€æŸ¥ SSH å’Œ HTTP&#x2F;HTTPS é…ç½®</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini">gitlab_rails<span class="hljs-section">[&#x27;gitlab_shell_ssh_host&#x27;]</span> = &#x27;your.gitlab.domain&#x27;<br></code></pre></td></tr></table></figure></li></ol><ul><li><p>å¦‚æœä¾ç„¶æ˜¾ç¤ºé”™è¯¯å¯å°è¯•æ¸…ç†ç¼“å­˜</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> gitlab-rake cache:clear<br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æœåŠ¡çŠ¶æ€</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> gitlab-ctl status<br></code></pre></td></tr></table></figure><p>  Nginx é…ç½®å†²çª</p><p>  â€¢ ç¡®ä¿æ²¡æœ‰å…¶ä»–æœåŠ¡å ç”¨ GitLab çš„ç«¯å£ã€‚</p><p>  â€¢ æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦ç”Ÿæˆæ­£ç¡®ï¼š</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> gitlab-ctl show-config | grep nginx<br></code></pre></td></tr></table></figure></li></ul><h2 id="GitLab-å‡çº§è¿ç§»"><a href="#GitLab-å‡çº§è¿ç§»" class="headerlink" title="GitLab å‡çº§è¿ç§»"></a>GitLab å‡çº§è¿ç§»</h2><p>è·¨å¤šä¸ªç‰ˆæœ¬å‡çº§æ—¶ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜éœ€è¦é€æ­¥å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬</p><ul><li>GitLab 8:Â <code>8.11.Z</code>Â &gt;Â <code>8.12.0</code>Â &gt;Â <code>8.17.7</code></li><li>GitLab 9:Â <code>9.0.13</code>Â &gt;Â <code>9.5.10</code></li><li>GitLab 10:Â <code>10.0.7</code>Â &gt;Â <code>10.8.7</code></li><li>GitLab 11:Â <code>11.0.6</code>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1200"><code>11.11.8</code></a></li><li>GitLab 12:Â <code>12.0.12</code>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1210"><code>12.1.17</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#12100"><code>12.10.14</code></a></li><li>GitLab 13:Â <code>13.0.14</code>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1310"><code>13.1.11</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1388"><code>13.8.8</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#13120"><code>13.12.15</code></a></li><li>GitLab 14:Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1400"><code>14.0.12</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1430"><code>14.3.6</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1490"><code>14.9.5</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#14100"><code>14.10.5</code></a></li><li>GitLab 15:Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1500"><code>15.0.5</code></a>Â &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1510"><code>15.1.6</code></a>Â (for GitLab instances with multiple web nodes) &gt;Â <a href="https://archives.docs.gitlab.com/15.11/ee/update/index.html#1540"><code>15.4.6</code></a>Â &gt;Â <a href="https://gitlab.com/gitlab-org/gitlab/-/releases">latestÂ <code>15.Y.Z</code></a></li></ul><p>GitLab 15 includes the following required upgrade stops:</p><ul><li><p>15.0.5.</p></li><li><p>15.1.6. GitLab instances with multiple web nodes.</p></li><li><p>15.4.6.</p></li><li><p>15.11.13. The latest GitLab 15.11 release.</p></li></ul><p>GitLab 16 includes the following required upgrade stops:</p><ul><li><p>16.0.9. Instances with lots of users or large pipeline variables history.</p></li><li><p>16.1.7. Instances with NPM packages in their package registry.</p></li><li><p>16.2.10. Instances with large pipeline variables history.</p></li><li><p>16.3.8.</p></li><li><p>16.7.z. The latest GitLab 16.7 release.</p></li><li><p>16.11.z. The latest GitLab 16.11 release.</p></li></ul><p>GitLab 17 includes the following required upgrade stops:</p><ul><li><p>17.3.z. The latest GitLab 17.3 release.</p></li><li><p>17.5.z. The latest GitLab 17.5 release.</p></li><li><p>17.8.z. Not yet released.</p></li><li><p>17.11.z. Not yet released.</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å‡çº§å‰è¯·åŠ¡å¿…å…ˆå¤‡ä»½</span><br><span class="hljs-comment">## å…³é—­selinux</span><br>setenforce 0<br><span class="hljs-comment">## æ°¸ä¹…å…³é—­selinuxï¼Œå¹¶é‡å¯</span><br>sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing/SELINUX=disabled/&#x27;</span> /etc/selinux/config<br>rpm -Uvh gitlab-ce-11.11.8-ce.0.el7.x86_64.rpm<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://gitlab.cn/support/toolbox/upgrade-path/">https://gitlab.cn/support/toolbox/upgrade-path/</a></p></blockquote><h2 id="GitLab-åŸºç¡€æ“ä½œ"><a href="#GitLab-åŸºç¡€æ“ä½œ" class="headerlink" title="GitLab åŸºç¡€æ“ä½œ"></a>GitLab åŸºç¡€æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## è·å– gitlab ç‰ˆæœ¬ä¿¡æ¯</span><br>gitlab-rake gitlab:<span class="hljs-built_in">env</span>:info<br><span class="hljs-comment">## æŸ¥çœ‹ gitlab è¿è¡ŒçŠ¶æ€</span><br>gitlab-ctl status<br><span class="hljs-comment">## æŸ¥çœ‹ gitlab è¿è¡Œæ—¥å¿—</span><br>gitlab-ctl <span class="hljs-built_in">tail</span><br><span class="hljs-comment">## é‡å¯ gitlab</span><br>gitlab-ctl restart<br><span class="hljs-comment">## å¤‡ä»½ gitlab</span><br>gitlab-backup create<br><span class="hljs-comment">## æ—§ç‰ˆæœ¬å¤‡ä»½</span><br>gitlab-rake gitlab:backup:create<br><span class="hljs-comment">## æ¢å¤å¤‡ä»½</span><br><span class="hljs-comment">## timestamp å¡«æ—¶é—´æˆ³è€Œä¸æ˜¯æ–‡ä»¶å</span><br>gitlab-backup restore BACKUP=timestamp<br>gitlab-rake gitlab:backup:restore BACKUP=TIMESTAMP<br><span class="hljs-comment">## é‡æ–°é…ç½®gitlab</span><br>gitlab-ctl reconfigure<br><span class="hljs-comment">## æ£€æŸ¥ gitlab æ˜¯å¦æ­£å¸¸è¿è¡Œ</span><br>gitlab-rake gitlab:check<br><span class="hljs-comment">## æ£€æŸ¥ gitlab ä»“åº“æ˜¯å¦æ­£å¸¸è¿è¡Œ</span><br>gitlab-rake gitlab:repos:check<br>gitlab-rake gitlab:check SANITIZE=<span class="hljs-literal">true</span><br><span class="hljs-comment">## å¯ç”¨è¯¦ç»†æ¨¡å¼</span><br>gitlab-rake gitlab:check VERBOSE=<span class="hljs-literal">true</span><br>gitlab-ctl status<br><span class="hljs-comment">## é‡æ–°åŠ è½½é…ç½®</span><br>gitlab-ctl reconfigure<br></code></pre></td></tr></table></figure><h2 id="gitlab-å‡çº§-14-ç‰ˆæœ¬è¿ç§»é—®é¢˜"><a href="#gitlab-å‡çº§-14-ç‰ˆæœ¬è¿ç§»é—®é¢˜" class="headerlink" title="gitlab å‡çº§ 14 ç‰ˆæœ¬è¿ç§»é—®é¢˜"></a>gitlab å‡çº§ 14 ç‰ˆæœ¬è¿ç§»é—®é¢˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## è¿ç§»é¡¹ç›®åˆ°æ–°çš„å­˜å‚¨è·¯å¾„</span><br>gitlab-rake gitlab:storage:migrate_to_hashed<br><span class="hljs-comment">## ä½¿ç”¨ä¹‹åä¼šæç¤º Found 6 projects using Legacy Storage.</span><br><span class="hljs-comment">## æŸ¥çœ‹ä½¿ç”¨ Legacy Storage çš„é¡¹ç›®æ•°é‡ </span><br>gitlab-rake gitlab:storage:legacy_projects<br><span class="hljs-comment">## æŸ¥çœ‹è¿™å…­ä¸ªå…·ä½“æ˜¯ä»€ä¹ˆé¡¹ç›®</span><br><span class="hljs-comment">## æŸ¥çœ‹ä½¿ç”¨æ—§ç‰ˆæœ¬çš„é¡¹ç›®</span><br>gitlab-rake gitlab:storage:list_legacy_projects<br></code></pre></td></tr></table></figure><h3 id="read-onlyçŠ¶æ€å¯¼è‡´çš„è¿ç§»é—®é¢˜"><a href="#read-onlyçŠ¶æ€å¯¼è‡´çš„è¿ç§»é—®é¢˜" class="headerlink" title="read-onlyçŠ¶æ€å¯¼è‡´çš„è¿ç§»é—®é¢˜"></a>read-onlyçŠ¶æ€å¯¼è‡´çš„è¿ç§»é—®é¢˜</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># è¿›å…¥ Rails æ§åˆ¶å°</span><br>gitlab-rails console<br><br><span class="hljs-comment"># æŸ¥è¯¢ é¡¹ç›® read-only æ‰“å¼€çš„ </span><br>projects = <span class="hljs-title class_">Project</span>.where(<span class="hljs-symbol">repository_read_only:</span> <span class="hljs-literal">true</span>)<br><br><span class="hljs-comment"># å…³é—­ é¡¹ç›®çš„ read-only</span><br>projects.each <span class="hljs-keyword">do</span> |<span class="hljs-params">p</span>|<br>  p.update!(<span class="hljs-symbol">repository_read_only:</span><span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å­˜å‚¨åº“è¿ç§»</span><br>gitlab-rake gitlab:storage:migrate_to_hashed<br><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€åˆ—å‡ºé¡¹ç›®æ€»æ•°ï¼Œä¸é¡µé¢æ˜¾ç¤ºæ•°é‡è¿›è¡Œå¯¹æ¯”</span><br>gitlab-rake gitlab:storage:hashed_projects<br><br><span class="hljs-comment"># æŸ¥çœ‹ï¼Œå…¨éƒ¨è¿ç§»æˆåŠŸä»¥ä¸‹ä¸¤æ¡å‘½ä»¤åº”è¯¥ä¸º 0 </span><br>gitlab-rake gitlab:storage:legacy_projects<br>gitlab-rake gitlab:storage:legacy_attachments<br><br><span class="hljs-comment"># å…¨éƒ¨è¿ç§»æˆåŠŸï¼Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤åº”è¯¥æ²¡æœ‰è¾“å‡º</span><br>gitlab-rake gitlab:storage:list_legacy_projects<br>gitlab-rake gitlab:storage:list_legacy_attachments<br></code></pre></td></tr></table></figure><h3 id="hashed-ç›®å½•è¿ç§»å¤±è´¥"><a href="#hashed-ç›®å½•è¿ç§»å¤±è´¥" class="headerlink" title="@hashed ç›®å½•è¿ç§»å¤±è´¥"></a>@hashed ç›®å½•è¿ç§»å¤±è´¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å…·ä½“å“ªäº›é¡¹ç›®è¿ç§»å¤±è´¥</span><br>gitlab-rake gitlab:storage:list_legacy_projects<br><span class="hljs-comment"># åœ¨æ—¥å¿—ä¸­æœç´¢è¯¥é¡¹ç›®ï¼ŒæŸ¥çœ‹å…·ä½“è·¯å¾„</span><br>grep <span class="hljs-string">&#x27;xxxx&#x27;</span> /var/log/gitlab/sidekiq/current<br><span class="hljs-comment"># å‘ç°æŠ¥é”™Repository cannot be moved from &#x27;@hashed/b2/81/b281bcxxxxxxxx.wiki&#x27; to</span><br><span class="hljs-comment"># æŸ¥çœ‹ç›®å½•ä¸‹æ˜¯å¦æœ‰ xxx.wikiçš„ç›®å½•</span><br><span class="hljs-built_in">ls</span> -l /var/opt/gitlab/git-data/repositories/@hashed/98/96/<br><span class="hljs-comment"># å‘ç°æœ‰è¯¥ç›®å½•ï¼Œå°†å…¶ç§»åŠ¨åˆ° /tmp ç›®å½•ä¸‹</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> /var/opt/gitlab/git-data/repositories/@hashed/b2/81/b281bcxxxxxxx /tmp/<br><span class="hljs-comment"># ç„¶åå†æ‰§è¡Œè¿ç§»</span><br><span class="hljs-built_in">sudo</span> gitlab-rake gitlab:storage:migrate_to_hashed<br></code></pre></td></tr></table></figure><h3 id="åå°è¿ç§»ä»»åŠ¡æ²¡å®Œæˆ"><a href="#åå°è¿ç§»ä»»åŠ¡æ²¡å®Œæˆ" class="headerlink" title="åå°è¿ç§»ä»»åŠ¡æ²¡å®Œæˆ"></a>åå°è¿ç§»ä»»åŠ¡æ²¡å®Œæˆ</h3><blockquote><p><a href="https://archives.docs.gitlab.com/15.11/ee/update/background_migrations.html">https://archives.docs.gitlab.com/15.11/ee/update/background_migrations.html</a></p><p><a href="https://archives.docs.gitlab.com/15.11/ee/update/#upgrade-paths">https://archives.docs.gitlab.com/15.11/ee/update/#upgrade-paths</a></p></blockquote><p>14ç‰ˆæœ¬åå¯åœ¨é¡µé¢ä¸­çœ‹è§åå°è¿ç§»ä»»åŠ¡ã€‚<br>åœ¨ç®¡ç†ä¸­å¿ƒç›‘æ§ä¸­åå°è¿ç§»å¯çœ‹è§æœªå®Œæˆè¿ç§»ä»»åŠ¡ã€‚</p><p>å‡çº§ä¸­å¯èƒ½å› ä¸ºBackground Migrationä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå¯¼è‡´å‡çº§å¤±è´¥ã€‚<br>éœ€è¦ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œå†è¿›è¡Œå‡çº§ã€‚</p><h2 id="å‡çº§-16-å¤§ç‰ˆæœ¬é…ç½®é¡¹å·²åºŸå¼ƒçš„é—®é¢˜"><a href="#å‡çº§-16-å¤§ç‰ˆæœ¬é…ç½®é¡¹å·²åºŸå¼ƒçš„é—®é¢˜" class="headerlink" title="å‡çº§ 16 å¤§ç‰ˆæœ¬é…ç½®é¡¹å·²åºŸå¼ƒçš„é—®é¢˜"></a>å‡çº§ 16 å¤§ç‰ˆæœ¬é…ç½®é¡¹å·²åºŸå¼ƒçš„é—®é¢˜</h2><p>å¦‚ gitlab_rails[â€˜gitlab_default_can_create_groupâ€™] has been deprecated since 15.5 and was removed in 16.0.</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨ <code>gitlab.rb</code> ä¸­å°†æç¤ºé…ç½®é¡¹åˆ é™¤æˆ–æ³¨é‡Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¿®æ”¹å®Œé…ç½®é¡¹åï¼Œé‡æ–°é…ç½®ï¼Œé‡å¯</span><br>gitlab-ctl reconfigure<br>gitlab-ctl restart<br></code></pre></td></tr></table></figure><h2 id="åå°ä»»åŠ¡è¿›åº¦æœªçŸ¥é—®é¢˜"><a href="#åå°ä»»åŠ¡è¿›åº¦æœªçŸ¥é—®é¢˜" class="headerlink" title="åå°ä»»åŠ¡è¿›åº¦æœªçŸ¥é—®é¢˜"></a>åå°ä»»åŠ¡è¿›åº¦æœªçŸ¥é—®é¢˜</h2><p>è¿è¡Œ<code>gitlab-psql</code> è¿›å…¥æ§åˆ¶å°</p><figure class="highlight postgresql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs postgresql"># è·å–æ­£åœ¨è¿ç§»çš„ä»»åŠ¡ ID<br><span class="hljs-keyword">SELECT</span><br> id,<br> job_class_name,<br> <span class="hljs-built_in">table_name</span>,<br> <span class="hljs-built_in">column_name</span>,<br> job_arguments<br><span class="hljs-keyword">FROM</span> batched_background_migrations<br><span class="hljs-keyword">WHERE</span> status <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>);<br><br># æŸ¥çœ‹ä»»åŠ¡è¿›åº¦<br># å°† xx æ›¿æ¢ä¸ºæŸ¥è¯¢åˆ°çš„ ID<br># å¤šæ¬¡è¿è¡ŒæŸ¥è¯¢å¦‚æœæ²¡æœ‰æ–°è¡Œæ·»åŠ è¯´æ˜å®Œæˆæˆ–æš‚åœ<br># æœ‰å˜åŒ–åˆ™ä»åœ¨è¿è¡Œ<br><span class="hljs-keyword">SELECT</span><br> started_at,<br> finished_at,<br> finished_at - started_at <span class="hljs-keyword">AS</span> duration,<br> min_value,<br> max_value,<br> batch_size,<br> sub_batch_size<br><span class="hljs-keyword">FROM</span> batched_background_migration_jobs<br><span class="hljs-keyword">WHERE</span> batched_background_migration_id = XX<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span><br><span class="hljs-keyword">limit</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®-ldap"><a href="#é…ç½®-ldap" class="headerlink" title="é…ç½® ldap"></a>é…ç½® ldap</h2><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs rb">gitlab_rails[<span class="hljs-string">&#x27;ldap_enabled&#x27;</span>] = <span class="hljs-literal">true</span><br>gitlab_rails[<span class="hljs-string">&#x27;ldap_servers&#x27;</span>] = <span class="hljs-variable constant_">YAML</span>.load <span class="hljs-string">&lt;&lt;-EOS</span><br><span class="hljs-string">  main: # å¯ä»¥é…ç½®å¤šä¸ª LDAP æœåŠ¡å™¨ï¼Œè¿™é‡Œæ˜¯ä¸»æœåŠ¡å™¨</span><br><span class="hljs-string">    label: &#x27;LDAP&#x27; # æ˜¾ç¤ºåœ¨ç™»å½•é¡µé¢çš„åç§°</span><br><span class="hljs-string">    host: &#x27;ldap.example.com&#x27;</span><br><span class="hljs-string">    port: 389</span><br><span class="hljs-string">    uid: &#x27;sAMAccountName&#x27; # ç”¨äºç”¨æˆ·ç™»å½•çš„å±æ€§ï¼Œä¾‹å¦‚ AD ä¸­çš„ sAMAccountName</span><br><span class="hljs-string">    bind_dn: &#x27;cn=admin,dc=example,dc=com&#x27; # ç”¨äºç»‘å®šçš„æœåŠ¡è´¦æˆ·</span><br><span class="hljs-string">    password: &#x27;password&#x27; # æœåŠ¡è´¦æˆ·å¯†ç </span><br><span class="hljs-string">    encryption: &#x27;plain&#x27; # åŠ å¯†æ–¹å¼ï¼šplainã€start_tls æˆ– simple_tls</span><br><span class="hljs-string">    verify_certificates: true</span><br><span class="hljs-string">    smartcard_auth: false</span><br><span class="hljs-string">    active_directory: true # å¦‚æœä½¿ç”¨çš„æ˜¯ Active Directoryï¼Œè®¾ç½®ä¸º true</span><br><span class="hljs-string">    allow_username_or_email_login: false</span><br><span class="hljs-string">    lowercase_usernames: false</span><br><span class="hljs-string">    block_auto_created_users: false</span><br><span class="hljs-string">    base: &#x27;dc=example,dc=com&#x27; # ç”¨æˆ·æœç´¢çš„ Base DN</span><br><span class="hljs-string">    user_filter: &#x27;&#x27; # é¢å¤–çš„ç­›é€‰æ¡ä»¶ï¼Œä¾‹å¦‚åªå…è®¸ç‰¹å®šç»„çš„ç”¨æˆ·è®¿é—®</span><br><span class="hljs-string">    group_base: &#x27;&#x27;</span><br><span class="hljs-string">    admin_group: &#x27;&#x27; # å¦‚æœæœ‰ç®¡ç†å‘˜ç»„ï¼Œå¯ä»¥è®¾ç½®æ­¤é¡¹</span><br><span class="hljs-string">    sync_ssh_keys: false # æ˜¯å¦åŒæ­¥ç”¨æˆ·çš„ SSH å¯†é’¥</span><br><span class="hljs-string">EOS</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é‡æ–°é…ç½®</span><br>gitlab-ctl reconfigure<br><span class="hljs-comment"># é‡å¯</span><br>gitlab-ctl restart<br><span class="hljs-comment"># æµ‹è¯•ï¼Œå¦‚æœé…ç½®æˆåŠŸï¼Œè¾“å‡ºä¼šæ˜¾ç¤ºç”¨æˆ·å’Œç»„ä¿¡æ¯ã€‚</span><br>gitlab-rake gitlab:ldap:check<br></code></pre></td></tr></table></figure><h2 id="redis-å¼€å¯RDB-å¯¼è‡´-oom-gitlab-å´©æºƒ"><a href="#redis-å¼€å¯RDB-å¯¼è‡´-oom-gitlab-å´©æºƒ" class="headerlink" title="redis å¼€å¯RDB å¯¼è‡´ oom gitlab å´©æºƒ"></a>redis å¼€å¯RDB å¯¼è‡´ oom gitlab å´©æºƒ</h2><p>å…¬å¸ä½¿ç”¨äº†äº‘å­˜å‚¨ nasï¼Œç£ç›˜æ€§èƒ½ä¸å¥½ï¼Œå¯¼è‡´ gitlab å‡ºç°é—®é¢˜ã€‚</p><p>gitlab è‡ªå¸¦çš„ redis é…ç½®é»˜è®¤å¼€å¯ RDB æŒä¹…åŒ–ï¼Œå¦‚æœç£ç›˜æ€§èƒ½è¾ƒå·®ï¼Œå¯èƒ½å¯¼è‡´ oom å´©æºƒé—®é¢˜ã€‚</p><ul><li>Redis åœ¨è¿›è¡Œ RDB æŒä¹…åŒ–æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼ˆé€šè¿‡ forkï¼‰ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›æœåŠ¡ï¼Œå­è¿›ç¨‹è´Ÿè´£å†™å…¥ RDB æ–‡ä»¶ã€‚</li><li>å¦‚æœå†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œfork æ“ä½œä¼šè€—è´¹å¤§é‡å†…å­˜èµ„æºï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ã€‚</li><li>åœ¨ç”Ÿæˆ RDB æ–‡ä»¶æœŸé—´ï¼Œå¦‚æœ Redis æ­£åœ¨è¿›è¡Œå¤§é‡å†™æ“ä½œï¼Œå†…å­˜é¡µé¢ä¼šé¢‘ç¹è¢«ä¿®æ”¹ï¼Œå¯¼è‡´æ“ä½œç³»ç»Ÿå¿…é¡»å¤åˆ¶è¿™äº›é¡µé¢ï¼Œå¢åŠ äº†å†…å­˜å’Œ CPU çš„å¼€é”€ã€‚</li><li>å¦‚æœç£ç›˜æ€§èƒ½è¾ƒå·®ï¼ŒRDB æ–‡ä»¶çš„å†™å…¥é€Ÿåº¦è¾ƒæ…¢ï¼Œä¼šè®©å­è¿›ç¨‹å ç”¨æ›´å¤šæ—¶é—´ï¼Œä»è€Œä½¿çˆ¶è¿›ç¨‹çš„ COW æ“ä½œè¢«æ”¾å¤§ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## é»˜è®¤é…ç½®</span><br>save 900 1<br>save 300 10<br>save 60 10000<br>appendonly no<br><br><span class="hljs-comment">## ä¿®æ”¹é…ç½®</span><br>save <span class="hljs-string">&quot;&quot;</span><br>appendonly <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><blockquote><p>æœ€å¥½çš„æ–¹æ³•å½“ç„¶æ˜¯æ¢æ€§èƒ½å¥½çš„ç£ç›˜</p><p>è€Œä¸”ç£ç›˜æ€§èƒ½ä¸è¡Œä¼šå‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜</p></blockquote><h2 id="è¿ç§»å-webhooks-è®¿é—®-500"><a href="#è¿ç§»å-webhooks-è®¿é—®-500" class="headerlink" title="è¿ç§»å webhooks è®¿é—® 500"></a>è¿ç§»å webhooks è®¿é—® 500</h2><p>æ—§ç‰ˆæœ¬ webhook ä¸æ–°ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´</p><ol><li><p>æ‰¾åˆ°é¡¹ç›® id</p></li><li><p>åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢webhookçš„ idï¼š <code>select id from web_hooks where project_id=2016;</code></p></li><li><p>é€šè¿‡æ¥å£è¯·æ±‚åˆ é™¤ webhooks</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --header <span class="hljs-string">&quot;Private-Token: 4Yn1dffiTDpy5c2xvN8X&quot;</span> -X DELETE http://gitlab.com/api/v4/projects/&lt;project_id&gt;/hooks/&lt;webhook_id&gt;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker Notes</title>
    <link href="/2024/11/29/docker-notes/"/>
    <url>/2024/11/29/docker-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="Docker-Notes"><a href="#Docker-Notes" class="headerlink" title="Docker Notes"></a>Docker Notes</h1><h2 id="docker-save-å’Œ-export-åŒºåˆ«"><a href="#docker-save-å’Œ-export-åŒºåˆ«" class="headerlink" title="docker save å’Œ export åŒºåˆ«"></a>docker save å’Œ export åŒºåˆ«</h2><ol><li><p>åŠŸèƒ½å’Œç”¨é€”</p><ul><li><p>docker export</p><ul><li>å¯¼å‡ºä¸€ä¸ªå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>æå–å®¹å™¨å½“å‰çš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼Œä¸åŒ…æ‹¬é•œåƒçš„å†å²å±‚ã€å…ƒæ•°æ®æˆ–å¯åŠ¨å‘½ä»¤ç­‰ä¿¡æ¯ã€‚</li><li>é€šå¸¸ç”¨äºå¤‡ä»½æˆ–è¿ç§»å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå†…å®¹ã€‚</li></ul></li><li><p>docker save</p><ul><li>ä¿å­˜ä¸€ä¸ªé•œåƒåŠå…¶å†å²å±‚å’Œå…ƒæ•°æ®ã€‚</li><li>åŒ…æ‹¬é•œåƒçš„æ‰€æœ‰å†å²å±‚ã€CMDã€ENTRYPOINTã€ç¯å¢ƒå˜é‡ç­‰é…ç½®ã€‚</li><li>é€šå¸¸ç”¨äºå¤‡ä»½æˆ–è¿ç§»é•œåƒï¼ˆå¯ä»¥åœ¨ç›®æ ‡ç¯å¢ƒä¸­ç›´æ¥åŠ è½½å¹¶è¿è¡Œï¼‰ã€‚</li></ul></li></ul></li><li><p>å¯¼å‡ºçš„å†…å®¹</p><ul><li>docker export<ul><li>å¯¼å‡ºçš„å†…å®¹æ˜¯å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå½¢å¼æ˜¯ä¸€ä¸ªçº¯æ–‡ä»¶å±‚ï¼Œæ²¡æœ‰é•œåƒçš„ç»“æ„ä¿¡æ¯ã€‚</li><li>ä¸åŒ…æ‹¬å¯åŠ¨å‘½ä»¤ã€ç¯å¢ƒå˜é‡ç­‰å…ƒæ•°æ®ã€‚</li></ul></li><li>docker save<ul><li>å¯¼å‡ºçš„å†…å®¹æ˜¯é•œåƒçš„å®Œæ•´ç»“æ„ï¼ŒåŒ…æ‹¬æ‰€æœ‰å±‚å’Œå…ƒæ•°æ®ã€‚</li><li>å¯ç›´æ¥ç”¨äºåŠ è½½åˆ°å…¶ä»– Docker å®ä¾‹ä¸­ã€‚</li></ul></li></ul></li><li><p>ä½¿ç”¨åœºæ™¯</p><ul><li>docker export<ul><li>å½“æ‚¨åªéœ€è¦å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦é•œåƒä¿¡æ¯æ—¶ä½¿ç”¨ã€‚</li><li>ç”¨äºå®¹å™¨æ•°æ®å¤‡ä»½æˆ–åœ¨ä¸éœ€è¦ Docker ç¯å¢ƒçš„æƒ…å†µä¸‹æå–æ–‡ä»¶ã€‚</li></ul></li><li>docker save<ul><li>ç”¨äºè¿ç§»å®Œæ•´é•œåƒï¼ŒåŒ…æ‹¬å†å²è®°å½•ã€é…ç½®å’Œå¤šå±‚ç»“æ„ã€‚</li><li>å¸¸ç”¨äºè·¨ç¯å¢ƒä¼ è¾“é•œåƒï¼Œä¾‹å¦‚å°†é•œåƒä»å¼€å‘ç¯å¢ƒè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li></ul></li></ul></li><li><p>åŠ è½½&#x2F;æ¢å¤æ–¹å¼</p><ul><li><p>docker export</p><ul><li>ä½¿ç”¨ tar å·¥å…·è§£å‹æå–å†…å®¹ï¼Œæˆ–è€…é€šè¿‡ docker import æ¢å¤ä¸ºä¸€ä¸ªæ–°é•œåƒï¼Œä½†åªåŒ…å«æ–‡ä»¶ç³»ç»Ÿï¼Œæ²¡æœ‰å…ƒæ•°æ®ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker import container.tar &lt;new_image_name&gt;<br></code></pre></td></tr></table></figure></li><li><p>docker save</p><ul><li>ä½¿ç”¨ docker load åŠ è½½ä¸ºå®Œæ•´é•œåƒï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker load -i image.tar<br></code></pre></td></tr></table></figure></li></ul></li></ol><h2 id="å®¹å™¨å…±äº«å†…å­˜"><a href="#å®¹å™¨å…±äº«å†…å­˜" class="headerlink" title="å®¹å™¨å…±äº«å†…å­˜"></a>å®¹å™¨å…±äº«å†…å­˜</h2><p>åœ¨ Docker å®¹å™¨ä¸­ï¼Œ&#x2F;dev&#x2F;shm æ˜¯ä¸€ä¸ªå†…å­˜å…±äº«åŒºåŸŸï¼Œé€šå¸¸ç”¨äºé«˜æ•ˆçš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€‚Docker é»˜è®¤ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªå¤§å°å›ºå®šçš„ &#x2F;dev&#x2F;shm åŒºåŸŸï¼Œé»˜è®¤å¤§å°ä¸º 64MBï¼Œè¿™åœ¨æŸäº›åº”ç”¨åœºæ™¯ï¼ˆå¦‚é«˜æ€§èƒ½è®¡ç®—ã€æ•°æ®åº“æ“ä½œç­‰ï¼‰ä¸­å¯èƒ½ä¸è¶³ã€‚</p><ol><li><p>&#x2F;dev&#x2F;shm çš„é»˜è®¤å¤§å°ï¼š</p><p>é»˜è®¤å¤§å°ä¸º 64MBï¼Œä½†å¯ä»¥é€šè¿‡é…ç½®å®¹å™¨å¯åŠ¨å‚æ•°å¢åŠ ã€‚</p></li><li><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><p>æ•°æ®åº“ï¼ˆå¦‚ PostgreSQLã€Redisï¼‰ï¼šéœ€è¦ä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œç¼“å­˜ã€‚</p></li><li><p>å›¾åƒå¤„ç†ï¼ˆå¦‚ OpenCVï¼‰ï¼šæŸäº›åº“éœ€è¦ä¾èµ–å…±äº«å†…å­˜ã€‚</p></li><li><p>æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆå¦‚ Seleniumï¼‰ï¼šæµè§ˆå™¨è¿è¡Œä¾èµ–å…±äº«å†…å­˜ã€‚</p></li></ul></li><li><p>æŸ¥çœ‹å®¹å™¨å†… &#x2F;dev&#x2F;shm å¤§å°ï¼šdf -h &#x2F;dev&#x2F;shm</p></li></ol><h3 id="è°ƒæ•´å…±äº«å†…å­˜"><a href="#è°ƒæ•´å…±äº«å†…å­˜" class="headerlink" title="è°ƒæ•´å…±äº«å†…å­˜"></a>è°ƒæ•´å…±äº«å†…å­˜</h3><ol><li><p>åœ¨ docker run ä¸­æŒ‡å®š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --shm-size=1g your_image<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ docker-compose ä¸­é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">your_service:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">your_image</span><br>    <span class="hljs-attr">shm_size:</span> <span class="hljs-string">1g</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨ Kubernetes ä¸­é…ç½®</p><p>åœ¨ Pod çš„ spec ä¸­ï¼Œä½¿ç”¨ emptyDir é…ç½®å…±äº«å†…å­˜ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">example-deployment</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">example-app</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">example-app</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">example-container</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">your-image:latest</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">2Gi</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/dev/shm</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">dshm</span><br>      <span class="hljs-attr">volumes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">dshm</span><br>          <span class="hljs-attr">emptyDir:</span><br>            <span class="hljs-attr">medium:</span> <span class="hljs-string">Memory</span><br>            <span class="hljs-attr">sizeLimit:</span> <span class="hljs-string">1Gi</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="æ£€æŸ¥å…±äº«å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#æ£€æŸ¥å…±äº«å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æ£€æŸ¥å…±äº«å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>æ£€æŸ¥å…±äº«å†…å­˜ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipcs -m<br></code></pre></td></tr></table></figure><h3 id="æŒ‡å®šå¹³å°è·å–é•œåƒåŠæ„å»º"><a href="#æŒ‡å®šå¹³å°è·å–é•œåƒåŠæ„å»º" class="headerlink" title="æŒ‡å®šå¹³å°è·å–é•œåƒåŠæ„å»º"></a>æŒ‡å®šå¹³å°è·å–é•œåƒåŠæ„å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡è®©dockeré»˜è®¤è·å–x86_64æ¶æ„çš„é•œåƒ</span><br><span class="hljs-built_in">export</span> DOCKER_DEFAULT_PLATFORM=linux/amd64<br><br><span class="hljs-comment"># æŒ‡å®šæ„å»ºçš„æŒ‡ä»¤å¹³å°</span><br>docker buildx build --platform linux/amd64 -t your-image:latest .<br><br><span class="hljs-comment"># æ‹‰å–x86_64æ¶æ„çš„ubuntué•œåƒ</span><br>docker pull --platform=linux/amd64 ubuntu:22.04<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8s rbac &amp; Jenkins container</title>
    <link href="/2024/11/22/k8s-rbac-jenkins-container/"/>
    <url>/2024/11/22/k8s-rbac-jenkins-container/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubenetes-rbac-Jenkins-container"><a href="#Kubenetes-rbac-Jenkins-container" class="headerlink" title="Kubenetes rbac &amp; Jenkins container"></a>Kubenetes rbac &amp; Jenkins container</h1><h2 id="k8s-rbac-configure"><a href="#k8s-rbac-configure" class="headerlink" title="k8s rbac configure"></a>k8s rbac configure</h2><ul><li>apiversion: rbac.authorization.k8s.io&#x2F;v1</li><li>kind<ul><li>ClusterRoleBinding</li><li>ServiceAccount</li><li>ClusterRole</li></ul></li><li>token<ul><li>å®¹å™¨å†…ï¼š&#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;token</li></ul></li><li>éƒ¨ç½²pod specä¸­æ·»åŠ serviceAccountName: name</li></ul><h2 id="Jenkins-configure-docker-runtime"><a href="#Jenkins-configure-docker-runtime" class="headerlink" title="Jenkins configure docker runtime"></a>Jenkins configure docker runtime</h2><ul><li>å°†å®¿ä¸»æœºçš„docker.sockæŒ‚è½½åˆ°å®¹å™¨å†…<ul><li>è·¯å¾„ï¼š&#x2F;var&#x2F;run&#x2F;docker.sock</li></ul></li><li>ç¡®ä¿å®¹å™¨å†…æœ‰dockerå‘½ä»¤</li></ul><h2 id="Jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²å®Œæ•´æµç¨‹"><a href="#Jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²å®Œæ•´æµç¨‹" class="headerlink" title="Jenkins è‡ªåŠ¨åŒ–éƒ¨ç½²å®Œæ•´æµç¨‹"></a>Jenkins è‡ªåŠ¨åŒ–éƒ¨ç½²å®Œæ•´æµç¨‹</h2><p>å¦‚éœ€æ“ä½œk8sé›†ç¾¤ï¼Œéœ€è¦kubectlå‘½ä»¤</p><p>è‡ªåŠ¨åŒ–æµç¨‹ï¼š</p><ul><li>é…ç½®jenkinsæµæ°´çº¿ - webhook è§¦å‘ push event</li><li>git æ‹‰å–ä»£ç </li><li>docker build æ„å»ºé•œåƒ</li><li>docker push æ¨é€é•œåƒ</li><li>k8s éƒ¨ç½²åº”ç”¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># token æ˜¯ç”±rbacé…ç½®è·å–</span><br><span class="hljs-comment"># Jenkins ä¸­å¯é€šè¿‡æ„å»ºç¯å¢ƒä¸­çš„ use secret text or fileåŠŸèƒ½å°†tokenè¿›è¡Œéšè—</span><br>kubectl --server https://xxx --insecure-skip-tls-verify=<span class="hljs-literal">true</span> --token xxx -n <span class="hljs-variable">$namespace</span> <span class="hljs-built_in">set</span> image deploy/<span class="hljs-variable">$deploy_name</span> <span class="hljs-variable">$container_name</span>=<span class="hljs-variable">$image_name</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkins GitLab Webhook</title>
    <link href="/2024/11/21/Jekins-GitLab-Webhook/"/>
    <url>/2024/11/21/Jekins-GitLab-Webhook/</url>
    
    <content type="html"><![CDATA[<h1 id="Jenkins-GitLab-configure-webhook"><a href="#Jenkins-GitLab-configure-webhook" class="headerlink" title="Jenkins &amp; GitLab configure webhook"></a>Jenkins &amp; GitLab configure webhook</h1><p>GitLab version: community edition 10.4.2</p><p>Jenkins version: 2.426.3</p><h2 id="Install-GitLab-plugins"><a href="#Install-GitLab-plugins" class="headerlink" title="Install GitLab plugins"></a>Install GitLab plugins</h2><p>æ—§ç‰ˆæœ¬éœ€è¦æ’ä»¶gitlabå’Œgitlab-hookï¼Œä½†æ˜¯gitlab-hookæ’ä»¶ç”±äºå®‰å…¨é—®é¢˜å·²ç»åºŸå¼ƒã€‚</p><p>å…·ä½“è§ <a href="https://www.jenkins.io/blog/2021/12/22/deprecated-ruby-runtime/">https://www.jenkins.io/blog/2021/12/22/deprecated-ruby-runtime/</a></p><p>æ‰€ä»¥åªéœ€è¦ä¸‹è½½Gitlabæ’ä»¶åŠå…¶ç›¸å…³ä¾èµ–æ’ä»¶å³å¯ã€‚</p><p>Gitlab Plugin è¿™ä¸ªæ’ä»¶å…è®¸GitLabåœ¨æäº¤ä»£ç æˆ–æ‰“å¼€&#x2F;æ›´æ–°åˆå¹¶è¯·æ±‚æ—¶è§¦å‘Jenkinsä¸­çš„æ„å»ºã€‚å®ƒè¿˜å¯ä»¥å°†æ„å»ºçŠ¶æ€å‘é€å›GitLabã€‚</p><p><img src="/../images/jenkins-webhook/install_plugins.png" alt="å®‰è£…æ’ä»¶"></p><h2 id="Configure"><a href="#Configure" class="headerlink" title="Configure"></a>Configure</h2><h3 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h3><blockquote><p>å„ç‰ˆæœ¬ç•Œé¢å¯èƒ½ä¸åŒ</p></blockquote><ul><li>åˆ›å»ºGitLabå‡­è¯</li><li>é…ç½®Gitæ‹‰å–ä»£ç ç”¨åˆ°çš„å¯†é’¥å‡­è¯</li><li>ç”ŸæˆJenkins Token</li></ul><p><img src="/../images/jenkins-webhook/gitlab_credentials.png" alt="åˆ›å»ºGitLabå‡­è¯"></p><p>æ­¤å¤„APITokenåœ¨GitLabç”Ÿæˆï¼Œä»…ç”Ÿæˆæ—¶å¯çœ‹åˆ°ï¼ŒåŠ¡å¿…ä¿ç®¡å¥½ã€‚</p><p>æ„å»ºè§¦å‘å™¨é€‰æ‹© â€œBuild when a change is pushed to GitLabâ€ ï¼ˆè®°ä½åé¢çš„GitLab webhook URL åé¢è¦å¡«åœ¨gitlabçš„webhooksä¸­ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢å‹¾é€‰</p><p><img src="/../images/jenkins-webhook/jenkins_webhook.png" alt="é…ç½®Jenkins Webhook"></p><p>ç‚¹ â€œGenerateâ€ ç”Ÿæˆ tokenï¼Œè¿™ä¸ª token ç”¨äºå¡«å†™åˆ° gitlab çš„ webhook é‡Œï¼Œgitlab æ£€æµ‹åˆ°ä»£ç æäº¤ï¼Œä¼šé€šçŸ¥ webhook é‡Œå¡«å†™çš„ Jenkins ç”Ÿæˆçš„å›è°ƒURLã€‚</p><p>æ³¨: å¤åˆ¶å‡º URL å’Œ tokenï¼Œåé¢é…ç½® gitlab çš„ webhook ä¼šç”¨åˆ°</p><p><img src="/../images/jenkins-webhook/gen_token.png" alt="ç”Ÿæˆtoken"></p><h3 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h3><p>æ ¹æ®ç‰ˆæœ¬ä¸åŒï¼ŒwebhookåŠŸèƒ½åœ¨ä¸åŒä½ç½®ã€‚ </p><p>å½“å‰ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬åœ¨é¡¹ç›®ä¾§è¾¹æ ï¼š<code>Settings -&gt; Integrations</code>ä¸­ã€‚</p><p>å¡«å†™ URLå’Œ Secret Tokenå³å¯ï¼Œä¿å­˜åæµ‹è¯•æ˜¯å¦å¯ä»¥è§¦å‘ã€‚</p><p><img src="/../images/jenkins-webhook/gitlab_webhook.png" alt="é…ç½®gitlab webhook"></p><p><img src="/../images/jenkins-webhook/get_gitlab_token.png" alt="è·å–gitlab token"></p><blockquote><p>Secret Token æ¥è‡ªJenkinsä¸­ã€‚</p><p>æµ‹è¯•é»˜è®¤è§¦å‘masteråˆ†æ”¯ï¼Œå®é™…æ ¹æ®è‡ªå·±æ¨é€çš„åˆ†æ”¯è¿›è¡Œè§¦å‘ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastAPI Notes</title>
    <link href="/2024/11/20/fastapi-notes/"/>
    <url>/2024/11/20/fastapi-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="FastAPI-Notes"><a href="#FastAPI-Notes" class="headerlink" title="FastAPI Notes"></a>FastAPI Notes</h1><blockquote><p>FastAPI å…·æœ‰pythonçš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œæ¯”å¦‚ç±»å‹æç¤ºï¼Œå¼‚æ­¥æ”¯æŒï¼Œä»¥åŠè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€‚</p></blockquote><h2 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h2><ul><li>fastapi<ul><li>FastAPI</li><li>Path</li><li>Query</li><li>Body</li><li>Cookie</li></ul></li><li>pydantic<ul><li>BaseModel</li></ul></li><li>typing<ul><li>Annotated</li><li>Union</li><li>Optional</li><li>List</li><li>Set</li></ul></li><li>starlette<ul><li>RedirectResponse</li></ul></li></ul><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">project_name/<br>â”œâ”€â”€ app/<br>â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”œâ”€â”€ main.py          <span class="hljs-comment"># åº”ç”¨å…¥å£æ–‡ä»¶ï¼ŒåŒ…å« FastAPI å®ä¾‹å’Œè·¯ç”±åŠ è½½</span><br>â”‚   â”œâ”€â”€ config.py        <span class="hljs-comment"># é…ç½®æ–‡ä»¶ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰</span><br>â”‚   â”œâ”€â”€ routers/         <span class="hljs-comment"># è·¯ç”±æ¨¡å—</span><br>â”‚   â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”‚   â”œâ”€â”€ users.py     <span class="hljs-comment"># ç”¨æˆ·ç›¸å…³è·¯ç”±</span><br>â”‚   â”‚   â”œâ”€â”€ items.py     <span class="hljs-comment"># ç‰©å“ç›¸å…³è·¯ç”±</span><br>â”‚   â”œâ”€â”€ models/          <span class="hljs-comment"># æ•°æ®æ¨¡å‹</span><br>â”‚   â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”‚   â”œâ”€â”€ user.py      <span class="hljs-comment"># ç”¨æˆ·è¡¨æ¨¡å‹</span><br>â”‚   â”‚   â”œâ”€â”€ item.py      <span class="hljs-comment"># ç‰©å“è¡¨æ¨¡å‹</span><br>â”‚   â”œâ”€â”€ schemas/         <span class="hljs-comment"># Pydantic æ¨¡å¼ï¼Œç”¨äºæ•°æ®éªŒè¯</span><br>â”‚   â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”‚   â”œâ”€â”€ user.py      <span class="hljs-comment"># ç”¨æˆ·æ•°æ®æ¨¡å¼</span><br>â”‚   â”‚   â”œâ”€â”€ item.py      <span class="hljs-comment"># ç‰©å“æ•°æ®æ¨¡å¼</span><br>â”‚   â”œâ”€â”€ crud/            <span class="hljs-comment"># æ•°æ®åº“æ“ä½œå°è£…</span><br>â”‚   â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”‚   â”œâ”€â”€ user.py      <span class="hljs-comment"># ç”¨æˆ·ç›¸å…³æ•°æ®åº“æ“ä½œ</span><br>â”‚   â”‚   â”œâ”€â”€ item.py      <span class="hljs-comment"># ç‰©å“ç›¸å…³æ•°æ®åº“æ“ä½œ</span><br>â”‚   â”œâ”€â”€ db.py            <span class="hljs-comment"># æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†</span><br>â”‚   â”œâ”€â”€ dependencies.py  <span class="hljs-comment"># ä¾èµ–é¡¹ï¼ˆå¦‚æƒé™éªŒè¯ï¼‰</span><br>â”‚   â”œâ”€â”€ utils.py         <span class="hljs-comment"># é€šç”¨å·¥å…·å‡½æ•°</span><br>â”‚<br>â”œâ”€â”€ tests/               <span class="hljs-comment"># æµ‹è¯•æ–‡ä»¶å¤¹</span><br>â”‚   â”œâ”€â”€ __init__.py<br>â”‚   â”œâ”€â”€ test_users.py    <span class="hljs-comment"># ç”¨æˆ·ç›¸å…³æµ‹è¯•</span><br>â”‚   â”œâ”€â”€ test_items.py    <span class="hljs-comment"># ç‰©å“ç›¸å…³æµ‹è¯•</span><br>â”‚<br>â”œâ”€â”€ .<span class="hljs-built_in">env</span>                 <span class="hljs-comment"># ç¯å¢ƒå˜é‡é…ç½®</span><br>â”œâ”€â”€ requirements.txt     <span class="hljs-comment"># Python ä¾èµ–åŒ…åˆ—è¡¨</span><br>â”œâ”€â”€ Dockerfile           <span class="hljs-comment"># Docker é•œåƒé…ç½®ï¼ˆå¯é€‰ï¼‰</span><br>â”œâ”€â”€ README.md            <span class="hljs-comment"># é¡¹ç›®è¯´æ˜æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h2 id="ç®€å•ä¾‹å­"><a href="#ç®€å•ä¾‹å­" class="headerlink" title="ç®€å•ä¾‹å­"></a>ç®€å•ä¾‹å­</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h2><p>uvicorn main:app å‘½ä»¤å«ä¹‰å¦‚ä¸‹:</p><p>mainï¼šmain.py æ–‡ä»¶ï¼ˆä¸€ä¸ª Pythonã€Œæ¨¡å—ã€ï¼‰ã€‚<br>appï¼šåœ¨ main.py æ–‡ä»¶ä¸­é€šè¿‡ app &#x3D; FastAPI() åˆ›å»ºçš„å¯¹è±¡ã€‚<br>â€“reloadï¼šè®©æœåŠ¡å™¨åœ¨æ›´æ–°ä»£ç åé‡æ–°å¯åŠ¨ã€‚ä»…åœ¨å¼€å‘æ—¶ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">uvicorn main:app --reload<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ–‡æ¡£"><a href="#æŸ¥çœ‹æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹æ–‡æ¡£"></a>æŸ¥çœ‹æ–‡æ¡£</h2><ul><li><a href="http://127.0.0.1:8000/docs">http://127.0.0.1:8000/docs</a></li><li><a href="http://127.0.0.1:8000/redoc">http://127.0.0.1:8000/redoc</a></li></ul><h3 id="æŸ¥çœ‹æ–‡æ¡£æ˜¾ç¤ºç©ºç™½é—®é¢˜"><a href="#æŸ¥çœ‹æ–‡æ¡£æ˜¾ç¤ºç©ºç™½é—®é¢˜" class="headerlink" title="æŸ¥çœ‹æ–‡æ¡£æ˜¾ç¤ºç©ºç™½é—®é¢˜"></a>æŸ¥çœ‹æ–‡æ¡£æ˜¾ç¤ºç©ºç™½é—®é¢˜</h3><p>å› ä¸ºfastapiçš„openapiåŒ…é‡Œçš„docs.pyæ–‡ä»¶æ¥å£æ–‡æ¡£é»˜è®¤ä½¿ç”¨</p><p><a href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui.css">https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui.css</a></p><p><a href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui-bundle.js">https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui-bundle.js</a></p><p>å›½å¤–åœ°å€è®¿é—®è¾ƒæ…¢ï¼Œå¦‚æœæ˜¯çº¯å†…ç½‘ç¯å¢ƒä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ›¿æ¢fastapiä¸‹openapiåŒ…å†…çš„docs.pyæ–‡ä»¶çš„jså’Œcsså‚æ•°çš„å€¼</span><br><span class="hljs-comment"># å°†urlæ›¿æ¢ä¸ºæœ¬åœ°jså’Œcssæ–‡ä»¶</span><br><span class="hljs-comment"># Lib/site-packages/fastapi/openapi/docs.py</span><br><span class="hljs-comment"># ä¿®æ”¹å…¶ä¸­get_swagger_ui_html å‡½æ•°</span><br><span class="hljs-comment"># redocåˆ™ä¿®æ”¹get_redoc_htmlå‡½æ•°</span><br>swagger_js_url: <span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;/static/swagger-ui/swagger-ui-bundle.js&quot;</span>,<br>swagger_css_url: <span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;/static/swagger-ui/swagger-ui.css&quot;</span>,<br>swagger_favicon_url: <span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;/static/swagger-ui/favicon.png&quot;</span>,<br><br>redoc_js_url: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;/static/redoc/bundles/redoc.standalone.js&quot;</span>,<br>redoc_favicon_url: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;/static/redoc/favicon.png&quot;</span><br><br><span class="hljs-comment"># ä¿®æ”¹å®Œï¼Œç„¶åæŒ‚è½½ï¼Œ directory å¡«æœ¬åœ°è·¯å¾„</span><br>app.mount(<span class="hljs-string">&#x27;/static&#x27;</span>, StaticFiles(directory=<span class="hljs-string">&#x27;static&#x27;</span>),<br>          name=<span class="hljs-string">&#x27;static&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="FastAPI-å‚æ•°"><a href="#FastAPI-å‚æ•°" class="headerlink" title="FastAPI å‚æ•°"></a>FastAPI å‚æ•°</h2><blockquote><p>FastAPI æ˜¯ç›´æ¥ä» Starlette ç»§æ‰¿çš„ç±»ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ FastAPI ä½¿ç”¨æ‰€æœ‰çš„ Starlette çš„åŠŸèƒ½ã€‚</p></blockquote><ul><li><p><strong>è·¯å¾„</strong></p><p>è¿™é‡Œçš„ã€Œè·¯å¾„ã€æŒ‡çš„æ˜¯ URL ä¸­ä»ç¬¬ä¸€ä¸ª &#x2F; èµ·çš„ååŠéƒ¨åˆ†ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªè¿™æ ·çš„ URL ä¸­ï¼š</p><p><code>https://example.com/items/foo</code></p><p>â€¦è·¯å¾„ä¼šæ˜¯ï¼š</p><p>&#x2F;items&#x2F;foo</p></li><li><p><strong>æ“ä½œ</strong></p><p>åœ¨å¼€å‘ API æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ç‰¹å®šçš„ HTTP æ–¹æ³•å»æ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºã€‚</p><p>é€šå¸¸ä½¿ç”¨ï¼š</p><p>POSTï¼šåˆ›å»ºæ•°æ®ã€‚</p><p>GETï¼šè¯»å–æ•°æ®ã€‚</p><p>PUTï¼šæ›´æ–°æ•°æ®ã€‚</p><p>DELETEï¼šåˆ é™¤æ•°æ®ã€‚</p></li></ul><p><strong>è·¯å¾„æ“ä½œ</strong>æ˜¯æŒ‰é¡ºåºä¾æ¬¡è¿è¡Œçš„</p><p>ä¸‹é¢ä¾‹å­å…ˆè¿è¡Œ<code>/users/me</code>ï¼Œå¦‚æœä½ç½®äº’æ¢ï¼Œä¼šå…ˆè¿è¡Œ<code>/users/&#123;user_id&#125;</code>ï¼Œå¯¼è‡´<code>/users/me</code>å¤±æ•ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/me&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user_me</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-string">&quot;the current user&quot;</span>&#125;<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: user_id&#125;<br></code></pre></td></tr></table></figure><p><strong>åŒ…å«è·¯å¾„çš„è·¯å¾„å‚æ•°</strong></p><p>å‡è®¾<strong>è·¯å¾„æ“ä½œ</strong>çš„è·¯å¾„ä¸º <code>/files/&#123;file_path&#125;</code>ã€‚</p><p>ä½†éœ€è¦ file_path ä¸­ä¹ŸåŒ…å«<strong>è·¯å¾„</strong>ï¼Œæ¯”å¦‚ï¼Œ<code>home/johndoe/myfile.txt</code>ã€‚</p><p>æ­¤æ—¶ï¼Œè¯¥æ–‡ä»¶çš„ URL æ˜¯è¿™æ ·çš„ï¼š<code>/files/home/johndoe/myfile.txt</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_path&quot;</span>: file_path&#125;<br></code></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢å‚æ•°</strong></p><p>å£°æ˜çš„å‚æ•°ä¸æ˜¯è·¯å¾„å‚æ•°æ—¶ï¼Œè·¯å¾„æ“ä½œå‡½æ•°ä¼šæŠŠè¯¥å‚æ•°è‡ªåŠ¨è§£é‡Šä¸º<strong>æŸ¥è¯¢</strong>å‚æ•°ã€‚</p><p>æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œè¿™äº›é”®å€¼å¯¹ä½äº URL çš„ ? ä¹‹åï¼Œä»¥ &amp; åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ URL ä¸­ï¼š<br><code>http://127.0.0.1:8000/items/?skip=0&amp;limit=10</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br>fake_items_db = [&#123;<span class="hljs-string">&quot;item_name&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_name&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_name&quot;</span>: <span class="hljs-string">&quot;Baz&quot;</span>&#125;]<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">skip: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-keyword">return</span> fake_items_db[skip : skip + limit]<br></code></pre></td></tr></table></figure><p><strong>å¯é€‰å‚æ•°</strong></p><p>æŠŠé»˜è®¤å€¼è®¾ä¸º None å³å¯å£°æ˜<strong>å¯é€‰çš„</strong>æŸ¥è¯¢å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-comment">## str | None è¡¨ç¤º q å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ None</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">str</span>, q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> q:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br></code></pre></td></tr></table></figure><blockquote><p>FastAPI å¯ä»¥è¯†åˆ«å‡º item_id æ˜¯è·¯å¾„å‚æ•°ï¼Œq ä¸æ˜¯è·¯å¾„å‚æ•°ï¼Œè€Œæ˜¯æŸ¥è¯¢å‚æ•°ã€‚</p><p>å¦‚æœè¦æŠŠæŸ¥è¯¢å‚æ•°è®¾ç½®ä¸º<strong>å¿…é€‰</strong>ï¼Œå°±ä¸è¦å£°æ˜é»˜è®¤å€¼.</p><p>å¦‚æœåªæƒ³æŠŠå‚æ•°è®¾ä¸º<strong>å¯é€‰</strong>ï¼Œä½†åˆä¸æƒ³æŒ‡å®šå‚æ•°çš„å€¼ï¼Œåˆ™è¦æŠŠé»˜è®¤å€¼è®¾ä¸º None</p></blockquote><p><strong>è¯·æ±‚ä½“</strong></p><p><strong>è·¯å¾„</strong>ä¸­å£°æ˜äº†ç›¸åŒå‚æ•°çš„å‚æ•°ï¼Œæ˜¯è·¯å¾„å‚æ•°<br>ç±»å‹æ˜¯ï¼ˆintã€floatã€strã€bool ç­‰ï¼‰<strong>å•ç±»å‹</strong>çš„å‚æ•°ï¼Œæ˜¯<strong>æŸ¥è¯¢</strong>å‚æ•°<br>ç±»å‹æ˜¯ Pydantic æ¨¡å‹çš„å‚æ•°ï¼Œæ˜¯è¯·æ±‚ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><span class="hljs-comment">## å¯¼å…¥ Pydantic çš„ BaseModel</span><br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br><span class="hljs-comment"># åˆ›å»ºæ•°æ®æ¨¡å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-comment"># å£°æ˜è¯·æ±‚ä½“å‚æ•° item: Item</span><br><span class="hljs-comment"># è·¯å¾„å‚æ•° + è¯·æ±‚ä½“ + æŸ¥è¯¢å‚æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Item, q: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>):<br>    result = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, **item.<span class="hljs-built_in">dict</span>()&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        result.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²æ ¡éªŒ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><span class="hljs-comment"># å¯¼å…¥Query</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-comment"># ä½¿ç”¨Queryä½œä¸ºé»˜è®¤å€¼</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    <span class="hljs-comment"># æ·»åŠ æœ€å°é•¿åº¦ã€æœ€å¤§é•¿åº¦ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰æ ¡éªŒ</span></span><br><span class="hljs-params">    <span class="hljs-comment"># Optional[str] ç­‰ä»·äº Union[str, None]ï¼Œä½†æ›´å…·å¯è¯»æ€§</span></span><br><span class="hljs-params">    q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=<span class="hljs-literal">None</span>, min_length=<span class="hljs-number">3</span>, max_length=<span class="hljs-number">50</span>, pattern=<span class="hljs-string">&quot;^fixedquery$&quot;</span></span>)</span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><blockquote><p>å½“ä½ åœ¨ä½¿ç”¨ Query ä¸”éœ€è¦å£°æ˜ä¸€ä¸ªå€¼æ˜¯å¿…éœ€çš„æ—¶ï¼Œåªéœ€ä¸å£°æ˜é»˜è®¤å‚æ•°å³å¯ã€‚</p><p>ä¹Ÿå¯ä½¿ç”¨çœç•¥å·<code>...</code>å£°æ˜å¿…é¡»å‚æ•°ï¼Œå¦‚ <code>read_items(q: str = Query(default=..., min_length=3)):</code></p></blockquote><p><strong>ä½¿ç”¨Noneç±»å‹æ—¶å£°æ˜å¿…é¡»å‚æ•°</strong></p><p>å£°æ˜ä¸€ä¸ªå‚æ•°å¯ä»¥æ¥æ”¶<code>None</code>ï¼Œä½†ä»ç„¶æ˜¯å¿…éœ€çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å£°æ˜ Noneæ˜¯æœ‰æ•ˆç±»å‹ï¼Œä½¿ç”¨ ...</span><br><span class="hljs-comment"># æˆ–ä½¿ç”¨Pydanticä¸­çš„Requiredä»£æ›¿çœç•¥å·(...)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=..., min_length=<span class="hljs-number">3</span></span>)</span>):<br></code></pre></td></tr></table></figure><blockquote><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“ä½ éœ€è¦æŸäº›ä¸œè¥¿æ—¶ï¼Œå¯ä»¥ç®€å•åœ°çœç•¥ default å‚æ•°ï¼Œå› æ­¤ä½ é€šå¸¸ä¸å¿…ä½¿ç”¨ â€¦ æˆ– Required</p></blockquote><p><strong>æŸ¥è¯¢å‚æ•°åˆ—è¡¨ &#x2F; å¤šä¸ªå€¼</strong></p><blockquote><p>è¦å£°æ˜ç±»å‹ä¸º list çš„æŸ¥è¯¢å‚æ•°ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä½ éœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ Queryï¼Œå¦åˆ™è¯¥å‚æ•°å°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query<br><br>app = FastAPI()<br><br><span class="hljs-comment">## http://localhost:8000/items/?q=foo&amp;q=bar</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-comment"># List[str] ä¼šæ£€æŸ¥åˆ—è¡¨å†…å®¹å¿…é¡»ä¸ºå­—ç¬¦ä¸²</span><br><span class="hljs-comment"># ä½¿ç”¨liståˆ™ä¸ä¼šæ£€æŸ¥</span><br><span class="hljs-comment"># async def read_items(q: list = Query(default=[])):</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: <span class="hljs-type">Union</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], <span class="hljs-literal">None</span>] = Query(<span class="hljs-params">default=<span class="hljs-literal">None</span></span>)</span>):<br><span class="hljs-comment"># æœ‰å¤šä¸ªå€¼çš„é»˜è®¤å€¼ </span><br><span class="hljs-comment"># async def read_items(q: List[str] = Query(default=[&quot;foo&quot;, &quot;bar&quot;])):</span><br>    query_items = &#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;<br>    <span class="hljs-keyword">return</span> query_items<br></code></pre></td></tr></table></figure><p><strong>å£°æ˜æ›´å¤šå…ƒæ•°æ®</strong></p><p>ä½ å¯ä»¥æ·»åŠ æ›´å¤šæœ‰å…³è¯¥å‚æ•°çš„ä¿¡æ¯ã€‚</p><p>è¿™äº›ä¿¡æ¯å°†åŒ…å«åœ¨ç”Ÿæˆçš„ OpenAPI æ¨¡å¼ä¸­ï¼Œå¹¶ç”±æ–‡æ¡£ç”¨æˆ·ç•Œé¢å’Œå¤–éƒ¨å·¥å…·æ‰€ä½¿ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query<br><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    q: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Query(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-params">        default=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        title=<span class="hljs-string">&quot;Query string&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        description=<span class="hljs-string">&quot;Query string for the items to search in the database that have a good match&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">        min_length=<span class="hljs-number">3</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">    </span>),</span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;items&quot;</span>: [&#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item_id&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><p><strong>è·¯å¾„å‚æ•°å’Œæ•°å€¼æ ¡éªŒ</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path, Query<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params"></span><br><span class="hljs-params">    *,</span><br><span class="hljs-params">    item_id: Annotated[<span class="hljs-built_in">int</span>, Path(<span class="hljs-params">title=<span class="hljs-string">&quot;The ID of the item to get&quot;</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">1000</span></span>)],</span><br><span class="hljs-params">    q: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Query(<span class="hljs-params">alias=<span class="hljs-string">&quot;item-query&quot;</span></span>)] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    size: <span class="hljs-built_in">float</span> = Query(<span class="hljs-params">gt=<span class="hljs-number">0</span>, lt=<span class="hljs-number">10.5</span></span>),</span><br><span class="hljs-params">    </span><br><span class="hljs-params"></span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id&#125;<br>    <span class="hljs-keyword">if</span> q:<br>        results.update(&#123;<span class="hljs-string">&quot;q&quot;</span>: q&#125;)<br>    <span class="hljs-keyword">if</span> size:<br>        results.update(&#123;<span class="hljs-string">&quot;size&quot;</span>: size&#125;)<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><p><strong>è¯·æ±‚ä½“å†…å£°æ˜æ ¡éªŒå’Œå…ƒæ•°æ®</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated, <span class="hljs-type">List</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Body, FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field, HttpUrl<br><br>app = FastAPI()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>  <span class="hljs-comment"># å°†è¢«æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ URL</span><br>    url: HttpUrl<br>    name: <span class="hljs-built_in">str</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = Field(<br>        default=<span class="hljs-literal">None</span>, title=<span class="hljs-string">&quot;The description of the item&quot;</span>, max_length=<span class="hljs-number">300</span><br>    )<br>    price: <span class="hljs-built_in">float</span> = Field(gt=<span class="hljs-number">0</span>, description=<span class="hljs-string">&quot;The price must be greater than zero&quot;</span>)<br>    tax: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span><br>    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = []<br>    Image: Image | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>  <br>    <span class="hljs-comment"># images: list[Image] | None = None</span><br>    <span class="hljs-comment"># tags: set[str] = set()</span><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, item: Annotated[Item, Body(<span class="hljs-params">embed=<span class="hljs-literal">True</span></span>)]</span>):<br>    results = &#123;<span class="hljs-string">&quot;item_id&quot;</span>: item_id, <span class="hljs-string">&quot;item&quot;</span>: item&#125;<br>    <span class="hljs-keyword">return</span> results<br><br></code></pre></td></tr></table></figure><h2 id="Cookie-Header"><a href="#Cookie-Header" class="headerlink" title="Cookie, Header"></a>Cookie, Header</h2><p>Header æ¯” Pathã€Query å’Œ Cookie æä¾›äº†æ›´å¤šåŠŸèƒ½</p><p>å¤§éƒ¨åˆ†æ ‡å‡†è¯·æ±‚å¤´ç”¨<strong>è¿å­—ç¬¦</strong>åˆ†éš”ï¼Œå³<strong>å‡å·</strong>ï¼ˆ-ï¼‰ã€‚</p><p>ä½†æ˜¯ user-agent è¿™æ ·çš„å˜é‡åœ¨ Python ä¸­æ˜¯æ— æ•ˆçš„ã€‚</p><p>å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒHeader æŠŠå‚æ•°åä¸­çš„å­—ç¬¦ç”±ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æ”¹ä¸ºè¿å­—ç¬¦ï¼ˆ-ï¼‰æ¥æå–å¹¶å­˜æ¡£è¯·æ±‚å¤´ ã€‚</p><p>åŒæ—¶ï¼ŒHTTP çš„è¯·æ±‚å¤´ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥ä½¿ç”¨ Python æ ‡å‡†æ ·å¼ï¼ˆå³ snake_caseï¼‰è¿›è¡Œå£°æ˜</p><p>å¦‚éœ€ç¦ç”¨ä¸‹åˆ’çº¿è‡ªåŠ¨è½¬æ¢ä¸ºè¿å­—ç¬¦ï¼Œå¯ä»¥æŠŠ Header çš„ convert_underscores å‚æ•°è®¾ç½®ä¸º False</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Cookie, FastAPI, Header<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">ads_id: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Cookie(<span class="hljs-params"></span>)] = <span class="hljs-literal">None</span>, user_agent: Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, Header(<span class="hljs-params"></span>)] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;ads_id&quot;</span>: ads_id, <span class="hljs-string">&quot;user_agent&quot;</span>: user_agent&#125;<br></code></pre></td></tr></table></figure><h2 id="å“åº”æ¨¡å‹"><a href="#å“åº”æ¨¡å‹" class="headerlink" title="å“åº”æ¨¡å‹"></a>å“åº”æ¨¡å‹</h2><ul><li>response_model<ul><li>å®šä¹‰å“åº”æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯ç¡®ä¿ç§æœ‰æ•°æ®è¢«è¿‡æ»¤æ‰</li></ul></li><li>response_model_exclude_unset<ul><li>å“åº”ä¸­ä¸ä¼šåŒ…å«é»˜è®¤å€¼ï¼Œè€Œæ˜¯ä»…æœ‰å®é™…è®¾ç½®çš„å€¼ï¼Œå³ä»…è¿”å›æ˜¾å¼è®¾å®šçš„å€¼</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle Notes</title>
    <link href="/2024/11/20/oracle-notes/"/>
    <url>/2024/11/20/oracle-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="oracle"><a href="#oracle" class="headerlink" title="oracle"></a>oracle</h1><h2 id="ç™»å½•oracle"><a href="#ç™»å½•oracle" class="headerlink" title="ç™»å½•oracle"></a>ç™»å½•oracle</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - oracle<br>sqlplus / as sysdba<br><br>sqlplus username/password@ip/instance_name<br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹oracleå¯†ç ç­–ç•¥"><a href="#ä¿®æ”¹oracleå¯†ç ç­–ç•¥" class="headerlink" title="ä¿®æ”¹oracleå¯†ç ç­–ç•¥"></a>ä¿®æ”¹oracleå¯†ç ç­–ç•¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"># æŸ¥çœ‹æ‰€æœ‰çš„PDB<br><span class="hljs-keyword">show</span> pdbs;<br># åˆ‡æ¢åˆ°æŒ‡å®šPDB<br><span class="hljs-keyword">alter</span> session <span class="hljs-keyword">set</span> contaniner<span class="hljs-operator">=</span>PDB_NAME;<br># å†æ¬¡æŸ¥çœ‹pdbï¼Œå¯ä»¥çœ‹åˆ°å·²ç»åˆ‡æ¢åˆ°æŒ‡å®šPDB<br><br># ä¿®æ”¹å¯†ç ç­–ç•¥<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit FAILED_LOGIN_ATTEMPTS UNLIMITED;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_LIFE_TIME UNLIMITED;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_LOCK_TIME UNLIMITED;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_REUSE_TIME UNLIMITED;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_REUSE_MAX UNLIMITED;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_VERIFY_FUNCTION <span class="hljs-keyword">NULL</span>;<br><span class="hljs-keyword">alter</span> profile <span class="hljs-keyword">default</span> limit PASSWORD_GRACE_TIME UNLIMITED;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python Notes</title>
    <link href="/2024/11/20/python-notes/"/>
    <url>/2024/11/20/python-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="Python-Notes"><a href="#Python-Notes" class="headerlink" title="Python Notes"></a>Python Notes</h1><h2 id="isinstanceå‡½æ•°"><a href="#isinstanceå‡½æ•°" class="headerlink" title="isinstanceå‡½æ•°"></a>isinstanceå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ¤æ–­ç±»å‹</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(url, <span class="hljs-built_in">str</span>):<br>  <span class="hljs-comment"># å­—ç¬¦ä¸²è½¬åˆ—è¡¨ä¼šæŠŠå­—ç¬¦ä¸²æ‰“æ•£æˆå­—æ¯åˆ—è¡¨å­˜æ”¾</span><br>  <span class="hljs-comment"># å¯ä»¥å¦‚ä¸‹æ–¹æ³•è½¬æˆåˆ—è¡¨å­˜æ”¾</span><br>  url = [url]<br>  <span class="hljs-comment"># å¦‚æœä¸ä¼ é€’ä»»ä½•åˆ†éš”ç¬¦ç»™split()æ–¹æ³•ï¼Œä¸”å­—ç¬¦ä¸²ä¸­æ²¡æœ‰ç©ºæ ¼ï¼ˆé»˜è®¤åˆ†éš”ç¬¦ï¼‰æˆ–å…¶ä»–ç©ºç™½å­—ç¬¦</span><br>  <span class="hljs-comment"># å­—ç¬¦ä¸²å°†ä¸ä¼šè¢«æ‹†åˆ†ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“æ”¾å…¥åˆ—è¡¨ä¸­ã€‚</span><br>  url = url.split()<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(urls, <span class="hljs-built_in">list</span>):<br>  <span class="hljs-comment"># appendæ˜¯åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œä¼šå˜æˆåˆ—è¡¨åµŒå¥—</span><br>  <span class="hljs-comment"># extend åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œä¼šå°†åˆ—è¡¨åˆå¹¶æˆä¸€ä¸ªåˆ—è¡¨</span><br>  res.extend(urls)<br><br><span class="hljs-comment"># åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»æˆ–å­ç±»çš„å®ä¾‹</span><br><span class="hljs-comment"># å‡è®¾ erroræ˜¯ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ requests.exceptions.MissingSchema</span><br><span class="hljs-built_in">isinstance</span>(error, requests.exceptions.MissingSchema)<br><span class="hljs-comment"># è¿™é‡ŒExceptionä¹Ÿå¯ä»¥åˆ¤æ–­ï¼ŒExceptionæ˜¯æ‰€æœ‰å¼‚å¸¸ç±»çš„åŸºç±»</span><br><span class="hljs-built_in">isinstance</span>(error, Exception)<br></code></pre></td></tr></table></figure><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><p>pythonä¸­å­—å…¸è·Ÿjsonå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å­—å…¸ç±»å‹æ˜¯å­—å…¸ï¼Œjsonæ˜¯å­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">data = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;nobody&quot;</span>&#125; <span class="hljs-comment"># æ­¤æ—¶æ˜¯å­—å…¸ç±»å‹</span><br>data = json.dumps(data) <span class="hljs-comment"># è½¬æ¢åï¼Œdataå°±æ˜¯å­—ç¬¦ä¸²ç±»å‹</span><br></code></pre></td></tr></table></figure><h2 id="None-å’Œ-â€˜â€™"><a href="#None-å’Œ-â€˜â€™" class="headerlink" title="None å’Œ â€˜â€™"></a>None å’Œ â€˜â€™</h2><p>Noneå¹¶ä¸å®Œå…¨ç­‰äºâ€™â€™<br>None è¡¨ç¤ºç©ºå€¼æˆ–ç¼ºå¤±å€¼ï¼Œè€Œ â€˜â€™ è¡¨ç¤ºç©ºå­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç©ºå­—ç¬¦ä¸²æ˜¯False</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-string">&#x27;&#x27;</span>:<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç©ºå­—ç¬¦ä¸²&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="Flaskè®°å½•æ—¥å¿—"><a href="#Flaskè®°å½•æ—¥å¿—" class="headerlink" title="Flaskè®°å½•æ—¥å¿—"></a>Flaskè®°å½•æ—¥å¿—</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br>app = Flask(__name__)<br>app.logger.setLevel(logging.DEBUG)<br><span class="hljs-comment"># StreamHandlerï¼Œå®ƒä¼šå°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚å¯ä»¥é€šè¿‡addHandleræ–¹æ³•å°†è¿™ä¸ªå¤„ç†ç¨‹åºæ·»åŠ åˆ° Flask åº”ç”¨çš„æ—¥å¿—è®°å½•å™¨ä¸­ã€‚</span><br>console_handler = logging.StreamHandler()<br>app.logger.addHandler(console_handler)<br><br><span class="hljs-comment"># å°†æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨FileHandler</span><br>file_handler = logging.FileHandler(<span class="hljs-string">&#x27;app.log&#x27;</span>)<br><span class="hljs-comment"># INFOçº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—ä¼šè¢«è®°å½•åˆ°æ–‡ä»¶ä¸­</span><br>file_handler.setLevel(logging.INFO)<br>app.logger.addHandler(file_handler)<br><br><span class="hljs-comment"># RotatingFileHandlerä¼šå°†æ—¥å¿—è®°å½•åˆ°app.logæ–‡ä»¶ä¸­ï¼Œå½“æ–‡ä»¶å¤§å°è¾¾åˆ°1MBï¼ˆmaxBytes=1024*1024ï¼‰æ—¶ï¼Œä¼šè‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶ï¼Œæœ€å¤šä¿ç•™3ä¸ªå¤‡ä»½æ–‡ä»¶ï¼ˆbackupCount=3ï¼‰ï¼Œå¹¶ä¸”ä¼šè®°å½•DEBUGçº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—ã€‚</span><br><span class="hljs-keyword">from</span> logging.handlers <span class="hljs-keyword">import</span> RotatingFileHandler<br>rotating_handler = RotatingFileHandler(<span class="hljs-string">&#x27;app.log&#x27;</span>, maxBytes=<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>, backupCount=<span class="hljs-number">3</span>)<br><span class="hljs-comment"># å¯ä»¥ç»™æ¯ä¸ªhandlerå•ç‹¬è®¾ç½®æ—¥å¿—ç­‰çº§</span><br>rotating_handler.setLevel(logging.DEBUG)<br>app.logger.addHandler(rotating_handler)<br><br>formatter = Formatter(<span class="hljs-string">&quot; %(asctime)s threadId-%(thread)d %(levelname)s %(module)s %(funcName)s %(message)s&quot;</span>)<br>rotating_handler.setFormatter(formatter)<br><br><span class="hljs-comment"># é…ç½®TimedRotatingFileHandlerä¿ç•™ç­–ç•¥</span><br>time_handler = TimedRotatingFileHandler(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;LogPath&#125;</span>/main.log&#x27;</span>,<br>                                            when=<span class="hljs-string">&quot;midnight&quot;</span>,<br>                                            interval=<span class="hljs-number">1</span>,<br>                                            backupCount=<span class="hljs-number">20</span>,<br>                                            encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>time_handler.setFormatter(formatter)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    app.logger.debug(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡è°ƒè¯•ä¿¡æ¯&quot;</span>)<br>    app.logger.info(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡æ™®é€šä¿¡æ¯&quot;</span>)<br>    app.logger.warning(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡è­¦å‘Šä¿¡æ¯&quot;</span>)<br>    app.logger.error(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡é”™è¯¯ä¿¡æ¯&quot;</span>)<br>    app.logger.critical(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡ä¸¥é‡é”™è¯¯ä¿¡æ¯&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ—¥å¿—è®°å½•ç¤ºä¾‹&quot;</span><br></code></pre></td></tr></table></figure><h2 id="è¯»å–sqlæ–‡ä»¶å†…å®¹ï¼Œå¹¶ç”¨pymysqlæ‰§è¡Œ"><a href="#è¯»å–sqlæ–‡ä»¶å†…å®¹ï¼Œå¹¶ç”¨pymysqlæ‰§è¡Œ" class="headerlink" title="è¯»å–sqlæ–‡ä»¶å†…å®¹ï¼Œå¹¶ç”¨pymysqlæ‰§è¡Œ"></a>è¯»å–sqlæ–‡ä»¶å†…å®¹ï¼Œå¹¶ç”¨pymysqlæ‰§è¡Œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‡è®¾è¯»å–äº†ä¸€æ®µ sql</span><br>sql_text: <span class="hljs-built_in">str</span> = sql_text<br><span class="hljs-comment"># å¯¹ sqlå†…å®¹è¿›è¡Œå¤„ç†ï¼Œå˜ä¸º pymysqlå¯ä»¥æ‰§è¡Œçš„å½¢å¼</span><br>sqls: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] = sql.replace(<span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).split(<span class="hljs-string">&#x27;;&#x27;</span>)<br><span class="hljs-comment"># è¿æ¥æ•°æ®åº“</span><br>conn = pymysql.connect(host=<span class="hljs-string">&#x27;localhost&#x27;</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, password=<span class="hljs-string">&#x27;password&#x27;</span>, database=<span class="hljs-string">&#x27;mydatabase&#x27;</span>)<br>cursor = conn.cursor()<br><span class="hljs-keyword">for</span> sql <span class="hljs-keyword">in</span> sqls:<br>  cursor.execute(sql)<br>conn.commit()<br>cursor.close()<br>conn.close()<br></code></pre></td></tr></table></figure><h2 id="evalæ„é€ ä»£ç æ‰§è¡Œ"><a href="#evalæ„é€ ä»£ç æ‰§è¡Œ" class="headerlink" title="evalæ„é€ ä»£ç æ‰§è¡Œ"></a>evalæ„é€ ä»£ç æ‰§è¡Œ</h2><blockquote><p>éœ€è¦é˜²æ­¢æ³¨å…¥</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># DB_Info å¯¹è±¡</span><br>sql_str= <span class="hljs-string">f&quot;DB_Info.query.filter_by(**keys)&quot;</span><br><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> keys_list:<br>  sql_str += <span class="hljs-string">f&quot;.filter(DB_Info.<span class="hljs-subst">&#123;v&#125;</span>.in_(data[&#x27;<span class="hljs-subst">&#123;v&#125;</span>&#x27;]))&quot;</span><br><br>payload = <span class="hljs-string">f&quot;eval(<span class="hljs-subst">&#123;sql_str&#125;</span>)&quot;</span><br>db_info = <span class="hljs-built_in">eval</span>(sql_str)<br></code></pre></td></tr></table></figure><h2 id="sqlalchemy-or"><a href="#sqlalchemy-or" class="headerlink" title="sqlalchemy or_"></a>sqlalchemy or_</h2><p>åœ¨ SQLAlchemy ä¸­ï¼Œor_ å‡½æ•°ç”¨äºåˆ›å»º OR æ¡ä»¶ã€‚å®ƒå…è®¸ä½ åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å¤šä¸ªæ¡ä»¶ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªæ¡ä»¶æ»¡è¶³éƒ½ä¼šè¿”å›ç»“æœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> or_<br><br>Obj.query.<span class="hljs-built_in">filter</span>(or_<br>                 (<br>                 or_(Obj.name == <span class="hljs-string">&#x27;name&#x27;</span>, Obj.name == <span class="hljs-literal">None</span>),<br>                 or_(Obj.age == <span class="hljs-number">18</span>, Obj.age == <span class="hljs-number">19</span>)<br>                 )<br>                 ).<span class="hljs-built_in">all</span>()<br></code></pre></td></tr></table></figure><h2 id="flask-sqlalchemy"><a href="#flask-sqlalchemy" class="headerlink" title="flask_sqlalchemy"></a>flask_sqlalchemy</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># filter_by å¯ä»¥æ¥å— mapping ç±»å‹çš„å‚æ•°</span><br>Obj.query.filter_by(name=<span class="hljs-string">&#x27;name&#x27;</span>, age=<span class="hljs-number">18</span>).<span class="hljs-built_in">all</span>()<br><span class="hljs-comment"># data ä¸ºå­—å…¸ç±»å‹</span><br>Obj.query.filter_by(**data).<span class="hljs-built_in">all</span>()<br></code></pre></td></tr></table></figure><h2 id="ç±»å‹æ³¨è§£"><a href="#ç±»å‹æ³¨è§£" class="headerlink" title="ç±»å‹æ³¨è§£"></a>ç±»å‹æ³¨è§£</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-comment">## è¡¨ç¤º listé‡Œçš„å€¼åŒ…å« strå’Œ intä¸¤ç§ç±»å‹</span><br>test: <span class="hljs-built_in">list</span>[<span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]] = []<br></code></pre></td></tr></table></figure><h2 id="Flask-content-type"><a href="#Flask-content-type" class="headerlink" title="Flask content-type"></a>Flask content-type</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯ä»¥ç”¨æ¥åˆ¤æ–­è¯·æ±‚çš„ content-type</span><br>request.headers.get(<span class="hljs-string">&#x27;Content-Type&#x27;</span>) == <span class="hljs-string">&quot;application/json&quot;</span>  <br>request.content_type == <span class="hljs-string">&quot;application/json&quot;</span><br></code></pre></td></tr></table></figure><h2 id="functools-wraps"><a href="#functools-wraps" class="headerlink" title="functools.wraps"></a>functools.wraps</h2><p>åœ¨ Flaskï¼ˆä»¥åŠå…¶ä»–ç±»ä¼¼çš„ Web æ¡†æ¶ï¼‰ä¸­ï¼Œè§†å›¾å‡½æ•°çš„åç§°ï¼ˆé€šå¸¸æ˜¯å‡½æ•°çš„__name__å±æ€§ï¼‰è¢«ç”¨æ¥ä½œä¸ºç«¯ç‚¹ï¼ˆendpointï¼‰çš„é»˜è®¤æ ‡è¯†ç¬¦ã€‚åœ¨æ²¡æœ‰@wrapsçš„æƒ…å†µä¸‹ï¼ŒåŒ…è£…å‡½æ•°çš„åç§°ï¼ˆå¦‚wrapperï¼‰å¯èƒ½ä¼šè¦†ç›–å…¶ä»–è§†å›¾å‡½æ•°çš„ç«¯ç‚¹ï¼Œå¯¼è‡´AssertionError: view function mapping is overwriting an existing endpoint functioné”™è¯¯ã€‚</p><p>å½“ä½¿ç”¨@wrapsè£…é¥°åŒ…è£…å‡½æ•°ï¼ˆwrapperï¼‰æ—¶ï¼Œå®ƒä¼šä¿ç•™è¢«è£…é¥°å‡½æ•°ï¼ˆåŸå§‹è§†å›¾å‡½æ•°ï¼‰çš„é‡è¦å…ƒæ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬å‡½æ•°åï¼ˆ__name__å±æ€§ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log_decorator</span>(<span class="hljs-params">func</span>):<br><span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Calling <span class="hljs-subst">&#123;func.__name__&#125;</span>&quot;</span>)<br>        result = func(*args, **kwargs)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Finished <span class="hljs-subst">&#123;func.__name__&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> wrapper<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-loguru"><a href="#ä½¿ç”¨-loguru" class="headerlink" title="ä½¿ç”¨ loguru"></a>ä½¿ç”¨ loguru</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger<br><br>logger.debug(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡è°ƒè¯•ä¿¡æ¯&quot;</span>)<br>logger.info(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡æ™®é€šä¿¡æ¯&quot;</span>)<br>logger.warning(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡è­¦å‘Šä¿¡æ¯&quot;</span>)<br>logger.error(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¡é”™è¯¯ä¿¡æ¯&quot;</span>)<br><br>logger.add(<span class="hljs-string">&quot;app.log&quot;</span>)<br>logger.info(<span class="hljs-string">&quot;è¿™æ¡ä¿¡æ¯ä¼šåŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œapp.logæ–‡ä»¶ä¸­&quot;</span>)<br><br>log_format=<span class="hljs-string">&quot;&#123;time: YYYY-MM-DD HH:mm:ss&#125; | &#123;level&#125; | &#123;name&#125;:&#123;function&#125;:&#123;line&#125;: &#123;message&#125;&quot;</span><br>logger.add(<span class="hljs-string">&quot;app.log&quot;</span>, <span class="hljs-built_in">format</span>=log_format, level=<span class="hljs-string">&quot;INFO&quot;</span>, rotation=<span class="hljs-string">&quot;1 day&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>)<br><br>logger.debug(<span class="hljs-string">&quot;è¿™æ¡è°ƒè¯•ä¿¡æ¯ä¸ä¼šè¢«è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå› ä¸ºçº§åˆ«è®¾ç½®ä¸ºINFO&quot;</span>)<br>logger.info(<span class="hljs-string">&quot;è¿™æ¡ä¿¡æ¯ä¼šæŒ‰ç…§æŒ‡å®šæ ¼å¼è®°å½•åˆ°æ–‡ä»¶ä¸­&quot;</span>)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">å¾ªç¯ï¼Œrotationï¼Œè¾¾åˆ°æŒ‡å®šå¤§å°åå»ºæ–°æ—¥å¿—ã€‚</span><br><span class="hljs-string">ä¿ç•™ï¼Œretentionï¼Œå®šæœŸæ¸…ç†ã€‚</span><br><span class="hljs-string">å‹ç¼©ï¼Œcompressionï¼Œå‹ç¼©èŠ‚çœç©ºé—´ã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>logger.add(<span class="hljs-string">&quot;file_1.log&quot;</span>, rotation=<span class="hljs-string">&quot;500 MB&quot;</span>)  <span class="hljs-comment"># è‡ªåŠ¨å¾ªç¯è¿‡å¤§çš„æ–‡ä»¶</span><br>logger.add(<span class="hljs-string">&quot;file_2.log&quot;</span>, rotation=<span class="hljs-string">&quot;12:00&quot;</span>)  <span class="hljs-comment"># æ¯å¤©ä¸­åˆåˆ›å»ºæ–°æ–‡ä»¶</span><br>logger.add(<span class="hljs-string">&quot;file_3.log&quot;</span>, rotation=<span class="hljs-string">&quot;1 week&quot;</span>)  <span class="hljs-comment"># ä¸€æ—¦æ–‡ä»¶å¤ªæ—§è¿›è¡Œå¾ªç¯</span><br><br>logger.add(<span class="hljs-string">&quot;file_X.log&quot;</span>, retention=<span class="hljs-string">&quot;10 days&quot;</span>)  <span class="hljs-comment"># å®šæœŸæ¸…ç†</span><br><br>logger.add(<span class="hljs-string">&quot;file_Y.log&quot;</span>, compression=<span class="hljs-string">&quot;zip&quot;</span>)  <span class="hljs-comment"># å‹ç¼©èŠ‚çœç©ºé—´</span><br><br></code></pre></td></tr></table></figure><h2 id="set-æ“ä½œ"><a href="#set-æ“ä½œ" class="headerlink" title="set æ“ä½œ"></a>set æ“ä½œ</h2><p>é›†åˆæ˜¯æ— åºçš„ï¼Œæ¯æ¬¡è¾“å‡ºç»“æœé¡ºåºä¸ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br>list2 = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br>set1 = <span class="hljs-built_in">set</span>(list1)<br>set2 = <span class="hljs-built_in">set</span>(list2)<br><br><span class="hljs-comment"># - or difference : æ±‚ä¸¤é›†åˆå·®å€¼</span><br>set1.difference(set2)<br><br><span class="hljs-comment"># &amp; or intersection è®¡ç®—é›†åˆé‡å¤å…ƒç´  </span><br><span class="hljs-keyword">if</span> set1 &amp; set2:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸¤ä¸ªåˆ—è¡¨æœ‰é‡å¤å…ƒç´ &quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸¤ä¸ªåˆ—è¡¨æ²¡æœ‰é‡å¤å…ƒç´ &quot;</span>)<br><br><span class="hljs-comment"># issubset åˆ¤æ–­æ˜¯å¦æ˜¯å­é›†</span><br>set1.issubset(set2)<br></code></pre></td></tr></table></figure><h2 id="ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><p>ç”Ÿæˆå™¨çš„æœ¬è´¨ï¼šç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªæƒ°æ€§æ±‚å€¼çš„å¯¹è±¡ï¼Œå®ƒåªåœ¨è¿­ä»£æ—¶ç”Ÿæˆå€¼ã€‚åˆ›å»ºç”Ÿæˆå™¨æ—¶ï¼ŒPython ä¸ä¼šç«‹å³æ£€æŸ¥å®ƒæ˜¯å¦æœ‰å€¼å¯ä¾›ç”Ÿæˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python">items = (item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>))<br><br><span class="hljs-comment">## è·å–ç”Ÿæˆå™¨å€¼</span><br><span class="hljs-comment">## 1. é€šè¿‡for å¾ªç¯è·å–</span><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:<br>    <span class="hljs-built_in">print</span>(item)<br><span class="hljs-comment">## 2. é€šè¿‡next()å‡½æ•°è·å–</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(items))<br><span class="hljs-comment">## ä½†æ˜¯å½“ç”Ÿæˆå™¨å€¼æ¶ˆè€—æ®†å°½æ—¶ä¼šå¼•å‘StopIterationå¼‚å¸¸</span><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(items))<br><span class="hljs-keyword">except</span> StopIteration:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆå™¨å€¼å·²è€—å°½&quot;</span>)<br><br><span class="hljs-comment">## 3. é€šè¿‡list()å‡½æ•°è·å–</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(items))<br><br><span class="hljs-comment">## ç”Ÿæˆå™¨æœ¬èº«å§‹ç»ˆè¢«è®¤ä¸ºæ˜¯â€œæœ‰å€¼â€çš„ï¼ˆå³ä½¿å®ƒè¿˜æ²¡æœ‰äº§ç”Ÿä»»ä½•å®é™…å€¼ï¼‰ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ if not items æ¥æ£€æŸ¥ç”Ÿæˆå™¨æ˜¯å¦ä¸ºç©ºæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„</span><br><br><span class="hljs-comment">## ä½¿ç”¨ next() å–å€¼ï¼Œå¦‚æœç”Ÿæˆå™¨ä¸ºç©ºï¼Œä¼šå¼•å‘ StopIteration å¼‚å¸¸</span><br>items = (item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> [])<br><span class="hljs-keyword">try</span>:<br>    item = <span class="hljs-built_in">next</span>(items)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆå™¨ä¸ä¸ºç©º:&quot;</span>, item)<br><span class="hljs-keyword">except</span> StopIteration:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆå™¨ä¸ºç©º&quot;</span>)<br><br><span class="hljs-comment">## è½¬ä¸ºåˆ—è¡¨æ£€æŸ¥</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">list</span>(items):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆå™¨ä¸ä¸ºç©º&quot;</span>)<br><br><span class="hljs-comment">## ä½¿ç”¨ any() æ£€æŸ¥</span><br><span class="hljs-comment">## å¦‚æœåªæƒ³åˆ¤æ–­ç”Ÿæˆå™¨æ˜¯å¦èƒ½ç”Ÿæˆè‡³å°‘ä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ any()</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(items):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆå™¨ä¸ä¸ºç©º&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>ä¸€æ—¦ç”Ÿæˆå™¨çš„å€¼è¢«æ¶ˆè´¹ï¼ˆé€šè¿‡ for å¾ªç¯ã€next() æˆ– list()ï¼‰ï¼Œå®ƒå°†å˜ä¸ºç©ºï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨ã€‚</p><p>ä½¿ç”¨ any() æˆ–å°†ç”Ÿæˆå™¨è½¬ä¸ºåˆ—è¡¨åï¼Œç”Ÿæˆå™¨çš„å†…å®¹ä¼šè¢«æ¶ˆè´¹ï¼Œä¹‹åä¸èƒ½å†æ¬¡ä½¿ç”¨è¿™äº›å€¼ã€‚</p></blockquote><h2 id="requests-ä¸Šä¼ æ–‡ä»¶"><a href="#requests-ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="requests ä¸Šä¼ æ–‡ä»¶"></a>requests ä¸Šä¼ æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># å®šä¹‰ä¸Šä¼ çš„ç›®æ ‡ URL</span><br>url = <span class="hljs-string">&quot;https://example.com/upload&quot;</span><br><br><span class="hljs-comment"># æ‰“å¼€æ–‡ä»¶å¹¶å°†å…¶åŒ…å«åœ¨æ–‡ä»¶å­—å…¸ä¸­</span><br>file_path = <span class="hljs-string">&quot;path/to/your/file.txt&quot;</span><br>files = &#123;<br>    <span class="hljs-string">&#x27;file&#x27;</span>: <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>)  <span class="hljs-comment"># &#x27;file&#x27; æ˜¯æœåŠ¡å™¨è®¾å®šçš„æ¥æ”¶å­—æ®µå</span><br>&#125;<br><br><span class="hljs-comment"># å…¶ä»–è¡¨å•å­—æ®µï¼ˆå¦‚æœæœ‰ï¼‰</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>,<br>    <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span><br>&#125;<br><br><span class="hljs-comment"># å‘é€ POST è¯·æ±‚</span><br>response = requests.post(url, files=files, data=data)<br><br><span class="hljs-comment"># æ‰“å°å“åº”</span><br><span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸Šä¼ æˆåŠŸ:&quot;</span>, response.text)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥:&quot;</span>, response.status_code, response.text)<br><br><span class="hljs-comment"># è®°å¾—å…³é—­æ–‡ä»¶</span><br>files[<span class="hljs-string">&#x27;file&#x27;</span>].close()<br></code></pre></td></tr></table></figure><h2 id="paramiko-è¿æ¥æœåŠ¡å™¨"><a href="#paramiko-è¿æ¥æœåŠ¡å™¨" class="headerlink" title="paramiko è¿æ¥æœåŠ¡å™¨"></a>paramiko è¿æ¥æœåŠ¡å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> paramiko<br><span class="hljs-keyword">import</span> io<br><br><span class="hljs-comment">## ä»æ–‡ä»¶ä¸­è·å–</span><br>pkey = paramiko.RSAKey.from_private_key_file(<span class="hljs-string">&#x27;/path/to/your/private_key&#x27;</span>)<br><br><span class="hljs-comment"># å‡è®¾è¿™æ˜¯ä½ çš„ç§é’¥å­—ç¬¦ä¸²</span><br>private_key_str = <span class="hljs-string">&quot;-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA...ï¼ˆæ­¤å¤„çœç•¥ä¸­é—´éƒ¨åˆ†ï¼‰.../k=\n-----END RSA PRIVATE KEY-----&quot;</span><br><span class="hljs-comment"># ä½¿ç”¨ io.StringIO å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–‡ä»¶å¯¹è±¡</span><br>pkey_str_io = io.StringIO(private_key_str)<br>pkey = paramiko.RSAKey.from_private_key(pkey_str_io)<br><br>ssh_client = paramiko.SSHClient()<br>ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())<br><span class="hljs-keyword">try</span>:<br>    ssh_client.connect(hostname=<span class="hljs-string">&#x27;your_host&#x27;</span>, port=<span class="hljs-number">22</span>, username=<span class="hljs-string">&#x27;your_username&#x27;</span>, pkey=pkey)<br>    stdin, stdout, stderr = ssh_client.exec_command(<span class="hljs-string">&#x27;ls -l&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(stdout.read().decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-keyword">except</span> paramiko.AuthenticationException <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è®¤è¯å¤±è´¥:&quot;</span>, e)<br><span class="hljs-keyword">except</span> paramiko.SSHException <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SSHè¿æ¥é”™è¯¯:&quot;</span>, e)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å…¶ä»–é”™è¯¯:&quot;</span>, e)<br><span class="hljs-keyword">finally</span>:<br>    ssh_client.close()<br></code></pre></td></tr></table></figure><h2 id="è·¯å¾„æ“ä½œ"><a href="#è·¯å¾„æ“ä½œ" class="headerlink" title="è·¯å¾„æ“ä½œ"></a>è·¯å¾„æ“ä½œ</h2><h3 id="è·å–æ–‡ä»¶è·¯å¾„"><a href="#è·å–æ–‡ä»¶è·¯å¾„" class="headerlink" title="è·å–æ–‡ä»¶è·¯å¾„"></a>è·å–æ–‡ä»¶è·¯å¾„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨ os.path.dirname</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># ç¤ºä¾‹è·¯å¾„</span><br>file_path = <span class="hljs-string">&quot;/home/user/docs/file.txt&quot;</span><br><span class="hljs-comment"># è·å–ç›®å½•è·¯å¾„</span><br>directory = os.path.dirname(file_path)<br><span class="hljs-built_in">print</span>(directory)  <span class="hljs-comment"># è¾“å‡º: /home/user/docs</span><br><br><br><span class="hljs-comment"># ä½¿ç”¨ pathlib, python 3.4+</span><br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-comment"># ç¤ºä¾‹è·¯å¾„</span><br>file_path = <span class="hljs-string">&quot;/home/user/docs/file.txt&quot;</span><br><span class="hljs-comment"># è·å–ç›®å½•è·¯å¾„</span><br>directory = Path(file_path).parent<br><span class="hljs-built_in">print</span>(directory)  <span class="hljs-comment"># è¾“å‡º: /home/user/docs</span><br><br><span class="hljs-comment"># é€šè¿‡ rsplit åˆ†å‰²è·¯å¾„</span><br>directory = file_path.rsplit(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(directory)  <span class="hljs-comment"># è¾“å‡º: /home/user/docs</span><br></code></pre></td></tr></table></figure><h3 id="åˆ†å‰²æ–‡ä»¶åå’Œåç¼€"><a href="#åˆ†å‰²æ–‡ä»¶åå’Œåç¼€" class="headerlink" title="åˆ†å‰²æ–‡ä»¶åå’Œåç¼€"></a>åˆ†å‰²æ–‡ä»¶åå’Œåç¼€</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># ç¤ºä¾‹è·¯å¾„</span><br>file_path = <span class="hljs-string">&quot;/home/user/docs/file.txt&quot;</span><br><span class="hljs-comment"># è·å–æ–‡ä»¶åå’Œåç¼€</span><br>filename, file_extension = os.path.splitext(file_path)<br><span class="hljs-built_in">print</span>(filename, file_extension)  <br><br><br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br>file_path = <span class="hljs-string">&quot;/home/user/docs/file.txt&quot;</span><br>path_obj = Path(file_path)<br><span class="hljs-comment"># è·å–æ ¹è·¯å¾„å’Œæ‰©å±•å</span><br>root = path_obj.with_suffix(<span class="hljs-string">&quot;&quot;</span>) <span class="hljs-comment"># å»æ‰æ‰©å±•å</span><br>ext = path_obj.suffix  <span class="hljs-comment"># è·å–æ‰©å±•åï¼ˆåŒ…æ‹¬ .ï¼‰</span><br><span class="hljs-built_in">print</span>(root)  <span class="hljs-comment"># è¾“å‡º: /home/user/docs/file</span><br><span class="hljs-built_in">print</span>(ext)   <span class="hljs-comment"># è¾“å‡º: .txt</span><br></code></pre></td></tr></table></figure><h3 id="åˆ—å‡ºç›®å½•ä¸‹çš„å†…å®¹"><a href="#åˆ—å‡ºç›®å½•ä¸‹çš„å†…å®¹" class="headerlink" title="åˆ—å‡ºç›®å½•ä¸‹çš„å†…å®¹"></a>åˆ—å‡ºç›®å½•ä¸‹çš„å†…å®¹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br>path = <span class="hljs-string">&quot;/your/directory/path&quot;</span><br><br><span class="hljs-comment"># åˆ—å‡ºè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•</span><br>files_and_dirs = os.listdir(path)<br><span class="hljs-built_in">print</span>(files_and_dirs)  <span class="hljs-comment"># è¾“å‡ºåˆ—è¡¨å½¢å¼</span><br><br><span class="hljs-comment"># ä½¿ç”¨ os.scandir åªæ˜¾ç¤ºæ–‡ä»¶</span><br><span class="hljs-keyword">with</span> os.scandir(path) <span class="hljs-keyword">as</span> entries:<br>    files = [entry.name <span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> entries <span class="hljs-keyword">if</span> entry.is_file()]<br><span class="hljs-built_in">print</span>(files)<br><span class="hljs-comment"># é€’å½’æ–¹å¼</span><br><span class="hljs-comment"># éå†è·¯å¾„åŠå…¶å­ç›®å½•</span><br><span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(path):<br>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>        <span class="hljs-built_in">print</span>(os.path.join(root, file))  <span class="hljs-comment"># æ‰“å°å®Œæ•´è·¯å¾„</span><br><br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br>path = Path(<span class="hljs-string">&quot;/your/directory/path&quot;</span>)<br><br><span class="hljs-comment"># åˆ—å‡ºè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><br>files = [file.name <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> path.iterdir() <span class="hljs-keyword">if</span> file.is_file()]<br><span class="hljs-built_in">print</span>(files)<br><br><span class="hljs-comment"># é€’å½’æ–¹å¼</span><br><span class="hljs-comment"># éå†è·¯å¾„åŠå…¶å­ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span><br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> path.rglob(<span class="hljs-string">&quot;*&quot;</span>):  <span class="hljs-comment"># rglob(&quot;*&quot;) åŒ¹é…æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•</span><br>    <span class="hljs-keyword">if</span> file.is_file():<br>        <span class="hljs-built_in">print</span>(file)  <span class="hljs-comment"># æ‰“å°å®Œæ•´è·¯å¾„</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSL åˆ‡æ¢å­˜å‚¨è·¯å¾„</title>
    <link href="/2024/10/17/wsl-migrate/"/>
    <url>/2024/10/17/wsl-migrate/</url>
    
    <content type="html"><![CDATA[<h1 id="WSL-åˆ‡æ¢å­˜å‚¨è·¯å¾„"><a href="#WSL-åˆ‡æ¢å­˜å‚¨è·¯å¾„" class="headerlink" title="WSL åˆ‡æ¢å­˜å‚¨è·¯å¾„"></a>WSL åˆ‡æ¢å­˜å‚¨è·¯å¾„</h1><blockquote><p>WSLé»˜è®¤å®‰è£…åœ¨Cç›˜ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å®¹æ˜“æ’‘æ»¡Cç›˜</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span><br>wsl -l -v <br><br><span class="hljs-comment"># å¦‚æœå®‰è£…äº†dockeråˆ™æ‰§è¡Œ</span><br><span class="hljs-comment"># å…ˆåœ¨ä»»åŠ¡æ æŠŠdocker-desktopé€€å‡º</span><br>wsl --<span class="hljs-built_in">export</span> docker-desktop-data <span class="hljs-string">&quot;D:\wsl\docker-desktop-data.tar&quot;</span><br>wsl --unregister docker-desktop-data<br>wsl --import docker-desktop-data <span class="hljs-string">&quot;D:\wsl\docker-desktop-data&quot;</span> <span class="hljs-string">&quot;D:\wsl\docker-desktop-data.tar&quot;</span> --version 2<br><br>wsl --<span class="hljs-built_in">export</span> docker-desktop <span class="hljs-string">&quot;D:\wsl\docker-desktop.tar&quot;</span><br>wsl --unregister docker-desktop<br>wsl --import docker-desktop <span class="hljs-string">&quot;D:\wsl\docker-desktop&quot;</span> <span class="hljs-string">&quot;D:\wsl\docker-desktop.tar&quot;</span> --version 2<br><br>wsl --shutdown<br>wsl --<span class="hljs-built_in">export</span> Ubuntu <span class="hljs-string">&quot;D:\wsl\ubuntu.tar&quot;</span><br>wsl --unregister Ubuntu<br>wsl --import Ubuntu <span class="hljs-string">&quot;D:\wsl\ubuntu&quot;</span> <span class="hljs-string">&quot;D:\wsl\ubuntu.tar&quot;</span> --version 2<br><span class="hljs-comment">## é…ç½®é»˜è®¤ç™»é™†ç”¨æˆ·</span><br>ubuntu config --default-user guest<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SVN GitLab å¤‡ä»½ä¸è¿˜åŸ</title>
    <link href="/2024/10/15/svn-gitlab-backup/"/>
    <url>/2024/10/15/svn-gitlab-backup/</url>
    
    <content type="html"><![CDATA[<h1 id="SVN-GitLab-å¤‡ä»½ä¸è¿˜åŸ"><a href="#SVN-GitLab-å¤‡ä»½ä¸è¿˜åŸ" class="headerlink" title="SVN &amp; GitLab å¤‡ä»½ä¸è¿˜åŸ"></a>SVN &amp; GitLab å¤‡ä»½ä¸è¿˜åŸ</h1><h2 id="svn"><a href="#svn" class="headerlink" title="svn"></a>svn</h2><ul><li>çƒ­å¤‡<ul><li>é€šè¿‡svnçš„hookè¾¾åˆ°çƒ­å¤‡æ•ˆæœ</li><li>svnsync</li></ul></li><li>å†·å¤‡<ul><li>é€šè¿‡ svnadmin dump å¯¼å‡ºå¤‡ä»½æ•°æ®</li><li>rsyncæˆ–scp ä¼ è¾“å¤‡ä»½æ•°æ®åˆ°å…¶ä»–æœºå™¨</li></ul></li></ul><h3 id="svnsyncçƒ­å¤‡"><a href="#svnsyncçƒ­å¤‡" class="headerlink" title="svnsyncçƒ­å¤‡"></a>svnsyncçƒ­å¤‡</h3><h4 id="åˆ›å»ºsvn-ä»“åº“"><a href="#åˆ›å»ºsvn-ä»“åº“" class="headerlink" title="åˆ›å»ºsvn ä»“åº“"></a>åˆ›å»ºsvn ä»“åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¥åˆ›å»ºè·¯å¾„</span><br>svnadmin create /home/svn<br></code></pre></td></tr></table></figure><h4 id="ä¿®æ”¹svné…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹svné…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹svné…ç½®æ–‡ä»¶"></a>ä¿®æ”¹svné…ç½®æ–‡ä»¶</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># svnserver.conf</span><br><span class="hljs-comment"># å–æ¶ˆå¦‚ä¸‹é…ç½®æ³¨é‡Š</span><br><span class="hljs-attr">anon-access</span> = none<br><span class="hljs-attr">auth-access</span> = write<br><span class="hljs-attr">password-db</span> = passwd<br><span class="hljs-attr">authz-db</span> = authz<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ adminè´¦å·æƒé™"><a href="#æ·»åŠ adminè´¦å·æƒé™" class="headerlink" title="æ·»åŠ adminè´¦å·æƒé™"></a>æ·»åŠ adminè´¦å·æƒé™</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># authz</span><br><span class="hljs-section">[groups]</span><br><span class="hljs-attr">admin</span> = &lt;username&gt;<br><br><span class="hljs-section">[/]</span><br>@<span class="hljs-attr">admin</span> = rw<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ adminè´¦å·å¯†ç "><a href="#æ·»åŠ adminè´¦å·å¯†ç " class="headerlink" title="æ·»åŠ adminè´¦å·å¯†ç "></a>æ·»åŠ adminè´¦å·å¯†ç </h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># passwd</span><br><span class="hljs-section">[users]</span><br><span class="hljs-attr">admin</span> = &lt;password&gt;<br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨svnæœåŠ¡"><a href="#å¯åŠ¨svnæœåŠ¡" class="headerlink" title="å¯åŠ¨svnæœåŠ¡"></a>å¯åŠ¨svnæœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">svnserve -d -r /home/svn<br></code></pre></td></tr></table></figure><h4 id="svnsyncå¤‡ä»½"><a href="#svnsyncå¤‡ä»½" class="headerlink" title="svnsyncå¤‡ä»½"></a>svnsyncå¤‡ä»½</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨æ–‡ä»¶ç¬¬äºŒè¡ŒåŠ å…¥ exit 0</span><br><span class="hljs-built_in">cp</span> pre-revprop-change.tmpl pre-revprop-change<br><br><span class="hljs-comment"># åˆå§‹åŒ–å¤‡ä»½ä»“åº“</span><br>svnsync init svn://&lt;backup_ip&gt; svn://&lt;svn_ip&gt;<br><br><span class="hljs-comment"># ä¼šæç¤ºè¾“å…¥è´¦å·å¯†ç </span><br>svnsync <span class="hljs-built_in">sync</span> svn://&lt;backup_ip&gt;<br><span class="hljs-comment"># æˆ–</span><br>svnsync <span class="hljs-built_in">sync</span> --non-interactive svn://&lt;backup_ip&gt; --sync-username &lt;username&gt; --sync-password &lt;password&gt; --source-username &lt;username&gt; --source-password &lt;password&gt;<br></code></pre></td></tr></table></figure><h4 id="å°†svnsyncå†™å…¥post-commit-hook"><a href="#å°†svnsyncå†™å…¥post-commit-hook" class="headerlink" title="å°†svnsyncå†™å…¥post-commit hook"></a>å°†svnsyncå†™å…¥post-commit hook</h4><p>é’©å­è„šæœ¬çš„å…·ä½“å†™æ³•å’Œshellè„šæœ¬å†™æ³•æ˜¯ä¸€æ ·çš„ã€‚é’©å­è„šæœ¬å°±æ˜¯è¢«æŸäº›ç‰ˆæœ¬åº“äº‹ä»¶è§¦å‘çš„ç¨‹åºã€‚</p><p>post-commit åœ¨æäº¤å®ŒæˆæˆåŠŸåˆ›å»ºç‰ˆæœ¬ä¹‹åæ‰§è¡Œè¯¥é’©å­ï¼Œæäº¤å·²ç»å®Œæˆï¼Œä¸å¯æ›´æ”¹ã€‚</p><p>pre-commit æäº¤å®Œæˆå‰è§¦å‘æ‰§è¡Œè¯¥è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># hooksç›®å½•</span><br><span class="hljs-built_in">cp</span> post-commit.tmpl post-commit<br><span class="hljs-comment"># å°†å¦‚ä¸‹å‘½ä»¤å†™å…¥ post-commit</span><br>svnsync <span class="hljs-built_in">sync</span> --non-interactive svn://&lt;backup_ip&gt; --sync-username &lt;username&gt; --sync-password &lt;password&gt; --source-username &lt;username&gt; --source-password &lt;password&gt;<br></code></pre></td></tr></table></figure><h3 id="å†·å¤‡"><a href="#å†·å¤‡" class="headerlink" title="å†·å¤‡"></a>å†·å¤‡</h3><h4 id="svnadmin-dump"><a href="#svnadmin-dump" class="headerlink" title="svnadmin dump"></a>svnadmin dump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æŸ¥çœ‹ç‰ˆæœ¬</span><br>svnlook youngest /home/svn<br><br><span class="hljs-comment">## youngest_numå¡«å…¥svnlookæŸ¥åˆ°å€¼</span><br>svnadmin dump /home/svn -r 0:<span class="hljs-variable">$youngest_num</span> --incremental &gt; /home/svn_backup/svn.dump<br><span class="hljs-comment"># å¯ä»¥å°è¯•å†™æˆå¢é‡å¯¼å‡ºè„šæœ¬ï¼Œä¹‹åç”¨å¢é‡æ–‡ä»¶ä¼šæ¯”å…¨é‡å¿«</span><br><span class="hljs-comment">## æ¢å¤å¤‡ä»½æ–‡ä»¶</span><br>svnadmin load /home/svn &lt; /home/svn_backup/svn.dump<br><br><span class="hljs-comment">## ç„¶ååšæˆ rsyncæˆ–è€… scpä¼ è¾“ dumpæ–‡ä»¶åˆ°å¤‡ä»½æœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure><h2 id="gitlabå¤‡ä»½"><a href="#gitlabå¤‡ä»½" class="headerlink" title="gitlabå¤‡ä»½"></a>gitlabå¤‡ä»½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">gitlab-rake gitlab:backup:create<br><span class="hljs-comment"># å¤‡ä»½æ–‡ä»¶åœ¨/var/opt/gitlab/backups/ç›®å½•ä¸‹</span><br><br><span class="hljs-comment">## ä¿®æ”¹å¤‡ä»½æ–‡ä»¶æƒé™</span><br><span class="hljs-built_in">chmod</span> 777 /var/opt/gitlab/backups/*.tar<br><span class="hljs-comment">## åœæ­¢æœåŠ¡</span><br>gitlab-ctl stop unicorn<br>gitlab-ctl stop sidekiq<br><br><span class="hljs-comment">## æ¢å¤</span><br>gitlab-rake gitlab:backup:restore BACKUP=1481434654<br><br><span class="hljs-comment">## å¯åŠ¨æœåŠ¡</span><br>gitlab-ctl restart<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible Playbook è§„èŒƒ</title>
    <link href="/2024/09/27/ansible-action/"/>
    <url>/2024/09/27/ansible-action/</url>
    
    <content type="html"><![CDATA[<h1 id="Ansible-Playbook-è§„èŒƒ"><a href="#Ansible-Playbook-è§„èŒƒ" class="headerlink" title="Ansible Playbook è§„èŒƒ"></a>Ansible Playbook è§„èŒƒ</h1><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>å¯ä»¥ä½¿ç”¨ansible-galaxy æ¥ç”Ÿæˆroleçš„ç›®å½•ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## ç”Ÿæˆ role</span><br>ansible-galaxy init rolename<br><br><span class="hljs-comment">## æŸ¥çœ‹ç”Ÿæˆçš„ roleç»“æ„</span><br>tree roles<br>roles/<br>â””â”€â”€ rolename<br>    â”œâ”€â”€ README.md<br>    â”œâ”€â”€ defaults<br>    â”‚Â Â  â””â”€â”€ main.yml<br>    â”œâ”€â”€ files<br>    â”œâ”€â”€ handlers<br>    â”‚Â Â  â””â”€â”€ main.yml<br>    â”œâ”€â”€ meta<br>    â”‚Â Â  â””â”€â”€ main.yml<br>    â”œâ”€â”€ tasks<br>    â”‚Â Â  â””â”€â”€ main.yml<br>    â”œâ”€â”€ templates<br>    â”œâ”€â”€ tests<br>    â”‚Â Â  â”œâ”€â”€ inventory<br>    â”‚Â Â  â””â”€â”€ test.yml<br>    â””â”€â”€ vars<br>        â””â”€â”€ main.yml<br><br><span class="hljs-comment">## Ansible Galaxy ç½‘ç«™ä¸‹è½½è§’è‰²</span><br><span class="hljs-comment">## å¯ä»¥ä¸‹è½½çœ‹çœ‹åˆ«äººçš„ playbook</span><br>ansible-galaxy install username.rolename<br></code></pre></td></tr></table></figure><h2 id="Playbook-è§„èŒƒ"><a href="#Playbook-è§„èŒƒ" class="headerlink" title="Playbook è§„èŒƒ"></a>Playbook è§„èŒƒ</h2><p>ä¸¥æ ¼ç¼©è¿›ï¼Œä¸¤ä¸ªç©ºæ ¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span><br>  <span class="hljs-attr">vars:</span><br>    <span class="hljs-attr">http_port:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">max_clients:</span> <span class="hljs-number">200</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ensure</span> <span class="hljs-string">apache</span> <span class="hljs-string">is</span> <span class="hljs-string">at</span> <span class="hljs-string">the</span> <span class="hljs-string">latest</span> <span class="hljs-string">version</span><br>    <span class="hljs-attr">yum:</span> <span class="hljs-string">pkg=httpd</span> <span class="hljs-string">state=latest</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">write</span> <span class="hljs-string">the</span> <span class="hljs-string">apache</span> <span class="hljs-string">config</span> <span class="hljs-string">file</span><br>    <span class="hljs-attr">template:</span> <span class="hljs-string">src=/srv/httpd.j2</span> <span class="hljs-string">dest=/etc/httpd.conf</span><br>    <span class="hljs-attr">notify:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">restart</span> <span class="hljs-string">apache</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ensure</span> <span class="hljs-string">apache</span> <span class="hljs-string">is</span> <span class="hljs-string">running</span><br>    <span class="hljs-attr">service:</span> <span class="hljs-string">name=httpd</span> <span class="hljs-string">state=started</span><br>  <span class="hljs-attr">handlers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">restart</span> <span class="hljs-string">apache</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=httpd</span> <span class="hljs-string">state=restarted</span><br></code></pre></td></tr></table></figure><h2 id="shell-command-æ¨¡å—è¿”å›ç å¤„ç†"><a href="#shell-command-æ¨¡å—è¿”å›ç å¤„ç†" class="headerlink" title="shell, command æ¨¡å—è¿”å›ç å¤„ç†"></a>shell, command æ¨¡å—è¿”å›ç å¤„ç†</h2><p>ä½¿ç”¨ command module å’Œ shell module æ—¶,æˆ‘ä»¬éœ€è¦å…³å¿ƒè¿”å›ç ä¿¡æ¯,å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æˆåŠŸæ‰§è¡Œçš„è¿”å›ç ä¸æ˜¯0, å¯ä»¥è¿™æ ·åš:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">run</span> <span class="hljs-string">this</span> <span class="hljs-string">command</span> <span class="hljs-string">and</span> <span class="hljs-string">ignore</span> <span class="hljs-string">the</span> <span class="hljs-string">result</span><br>    <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/somecommand</span> <span class="hljs-string">||</span> <span class="hljs-string">/bin/true</span><br><br><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">run</span> <span class="hljs-string">this</span> <span class="hljs-string">command</span> <span class="hljs-string">and</span> <span class="hljs-string">ignore</span> <span class="hljs-string">the</span> <span class="hljs-string">result</span><br>    <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/somecommand</span><br>    <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>å¯¹äº command module å’Œ shell module,é‡å¤æ‰§è¡Œ playbook,å®é™…ä¸Šæ˜¯é‡å¤è¿è¡ŒåŒæ ·çš„å‘½ä»¤.å¦‚æœæ‰§è¡Œçš„å‘½ä»¤ç±»ä¼¼äº â€˜chmodâ€™ æˆ–è€… â€˜setseboolâ€™ è¿™ç§å‘½ä»¤,è¿™æ²¡æœ‰ä»»ä½•é—®é¢˜.ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš â€˜createsâ€™ çš„ flag ä½¿å¾—è¿™ä¸¤ä¸ª module å˜å¾—å…·æœ‰â€å¹‚ç­‰â€ç‰¹æ€§.</p><h2 id="å¼•ç”¨task"><a href="#å¼•ç”¨task" class="headerlink" title="å¼•ç”¨task"></a>å¼•ç”¨task</h2><p>å¦‚ä¸‹foo.yamlä¾‹å­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># possibly saved as tasks/foo.yml</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">placeholder</span> <span class="hljs-string">foo</span><br>  <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/foo</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">placeholder</span> <span class="hljs-string">bar</span><br>  <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/bar</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨includeå¼•ç”¨foo.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">tasks/foo.yml</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¼ é€’å˜é‡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">wordpress.yml</span> <span class="hljs-string">wp_user=timmy</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">wordpress.yml</span> <span class="hljs-string">wp_user=alice</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">wordpress.yml</span> <span class="hljs-string">wp_user=bob</span><br><br><span class="hljs-comment">## æˆ–è€…</span><br><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">include:</span> <span class="hljs-string">wordpress.yml</span><br>    <span class="hljs-attr">vars:</span><br>        <span class="hljs-attr">wp_user:</span> <span class="hljs-string">timmy</span><br>        <span class="hljs-attr">some_list_variable:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">alpha</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">beta</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">gamma</span><br></code></pre></td></tr></table></figure><h2 id="roles-å¼•ç”¨"><a href="#roles-å¼•ç”¨" class="headerlink" title="roles å¼•ç”¨"></a>roles å¼•ç”¨</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span><br>  <span class="hljs-attr">roles:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">common</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">webservers</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ª playbook ä¸ºä¸€ä¸ªè§’è‰² common æŒ‡å®šäº†å¦‚ä¸‹çš„è¡Œä¸ºï¼š</p><ul><li>å¦‚æœ roles&#x2F;common&#x2F;tasks&#x2F;main.yml å­˜åœ¨, å…¶ä¸­åˆ—å‡ºçš„ tasks å°†è¢«æ·»åŠ åˆ° play ä¸­</li><li>å¦‚æœ roles&#x2F;common&#x2F;handlers&#x2F;main.yml å­˜åœ¨, å…¶ä¸­åˆ—å‡ºçš„ handlers å°†è¢«æ·»åŠ åˆ° play ä¸­</li><li>å¦‚æœ roles&#x2F;common&#x2F;vars&#x2F;main.yml å­˜åœ¨, å…¶ä¸­åˆ—å‡ºçš„ variables å°†è¢«æ·»åŠ åˆ° play ä¸­</li><li>å¦‚æœ roles&#x2F;common&#x2F;meta&#x2F;main.yml å­˜åœ¨, å…¶ä¸­åˆ—å‡ºçš„ â€œè§’è‰²ä¾èµ–â€ å°†è¢«æ·»åŠ åˆ° roles åˆ—è¡¨ä¸­ (1.3 and later)</li><li>æ‰€æœ‰ copy tasks å¯ä»¥å¼•ç”¨ roles&#x2F;common&#x2F;files&#x2F; ä¸­çš„æ–‡ä»¶ï¼Œä¸éœ€è¦æŒ‡æ˜æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li>æ‰€æœ‰ script tasks å¯ä»¥å¼•ç”¨ roles&#x2F;common&#x2F;files&#x2F; ä¸­çš„è„šæœ¬ï¼Œä¸éœ€è¦æŒ‡æ˜æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li>æ‰€æœ‰ template tasks å¯ä»¥å¼•ç”¨ roles&#x2F;common&#x2F;templates&#x2F; ä¸­çš„æ–‡ä»¶ï¼Œä¸éœ€è¦æŒ‡æ˜æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li>æ‰€æœ‰ include tasks å¯ä»¥å¼•ç”¨ roles&#x2F;common&#x2F;tasks&#x2F; ä¸­çš„æ–‡ä»¶ï¼Œä¸éœ€è¦æŒ‡æ˜æ–‡ä»¶çš„è·¯å¾„ã€‚</li></ul><p>ä¸º roles è®¾ç½®è§¦å‘æ¡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span><br>  <span class="hljs-attr">roles:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">role:</span> <span class="hljs-string">some_role</span>, <span class="hljs-attr">when:</span> <span class="hljs-string">&quot;ansible_os_family == &#x27;RedHat&#x27;&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ å¸Œæœ›å®šä¹‰ä¸€äº› tasksï¼Œè®©å®ƒä»¬åœ¨ roles ä¹‹å‰ä»¥åŠä¹‹åæ‰§è¡Œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span><br>  <span class="hljs-attr">pre_tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&#x27;hello&#x27;</span><br>  <span class="hljs-attr">roles:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">role:</span> <span class="hljs-string">some_role</span> &#125;<br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&#x27;still busy&#x27;</span><br>  <span class="hljs-attr">post_tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&#x27;goodbye&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="è§’è‰²é»˜è®¤å˜é‡"><a href="#è§’è‰²é»˜è®¤å˜é‡" class="headerlink" title="è§’è‰²é»˜è®¤å˜é‡"></a>è§’è‰²é»˜è®¤å˜é‡</h2><p>è§’è‰²é»˜è®¤å˜é‡å…è®¸ä½ ä¸º included roles æˆ–è€… dependent rolesè®¾ç½®é»˜è®¤å˜é‡ã€‚è¦åˆ›å»ºé»˜è®¤å˜é‡ï¼Œåªéœ€åœ¨ roles ç›®å½•ä¸‹æ·»åŠ  defaults&#x2F;main.yml æ–‡ä»¶ã€‚è¿™äº›å˜é‡åœ¨æ‰€æœ‰å¯ç”¨å˜é‡ä¸­æ‹¥æœ‰æœ€ä½ä¼˜å…ˆçº§ï¼Œå¯èƒ½è¢«å…¶ä»–åœ°æ–¹å®šä¹‰çš„å˜é‡(åŒ…æ‹¬ inventory ä¸­çš„å˜é‡)æ‰€è¦†ç›–ã€‚</p><h2 id="è§’è‰²ä¾èµ–"><a href="#è§’è‰²ä¾èµ–" class="headerlink" title="è§’è‰²ä¾èµ–"></a>è§’è‰²ä¾èµ–</h2><p>â€œè§’è‰²ä¾èµ–â€ ä½¿ä½ å¯ä»¥è‡ªåŠ¨åœ°å°†å…¶ä»– roles æ‹‰å–åˆ°ç°åœ¨ä½¿ç”¨çš„ role ä¸­ã€‚â€è§’è‰²ä¾èµ–â€ ä¿å­˜åœ¨ roles ç›®å½•ä¸‹çš„ meta&#x2F;main.yml æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶åº”åŒ…å«ä¸€åˆ— roles å’Œ ä¸ºä¹‹æŒ‡å®šçš„å‚æ•°ï¼Œä¸‹é¢æ˜¯åœ¨ roles&#x2F;myapp&#x2F;meta&#x2F;main.yml æ–‡ä»¶ä¸­çš„ç¤ºä¾‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">role:</span> <span class="hljs-string">common</span>, <span class="hljs-attr">some_parameter:</span> <span class="hljs-number">3</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">role:</span> <span class="hljs-string">apache</span>, <span class="hljs-attr">port:</span> <span class="hljs-number">80</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">role:</span> <span class="hljs-string">postgres</span>, <span class="hljs-attr">dbname:</span> <span class="hljs-string">blarg</span>, <span class="hljs-attr">other_parameter:</span> <span class="hljs-number">12</span> &#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å˜é‡"><a href="#ä½¿ç”¨å˜é‡" class="headerlink" title="ä½¿ç”¨å˜é‡"></a>ä½¿ç”¨å˜é‡</h2><h3 id="æ³¨å†Œå˜é‡"><a href="#æ³¨å†Œå˜é‡" class="headerlink" title="æ³¨å†Œå˜é‡"></a>æ³¨å†Œå˜é‡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">web_servers</span><br>  <span class="hljs-attr">tasks:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/foo</span><br>       <span class="hljs-attr">register:</span> <span class="hljs-string">foo_result</span><br>       <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/bar</span><br>       <span class="hljs-attr">when:</span> <span class="hljs-string">foo_result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨factsè·å–çš„ä¿¡æ¯"><a href="#ä½¿ç”¨factsè·å–çš„ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨factsè·å–çš„ä¿¡æ¯"></a>ä½¿ç”¨factsè·å–çš„ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible hostname -m setup<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;ansible_all_ipv4_addresses&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;REDACTED IP ADDRESS&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_all_ipv6_addresses&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;REDACTED IPV6 ADDRESS&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_architecture&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;x86_64&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_bios_date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;09/20/2012&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_bios_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6.00&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_cmdline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;BOOT_IMAGE&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/boot/vmlinuz-3.5.0-23-generic&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;quiet&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ro&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;UUID=4195bff4-e157-4e41-8701-e93f0aec9e22&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;splash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_date_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-10-02&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;day&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;02&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;epoch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1380756810&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;hour&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;19&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;iso8601&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-10-02T23:33:30Z&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;iso8601_micro&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013-10-02T23:33:30.036070Z&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;minute&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;33&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;month&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;second&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;30&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;19:33:30&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tz&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;EDT&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;year&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2013&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_default_ipv4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;alias&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eth0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;gateway&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;interface&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eth0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;macaddress&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mtu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;netmask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;255.255.255.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ether&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_default_ipv6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_devices&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;fd0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;holders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;partitions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;removable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rotational&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;scheduler_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadline&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;512&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.00 Bytes&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;support_discard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vendor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sda&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;holders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware Virtual S&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;partitions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;sda1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;39843840&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;19.00 GB&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2048&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sda2&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.00 KB&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;39847934&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sda5&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2093056&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1022.00 MB&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;39847936&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;removable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rotational&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;scheduler_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadline&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;41943040&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;512&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;20.00 GB&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;support_discard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vendor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware,&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sr0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;holders&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware IDE CDR10&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;partitions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;removable&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rotational&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;scheduler_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;deadline&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2097151&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sectorsize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;512&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1024.00 MB&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;support_discard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vendor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NECVMWar&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_distribution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ubuntu&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_distribution_release&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;precise&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_distribution_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;12.04&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;COLORTERM&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gnome-terminal&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;DISPLAY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;:0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;HOME&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/mdehaan&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;LANG&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;LESSCLOSE&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/bin/lesspipe %s %s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;LESSOPEN&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;| /usr/bin/lesspipe %s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;LOGNAME&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;root&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;LS_COLORS&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;MAIL&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/mail/root&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;OLDPWD&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/root/ansible/docsite&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;PATH&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;PWD&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/root/ansible&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SHELL&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/bin/bash&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SHLVL&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SUDO_COMMAND&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/bin/bash&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SUDO_GID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SUDO_UID&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;SUDO_USER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mdehaan&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;TERM&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xterm&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;USER&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;root&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;USERNAME&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;root&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;XAUTHORITY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/mdehaan/.Xauthority&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;_&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/bin/ansible&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_eth0&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;active&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;device&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eth0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ipv4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;netmask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;255.255.255.0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ipv6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;prefix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;64&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;link&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;macaddress&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e1000&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mtu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ether&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_form_factor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Other&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_fqdn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ubuntu2.example.com&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_hostname&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ubuntu2&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_interfaces&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;lo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;eth0&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_kernel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.5.0-23-generic&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_lo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;active&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;device&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ipv4&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;netmask&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;255.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.0&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ipv6&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;::1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;prefix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;128&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;host&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;mtu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16436</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;loopback&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_lsb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;codename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;precise&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ubuntu 12.04.2 LTS&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ubuntu&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;major_release&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;12&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;release&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;12.04&quot;</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_machine&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;x86_64&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_memfree_mb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">74</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_memtotal_mb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">991</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_mounts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;device&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/dev/sda1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;fstype&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ext4&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;mount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;options&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rw,errors=remount-ro&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;size_available&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15032406016</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;size_total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20079898624</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_nodename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ubuntu2.example.com&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_os_family&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Debian&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_pkg_mgr&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;apt&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_processor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;Intel(R) Core(TM) i7 CPU         860  @ 2.80GHz&quot;</span><br><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_processor_cores&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_processor_count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_processor_threads_per_core&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_processor_vcpus&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_product_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware Virtual Platform&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_product_serial&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_product_uuid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_product_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;None&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_python_version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.7.3&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_selinux&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_ssh_host_key_dsa_public&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED KEY VALUE&quot;</span><br><span class="hljs-attr">&quot;ansible_ssh_host_key_ecdsa_public&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED KEY VALUE&quot;</span><br><span class="hljs-attr">&quot;ansible_ssh_host_key_rsa_public&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;REDACTED KEY VALUE&quot;</span><br><span class="hljs-attr">&quot;ansible_swapfree_mb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">665</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_swaptotal_mb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1021</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_system&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Linux&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_system_vendor&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware, Inc.&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_user_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;root&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_userspace_architecture&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;x86_64&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_userspace_bits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;64&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_virtualization_role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;guest&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;ansible_virtualization_type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;VMware&quot;</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¤æ‚å˜é‡"><a href="#ä½¿ç”¨å¤æ‚å˜é‡" class="headerlink" title="ä½¿ç”¨å¤æ‚å˜é‡"></a>ä½¿ç”¨å¤æ‚å˜é‡</h3><figure class="highlight jinja"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jinja"><span class="hljs-template-variable">&#123;&#123; ansible_eth0[&quot;ipv4&quot;][&quot;address&quot;] &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; ansible_eth0.ipv4.address &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">## è®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; foo[0] &#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="æ¡ä»¶é€‰æ‹©"><a href="#æ¡ä»¶é€‰æ‹©" class="headerlink" title="æ¡ä»¶é€‰æ‹©"></a>æ¡ä»¶é€‰æ‹©</h2><h3 id="when-ä½¿ç”¨"><a href="#when-ä½¿ç”¨" class="headerlink" title="when ä½¿ç”¨"></a>when ä½¿ç”¨</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;shutdown Debian flavored systems&quot;</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">/sbin/shutdown</span> <span class="hljs-string">-t</span> <span class="hljs-string">now</span><br>    <span class="hljs-attr">when:</span> <span class="hljs-string">ansible_os_family</span> <span class="hljs-string">==</span> <span class="hljs-string">&quot;Debian&quot;</span><br><br><span class="hljs-comment">## é€šè¿‡æ‰§è¡Œç»“æœæ¥åˆ¤æ–­</span><br><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/false</span><br>    <span class="hljs-attr">register:</span> <span class="hljs-string">result</span><br>    <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/something</span><br>    <span class="hljs-attr">when:</span> <span class="hljs-string">result|failed</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/something_else</span><br>    <span class="hljs-attr">when:</span> <span class="hljs-string">result|success</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">/bin/still/something_else</span><br>    <span class="hljs-attr">when:</span> <span class="hljs-string">result|skipped</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">vars:</span><br>  <span class="hljs-attr">epic:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;This certainly is epic!&quot;</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">epic</span><br><br><span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;This certainly isn&#x27;t epic!&quot;</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">not</span> <span class="hljs-string">epic</span><br><br><span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;I&#x27;ve got &#x27;<span class="hljs-template-variable">&#123;&#123; foo &#125;&#125;</span>&#x27; and am not afraid to use it!&quot;</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">foo</span> <span class="hljs-string">is</span> <span class="hljs-string">defined</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">fail:</span> <span class="hljs-string">msg=&quot;Bailing</span> <span class="hljs-string">out.</span> <span class="hljs-string">this</span> <span class="hljs-string">play</span> <span class="hljs-string">requires</span> <span class="hljs-string">&#x27;bar&#x27;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">      when: bar is not defined</span><br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶å¯¼å…¥"><a href="#æ¡ä»¶å¯¼å…¥" class="headerlink" title="æ¡ä»¶å¯¼å…¥"></a>æ¡ä»¶å¯¼å…¥</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">vars_files:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;vars/common.yml&quot;</span><br>    <span class="hljs-bullet">-</span> [ <span class="hljs-string">&quot;vars/<span class="hljs-template-variable">&#123;&#123; ansible_os_family &#125;&#125;</span>.yml&quot;</span>, <span class="hljs-string">&quot;vars/os_defaults.yml&quot;</span> ]<br>  <span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">make</span> <span class="hljs-string">sure</span> <span class="hljs-string">apache</span> <span class="hljs-string">is</span> <span class="hljs-string">running</span><br>    <span class="hljs-attr">service:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">apache</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">state=running</span><br></code></pre></td></tr></table></figure><h3 id="åŸºäºå˜é‡é€‰æ‹©æ–‡ä»¶å’Œæ¨¡ç‰ˆ"><a href="#åŸºäºå˜é‡é€‰æ‹©æ–‡ä»¶å’Œæ¨¡ç‰ˆ" class="headerlink" title="åŸºäºå˜é‡é€‰æ‹©æ–‡ä»¶å’Œæ¨¡ç‰ˆ"></a>åŸºäºå˜é‡é€‰æ‹©æ–‡ä»¶å’Œæ¨¡ç‰ˆ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">template</span> <span class="hljs-string">a</span> <span class="hljs-string">file</span><br>  <span class="hljs-attr">template:</span> <span class="hljs-string">src=&#123;&#123;</span> <span class="hljs-string">item</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">dest=/etc/myapp/foo.conf</span><br>  <span class="hljs-attr">with_first_found:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">files:</span><br>      <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">ansible_distribution</span> &#125;&#125;<span class="hljs-string">.conf</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">default.conf</span><br>      <span class="hljs-attr">paths:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">search_location_one/somedir/</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/other_location/somedir/</span><br></code></pre></td></tr></table></figure><h3 id="æ³¨å†Œå˜é‡-1"><a href="#æ³¨å†Œå˜é‡-1" class="headerlink" title="æ³¨å†Œå˜é‡"></a>æ³¨å†Œå˜é‡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test</span> <span class="hljs-string">play</span><br>  <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">cat</span> <span class="hljs-string">/etc/motd</span><br>      <span class="hljs-attr">register:</span> <span class="hljs-string">motd_contents</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;motd contains the word hi&quot;</span><br>      <span class="hljs-attr">when:</span> <span class="hljs-string">motd_contents.stdout.find(&#x27;hi&#x27;)</span> <span class="hljs-type">!=</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><h2 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h2><h3 id="æ ‡å‡†å¾ªç¯"><a href="#æ ‡å‡†å¾ªç¯" class="headerlink" title="æ ‡å‡†å¾ªç¯"></a>æ ‡å‡†å¾ªç¯</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">add</span> <span class="hljs-string">several</span> <span class="hljs-string">users</span><br>  <span class="hljs-attr">user:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">item</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">state=present</span> <span class="hljs-string">groups=wheel</span><br>  <span class="hljs-attr">with_items:</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">testuser1</span><br>     <span class="hljs-bullet">-</span> <span class="hljs-string">testuser2</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">add</span> <span class="hljs-string">several</span> <span class="hljs-string">users</span><br>  <span class="hljs-attr">user:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">item.name</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">state=present</span> <span class="hljs-string">groups=&#123;&#123;</span> <span class="hljs-string">item.groups</span> <span class="hljs-string">&#125;&#125;</span><br>  <span class="hljs-attr">with_items:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;testuser1&#x27;</span>, <span class="hljs-attr">groups:</span> <span class="hljs-string">&#x27;wheel&#x27;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;testuser2&#x27;</span>, <span class="hljs-attr">groups:</span> <span class="hljs-string">&#x27;root&#x27;</span> &#125;<br></code></pre></td></tr></table></figure><h3 id="åµŒå¥—å¾ªç¯"><a href="#åµŒå¥—å¾ªç¯" class="headerlink" title="åµŒå¥—å¾ªç¯"></a>åµŒå¥—å¾ªç¯</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">give</span> <span class="hljs-string">users</span> <span class="hljs-string">access</span> <span class="hljs-string">to</span> <span class="hljs-string">multiple</span> <span class="hljs-string">databases</span><br>  <span class="hljs-attr">mysql_user:</span> <span class="hljs-string">name=&#123;&#123;</span> <span class="hljs-string">item[0]</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">priv=&#123;&#123;</span> <span class="hljs-string">item[1]</span> <span class="hljs-string">&#125;&#125;.*:ALL</span> <span class="hljs-string">append_privs=yes</span> <span class="hljs-string">password=foo</span><br>  <span class="hljs-attr">with_nested:</span><br>    <span class="hljs-bullet">-</span> [ <span class="hljs-string">&#x27;alice&#x27;</span>, <span class="hljs-string">&#x27;bob&#x27;</span> ]<br>    <span class="hljs-bullet">-</span> [ <span class="hljs-string">&#x27;clientdb&#x27;</span>, <span class="hljs-string">&#x27;employeedb&#x27;</span>, <span class="hljs-string">&#x27;providerdb&#x27;</span> ]<br></code></pre></td></tr></table></figure><h3 id="å“ˆå¸Œè¡¨å¾ªç¯"><a href="#å“ˆå¸Œè¡¨å¾ªç¯" class="headerlink" title="å“ˆå¸Œè¡¨å¾ªç¯"></a>å“ˆå¸Œè¡¨å¾ªç¯</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">users:</span><br>  <span class="hljs-attr">alice:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">Alice</span> <span class="hljs-string">Appleworth</span><br>    <span class="hljs-attr">telephone:</span> <span class="hljs-number">123</span><span class="hljs-number">-456</span><span class="hljs-number">-7890</span><br>  <span class="hljs-attr">bob:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">Bob</span> <span class="hljs-string">Bananarama</span><br>    <span class="hljs-attr">telephone:</span> <span class="hljs-number">987</span><span class="hljs-number">-654</span><span class="hljs-number">-3210</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Print</span> <span class="hljs-string">phone</span> <span class="hljs-string">records</span><br>    <span class="hljs-attr">debug:</span> <span class="hljs-string">msg=&quot;User</span> &#123;&#123; <span class="hljs-string">item.key</span> &#125;&#125; <span class="hljs-string">is</span> &#123;&#123; <span class="hljs-string">item.value.name</span> &#125;&#125; <span class="hljs-string">(&#123;&#123;</span> <span class="hljs-string">item.value.telephone</span> <span class="hljs-string">&#125;&#125;)&quot;</span><br>    <span class="hljs-attr">with_dict:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;users&#125;&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><h3 id="æ–‡ä»¶åˆ—è¡¨å¾ªç¯"><a href="#æ–‡ä»¶åˆ—è¡¨å¾ªç¯" class="headerlink" title="æ–‡ä»¶åˆ—è¡¨å¾ªç¯"></a>æ–‡ä»¶åˆ—è¡¨å¾ªç¯</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-comment"># first ensure our target directory exists</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">file:</span> <span class="hljs-string">dest=/etc/fooapp</span> <span class="hljs-string">state=directory</span><br>    <span class="hljs-comment"># copy each file over that matches the given pattern</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">copy:</span> <span class="hljs-string">src=&#123;&#123;</span> <span class="hljs-string">item</span> <span class="hljs-string">&#125;&#125;</span> <span class="hljs-string">dest=/etc/fooapp/</span> <span class="hljs-string">owner=root</span> <span class="hljs-string">mode=600</span><br>      <span class="hljs-attr">with_fileglob:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">/playbooks/files/fooapp/*</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ansible</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible æ‰¹é‡è®¾ç½®å…å¯†ç™»å½•</title>
    <link href="/2024/08/29/ansible-set-sshpass/"/>
    <url>/2024/08/29/ansible-set-sshpass/</url>
    
    <content type="html"><![CDATA[<h2 id="1-å‡†å¤‡-inventory-sshkey"><a href="#1-å‡†å¤‡-inventory-sshkey" class="headerlink" title="1. å‡†å¤‡ inventory &amp;&amp; sshkey"></a>1. å‡†å¤‡ inventory &amp;&amp; sshkey</h2><p>  é¦–æ¬¡æ‰¹é‡è®¾ç½®å…å¯†å¿…ç„¶æ¶‰åŠä½¿ç”¨å¸¦è´¦å·å¯†ç çš„inventoryæ–‡ä»¶ï¼Œ<br>  åœ¨è®¾ç½®å®Œåè®°å¾—ä¿®æ”¹æˆ–åˆ é™¤inventoryæ–‡ä»¶ã€‚</p><p>  ç”Ÿæˆå…¬é’¥å’Œç§é’¥</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># éšæœºç”Ÿæˆå…¬ç§é’¥å¯¹ï¼Œssh-keygenæ˜¯Linuxä¸‹è®¤è¯å¯†é’¥ç”Ÿæˆã€ç®¡ç†å’Œè½¬æ¢å·¥å…·ï¼Œè¯¦ç»†ç”¨æ³•å¯å‚è€ƒå…¶manæ–‡æ¡£</span><br><span class="hljs-comment"># æœ€ç®€å•çš„ç”¨æ³•ï¼Œç„¶åæ•²å›è½¦å³å¯</span><br>ssh-keygen -t rsa<br><span class="hljs-comment"># -N å¿…é¡»è®¾ç½®ä¸ºç©ºï¼Œå¦åˆ™sshæ—¶ä¾ç„¶éœ€è¦è¾“å…¥-Nè®¾ç½®çš„å¯†ç </span><br><span class="hljs-comment"># -C æ·»åŠ æ³¨é‡Š</span><br>ssh-keygen -N <span class="hljs-string">&quot;&quot;</span> -b 4096 -t rsa -C <span class="hljs-string">&quot;root@localhost.com&quot;</span> -f /root/.ssh/root.rsa<br></code></pre></td></tr></table></figure><h2 id="2-ç¼–å†™playbook-or-ä½¿ç”¨ad-hoc"><a href="#2-ç¼–å†™playbook-or-ä½¿ç”¨ad-hoc" class="headerlink" title="2. ç¼–å†™playbook or ä½¿ç”¨ad-hoc"></a>2. ç¼–å†™playbook or ä½¿ç”¨ad-hoc</h2><ul><li><p>authorized_key æ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## manage_dir æ„æ€æ˜¯å¦‚æœ/rootæ²¡æœ‰.sshæ–‡ä»¶ç›®å½•å°±è‡ªåŠ¨åˆ›å»º.sshæ–‡ä»¶ç›®å½•</span><br>ansible machine -m authorized_key -a  <span class="hljs-string">&quot;user=root  key=&#x27;&#123;&#123;  lookup(&#x27;file&#x27;, &#x27;/root/.ssh/id_rsa.pub&#x27;)  &#125;&#125;&#x27;  path=/root/.ssh/authorized_keys  manage_dir=yes&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>copy &amp;&amp; shell æ¨¡å—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># copyå…¬é’¥è‡³è¿œç¨‹ä¸»æœº/tmpç›®å½•ä¸‹</span><br>ansible machine -m copy -a <span class="hljs-string">&quot;src=/root/.ssh/id_rsa.pub dest=/tmp/id_rsa.pub&quot;</span><br><span class="hljs-comment"># æ·»åŠ å…¬é’¥</span><br>ansible machine -m shell -a <span class="hljs-string">&quot;cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>å°‘é‡ä¸»æœºæ—¶å¯ç”¨</p><ul><li>éœ€è¦è‡ªå·±è¾“å…¥å¯†ç </li><li>ä¸»æœºè¾ƒå¤šæ—¶é¢‘ç¹è¾“å…¥å¯†ç è¾ƒéº»çƒ¦ï¼Œä¸»æœºé‡å°‘æ—¶å¯ä»¥ä½¿ç”¨</li><li>ä¸ªåˆ«æ–°å¢å¯ç”¨æ­¤æ–¹æ³•</li><li>ä¹Ÿå¯é…åˆexpectå®ç°è‡ªåŠ¨è¾“å…¥å¯†ç </li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.1<br></code></pre></td></tr></table></figure><p>å…³äºexpectç”¨æ³•å¯æŸ¥è¯¢å…¶ä»–èµ„æ–™ï¼Œbashè„šæœ¬å¯ä»¥ç»“åˆexpectä½¿ç”¨ï¼Œä»è€Œè¾¾åˆ°è‡ªåŠ¨æ‰¹é‡ç™»å½•è®¾ç½®å…å¯†çš„æ•ˆæœã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ! /usr/bin/expect</span><br><span class="hljs-comment"># è®¾ç½®è¦è¿æ¥çš„è¿œç¨‹ä¸»æœºIPä¿¡æ¯</span><br><span class="hljs-built_in">set</span> IP      [ lindex <span class="hljs-variable">$argv</span> 0 ]<br><span class="hljs-comment"># è®¾ç½®è¦è¿æ¥çš„è¿œç¨‹ä¸»æœºç™»å½•ç”¨æˆ·</span><br><span class="hljs-built_in">set</span> USER    [ lindex <span class="hljs-variable">$argv</span> 1 ]<br><span class="hljs-comment"># è®¾ç½®è¦è¿æ¥çš„è¿œç¨‹ä¸»æœºç™»å½•ç”¨æˆ·çš„å¯†ç ä¿¡æ¯</span><br><span class="hljs-built_in">set</span> PASSWD [ lindex <span class="hljs-variable">$argv</span> 2 ]<br><span class="hljs-comment"># è®¾ç½®è¦æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="hljs-built_in">set</span> CMD     [ lindex <span class="hljs-variable">$argv</span> 3 ]<br><span class="hljs-comment"># spawnæ˜¯expectå†…éƒ¨å‘½ä»¤ï¼Œå¼€å¯sshè¿æ¥</span><br>spawn ssh <span class="hljs-variable">$USER</span>@<span class="hljs-variable">$IP</span> <span class="hljs-variable">$CMD</span><br><span class="hljs-comment"># åˆ¤æ–­ä¸Šæ¬¡æ‰§è¡Œç»“æœ</span><br>expect &#123;<br>    <span class="hljs-comment"># å¦‚æœæœ‰yesæˆ–noå…³é”®å­—</span><br>    <span class="hljs-string">&quot;(yes/no)? &quot;</span> &#123;<br>        <span class="hljs-comment"># åˆ™è¾“å…¥yes</span><br>        send <span class="hljs-string">&quot;yes\r&quot;</span><br>        <span class="hljs-comment"># è¾“å…¥å®Œyesåå¦‚æœè¾“å‡ºç»“æœæœ‰ï¼špassword: å…³é”®å­—</span><br>        expect <span class="hljs-string">&quot;password:&quot;</span><br>        <span class="hljs-comment"># åˆ™è¾“å…¥å¯†ç æ–‡ä»¶</span><br>        send <span class="hljs-string">&quot;<span class="hljs-variable">$PASSWD</span>\r&quot;</span><br>        &#125;<br>    <span class="hljs-comment"># å¦‚æœä¸Šæ¬¡è¾“å‡ºç»“æœæœ‰ï¼špassword: ï¼Œåˆ™è¾“å…¥å¯†ç </span><br>    <span class="hljs-string">&quot;password:&quot;</span> &#123;send <span class="hljs-string">&quot;<span class="hljs-variable">$PASSWD</span>\r&quot;</span>&#125;<br>    <span class="hljs-comment"># å¦‚æœä¸Šæ¬¡è¾“å‡ºç»“æœæœ‰ï¼š* to host ï¼Œåˆ™é€€å‡º</span><br>    <span class="hljs-string">&quot;* to host&quot;</span> &#123;<span class="hljs-built_in">exit</span> 1&#125;<br>    &#125;<br>expect eof<br></code></pre></td></tr></table></figure><h2 id="3-éªŒè¯"><a href="#3-éªŒè¯" class="headerlink" title="3. éªŒè¯"></a>3. éªŒè¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°† ip host å†™å…¥/etc/hostsæ–‡ä»¶ï¼Œå¦‚</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.1.1 master&quot;</span> &gt;&gt; /etc/hosts<br><span class="hljs-comment">## å®ç°ç›´æ¥è¾“å…¥masterç™»å½•è¿œç¨‹æœåŠ¡å™¨</span><br>ssh master <br></code></pre></td></tr></table></figure><h2 id="Windows-è®¾ç½®å…å¯†"><a href="#Windows-è®¾ç½®å…å¯†" class="headerlink" title="Windows è®¾ç½®å…å¯†"></a>Windows è®¾ç½®å…å¯†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible win -m win_shell -a &quot;mkdir C:\Users\Administrator\.ssh -Force&quot;<br><br>ansible hz_win -m win_copy  -a &quot;src=&#x27;/root/.ssh/id_rsa.pub&#x27; dest=&#x27;C:/Users/Administrator/.ssh/authorized_keys&#x27;&quot;<br><br>ansible hz_win -m win_copy  -a &#x27;icacls C:\Users\Administrator\.ssh\authorized_keys /inheritance:r /grant &quot;Administrator:F&quot;&#x27;&#x27;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8s åŸºç¡€æ“ä½œä¸é…ç½®</title>
    <link href="/2024/08/27/k8s-base-operation-config/"/>
    <url>/2024/08/27/k8s-base-operation-config/</url>
    
    <content type="html"><![CDATA[<h1 id="K8s-åŸºç¡€"><a href="#K8s-åŸºç¡€" class="headerlink" title="K8s åŸºç¡€"></a>K8s åŸºç¡€</h1><h2 id="kubectl-cmd"><a href="#kubectl-cmd" class="headerlink" title="kubectl cmd"></a>kubectl cmd</h2><ul><li><p>command å­å‘½ä»¤ï¼Œå¸¸ç”¨å¦‚ createã€ deleteã€ describeã€ getã€ applyã€ execç­‰ã€‚</p></li><li><p>TYPE èµ„æºå¯¹è±¡ç±»å‹ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚ å¯ç®€å†™ï¼Œç®€å†™å½¢å¼å¯ç”¨<code>kubectl api-resources</code>æŸ¥çœ‹ã€‚</p></li><li><p>NAME èµ„æºå¯¹è±¡åç§°ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚</p></li><li><p>flags å­å‘½ä»¤è¡Œå‚æ•°ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kubectl [<span class="hljs-built_in">command</span>] [TYPE] [NAME] [flags]<br><br><span class="hljs-comment">## è·å–å¤šä¸ªpodä¿¡æ¯</span><br>kubectl get pods name1 name2<br><br><span class="hljs-comment">## è·å–å¤šç§å¯¹è±¡ä¿¡æ¯</span><br>kubectl get pod/pod_name rc/rc_name<br>kubectl get pod,rc,service<br><br><span class="hljs-comment">## åŒæ—¶åº”ç”¨å¤šä¸ªYAMLæ–‡ä»¶ï¼Œä»¥å¤šä¸ª-f fileå‚æ•°è¡¨ç¤º </span><br>kubectl get pod -f pod1.yaml -f pod2.yaml<br>kubectl create -f pod1.yaml -f rc1.yaml -f service1.yaml<br><br><span class="hljs-comment">## æŒ‰åå­—è¿›è¡Œæ’åº</span><br>kubectl get pods --sort-by=.metadata.name<br><br><span class="hljs-comment">## æŸ¥çœ‹æŒ‡å®š namespaceä¸‹çš„æŒ‡å®šæ ‡ç­¾ä¸‹çš„ pod</span><br>kubectl get pod -n ns -l &lt;labelname&gt;=nginx_proxy<br><br><span class="hljs-comment">## åˆ›å»ºèµ„æºå¯¹è±¡</span><br><span class="hljs-comment">## æ ¹æ® yamlé…ç½®æ–‡ä»¶ä¸€æ¬¡æ€§åˆ›å»º serviceå’Œ rc</span><br>kubectl create -f my-service.yaml -f my-rc.yaml<br><br><span class="hljs-comment">## æ ¹æ®&lt;directory&gt;ç›®å½•ä¸‹æ‰€æœ‰.yamlã€.ymlã€.jsonæ–‡ä»¶çš„å®šä¹‰è¿›è¡Œåˆ›å»º</span><br>kubectl create -f &lt;directory&gt;<br><br><span class="hljs-comment">## åˆ é™¤æ‰€æœ‰åŒ…å«æŸä¸ªlabelçš„podå’Œservice</span><br>kubectl delete pods,services -l name=&lt;label-name&gt;<br><br><span class="hljs-comment">## åˆ é™¤æ‰€æœ‰pod</span><br>kubectl delete pods --all<br><br><span class="hljs-comment">## æŒ‡å®š Podä¸­çš„æŒ‡å®šå®¹å™¨æ‰§è¡Œ dateå‘½ä»¤</span><br>kubectl <span class="hljs-built_in">exec</span> &lt;pod-name&gt; -c &lt;container-name&gt; <span class="hljs-built_in">date</span><br><br><span class="hljs-comment">## ç™»å½•å®¹å™¨</span><br>kubectl <span class="hljs-built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -- /bin/bash<br><br><span class="hljs-comment">## è·Ÿè¸ªæŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br>kubectl logs -f &lt;pod-name&gt; -c &lt;container-name&gt;<br><br><span class="hljs-comment">## åˆ›å»ºæˆ–æ›´æ–°èµ„æºå¯¹è±¡</span><br>kubectl apply -f app.yaml<br><br><span class="hljs-comment">## åœ¨çº¿ç¼–è¾‘è¿è¡Œä¸­çš„èµ„æºå¯¹è±¡</span><br>kubectl edit deploy nginx<br></code></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ä¸ä¼šå»ä½¿ç”¨podç±»å‹å•ç‹¬æ§åˆ¶podï¼Œè€Œæ˜¯ä½¿ç”¨Deploymentã€ReplicaSetã€StatefulSetç­‰èµ„æºå¯¹è±¡æ¥é…ç½®podã€‚</p><h2 id="k8s-pod-config"><a href="#k8s-pod-config" class="headerlink" title="k8s pod config"></a>k8s pod config</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">imagePullPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">IfNotPresent</span>]<br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]<br>    <span class="hljs-attr">args:</span> [<span class="hljs-string">string</span>]<br>    <span class="hljs-attr">workingDir:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">readOnly:</span> <span class="hljs-string">boolean</span><br>    <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">containerPort:</span> <span class="hljs-string">int</span><br>      <span class="hljs-attr">hostPort:</span> <span class="hljs-string">int</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">env:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">value:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-attr">limits:</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">requests:</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">emptyDir:</span> &#123;&#125;<br>    <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">secret:</span><br>      <span class="hljs-attr">secretName:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">configMap:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">items:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br><br>    <span class="hljs-attr">livenessProbe:</span><br>      <span class="hljs-attr">exec:</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]<br>      <span class="hljs-attr">httpGet:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">scheme:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">httpHeaders:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">value:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">tcpSocket:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-string">number</span><br>      <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">securityContext:</span><br>      <span class="hljs-attr">privileged:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">restartPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">OnFailure</span>]<br>  <span class="hljs-attr">nodeSelector:</span> <span class="hljs-string">object</span><br>  <span class="hljs-attr">imagePullSecrets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>  <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">false</span>   <br></code></pre></td></tr></table></figure><h2 id="Podå…±äº«volume"><a href="#Podå…±äº«volume" class="headerlink" title="Podå…±äº«volume"></a>Podå…±äº«volume</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">volume-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tomcat</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">tomcat</span><br>    <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span><br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app-logs</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/local/tomcat/logs</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;tail -f /logs/catalina*.log&quot;</span>]<br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app-logs</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/logs</span><br>  <span class="hljs-comment"># è®¾ç½®çš„Volumeåä¸ºapp-logs,ç±»å‹ä¸ºemptyDir</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app-logs</span><br>    <span class="hljs-attr">emptyDir:</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">cm-appvars</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">apploglevel:</span> <span class="hljs-string">info</span><br>  <span class="hljs-attr">appdatadir:</span> <span class="hljs-string">/var/data</span><br><br></code></pre></td></tr></table></figure><h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><p>ç”¨äºç®¡ç†åœ¨é›†ç¾¤ä¸­æ¯ä¸ªNodeä¸Šä»…è¿è¡Œä¸€ä»½Podçš„å‰¯æœ¬å®ä¾‹<br>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>åœ¨æ¯ä¸ªnodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªGlusterFSå­˜å‚¨æˆ–è€…Cephå­˜å‚¨çš„Daemonè¿›ç¨‹</li><li>åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªæ—¥å¿—é‡‡é›†ç¨‹åº</li><li>åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªæ€§èƒ½ç›‘æ§ç¨‹åºï¼Œé‡‡é›†è¯¥Nodeçš„è¿è¡Œæ€§èƒ½æ•°æ®</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">fluentd-cloud-logging</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">fluentd-cloud-logging</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>      <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">fluentd-cloud-logging</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">fluentd-cloud-logging</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">gcr.io/google_containers/fluentd-elasticsearch:1.17</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">200Mi</span><br>      <span class="hljs-attr">env:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FLUENTD_ARGS</span><br>        <span class="hljs-attr">value:</span> <span class="hljs-string">-q</span><br>      <span class="hljs-attr">volumeMounts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">varlog</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/log</span><br>        <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">containers</span><br>        <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/docker/containers</span><br>        <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">containers</span><br>      <span class="hljs-attr">hostPath:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/docker/containers</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">varlog</span><br>      <span class="hljs-attr">hostPath:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log</span><br>  <span class="hljs-attr">updateStrategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br></code></pre></td></tr></table></figure><blockquote><p>updateStrategyçš„å¦å¤–ä¸€ä¸ªå€¼æ˜¯OnDeleteï¼Œå³åªæœ‰æ‰‹å·¥åˆ é™¤äº†DaemonSetåˆ›å»ºçš„Podå‰¯æœ¬ï¼Œæ–°çš„Podå‰¯æœ¬æ‰ä¼šè¢«åˆ›å»ºå‡ºæ¥</p></blockquote><h2 id="Job-æ‰¹å¤„ç†è°ƒåº¦"><a href="#Job-æ‰¹å¤„ç†è°ƒåº¦" class="headerlink" title="Job æ‰¹å¤„ç†è°ƒåº¦"></a>Job æ‰¹å¤„ç†è°ƒåº¦</h2><p>é€šè¿‡Kubernetes Jobèµ„æºå¯¹è±¡æ¥å®šä¹‰å¹¶å¯åŠ¨ä¸€ä¸ªæ‰¹å¤„ç†ä»»åŠ¡</p><p>æ‰¹å¤„ç†å¯åˆ†ä¸ºï¼š</p><ul><li>Job Template Expansionæ¨¡å¼<ul><li>ä¸€ä¸ªJobå¯¹è±¡å¯¹åº”ä¸€ä¸ªå¾…å¤„ç†çš„Work itemï¼Œæœ‰å‡ ä¸ªWork itemå°±äº§ç”Ÿå‡ ä¸ªç‹¬ç«‹çš„Job</li></ul></li><li>Queue with Pod Per Work Itemæ¨¡å¼<ul><li>é‡‡ç”¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å­˜æ”¾Work itemï¼Œä¸€ä¸ªJobå¯¹è±¡ä½œä¸ºæ¶ˆè´¹è€…å»å®Œæˆè¿™äº›Work item</li><li>Jobä¼šå¯åŠ¨Nä¸ªPodï¼Œæ¯ä¸ªPodéƒ½å¯¹åº”ä¸€ä¸ªWork item</li></ul></li><li>Queue with Variable Pod Countæ¨¡å¼<ul><li>é‡‡ç”¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å­˜æ”¾Work itemï¼Œä¸€ä¸ªJobå¯¹è±¡ä½œä¸ºæ¶ˆè´¹è€…å»å®Œæˆè¿™äº›Work itemï¼Œä½†ä¸ä¸Šé¢çš„æ¨¡å¼ä¸åŒï¼ŒJobå¯åŠ¨çš„Podæ•°é‡æ˜¯å¯å˜çš„ã€‚</li></ul></li><li>Single Job with Static Work Assignmentæ¨¡å¼<ul><li>ä¸€ä¸ªJobäº§ç”Ÿå¤šä¸ªPodï¼Œä½†å®ƒé‡‡ç”¨ç¨‹åºé™æ€æ–¹å¼åˆ†é…ä»»åŠ¡é¡¹ï¼Œè€Œä¸æ˜¯é‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼è¿›è¡ŒåŠ¨æ€åˆ†é…</li></ul></li></ul><p>Kuberneteså°†Jobåˆ†ä»¥ä¸‹ä¸‰ç§ç±»å‹:</p><ul><li>Non-parallel Jobs</li><li>Parallel Jobs with a fixed completion count</li><li>Parallel Jobs with a work queue</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">process-item-$ITEM</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">jobgroup:</span> <span class="hljs-string">jobexample</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">jobexample</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">jobgroup:</span> <span class="hljs-string">jobexample</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">c</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo Processing item $ITEM&amp;&amp; sleep 5&quot;</span>]<br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span><br></code></pre></td></tr></table></figure><h2 id="Cronjob-å®šæ—¶ä»»åŠ¡"><a href="#Cronjob-å®šæ—¶ä»»åŠ¡" class="headerlink" title="Cronjob å®šæ—¶ä»»åŠ¡"></a>Cronjob å®šæ—¶ä»»åŠ¡</h2><p>åŸºæœ¬ä¸Šå¯å‚ç…§Linux Cronçš„è¡¨è¾¾å¼</p><p><code>Minutes Hours DayofMonth Month DayofWeek Year</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hello</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">&quot;*/1 * * * *&quot;</span><br>  <span class="hljs-attr">jobTemplate:</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">spec:</span><br>          <span class="hljs-attr">containers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>            <span class="hljs-attr">args:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/sh</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">date;</span> <span class="hljs-string">echo</span> <span class="hljs-string">Hello</span> <span class="hljs-string">from</span> <span class="hljs-string">the</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">cluster</span><br>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span><br></code></pre></td></tr></table></figure><h2 id="Pod-å‡çº§å›æ»š"><a href="#Pod-å‡çº§å›æ»š" class="headerlink" title="Pod å‡çº§å›æ»š"></a>Pod å‡çº§å›æ»š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ›´æ–°é•œåƒ</span><br>kubectl <span class="hljs-built_in">set</span> image deployment/nginx-deployment nginx=nginx:1.9.1<br><span class="hljs-comment"># æˆ–è€…editç¼–è¾‘</span><br>kubectl edit deployment/nginx-deployment<br><br><span class="hljs-comment"># æŸ¥çœ‹deploymentæ›´æ–°è¿‡ç¨‹</span><br>kubetl rollout status deployment/hello<br><br><span class="hljs-comment">## æŸ¥çœ‹å†å²è®°å½•</span><br>kubectl rollout <span class="hljs-built_in">history</span> deployment/hello<br><span class="hljs-comment"># æŸ¥çœ‹æŒ‡å®šç‰ˆæœ¬</span><br>kubectl rollout <span class="hljs-built_in">history</span> deployment/hello --revision=2<br><span class="hljs-comment"># å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span><br>kubectl rollout undo deployment/hello<br><span class="hljs-comment"># å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬</span><br>kubectl rollout undo deployment/hello --to-revision=2<br><br><span class="hljs-comment">## æš‚åœdeploymentæ›´æ–°</span><br>kubectl rollout pause deployment/hello<br><span class="hljs-comment"># æ¢å¤Deploymentéƒ¨ç½²</span><br>kubectl rollout resume deployment/hello<br><span class="hljs-comment"># åœ¨æ¢å¤æš‚åœçš„Deploymentä¹‹å‰ï¼Œæ— æ³•å›æ»šè¯¥Deployment</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell å®ç”¨æŠ€å·§ï¼ˆä¸‰ï¼‰</title>
    <link href="/2024/08/15/shell-action-3/"/>
    <url>/2024/08/15/shell-action-3/</url>
    
    <content type="html"><![CDATA[<ol><li><p><strong>getopts</strong></p><ul><li><code>getopts</code> æ˜¯ä¸€ä¸ªå†…å»ºå‘½ä»¤ï¼Œç”¨äºå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹ã€‚</li><li>å®ƒå¯ä»¥è®©è„šæœ¬åœ¨è¿è¡Œæ—¶æ¥å—å‘½ä»¤è¡Œå‚æ•°ã€‚</li><li>å®ƒçš„è¯­æ³•æ˜¯ï¼š<code>getopts optstring variable</code>ã€‚</li><li><code>optstring</code> å¡«å…¥é€‰é¡¹å­—ç¬¦ï¼Œå¦‚ <code>abc</code> è¡¨ç¤ºé€‰é¡¹ aã€b å’Œ c æ˜¯åˆæ³•çš„é€‰é¡¹ã€‚</li><li>å¦‚æœæ˜¯å¿…å¡«é¡¹è¦åœ¨é€‰é¡¹åé¢åŠ å†’å·ï¼Œå¦‚<code>a:bc</code></li><li>å¯¹äºæ¥å—å‚æ•°çš„é€‰é¡¹ï¼Œå‚æ•°ä¼šä¿å­˜åœ¨ shell å˜é‡ <code>$OPTARG</code>ä¸­</li><li>å½“é€‰é¡¹æ˜¯ä¸éœ€è¦è¾“å…¥å‚æ•°çš„æ—¶å€™ï¼Œ<code>$OPTARG</code>ä¸ºç©º</li><li><code>$OPTIND</code> åˆå§‹å€¼ä¸º1ï¼Œæ¯è§£æä¸€ä¸ªé€‰é¡¹ï¼Œ<code>$OPTIND</code> ä¼šåŠ 1</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šgetopts_example</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># getoptsç”¨æ³•</span><br><span class="hljs-comment">#</span><br>aflag=<br>bflag=<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> <span class="hljs-string">&#x27;ab:&#x27;</span> OPTION<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-variable">$OPTION</span> <span class="hljs-keyword">in</span><br>        a) aflag=1<br>        ;;<br>        b) bflag=1<br>        bval=<span class="hljs-string">&quot;<span class="hljs-variable">$OPTARG</span>&quot;</span><br>        ;;<br>        ?) <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Usage: %s: [-a] [-b value] args\n&quot;</span> <span class="hljs-variable">$&#123;0##*/&#125;</span> &gt;&amp;2<br>        <span class="hljs-built_in">exit</span> 2<br>        ;;<br>    <span class="hljs-keyword">esac</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">shift</span> $((<span class="hljs-variable">$OPTIND</span> - <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$aflag</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Option -a specified\n&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$bflag</span>&quot;</span> ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;Option -b &quot;%s&quot; specified\n&#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$bval</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Remaining arguments are: %s\n&quot;</span> <span class="hljs-string">&quot;$*&quot;</span><br><br>myscript -a -b alt plow harvest reap<br><span class="hljs-comment">## è¿™é‡Œè§£æå®Œé€‰é¡¹å $OPTIND ä¸º 4, å› æ­¤$OPTIND - 1ï¼Œä¸¢å¼ƒè§£æè¿‡çš„é€‰é¡¹ï¼Œå‰©ä½™çš„å‚æ•°ä¸º plow harvest reap</span><br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæƒ³è®©è„šæœ¬è¾“å‡ºè‡ªå·±è‡ªå®šä¹‰çš„é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦åœ¨ <code>getopts</code> é€‰é¡¹åˆ—è¡¨å‰åŠ ä¸Š<code>:</code>, å¦‚<code>:ab:c</code> ä½¿<code>getopts</code>ä¸è¾“å‡ºé”™è¯¯æ¶ˆæ¯ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šgetopts_custom</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># è§£æå‚æ•°æ—¶ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯</span><br><span class="hljs-comment">#</span><br>aflag=<br>bflag=<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> :ab: FOUND<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-variable">$FOUND</span> <span class="hljs-keyword">in</span><br>        a) aflag=1<br>        ;;<br>        b) bflag=1<br>        bval=<span class="hljs-string">&quot;<span class="hljs-variable">$OPTARG</span>&quot;</span><br>            ;;<br>        <span class="hljs-comment"># ç¼ºå°‘å‚æ•°è¿”å› :</span><br>        \:) <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;argument missing from -%s option\n&quot;</span> <span class="hljs-variable">$OPTARG</span><br>            <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Usage: %s: [-a] [-b value] args\n&quot;</span> <span class="hljs-variable">$&#123;0##*/&#125;</span><br>            <span class="hljs-built_in">exit</span> 2<br>            ;;<br>        <span class="hljs-comment"># ä¸æ”¯æŒçš„é€‰é¡¹è¿”å› ?</span><br>        \?) <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;unknown option: -%s\n&quot;</span> <span class="hljs-variable">$OPTARG</span><br>            <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Usage: %s: [-a] [-b value] args\n&quot;</span> <span class="hljs-variable">$&#123;0##*/&#125;</span><br>            <span class="hljs-built_in">exit</span> 2<br>            ;;<br>        <span class="hljs-keyword">esac</span> &gt;&amp;2<br>    <span class="hljs-keyword">done</span><br><span class="hljs-built_in">shift</span> $((<span class="hljs-variable">$OPTIND</span> - <span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>ç”¨readè§£ææ–‡æœ¬</strong></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šparseViaRead</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ç”¨readè¯­å¥è§£æls -lçš„è¾“å‡º</span><br><span class="hljs-comment"># ls -lçš„è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹è¿™æ ·ï¼š</span><br><span class="hljs-comment"># -rw-r--r--  1 albing users 126 2006-10-10 22:50 fnsize</span><br><br><span class="hljs-built_in">ls</span> -l <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> | &#123; <span class="hljs-built_in">read</span> PERMS LCOUNT OWNER GROUP SIZE CRDATE CRTIME FILE ;<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$FILE</span> has <span class="hljs-variable">$LCOUNT</span> <span class="hljs-string">&#x27;link(s)&#x27;</span> and is <span class="hljs-variable">$SIZE</span> bytes long. ;<br>&#125;<br><br><span class="hljs-comment"># read å°†å„å•è¯è¯»å…¥æ•°ç»„å˜é‡</span><br><span class="hljs-built_in">read</span> -a MYRAY<br></code></pre></td></tr></table></figure></li><li><p><strong>è¯»å–æ•´ä¸ªæ–‡ä»¶</strong></p><blockquote><p>mapfile å’Œ readarray</p><p>èƒ½å¤Ÿå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ å¯¹åº”æ–‡ä»¶ä¸­çš„ä¸€è¡Œ</p></blockquote> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mapfile</span> -t -s 1 -n 1500 -C showprg -c 100 BIGDATA &lt; /tmp/myfile.data<br><span class="hljs-comment"># -s 1 è·³è¿‡ç¬¬ä¸€è¡Œè¾“å…¥</span><br><span class="hljs-comment"># -n 1500 è¯»å– 1500è¡Œ</span><br><span class="hljs-comment"># -t åˆ é™¤æ¯è¡Œè¡Œå°¾çš„æ¢è¡Œç¬¦</span><br><span class="hljs-comment"># -c 100 æ¯è¯»å– 100è¡Œè°ƒç”¨ä¸€æ¬¡ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° showprg, é»˜è®¤æ¯ 5000è¡Œè°ƒç”¨ä¸€æ¬¡</span><br><span class="hljs-comment"># ç»“æœæ”¾è¿›æ•°ç»„ BIGDATA</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ¯æ¬¡æå–ä¸€ä¸ªå­—ç¬¦</strong></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šonebyone</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ä»è¾“å…¥ä¸­ä¸€æ¬¡è§£æä¸€ä¸ªå­—ç¬¦</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> ALINE<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">for</span> ((i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-variable">$&#123;#ALINE&#125;</span>; i++))<br>    <span class="hljs-keyword">do</span><br>        ACHAR=<span class="hljs-variable">$&#123;ALINE:i:1&#125;</span><br>        <span class="hljs-comment"># åœ¨è¿™é‡Œæ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¦‚echo $ACHAR</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$ACHAR</span><br>    <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æå–æ•°æ®ä¸­çš„ç‰¹å®šå­—æ®µ</strong></p><ul><li><code>cut</code></li><li><code>awk</code></li><li><code>grep -o</code> æ­£åˆ™æå–</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cut</span> -d: -f1,6,7 /etc/passwd<br><span class="hljs-built_in">cut</span> -d: -f1-3<br><br><span class="hljs-comment"># é»˜è®¤è¾“å‡ºåˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ï¼Œé€šè¿‡ OFSå˜é‡ä¿®æ”¹</span><br>awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;:&quot;; OFS=&quot;\t&quot;&#125; &#123;print $1 $7 $6&#125;&#x27;</span> /etc/passwd<br><br><span class="hljs-comment">## ipåœ°å€æå–</span><br>ip a | grep -oP <span class="hljs-string">&#x27;([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ›´æ–°æ–‡ä»¶ä¸­çš„ç‰¹å®šå­—æ®µ</strong></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ grep csh /etc/passwd<br>root:*:0:0:Charlie &amp;:/root:/bin/csh<br><br>$ sed <span class="hljs-string">&#x27;s;/csh$;/sh;&#x27;</span> /etc/passwd | grep <span class="hljs-string">&#x27;^root&#x27;</span><br>root:*:0:0:Charlie &amp;:/root:/bin/sh<br><br><span class="hljs-comment"># å¯¹å­—æ®µè¿›è¡Œè¿ç®—æˆ–ä¿®æ”¹ç‰¹å®šå­—æ®µä¸­çš„å†…å®¹</span><br>$ <span class="hljs-built_in">cat</span> data_file<br>Line 1 ends<br>Line 2 ends<br>Line 3 ends<br>Line 4 ends<br>Line 5 ends<br><br>$ awk <span class="hljs-string">&#x27;&#123;print $1, $2+5, $3&#125;&#x27;</span> data_file<br>Line 6 ends<br>Line 7 ends<br>Line 8 ends<br>Line 9 ends<br>Line 10 ends<br><span class="hljs-comment"># å¦‚æœç¬¬2ä¸ªå­—æ®µä¸­åŒ…å«&#x27;3&#x27;ï¼Œå°†å…¶ä¿®æ”¹ä¸º&#x27;8&#x27;å¹¶åšæ ‡è®°</span><br>$ awk <span class="hljs-string">&#x27;&#123; if ($2 == &quot;3&quot;) print $1, $2+5, $3, &quot;Tweaked&quot; ; else print $0; &#125;&#x27;</span> \<br>data_file<br>Line 1 ends<br>Line 2 ends<br>Line 8 ends Tweaked<br>Line 4 ends<br>Line 5 ends<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¿®å‰ªç©ºç™½å­—ç¬¦</strong></p><ul><li><code>shopt -s extglob</code> å¼€å¯æ‰©å±•é€šé…ç¬¦åŒ¹é…</li><li>åˆ©ç”¨ <code>read</code>çš„è®¾è®¡æ–¹æ³•</li><li><code>$&#123;##&#125; æˆ– $&#123;%%&#125;</code> å˜é‡å­—ç¬¦ä¸²åˆ‡å‰²</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">shopt</span> -s extglob<br><span class="hljs-comment">## å¼€å¯åå¯ä»¥ç”¨ +(), åŒ¹é…å¤šä¸ªç©ºæ ¼ç¬¦</span><br><span class="hljs-variable">$&#123;line##+([[:space:]])&#125;</span><br><span class="hljs-variable">$&#123;line%%+([[:space:]])&#125;</span><br><br><span class="hljs-built_in">shopt</span> -s extglob<br><br><span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r line; <span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;None: <span class="hljs-variable">$line</span>&quot;</span> <span class="hljs-comment"># ä¿ç•™æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Ld: <span class="hljs-variable">$&#123;line##+([[:space:]])&#125;</span>&quot;</span> <span class="hljs-comment"># ä¿®å‰ªè¡Œé¦–ç©ºç™½å­—ç¬¦</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Tr: <span class="hljs-variable">$&#123;line%%+([[:space:]])&#125;</span>&quot;</span> <span class="hljs-comment"># ä¿®å‰ªè¡Œå°¾ç©ºç™½å­—ç¬¦</span><br>line=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;line##+([[:space:]])&#125;</span>&quot;</span> <span class="hljs-comment"># ä¿®å‰ªè¡Œé¦–å’Œâ€¦â€¦</span><br>line=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;line%%+([[:space:]])&#125;</span>&quot;</span> <span class="hljs-comment"># â€¦â€¦è¡Œå°¾çš„ç©ºç™½å­—ç¬¦</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;All: <span class="hljs-variable">$line</span>&quot;</span> <span class="hljs-comment"># æ˜¾ç¤ºä¿®å‰ªåçš„å†…å®¹</span><br><span class="hljs-keyword">done</span> &lt; whitespace<br></code></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™å®‰å…¨çš„shellè„šæœ¬</strong></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šsecurity_template</span><br><br><span class="hljs-comment"># è®¾ç½®åˆç†çš„/å®‰å…¨çš„è·¯å¾„</span><br>PATH=<span class="hljs-string">&#x27;/usr/local/bin:/bin:/usr/bin&#x27;</span><br><span class="hljs-comment"># ç¡®ä¿å¯¼å‡º$PATH</span><br>\<span class="hljs-built_in">export</span> PATH<br><br><span class="hljs-comment"># æ¸…é™¤æ‰€æœ‰åˆ«åã€‚åˆ‡è®°ï¼šå¼€å¤´çš„\ç”¨äºç¦æ­¢åˆ«åæ‰©å±•</span><br>\<span class="hljs-built_in">unalias</span> -a<br><br><span class="hljs-comment"># æ¸…é™¤å‘½ä»¤è·¯å¾„æ•£åˆ—</span><br><span class="hljs-built_in">hash</span> -r<br><br><span class="hljs-comment"># å°†ç¡¬æ€§é™åˆ¶è®¾ç½®ä¸º0ï¼Œå…³é—­æ ¸å¿ƒè½¬å‚¨ï¼ˆcore dumpsï¼‰</span><br><span class="hljs-built_in">ulimit</span> -H -c 0 --<br><br><span class="hljs-comment"># è®¾ç½®åˆç†çš„/å®‰å…¨çš„IFSï¼ˆæ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨çš„è¯­æ³•ä»…é€‚ç”¨äºbashå’Œksh93ï¼Œä¸å…·å¤‡å¯ç§»æ¤æ€§ï¼ï¼‰</span><br>IFS=$<span class="hljs-string">&#x27; \t\n&#x27;</span><br><br><span class="hljs-comment"># è®¾ç½®å¹¶ä½¿ç”¨åˆç†çš„/å®‰å…¨çš„umaskå˜é‡</span><br><span class="hljs-comment"># æ³¨æ„ï¼Œè¿™ä¸ä¼šå½±å“å·²ç»åœ¨å‘½ä»¤è¡Œä¸Šé‡å®šå‘çš„æ–‡ä»¶</span><br><span class="hljs-comment"># 022äº§ç”Ÿ0755æƒé™ï¼Œ077äº§ç”Ÿ0700æƒé™â€¦â€¦</span><br>UMASK=022<br><span class="hljs-built_in">umask</span> <span class="hljs-variable">$UMASK</span><br><br><span class="hljs-keyword">until</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$temp_dir</span>&quot;</span> -a ! -d <span class="hljs-string">&quot;<span class="hljs-variable">$temp_dir</span>&quot;</span> ]; <span class="hljs-keyword">do</span><br>    temp_dir=<span class="hljs-string">&quot;/tmp/meaningful_prefix.<span class="hljs-variable">$&#123;RANDOM&#125;</span><span class="hljs-variable">$&#123;RANDOM&#125;</span><span class="hljs-variable">$&#123;RANDOM&#125;</span>&quot;</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">mkdir</span> -p -m 0700 <span class="hljs-variable">$temp_dir</span> \<br>|| (<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;FATAL: Failed to create temp dir &#x27;<span class="hljs-variable">$temp_dir</span>&#x27;: $?&quot;</span>; <span class="hljs-built_in">exit</span> 100)<br><br><span class="hljs-comment"># å°½å…¨åŠ›æ¸…é™¤ä¸´æ—¶æ–‡ä»¶</span><br><span class="hljs-comment"># æ³¨æ„ï¼Œä¸€å®šè¦å…ˆè®¾ç½®å¥½$temp_dirï¼Œåƒä¸‡ä¸è¦ä¿®æ”¹ï¼</span><br>cleanup=<span class="hljs-string">&quot;rm -rf <span class="hljs-variable">$temp_dir</span>&quot;</span><br><span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;<span class="hljs-variable">$cleanup</span>&quot;</span> ABRT EXIT HUP INT QUIT<br></code></pre></td></tr></table></figure></li><li><p><strong>è„šæœ¬é‡å®šå‘è¾“å‡º</strong></p><p> exec é€šå¸¸ä¼šä½¿ç”¨å…¶å‚æ•°æ‰€æŒ‡å®šçš„å‘½ä»¤æ¥æ›¿æ¢æ­£åœ¨è¿è¡Œçš„ shell</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¿å­˜æ—§çš„STDERR</span><br><span class="hljs-built_in">exec</span> 3&gt;&amp;2<br><br><span class="hljs-comment"># å°†æ‰€æœ‰å‘å¾€STDERRçš„è¾“å‡ºé‡å®šå‘åˆ°é”™è¯¯æ—¥å¿—æ–‡ä»¶</span><br><span class="hljs-built_in">exec</span> 2&gt; /path/to/error_log<br><br><span class="hljs-comment"># é€šè¿‡è¿˜åŸSTDERRå¹¶å…³é—­æ–‡ä»¶å¥æŸ„3æ¥åœæ­¢é‡å®šå‘</span><br><span class="hljs-built_in">exec</span> 2&gt;&amp;3-<br></code></pre></td></tr></table></figure></li><li><p><strong>Argument list too long</strong></p><p>ä½¿ç”¨ xargs å‘½ä»¤ï¼ˆå¯èƒ½è¿˜è¦é…åˆ findï¼‰æ¥æ‹†åˆ†å‚æ•°åˆ—è¡¨ã€‚</p><p>find -print0 é…åˆ xargs -0ã€‚å¯ä»¥ä½¿ find ä½¿ç”¨ç©ºå­—ç¬¦ï¼ˆæ–‡ä»¶åä¸­ä¸ä¼šå‡ºç°è¿™ç§å­—ç¬¦ï¼‰ä»£æ›¿ç©ºç™½å­—ç¬¦ä½œä¸ºè¾“å‡ºè®°å½•åˆ†éš”ç¬¦ï¼Œxargs ä½¿ç”¨ç©ºå­—ç¬¦ä½œä¸ºè¾“å…¥è®°å½•åˆ†éš”ç¬¦ã€‚è¿™æ ·èƒ½æ­£ç¡®åœ°è§£æåŒ…å«æ€ªå¼‚å­—ç¬¦çš„æ–‡ä»¶åã€‚</p><p>ARG_MAX é™åˆ¶äº† exec* ç³»åˆ—ç³»ç»Ÿè°ƒç”¨çš„æ€»ç©ºé—´éœ€æ±‚ï¼Œå†…æ ¸ä»¥æ­¤çŸ¥é“å®ƒå¿…é¡»åˆ†é…çš„æœ€å¤§ç¼“å†²åŒºã€‚execve çš„ 3 ä¸ªå‚æ•°æ˜¯ï¼šç¨‹åºåç§°ã€å‚æ•°å‘é‡å’Œç¯å¢ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æŸ¥çœ‹ç³»ç»Ÿé™åˆ¶å€¼</span><br>getconf ARG_MAX<br>getconf LINE_MAX<br></code></pre></td></tr></table></figure></li><li><p><strong>è‡ªå®šä¹‰æç¤ºç¬¦</strong></p><p>æç¤ºå­—ç¬¦ä¸²åˆ†åˆ«ä¸º $PS0ã€$PS1ã€$PS2ã€$PS3ã€$PS4</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šprompts</span><br><br><span class="hljs-comment"># ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€æ—¥æœŸå’Œæ—¶é—´ï¼Œä»¥åŠå½“å‰å·¥ä½œç›®å½•ï¼ˆCWDï¼‰ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;[\u@\h \d \A] \w \$ &#x27;</span><br><br><span class="hljs-comment"># ç”¨æˆ·å@é•¿æ ¼å¼ä¸»æœºåã€ISO 8601æ ¼å¼çš„æ—¥æœŸå’Œæ—¶é—´ã€å½“å‰å·¥ä½œç›®å½•çš„åŸºæœ¬åç§°ï¼ˆ\Wï¼‰:</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;[\u@\H \D&#123;%Y-%m-%d %H:%M:%S%z&#125;] \W \$ &#x27;</span><br><br><span class="hljs-comment"># ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€bashç‰ˆæœ¬å·ï¼Œä»¥åŠå½“å‰å·¥ä½œç›®å½•ï¼ˆ\wï¼‰ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;[\u@\h \V \w] \$ &#x27;</span><br><br><span class="hljs-comment"># æ¢è¡Œç¬¦ã€ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€åŸºæœ¬PTYã€shellå±‚çº§ã€å†å²ç¼–å·ã€æ¢è¡Œç¬¦ï¼Œä»¥åŠå®Œæ•´çš„å·¥ä½œ</span><br>ç›®å½•åç§°ï¼ˆ<span class="hljs-variable">$PWD</span>ï¼‰ï¼š<br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\n[\u@\h \l:$SHLVL:\!]\n$PWD\$ &#x27;</span><br><br><span class="hljs-comment"># ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œä»¥åŠå½“å‰å·¥ä½œç›®å½•ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;[\u@\h $? \w \$ &#x27;</span><br><br><span class="hljs-comment"># æ¢è¡Œç¬¦ã€ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåï¼Œä»¥åŠåå°ä½œä¸šæ•°ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\n[\u@\h jobs:\j]\n$PWD\$ &#x27;</span><br><br><span class="hljs-comment"># æ¢è¡Œç¬¦ã€ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€ç»ˆç«¯ã€shellå±‚çº§ã€å†å²ç¼–å·ã€ä½œä¸šæ•°é‡ã€bashç‰ˆæœ¬å·ï¼Œä»¥</span><br>åŠå®Œæ•´çš„å·¥ä½œç›®å½•ï¼š<br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\n[\u@\h t:\l l:$SHLVL h:\! j:\j v:\V]\n$PWD\$ &#x27;</span><br><br><span class="hljs-comment"># æ¢è¡Œç¬¦ã€ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€ä»£è¡¨ç»ˆç«¯çš„Tã€ä»£è¡¨shellå±‚çº§çš„Lã€ä»£è¡¨å‘½ä»¤ç¼–å·çš„Cï¼Œä»¥åŠ</span><br>ISO 8601æ ¼å¼çš„æ—¥æœŸå’Œæ—¶é—´ï¼š<br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\n[\u@\h:T\l:L$SHLVL:C\!:\D&#123;%Y-%m-%d_%H:%M:%S_%Z&#125;]\n$PWD\$ &#x27;</span><br><br><span class="hljs-comment"># ç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€æµ…è“è‰²çš„å½“å‰å·¥ä½œç›®å½•ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\[\033[1;34m\][\u@\h:\w]\$\[\033[0m\] &#x27;</span><br><br><span class="hljs-comment"># åœ¨xtermçš„æ ‡é¢˜æ å’Œæç¤ºç¬¦ä¸­åŒæ—¶æ˜¾ç¤ºç”¨æˆ·å@çŸ­æ ¼å¼ä¸»æœºåã€å½“å‰å·¥ä½œç›®å½•ï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\[\033]0;\u@\h:\w\007\][\u@\h:\w]\$ &#x27;</span><br><br><span class="hljs-comment"># åŒæ—¶æ›´æ–°é¢œè‰²å’Œxtermï¼š</span><br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&#x27;\[\033]0;\u@\h:\w\007\]\[\033[1;34m\][\u@\h:\w]\$\[\033[0m\] &#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®$CDPATH</strong></p><p>CDPATH æ˜¯ä¸€ä¸ªä»¥å†’å·ä¸ºåˆ†éš”ç¬¦çš„ç›®å½•åˆ—è¡¨ï¼Œç”¨ä½œå†…å»ºå‘½ä»¤ cd çš„æœç´¢è·¯å¾„â€‹ã€‚å¯ä»¥å°†å®ƒçœ‹ä½œ cd çš„ $PATHã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">CDPATH=<span class="hljs-string">&#x27;.:/etc:/usr&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨ä¼šè¯é—´åŒæ­¥shellå†å²è®°å½•</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°†å½“å‰å†å²è®°å½•è¿½åŠ åˆ°å†å²æ–‡ä»¶</span><br><span class="hljs-built_in">history</span> -a <br><br><span class="hljs-comment"># å°†å†å²è®°å½•è¯»å…¥å½“å‰shell</span><br><span class="hljs-built_in">history</span> -n<br><br>HISTTIMEFORMAT=<span class="hljs-string">&#x27;%Y-%m-%d_%H:%M:%S; &#x27;</span><br><br>HISTTIMEFORMAT=<span class="hljs-string">&#x27;: %Y-%m-%d_%H:%M:%S; &#x27;</span><br></code></pre></td></tr></table></figure><ol start="14"><li><strong>æ‰¹é‡è§£å‹ZIPæ–‡ä»¶</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">unzip <span class="hljs-string">&#x27;*.zip&#x27;</span><br><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> /path/to/date*/name/*.zip; <span class="hljs-keyword">do</span> unzip <span class="hljs-string">&quot;<span class="hljs-variable">$x</span>&quot;</span>; <span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">ls</span> /path/to/date*/name/*.zip 2&gt;/dev/null); <span class="hljs-keyword">do</span> unzip <span class="hljs-variable">$x</span>; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><ol start="15"><li><strong>è·å–æ–‡ä»¶å…ƒæ•°æ®</strong></li></ol><ul><li>(-path &#x2F;proc -o -pathâ€¦) -prune ç”¨äºå»é™¤å„ç§æ— å…³çš„ç›®å½•</li><li>printf æ ¼å¼ä»¥ d ä½œä¸ºå‰ç¼€ï¼Œç„¶åæ˜¯å…«è¿›åˆ¶æ¨¡å¼çš„æ–‡ä»¶æƒé™ã€ç”¨æˆ·åã€ç”¨æˆ·ç»„ç­‰ã€‚</li><li>-type l è¡¨ç¤ºæŸ¥æ‰¾ç¬¦å·é“¾æ¥å¹¶æ˜¾ç¤ºæ¯ä¸ªé“¾æ¥çš„æŒ‡å‘ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šarchive_meta-data</span><br><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%b&quot;</span> <span class="hljs-string">&quot;Mode\tUser\tGroup\tBytes\tModified\tFileSpec\n&quot;</span> &gt; archive_file<br>find / \( -path /proc -o -path /mnt -o -path /tmp -o -path /var/tmp \<br>  -o -path /var/cache -o -path /var/spool \) -prune \<br>  -o -<span class="hljs-built_in">type</span> d -<span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;d%m\t%u\t%g\t%s\t%t\t%p/\n&#x27;</span> \<br>  -o -<span class="hljs-built_in">type</span> l -<span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;l%m\t%u\t%g\t%s\t%t\t%p -&gt; %l\n&#x27;</span> \<br>  -o -<span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%m\t%u\t%g\t%s\t%t\t%p\n&#x27;</span> &gt;&gt; archive_file<br></code></pre></td></tr></table></figure><ol start="16"><li><strong>æŸ¥æ‰¾åªå‡ºç°åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹</strong></li></ol><p>å‘½ä»¤ grep -vf right left ä¸­ï¼Œ-f é€‰é¡¹å°†å‚æ•° right è§†ä¸ºæ¨¡å¼æ–‡ä»¶ï¼Œä»ä¸­æå–æ¨¡å¼ï¼ˆä¸€è¡Œä¸€ä¸ªæ¨¡å¼ï¼‰</p><p>uniq -u èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ–‡ä»¶ä¸­ç‹¬æœ‰çš„è¡Œ</p><p>uniq -d èƒ½å¤Ÿæ˜¾ç¤ºå‡ºåŒæ—¶åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­å‡ºç°çš„è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> left<br>record_01<br>record_02.left only<br>record_03<br>record_05.differ<br>record_06<br>record_07<br>record_08<br>record_09<br>record_10<br><br>$ <span class="hljs-built_in">cat</span> right<br>record_01<br>record_02<br>record_04<br>record_05<br>record_06.differ<br>record_07<br>record_08<br>record_09.right only<br>record_10<br><br><span class="hljs-comment"># ä»…æ˜¾ç¤ºå‡ºç°åœ¨æ–‡ä»¶leftä¸­çš„è¡Œ</span><br>$ <span class="hljs-built_in">comm</span> -23 left right<br>record_02.left only<br>record_03<br>record_05.differ<br>record_06<br>record_09<br><br><span class="hljs-comment"># ä»…æ˜¾ç¤ºå‡ºç°åœ¨æ–‡ä»¶rightä¸­çš„è¡Œ</span><br>$ <span class="hljs-built_in">comm</span> -13 left right<br>record_02<br>record_04<br>record_05<br>record_06.differ<br>record_09.right only<br><br><span class="hljs-comment"># ä»…æ˜¾ç¤ºåŒæ—¶å‡ºç°åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„è¡Œ</span><br>$ <span class="hljs-built_in">comm</span> -12 left right<br>record_01<br>record_07<br>record_08<br>record_10<br></code></pre></td></tr></table></figure><ol start="17"><li><strong>åœ¨ç›®å½•é—´å¿«é€Ÿç§»åŠ¨</strong></li></ol><ul><li>pushd</li><li>popd</li><li>dirs</li></ul><p>å¦‚æœå¯¹ä¸€ä¸ªæ–°ç›®å½•ä½¿ç”¨ pushdï¼Œé‚£ä¹ˆå®ƒä¼šå°†å‰ä¸€ä¸ªç›®å½•å‹å…¥æ ˆä¸­</p><p>å¦‚æœä½¿ç”¨ pushd æ—¶æ²¡æœ‰æŒ‡å®šç›®å½•ï¼Œé‚£ä¹ˆå®ƒä¼šäº¤æ¢æ ˆé¡¶çš„ä¸¤ä¸ªç›®å½•çš„ä½ç½®</p><p>å½“ä½¿ç”¨ popd æ—¶ï¼Œå®ƒä¼šå¼¹å‡ºæ ˆé¡¶ä¿å­˜çš„å½“å‰ä½ç½®ï¼Œåˆ‡æ¢åˆ°æ–°çš„æ ˆé¡¶ç›®å½•</p><p>å¦‚æœä¸è®°å¾—ç›®å½•æ ˆä¸­éƒ½æœ‰å“ªäº›ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨å†…å»ºå‘½ä»¤ dirs æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ˜¾ç¤ºã€‚åŠ ä¸Š -v é€‰é¡¹åï¼Œæ˜¾ç¤ºå½¢å¼æ›´å½¢è±¡ã€‚</p><p>pushd +2 ä¼šå°†ç¼–å·ä¸º 2 çš„ç›®å½•ç½®ä¸ºæ ˆé¡¶ï¼ˆå¹¶åˆ‡æ¢åˆ°è¯¥ç›®å½•ï¼‰å¹¶å°†å…¶ä»–ç›®å½•ä¸‹å‹ã€‚</p><p>è¦æƒ³çœ‹åˆ°ç±»ä¼¼äºæ ˆçš„ç›®å½•åˆ—è¡¨ï¼Œä½†åˆä¸å¸Œæœ›å‡ºç°ç¼–å·ï¼Œå¯ä»¥ä½¿ç”¨ -p é€‰é¡¹</p><ol start="18"><li><strong>å†å²å‘½ä»¤é‡ç”¨</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## é‡å¤ä¸Šä¸€æ¬¡å‘½ä»¤</span><br>!!<br><span class="hljs-comment">## é‡å¤ä¸Šä¸€æ¬¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°</span><br>!$<br><span class="hljs-comment">## é‡å¤ä¸Šä¸€æ¬¡å‘½ä»¤çš„ç¬¬1ä¸ªå‚æ•°</span><br>!:1<br><span class="hljs-comment">## é‡å¤ä¸Šä¸€æ¬¡å‘½ä»¤çš„ç¬¬2ä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨</span><br>!:2<br><br><span class="hljs-comment">## ä½¿ç”¨è„±å­—ç¬¦ï¼ˆ^ï¼‰æ›¿æ¢æœºåˆ¶</span><br>$ /usr/bin/somewhere/someprog -g -A -yknot -w /tmp/soforthandsoon<br>...<br>$ ^-g -A^-gB^<br>/usr/bin/somewhere/someprog -gB -yknot -w /tmp/soforthandsoon<br>...<br><br><span class="hljs-comment">## è¿›è¡Œå‘½ä»¤è¡Œå†…å®¹æ›¿æ¢æ—¶è¦ä»¥ ^ èµ·å§‹ï¼Œå½“ä½ æƒ³åœ¨å‘½ä»¤è¡Œæœ€åæ·»åŠ æ›´å¤šæ–‡æœ¬æ—¶ï¼Œç»“å°¾çš„ï¼ˆç¬¬ 3 ä¸ªï¼‰^æ‰æœ‰å¿…è¦ã€‚</span><br>$ /usr/bin/somewhere/someprog -g -A -yknot<br>...<br>$ ^-g -A^-gB^ /tmp^<br>/usr/bin/somewhere/someprog -gB -yknot /tmp<br>...<br><br><span class="hljs-comment">## è¦æƒ³åˆ é™¤éƒ¨åˆ†å†…å®¹å¹¶å°†å…¶æ›¿æ¢ä¸ºç©ºå€¼ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·åšã€‚</span><br>$ /usr/bin/somewhere/someprog -g -A -yknot /tmp<br>...<br>$ ^-g -A^^<br>/usr/bin/somewhere/someprog -yknot /tmp<br>...<br>$ ^knot^<br>/usr/bin/somewhere/someprog -gA -y /tmp<br>...<br>$<br><br><span class="hljs-comment">## ç”¨:æ›¿æ¢</span><br><span class="hljs-comment">## å¦‚æœæƒ³ä¿®æ”¹å‘½ä»¤è¡Œä¸­å‡ºç°çš„æ‰€æœ‰å®ä¾‹ï¼Œåˆ™éœ€è¦åœ¨ s ä¹‹å‰åŠ ä¸Š gï¼ˆä»¥è¡¨ç¤ºå…¨å±€æ›¿æ¢ï¼‰</span><br>$ /usr/bin/somewhere/someprog -g -H -yknot -w /tmp/soforthandsoon<br>Error: -H not recognized. Did you mean -A?<br>$ !!:s/H/A/<br>/usr/bin/somewhere/someprog -g -A -yknot -w /tmp/soforthandsoon<br>...<br>$ !!:gs/s/S/<br>/usr/bin/Somewhere/Someprog -g -S -yknotS -w /tmp/SoforthandSoon<br>...<br>$<br><br><span class="hljs-comment">## ä½¿ç”¨å†å²å‘½ä»¤æ—¶ï¼Œå¯ä»¥åŠ å…¥ :p ä¿®é¥°ç¬¦ï¼Œè¿™ä¼šä½¿å¾— bash åªè¾“å‡ºå‘½ä»¤</span><br>$ <span class="hljs-built_in">rm</span> !$:p<br><span class="hljs-built_in">rm</span> ?b1.txt<br>$<br></code></pre></td></tr></table></figure><p>fc å‘½ä»¤å¯ä»¥å°†æœ€è¿‘æ‰§è¡Œçš„å‘½ä»¤ï¼ˆæˆ–è€…ä¸€æ‰¹å‘½ä»¤ï¼‰ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè°ƒç”¨ç¼–è¾‘å™¨ï¼Œå¹¶å…è®¸ä½ æŒ‰ç…§é€‚åˆçš„æ–¹å¼ä¿®æ”¹å…¶ä¸­çš„å‘½ä»¤ï¼Œç„¶ååœ¨é€€å‡ºç¼–è¾‘å™¨æ—¶è‡ªåŠ¨é‡æ–°æ‰§è¡Œç¼–è¾‘è¿‡çš„å‘½ä»¤ã€‚</p><p>å¦‚æœè°ƒç”¨ fc æ—¶ä¸å¸¦å‚æ•°ï¼Œåˆ™åªä½¿ç”¨æœ€åä¸€è¡Œã€‚ä½ ä¹Ÿå¯ä»¥ç”¨å‚æ•°æŒ‡å®šæŸä¸€è¡Œï¼šfc 1004 ä¼šä½¿ç”¨å‘½ä»¤å†å²è®°å½•ä¸­ç¼–å·ä¸º1004 çš„å‘½ä»¤è¡Œï¼Œè€Œ fc -5 ä¼šä½¿ç”¨ç¬¬ 5 ä¸ªæœ€è¿‘çš„å‘½ä»¤ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šèŒƒå›´å‚æ•°ï¼Œä¾‹å¦‚ï¼Œfc 1001 1005 å…è®¸ç¼–è¾‘ç¼–å·ä¸º 1001 åˆ° 1005 çš„å‘½ä»¤è¡Œï¼Œfc -5 -1 å…è®¸ç¼–è¾‘æœ€è¿‘æ‰§è¡Œè¿‡çš„ 5 ä¸ªå‘½ä»¤ã€‚</p><p>å½“ä½ é€€å‡º fc å‘½ä»¤æ‰€è°ƒç”¨çš„ç¼–è¾‘å™¨æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œä¸´æ—¶æ–‡ä»¶ä¸­å‰©ä½™çš„æ‰€æœ‰å‘½ä»¤ï¼Œå³ä½¿æœªåšä»»ä½•æ”¹åŠ¨ï¼Œè¿™æ—¶å¯ä»¥åˆ é™¤æ–‡ä»¶ä¸­çš„æ‰€æœ‰å‘½ä»¤è¡Œï¼Œä¿å­˜å¹¶é€€å‡ºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux curl åŸºç¡€ç”¨æ³•</title>
    <link href="/2024/08/14/curl-action/"/>
    <url>/2024/08/14/curl-action/</url>
    
    <content type="html"><![CDATA[<h1 id="Curl-åŸºç¡€ç”¨æ³•"><a href="#Curl-åŸºç¡€ç”¨æ³•" class="headerlink" title="Curl åŸºç¡€ç”¨æ³•"></a>Curl åŸºç¡€ç”¨æ³•</h1><p>curl æ˜¯ä¸€ä¸ªå¾ˆå…¨é¢çš„å‘½ä»¤è¡Œæµè§ˆå™¨ï¼ŒåŠŸèƒ½ä¸°å¯Œ</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><ul><li><p>-f&#x2F;â€“fail  åœ¨ HTTP é”™è¯¯æ—¶è¿”å›éé›¶çŠ¶æ€ç ï¼Œ echo $?, ä¸ç”¨-få³ä½¿HTTPé”™è¯¯çŠ¶æ€ç ä¹Ÿä¸º0</p></li><li><p>-s   é™é»˜è¾“å‡º</p></li><li><p>-S   è¾“å‡ºé”™è¯¯æ¶ˆæ¯ï¼Œé…åˆsä½¿ç”¨ï¼Œ-sSï¼Œé™é»˜è¾“å‡ºçŠ¶æ€ä¸‹ä¹Ÿè¾“å‡ºé”™è¯¯æ¶ˆæ¯</p><p>  -sSf è¿”å›é”™è¯¯çŠ¶æ€ç  å¦‚ï¼šcurl: (22) The requested URL returned error: 400</p><p>  ä¸åŠ Sä¸ä¼šæ˜¾ç¤ºé”™è¯¯è¾“å‡º</p></li><li><p>-k  å¿½ç•¥SSLè¯ä¹¦éªŒè¯</p></li><li><p>â€“connect-timeout: è®¾ç½®è¿æ¥è¶…æ—¶çš„ç§’æ•°ã€‚è¿™æ˜¯æŒ‡ä»å¼€å§‹è¯·æ±‚åˆ°å®Œæˆ TCP è¿æ¥çš„æ—¶é—´é™åˆ¶ã€‚å¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•å»ºç«‹è¿æ¥ï¼Œcurl å°†ä¼šä¸­æ­¢ã€‚</p></li><li><p>â€“max-time: è®¾ç½®æ•´ä¸ªè¯·æ±‚çš„æœ€å¤§æ—¶é—´ï¼ˆåŒ…æ‹¬è¿æ¥æ—¶é—´ã€ä¼ è¾“æ—¶é—´ç­‰ï¼‰ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œcurl å°†ä¸­æ­¢è¯·æ±‚ã€‚</p></li><li><p>-H æ·»åŠ header</p></li><li><p>-X GET&#x2F;POST  æŒ‡å®šè¯·æ±‚æ–¹æ³•</p></li><li><p>-u username:passwd  æŒ‡å®šè´¦å·å¯†ç </p></li><li><p>-d å‘é€POSTè¯·æ±‚æ—¶é™„å¸¦çš„æ•°æ®</p></li><li><p>-v è¯¦ç»†æ¨¡å¼å‘é€è¯·æ±‚</p></li><li><p>-o å°†ä¸‹è½½çš„æ–‡ä»¶ä¿å­˜ä¸ºæŒ‡å®šæ–‡ä»¶å</p></li><li><p>-O ä¿å­˜ä¸ºåŸå§‹æ–‡ä»¶å</p></li><li><p>-F ä¸Šä¼ æ–‡ä»¶  headerä½¿ç”¨ Content-Type multipart&#x2F;form-data</p></li><li><p>-C æ–­ç‚¹ç»­ä¼ </p></li><li><p>-I æ˜¾ç¤ºå“åº”ç åŠæºç </p></li><li><p>-i åªæ˜¾ç¤ºå“åº”ç </p></li><li><p>-c è®°å½•cookieæˆ–session</p></li><li><p>-b è¯·æ±‚æ—¶ä½¿ç”¨æºå¸¦çš„cookie</p></li></ul><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># postè¯·æ±‚æºå¸¦å‚æ•°</span><br>curl -X POST -d <span class="hljs-string">&quot;key=value&quot;</span> http://127.0.0.1<br><br><span class="hljs-comment"># json æ ¼å¼è¯·æ±‚</span><br>curl -X POST -d <span class="hljs-string">&#x27;&#123;&quot;key&quot;: &quot;value&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> http://127.0.0.1<br><br><span class="hljs-comment"># è®¿é—® httpsæ—¶å¿½ç•¥è¯ä¹¦ </span><br>curl -sSfL -k https://127.0.0.1<br><br><span class="hljs-comment"># è®°å½•è¿”å›çš„cookie</span><br>curl -c cookies.txt -X POST -d <span class="hljs-string">&#x27;&#123;&quot;key&quot;: &quot;value&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> http://127.0.0.1<br><br><span class="hljs-comment"># è¯·æ±‚æ—¶æºå¸¦æ–‡ä»¶ä¸­çš„cookieå€¼</span><br>curl -b cookies.txt -X POST -d <span class="hljs-string">&#x27;&#123;&quot;key&quot;: &quot;value&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> http://127.0.0.1<br><br><span class="hljs-comment"># è¡¨å•ä¸Šä¼ æ–‡ä»¶</span><br>curl -X POST -F <span class="hljs-string">&quot;files=@/path/to/local/file&quot;</span> http://127.0.0.1/upload-files<br><br><span class="hljs-comment"># å¦‚æœè¯·æ±‚è¿”å›æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œ</span><br>curl -s http://127.0.0.1 -O- | bash<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºDockeræœ¬åœ°ä»“åº“</title>
    <link href="/2024/08/11/docker-local-registry/"/>
    <url>/2024/08/11/docker-local-registry/</url>
    
    <content type="html"><![CDATA[<h1 id="æ­å»ºDockeræœ¬åœ°ä»“åº“"><a href="#æ­å»ºDockeræœ¬åœ°ä»“åº“" class="headerlink" title="æ­å»ºDockeræœ¬åœ°ä»“åº“"></a>æ­å»ºDockeræœ¬åœ°ä»“åº“</h1><p>å‰æ</p><ul><li>å®‰è£… docker</li><li>ç†Ÿæ‚‰ dockerç¯å¢ƒåŠåŸºæœ¬æ“ä½œ</li></ul><blockquote><p>äºŒè¿›åˆ¶åŒ…éƒ¨ç½²ï¼š<a href="https://download.docker.com/linux/static/stable/x86_64/">https://download.docker.com/linux/static/stable/x86_64/</a></p></blockquote><h2 id="å®¹å™¨åŒ–éƒ¨ç½²"><a href="#å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="å®¹å™¨åŒ–éƒ¨ç½²"></a>å®¹å™¨åŒ–éƒ¨ç½²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è”ç½‘ç¯å¢ƒä¸‹</span><br><span class="hljs-comment"># ç›´æ¥è¿è¡Œ registryé•œåƒï¼Œæœ¬åœ°æ²¡æœ‰ä¼šè‡ªåŠ¨æ‹‰å–</span><br>docker run -d -p 5000:5000 --name registry registry:2<br><br><span class="hljs-comment"># å†…ç½‘ç¯å¢ƒ</span><br><span class="hljs-comment"># ä¸‹è½½å¯¹åº”é•œåƒ taråŒ…ä¼ å…¥å†…ç½‘ç¯å¢ƒ</span><br><span class="hljs-comment"># åªæœ‰ç”¨saveçš„é•œåƒæ‰èƒ½loadå¯¼å…¥ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span><br>docker save registry:2 -o registry.tar<br>docker load -i registry.tar<br><br><span class="hljs-comment"># ä¹Ÿå¯å°†è¿è¡Œå®¹å™¨å¯¼å‡º</span><br>docker <span class="hljs-built_in">export</span> å®¹å™¨ID &gt; registry.tar<br><span class="hljs-comment"># å°†æ‰“åŒ…å®¹å™¨å¯¼å…¥</span><br><span class="hljs-comment"># ç”¨exportå¯¼å‡ºçš„å®¹å™¨ï¼Œéœ€è¦ç”¨importå¯¼å…¥</span><br>docker import registry.tar localhost/registry:2<br><br><span class="hljs-comment">## éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</span><br><span class="hljs-comment">## è¿”å› &#123;&#125;è¡¨ç¤ºæˆåŠŸ</span><br>curl -s http://localhost:5000/v2/<br></code></pre></td></tr></table></figure><h2 id="æ¨é€é•œåƒåˆ°æœ¬åœ°ä»“åº“"><a href="#æ¨é€é•œåƒåˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="æ¨é€é•œåƒåˆ°æœ¬åœ°ä»“åº“"></a>æ¨é€é•œåƒåˆ°æœ¬åœ°ä»“åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## ä¿®æ”¹é•œåƒtagä¸ºæœ¬åœ°ä»“åº“åœ°å€</span><br>docker tag <span class="hljs-variable">$image</span> localhost:5000/<span class="hljs-variable">$image</span><br><br><span class="hljs-comment">## æ¨é€åˆ°æœ¬åœ°ä»“åº“</span><br>docker push localhost:5000/<span class="hljs-variable">$image</span><br><br><span class="hljs-comment">## æ‹‰å–æœ¬åœ°ä»“åº“é•œåƒ</span><br>docker pull localhost:5000/<span class="hljs-variable">$image</span><br></code></pre></td></tr></table></figure><h2 id="æŒä¹…åŒ–å­˜å‚¨é•œåƒ"><a href="#æŒä¹…åŒ–å­˜å‚¨é•œåƒ" class="headerlink" title="æŒä¹…åŒ–å­˜å‚¨é•œåƒ"></a>æŒä¹…åŒ–å­˜å‚¨é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 5000:5000 --name registry -v /home/registry:/var/lib/registry registry:2<br></code></pre></td></tr></table></figure><h2 id="é…ç½®æœ¬åœ°ä»“åº“HTTPS"><a href="#é…ç½®æœ¬åœ°ä»“åº“HTTPS" class="headerlink" title="é…ç½®æœ¬åœ°ä»“åº“HTTPS"></a>é…ç½®æœ¬åœ°ä»“åº“HTTPS</h2><p>å¯ä»¥é€‰æ‹©ç”Ÿæˆè‡ªç­¾åè¯ä¹¦æˆ–ä½¿ç”¨å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ (CA) ç­¾å‘çš„è¯ä¹¦ã€‚</p><h3 id="ç”Ÿæˆè‡ªç­¾åè¯ä¹¦"><a href="#ç”Ÿæˆè‡ªç­¾åè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè‡ªç­¾åè¯ä¹¦"></a>ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</h3><ul><li><code>-newkey rsa:4096</code>ï¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ RSA ç§é’¥å’Œè¯ä¹¦è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ 4096 ä½çš„å¯†é’¥é•¿åº¦</li><li><code>-nodes</code>ï¼šæŒ‡å®šä¸å¯¹ç”Ÿæˆçš„ç§é’¥è¿›è¡ŒåŠ å¯†ã€‚å¦‚æœä¸ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œéœ€è¦ä¸ºç§é’¥è®¾ç½®ä¸€ä¸ªå¯†ç ã€‚å¯¹äºè‡ªåŠ¨åŒ–ä½¿ç”¨ï¼Œé€šå¸¸ä¸è®¾ç½®å¯†ç ã€‚</li><li><code>-sha256</code>ï¼šä½¿ç”¨ SHA-256 å“ˆå¸Œç®—æ³•æ¥ç”Ÿæˆè¯ä¹¦ã€‚</li><li><code>-keyout certs/domain.key</code>ï¼šæŒ‡å®šç”Ÿæˆçš„ç§é’¥æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚</li><li><code>-x509</code>ï¼šè¡¨ç¤ºç”Ÿæˆè‡ªç­¾åçš„ X.509 è¯ä¹¦ã€‚X.509 æ˜¯ä¸€ç§æ ‡å‡†æ ¼å¼ï¼Œç”¨äºå…¬é’¥è¯ä¹¦ã€‚</li><li><code>-days 365</code>ï¼šè®¾ç½®è¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 365 å¤©ï¼Œè¿‡æœŸåéœ€è¦æ›´æ–°ã€‚</li><li><code>-out certs/domain.crt</code>ï¼šæŒ‡å®šç”Ÿæˆçš„è‡ªç­¾åè¯ä¹¦æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /etc/certs<br><br>openssl req -newkey rsa:4096 -nodes -sha256 -keyout /etc/certs/domain.key -x509 -days 365 -out /etc/certs/domain.crt<br><span class="hljs-comment">## è¿è¡Œå®Œä¼šæç¤ºéœ€è¦è¾“å…¥ä¸€äº›ä¿¡æ¯</span><br><span class="hljs-comment">## Common Nameæ˜¯æœ€é‡è¦çš„ä¸€ä¸ª</span><br><span class="hljs-comment"># éœ€è¦å¡«å†™æœåŠ¡å™¨çš„å®Œå…¨é™å®šåŸŸå (FQDN) æˆ– IP åœ°å€ã€‚</span><br><span class="hljs-comment"># å¦‚æœä¸º Registry é…ç½® HTTPSï¼Œå¿…é¡»åŒ¹é…å®¢æˆ·ç«¯å°†ç”¨æ¥è®¿é—®æœåŠ¡å™¨çš„åŸŸåæˆ– IP åœ°å€</span><br><span class="hljs-comment"># æ¯”å¦‚æœ¬åœ°localhostæˆ–è€…127.0.0.1</span><br></code></pre></td></tr></table></figure><h3 id="registry-é…ç½®HTTPS"><a href="#registry-é…ç½®HTTPS" class="headerlink" title="registry é…ç½®HTTPS"></a>registry é…ç½®HTTPS</h3><ul><li><code>REGISTRY_HTTP_ADDR=0.0.0.0:443</code>ï¼šé…ç½® Registry ç›‘å¬ HTTPS è¯·æ±‚</li><li><code>REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt</code>ï¼šæŒ‡å®š SSL è¯ä¹¦è·¯å¾„</li><li><code>REGISTRY_HTTP_TLS_KEY=/certs/domain.key</code>ï¼šæŒ‡å®š SSL ç§é’¥è·¯å¾„</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  -p 443:443 \<br>  --name registry \<br>  -v /etc/certs:/certs \<br>  -v /home/registry:/var/lib/registry \<br>  -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \<br>  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \<br>  -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \<br>  registry:2<br></code></pre></td></tr></table></figure><h3 id="é…ç½®-Docker-å®¢æˆ·ç«¯ä¿¡ä»»è‡ªç­¾åè¯ä¹¦"><a href="#é…ç½®-Docker-å®¢æˆ·ç«¯ä¿¡ä»»è‡ªç­¾åè¯ä¹¦" class="headerlink" title="é…ç½® Docker å®¢æˆ·ç«¯ä¿¡ä»»è‡ªç­¾åè¯ä¹¦"></a>é…ç½® Docker å®¢æˆ·ç«¯ä¿¡ä»»è‡ªç­¾åè¯ä¹¦</h3><p>å¦‚æœä½¿ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ï¼ŒDocker å®¢æˆ·ç«¯é»˜è®¤ä¸ä¼šä¿¡ä»»ä½ ç”Ÿæˆçš„è¯ä¹¦ã€‚</p><p>éœ€è¦å°†è¯ä¹¦æ·»åŠ åˆ° Docker çš„ä¿¡ä»»åˆ—è¡¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## ä¹‹å‰ç”Ÿæˆè¯ä¹¦ common nameå¡«çš„ localhostï¼Œå› æ­¤åœ¨æ­¤å¤„åˆ›å»ºlocalhost</span><br><span class="hljs-built_in">mkdir</span> -p /etc/docker/certs.d/localhost<br><span class="hljs-built_in">cp</span> /etc/certs/domain.crt /etc/docker/certs.d/localhost/ca.crt<br></code></pre></td></tr></table></figure><h3 id="é…ç½®å®¢æˆ·ç«¯çš„-insecure-registries"><a href="#é…ç½®å®¢æˆ·ç«¯çš„-insecure-registries" class="headerlink" title="é…ç½®å®¢æˆ·ç«¯çš„ insecure-registries"></a>é…ç½®å®¢æˆ·ç«¯çš„ insecure-registries</h3><p>å¦‚æœä¸æƒ³é…ç½®è¯ä¹¦ï¼Œå¯ä»¥å°† Registry é…ç½®ä¸º insecure-registryï¼Œä½†ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;insecure-registries&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;localhost&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>é‡å¯dockerå³å¯ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -sSL -k https://localhost:443/v2/<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åå‘ä»£ç†"><a href="#ä½¿ç”¨åå‘ä»£ç†" class="headerlink" title="ä½¿ç”¨åå‘ä»£ç†"></a>ä½¿ç”¨åå‘ä»£ç†</h3><p>å¯ä»¥ä½¿ç”¨åå‘ä»£ç†æ¥å¤„ç† HTTPSï¼Œè€Œ Registryç»§ç»­ä½¿ç”¨ HTTP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen 443 ssl;<br>    server_name yourdomain.com;<br><br>    ssl_certificate /etc/nginx/certs/domain.crt;<br>    ssl_certificate_key /etc/nginx/certs/domain.key;<br><br>    location / &#123;<br>        proxy_pass http://localhost:5000;<br>        # å®¹å™¨åŒ–éƒ¨ç½²æ—¶æ”¹ä¸ºå®¹å™¨å <br>        proxy_pass http://registry:5000;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å®¹å™¨åŒ– nginxåå‘ä»£ç†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆ›å»ºä¸€ä¸ª bridgeç½‘ç»œ</span><br>docker create network proxy_network<br><span class="hljs-comment">## å¯åŠ¨æ—¶ nginxå’Œ registryä¸¤ä¸ªå®¹å™¨éƒ½æŒ‡å®š proxy_network ç½‘ç»œ</span><br>docker run -d --name nginx --network proxy_network -p 443:443 -v ~/nginx.conf:/etc/nginx/nginx.conf -v /etc/certs/:/etc/nginx/certs nginx:latest<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®ä»“åº“ç™»é™†è®¤è¯"><a href="#è®¾ç½®ä»“åº“ç™»é™†è®¤è¯" class="headerlink" title="è®¾ç½®ä»“åº“ç™»é™†è®¤è¯"></a>è®¾ç½®ä»“åº“ç™»é™†è®¤è¯</h2><h3 id="å®‰è£…-htpasswd"><a href="#å®‰è£…-htpasswd" class="headerlink" title="å®‰è£… htpasswd"></a>å®‰è£… htpasswd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get install apache2-utils<br><span class="hljs-built_in">sudo</span> yum install httpd-tools<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºè®¤è¯æ–‡ä»¶"><a href="#åˆ›å»ºè®¤è¯æ–‡ä»¶" class="headerlink" title="åˆ›å»ºè®¤è¯æ–‡ä»¶"></a>åˆ›å»ºè®¤è¯æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /etc/auth<br>htpasswd -Bc /etc/auth/htpasswd myuser<br><span class="hljs-comment">## -Bï¼šä½¿ç”¨ bcrypt åŠ å¯†ç®—æ³•</span><br><span class="hljs-comment">## -cï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</span><br><span class="hljs-comment">## /etc/auth/htpasswdï¼šä¿å­˜ç”¨æˆ·åå’Œå¯†ç çš„æ–‡ä»¶è·¯å¾„ã€‚</span><br><br><span class="hljs-comment">## å¦‚æœéœ€è¦æ·»åŠ æ›´å¤šç”¨æˆ·ï¼Œä¸åŠ  -c</span><br>htpasswd -B /etc/auth/htpasswd anotheruser<br></code></pre></td></tr></table></figure><h3 id="é…ç½®-Registryç™»é™†è®¤è¯"><a href="#é…ç½®-Registryç™»é™†è®¤è¯" class="headerlink" title="é…ç½® Registryç™»é™†è®¤è¯"></a>é…ç½® Registryç™»é™†è®¤è¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  -p 5000:5000 \<br>  --name registry \<br>  -v /etc/auth:/auth \<br>  -e <span class="hljs-string">&quot;REGISTRY_AUTH=htpasswd&quot;</span> \<br>  -e <span class="hljs-string">&quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot;</span> \<br>  -e <span class="hljs-string">&quot;REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd&quot;</span> \<br>  -v /home/registry:/var/lib/registry \<br>  registry:2<br><span class="hljs-comment"># REGISTRY_AUTH=htpasswdï¼šå¯ç”¨ htpasswd è®¤è¯</span><br><span class="hljs-comment"># REGISTRY_AUTH_HTPASSWD_REALM=Registry Realmï¼šè®¾ç½®è®¤è¯é¢†åŸŸï¼ˆå¯ä»¥éšæ„è®¾å®šï¼‰</span><br><span class="hljs-comment"># REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswdï¼šæŒ‡å®š htpasswd æ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><br><span class="hljs-comment">## éªŒè¯</span><br>docker login localhost:5000<br></code></pre></td></tr></table></figure><h2 id="é€šè¿‡apiæŸ¥çœ‹æœ¬åœ°é•œåƒ"><a href="#é€šè¿‡apiæŸ¥çœ‹æœ¬åœ°é•œåƒ" class="headerlink" title="é€šè¿‡apiæŸ¥çœ‹æœ¬åœ°é•œåƒ"></a>é€šè¿‡apiæŸ¥çœ‹æœ¬åœ°é•œåƒ</h2><blockquote><p>api è¿”å›çš„ä¿¡æ¯ä¸º jsonæ ¼å¼ï¼Œå¯ä»¥é…åˆlinuxçš„ <code>jq</code>å‘½ä»¤è¿›è¡Œç­›é€‰æŸ¥çœ‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## è·å–æ‰€æœ‰é•œåƒçš„åç§°</span><br>curl -sSL -k http://localhost:5000/v2/_catalog | jq<br><br><span class="hljs-comment">## è¿”å›è¾“å‡º</span><br>&#123;<br>  <span class="hljs-string">&quot;repositories&quot;</span>: [<br>    <span class="hljs-string">&quot;my-image1&quot;</span>,<br>    <span class="hljs-string">&quot;my-image2&quot;</span><br>  ]<br>&#125;<br><br><span class="hljs-comment">## è®¾ç½®è®¤è¯åéœ€è¦ä¿®æ”¹ä¸ºå¦‚ä¸‹å‘½ä»¤ï¼Œé…åˆ jqä½¿ç”¨æå–ä¿¡æ¯ </span><br>curl -sSL -k -u <span class="hljs-variable">$username</span>:<span class="hljs-variable">$passwd</span> http://127.0.0.1:5000/v2/_catalog |jq -r <span class="hljs-string">&quot;.repositories[]&quot;</span><br><br><span class="hljs-comment">## è·å–æ¯ä¸ªé•œåƒçš„æ ‡ç­¾</span><br>curl http://localhost:5000/v2/<span class="hljs-variable">$image</span>/tags/list<br>curl -sSL -k -u <span class="hljs-variable">$username</span>:<span class="hljs-variable">$passwd</span> http://127.0.0.1:5000/v2/<span class="hljs-variable">$image</span>/tags/list<br><br><span class="hljs-comment">## é•œåƒçš„æ–°ç‰ˆæœ¬ä¼šé å‰æ˜¾ç¤º</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;my-image1&quot;</span>,<br>  <span class="hljs-string">&quot;tags&quot;</span>: [<br>    <span class="hljs-string">&quot;latest&quot;</span>,<br>    <span class="hljs-string">&quot;v2.0&quot;</span>,<br>    <span class="hljs-string">&quot;v1.0&quot;</span><br>  ]<br>&#125;<br><br><span class="hljs-comment">## è·å– digestä¿¡æ¯</span><br>curl -u <span class="hljs-variable">$username</span>:<span class="hljs-variable">$passwd</span> -sSL -H <span class="hljs-string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> http://127.0.0.1:5000/v2/<span class="hljs-variable">$image</span>/manifests/<span class="hljs-variable">$tag</span> | jq -r <span class="hljs-string">&quot;.config.digest&quot;</span><br><br><span class="hljs-comment">## é€šè¿‡deleteæ–¹æ³•åˆ é™¤å¯¹åº”é•œåƒçš„ tag</span><br>curl -sSLf -k -X DELETE -u <span class="hljs-variable">$username</span>:<span class="hljs-variable">$passwd</span> http://127.0.0.1:5000/v2/<span class="hljs-variable">$image</span>/manifests/<span class="hljs-variable">$digest</span><br><br><span class="hljs-comment">## æ¸…ç†æœªè¢«å¼•ç”¨çš„blobs</span><br>registry garbage-collect -m /etc/docker/registry/config.yml<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell å®ç”¨æŠ€å·§ï¼ˆäºŒï¼‰</title>
    <link href="/2024/08/07/shell-action-2/"/>
    <url>/2024/08/07/shell-action-2/</url>
    
    <content type="html"><![CDATA[<h2 id="Shell-å®ç”¨æŠ€å·§"><a href="#Shell-å®ç”¨æŠ€å·§" class="headerlink" title="Shell å®ç”¨æŠ€å·§"></a>Shell å®ç”¨æŠ€å·§</h2><ol><li><strong>åˆ›å»ºç®€å•çš„èœå•</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šdbinit.1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">## ä¿®æ”¹æç¤ºç¬¦</span><br><span class="hljs-comment">## PS1 å‘½ä»¤è¡Œæç¤ºç¬¦</span><br><span class="hljs-comment">## PS2 ç»­è¡Œæç¤ºç¬¦</span><br><span class="hljs-comment">## PS3 selectæç¤ºç¬¦</span><br>DBLIST=$(sh ./listdb | <span class="hljs-built_in">tail</span> -n +2)<br><br>PS3=<span class="hljs-string">&quot;0 inits &gt;&quot;</span><br><br><span class="hljs-keyword">select</span> DB <span class="hljs-keyword">in</span> <span class="hljs-variable">$DBLIST</span><br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$DB</span> ]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> Initializing database: <span class="hljs-variable">$DB</span><br><br>        PS3=<span class="hljs-string">&quot;<span class="hljs-subst">$((++i)</span>) inits&gt; &quot;</span><br><br>        mysql -u user -p <span class="hljs-variable">$DB</span> &lt;myinit.sql<br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><ol start="2"><li><strong>ç®€å•çš„RPNè®¡ç®—å™¨</strong><blockquote><p>6RPNï¼ˆReverse Polish notationï¼Œé€†æ³¢å…°è¡¨ç¤ºæ³•æˆ–é€†æ³¢å…°è®°æ³•ï¼‰æ˜¯ä¸€ç§ç”±æ³¢å…°æ•°å­¦å®¶æ‰¬ â€¢ æ­¦å¡è°¢ç»´å¥‡äº1920 å¹´å¼•å…¥çš„æ•°å­¦è¡¨è¾¾å¼æ–¹å¼ã€‚åœ¨é€†æ³¢å…°è®°æ³•ä¸­ï¼Œæ‰€æœ‰è¿ç®—ç¬¦éƒ½ç½®äºæ“ä½œæ•°çš„åé¢ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºåç¼€è¡¨ç¤ºæ³•ã€‚é€†æ³¢å…°è®°æ³•ä¸éœ€è¦æ‹¬å·æ¥æ ‡è¯†è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ã€‚</p></blockquote></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šrpncalc</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ç®€å•çš„RPNå‘½ä»¤è¡Œï¼ˆæ•´æ•°ï¼‰è®¡ç®—å™¨</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># è·å–ç”¨æˆ·æä¾›çš„å‚æ•°å¹¶è®¡ç®—</span><br><span class="hljs-comment"># å‚æ•°å½¢å¼ä¸ºï¼ša bè¿ç®—ç¬¦</span><br><span class="hljs-comment"># å…è®¸ä½¿ç”¨*x*ä»£æ›¿*</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># æ£€æŸ¥å‚æ•°æ•°é‡ï¼š</span><br><span class="hljs-keyword">if</span> [ \( <span class="hljs-variable">$#</span> -lt 3 \) -o \( $((<span class="hljs-variable">$#</span> % <span class="hljs-number">2</span>)) -eq 0 \) ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;usage: calc number number op [ number op ] ...&quot;</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;use x or &#x27;*&#x27; for multiplication&quot;</span><br>    <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br>ANS=$((<span class="hljs-variable">$1</span> <span class="hljs-variable">$&#123;3//x/*&#125;</span> <span class="hljs-variable">$2</span>))<br><span class="hljs-built_in">shift</span> 3<br><span class="hljs-keyword">while</span> [ <span class="hljs-variable">$#</span> -gt 0 ]<br><span class="hljs-keyword">do</span><br>    <span class="hljs-comment"># åœ¨ $(( )) ä¸­ï¼Œé™¤äº†ä½ç½®å‚æ•°ï¼ˆå¦‚ $1ã€$2ï¼‰â€‹ï¼Œå˜é‡åå‰é¢å¹¶ä¸éœ€è¦åŠ  $</span><br>    ANS=$((ANS <span class="hljs-variable">$&#123;2//x/*&#125;</span> <span class="hljs-variable">$1</span>))<br>    <span class="hljs-built_in">shift</span> 2<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ANS</span><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>æµ®ç‚¹æ•°è®¡ç®—</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šfunc_calc</span><br><br><span class="hljs-comment"># ç®€å•çš„å‘½ä»¤è¡Œè®¡ç®—å™¨</span><br><span class="hljs-keyword">function</span> calc &#123;<br>    <span class="hljs-comment"># ä»…é€‚ç”¨äºæ•´æ•°ï¼--&gt; echo The answer is: $(( $* ))</span><br>    <span class="hljs-comment"># æµ®ç‚¹æ•°</span><br>    awk <span class="hljs-string">&quot;BEGIN &#123;print \&quot;The answer is: \&quot; $* &#125;&quot;</span>;<br>&#125; <span class="hljs-comment"># å‡½æ•°calcå®šä¹‰å®Œæ¯•</span><br></code></pre></td></tr></table></figure><ol start="4"><li><p><strong>æ­£åˆ™æ¨¡å¼</strong></p><ul><li><code>.</code>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</li><li>æ˜Ÿå·<code>*</code>åŒ¹é…ä¸Šä¸€ä¸ªå­—ç¬¦çš„ 0 æ¬¡æˆ–å¤šæ¬¡å‡ºç°<ul><li><code>.*</code> åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦,ç”šè‡³æ˜¯ç©ºè¡Œ</li><li><code>..*</code> åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ä»¥åŠç´§éšå…¶åçš„ 0 ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦,ä¹Ÿå°±æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œä½†ä¸èƒ½æ˜¯ç©ºè¡Œ</li></ul></li><li>è„±å­—ç¬¦ <code>^</code> åŒ¹é…æ–‡æœ¬è¡Œçš„è¡Œé¦–ä½ç½®</li><li>ç¾å…ƒç¬¦å· <code>$</code> åŒ¹é…æ–‡æœ¬è¡Œçš„è¡Œå°¾ä½ç½®ï¼Œå› æ­¤ <code>^$</code> åŒ¹é…ç©ºè¡Œ</li><li>æ–¹æ‹¬å·<code>[]</code>ä¸­çš„ä¸€ç»„å­—ç¬¦åŒ¹é…å…¶ä¸­ä»»æ„æŸä¸ªå­—ç¬¦</li><li>å¦‚æœæ–¹æ‹¬å·å†…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯è„±å­—ç¬¦<code>[^abcd]</code>ï¼Œåˆ™åŒ¹é…çš„æ˜¯<strong>ä¸åœ¨è¯¥å­—ç¬¦ç»„ä¸­çš„</strong>ä»»æ„å­—ç¬¦</li><li><code>&#123;&#125;</code> åŒºé—´è¡¨è¾¾å¼<ul><li><code>\&#123;n,m\&#125;</code>n æ˜¯é‡å¤çš„æœ€å°æ¬¡æ•°ï¼Œm æ˜¯é‡å¤çš„æœ€å¤§æ¬¡æ•°</li><li><code>\&#123;n\&#125;</code>ï¼Œåˆ™è¡¨ç¤ºâ€œåªé‡å¤ n æ¬¡â€â€‹</li><li><code>\&#123;n,\&#125;</code>ï¼Œåˆ™è¡¨ç¤ºâ€œè‡³å°‘é‡å¤ n æ¬¡â€â€‹</li></ul></li></ul></li><li><p><strong>æœç´¢å‹ç¼©æ–‡ä»¶</strong></p><ul><li>zcat</li><li>zgrep</li></ul></li><li><p><strong>awk</strong></p><ul><li><p>åè½¬æ¯è¡Œå•è¯</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ awk <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    for (i=NF; i&gt;=0; i--) &#123;</span><br><span class="hljs-string">        printf &quot;%s &quot;, $i;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    printf &quot;\n&quot;</span><br><span class="hljs-string">&#125;&#x27;</span> &lt;filename&gt;<br></code></pre></td></tr></table></figure></li><li><p>æ±‡æ€»æ•°å­—åˆ—è¡¨</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## next å‘½ä»¤ï¼Œå®ƒä¼šåœæ­¢å¤„ç†è¯¥è¾“å…¥è¡Œï¼Œå¹¶ä»ä¸‹ä¸€è¡Œè¾“å…¥é‡æ–°å¼€å§‹</span><br><span class="hljs-built_in">ls</span> -l | awk <span class="hljs-string">&#x27;/^total/&#123;next&#125; &#123;sum += $5&#125;; END &#123;print sum&#125;&#x27;</span><br><br><span class="hljs-comment">## tail +2 å¯å®ç°åŒæ ·çš„æ•ˆæœ</span><br><span class="hljs-built_in">ls</span> -l | <span class="hljs-built_in">tail</span> +2 | awk <span class="hljs-string">&#x27;/^total/&#123;next&#125; &#123;sum += $5&#125;; END &#123;print sum&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°</p>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/usr/bin/awk -f</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šasar.awk</span><br><span class="hljs-comment"># Awkå…³è”æ•°ç»„</span><br><span class="hljs-comment"># ç”¨æ³•ï¼šls -lR /usr/local | asar.awk</span><br><br>NF &gt; <span class="hljs-number">7</span> &#123;<br>    <span class="hljs-comment">## å˜é‡åˆå§‹ä¸ºç©º</span><br>    <span class="hljs-comment">## ++ å˜ä¸º 1</span><br>    user[<span class="hljs-variable">$3</span>]++<br>&#125;<br><br><span class="hljs-keyword">END</span> &#123;<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> user) &#123;<br>        printf <span class="hljs-string">&quot;%s owns %d files\n&quot;</span>, i, user[i]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -lR /usr/local | awk -f asar.awk<br>bin owns 68 files<br>albing owns 1801 files<br>root owns 13755 files<br>man owns 11491 files<br>$<br></code></pre></td></tr></table></figure></li><li><p>è¾“å‡ºç›´æ–¹å›¾</p>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#!/usr/bin/awk -f</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šhist.awk</span><br><span class="hljs-comment"># ç”¨Awkç”Ÿæˆç›´æ–¹å›¾</span><br><span class="hljs-comment"># ç”¨æ³•ï¼šls -lR /usr/local | hist.awk</span><br><br><span class="hljs-keyword">function</span> max(arr, big)<br>&#123;<br>    big = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> user)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (user[i] &gt; big) &#123; big=user[i];&#125;<br>    &#125;<br>    return big<br>&#125;<br><br>NF &gt; <span class="hljs-number">7</span> &#123;<br>    user[<span class="hljs-variable">$3</span>]++<br>&#125;<br><span class="hljs-keyword">END</span> &#123;<br>    <span class="hljs-comment"># è¿›è¡Œç¼©æ”¾</span><br>    maxm = max(user);<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> user) &#123;<br>        <span class="hljs-comment">#printf &quot;%s owns %d files\n&quot;, i, user[i]</span><br>        scaled = <span class="hljs-number">60</span> * user[i] / maxm ;<br>        printf <span class="hljs-string">&quot;%-10.10s [%8d]:&quot;</span>, i, user[i]<br>        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i&lt;scaled; i++) &#123;<br>            printf <span class="hljs-string">&quot;#&quot;</span>;<br>        &#125;<br>        printf <span class="hljs-string">&quot;\n&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è¾“å‡ºåŒ¹é…è¯ä¹‹åçš„æ–‡æœ¬</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> para.awk<br>/keyphrase/ &#123; flag=1 &#125;<br>flag == 1 &#123; <span class="hljs-built_in">print</span> &#125;<br>/^$/ &#123; flag=0 &#125;<br><br>$ awk -f para.awk &lt; searchthis.txt<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>bash å…³è”æ•°ç»„</strong></p></li></ol><blockquote><p>å…¶ä»–è¯­è¨€ä¸­ä¹Ÿç§°ä¸ºæ•£åˆ—æˆ–å­—å…¸</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šcnt_owner</span><br><span class="hljs-comment"># ä½¿ç”¨bashç»Ÿè®¡æ–‡ä»¶æ‰€æœ‰è€…</span><br><span class="hljs-comment"># å°†â€œls -lâ€çš„è¾“å‡ºé€šè¿‡ç®¡é“ä¼ å…¥è¯¥è„šæœ¬</span><br><br><span class="hljs-comment">## å®šä¹‰å…³è”æ•°ç»„</span><br><span class="hljs-built_in">declare</span> -A AACOUNT<br><span class="hljs-comment">## -a åçš„å˜é‡ä¼šè¢«è®¤ä¸ºæ˜¯æ•°ç»„ï¼Œé»˜è®¤ä»¥ç©ºæ ¼ä¸ºåˆ†å‰²ç¬¦</span><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span>  -a LSL<br><span class="hljs-keyword">do</span><br>    <span class="hljs-comment"># åªè€ƒè™‘åŒ…å«7ä¸ªåŠä»¥ä¸Šå­—æ®µçš„è¡Œ</span><br>    <span class="hljs-keyword">if</span> (( <span class="hljs-variable">$&#123;#LSL[*]&#125;</span> &gt; <span class="hljs-number">7</span> ))         <span class="hljs-comment"># æ•°ç»„å¤§å°</span><br>    <span class="hljs-keyword">then</span><br>        NDX=<span class="hljs-variable">$&#123;LSL[3]&#125;</span>               <span class="hljs-comment"># å­—ç¬¦ä¸²èµ‹å€¼</span><br>        (( AACOUNT[<span class="hljs-variable">$&#123;NDX&#125;</span>] += <span class="hljs-number">1</span> ))  <span class="hljs-comment"># ç®—æœ¯é€’å¢</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">## $&#123;AACOUNT[@]&#125; ä¼šç”Ÿæˆæ•°ç»„æ‰€æœ‰å…ƒç´ å€¼çš„åˆ—è¡¨ï¼Œå¦‚æœåŠ ä¸ŠæƒŠå¹å·å˜æˆ$&#123;!AACOUNT[@]&#125;ï¼Œåˆ™å¾—åˆ°çš„æ˜¯è¯¥æ•°ç»„æ‰€æœ‰ç´¢å¼•çš„åˆ—è¡¨ã€‚</span><br><span class="hljs-keyword">for</span> VALS <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;!AACOUNT[@]&#125;</span>&quot;</span>        <span class="hljs-comment"># å„ä¸ªå…ƒç´ çš„ç´¢å¼•</span><br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$VALS</span> <span class="hljs-string">&quot;owns&quot;</span> <span class="hljs-variable">$&#123;AACOUNT[$VALS]&#125;</span> <span class="hljs-string">&quot;files&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><ol start="8"><li><strong>sort æ’åº</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sort</span> -r <span class="hljs-comment"># reverse</span><br><span class="hljs-built_in">sort</span> -f <span class="hljs-comment"># ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="hljs-built_in">sort</span> -n <span class="hljs-comment"># æ•°å€¼æ’åº</span><br><span class="hljs-built_in">sort</span> -u <span class="hljs-comment"># å»æ‰é‡å¤è¾“å‡º</span><br></code></pre></td></tr></table></figure></li></ol><p>å¦‚æœé…åˆ <code>uniq -c</code> ä½¿ç”¨ï¼Œ<code>sort -rn</code> å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç»™å‡ºä¸€ä¸ªæŒ‰ç…§é™åºæ’åˆ—çš„åˆ—è¡¨ã€‚</p><blockquote><p>uniq -d  åªæŸ¥çœ‹é‡å¤è¡Œ</p></blockquote><ul><li><p>IPåœ°å€æ’åº</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## -t é€‰é¡¹ç”¨äºæŒ‡å®šå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦</span><br>$ <span class="hljs-built_in">sort</span> -t . -k 1,1n -k 2,2n -k 3,3n -k 4,4n ipaddr.list<br>10.0.0.2<br>10.0.0.5<br>10.0.0.20<br>192.168.0.2<br>192.168.0.4<br>192.168.0.12<br></code></pre></td></tr></table></figure></li></ul><ol start="9"><li><p><strong>tr</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27;;:.!?&#x27;</span> <span class="hljs-string">&#x27;,&#x27;</span> &lt;other.punct &gt;commas.all<br><span class="hljs-comment"># å°†å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯</span><br><span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27;A-Z&#x27;</span> <span class="hljs-string">&#x27;a-z&#x27;</span> &lt;be.fore &gt;af.ter<br><span class="hljs-comment"># åˆ é™¤æ‰€æœ‰å›è½¦ç¬¦</span><br><span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;\r&#x27;</span> &lt;file.dos &gt;file.txt<br></code></pre></td></tr></table></figure></li><li><p><strong>wc</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">wc</span> data_file<br>5     15     60 data_file<br><span class="hljs-comment"># åªæ˜¾ç¤ºè¡Œæ•°</span><br>$ <span class="hljs-built_in">wc</span> -l data_file<br>5 data_file<br><br><span class="hljs-comment"># åªæ˜¾ç¤ºå•è¯æ•°</span><br>$ <span class="hljs-built_in">wc</span> -w data_file<br>15 data_file<br><br><span class="hljs-comment"># åªæ˜¾ç¤ºå­—ç¬¦æ•°ï¼ˆé€šå¸¸ç­‰åŒäºå­—èŠ‚æ•°ï¼‰</span><br>$ <span class="hljs-built_in">wc</span> -c data_file<br>60 data_file<br><br><span class="hljs-comment">## è¾“å‡ºæ•°å­—åŠæ–‡ä»¶å</span><br><span class="hljs-built_in">wc</span> -l data_file<br><span class="hljs-comment">## åªè¾“å‡ºæ•°å­—</span><br><span class="hljs-built_in">wc</span> -l &lt; data_file<br><span class="hljs-comment"># è™½ç„¶ä¹Ÿèƒ½åªè¾“å‡ºæ•°å­—ï¼Œä½†æ˜¯catå¢åŠ äº†è„šæœ¬è¿è¡Œå¼€é”€</span><br><span class="hljs-built_in">cat</span> data_file | <span class="hljs-built_in">wc</span> -l<br></code></pre></td></tr></table></figure></li><li><p><strong>find</strong></p><ul><li><code>-delete</code></li><li><code>-newermt</code></li><li><code>-mtime</code></li><li><code>-size</code></li><li><code>-print0</code> å¾€å¾€é…åˆ <code>xargs -0</code></li><li><code>-type</code></li><li><code>-exec</code> <blockquote><p>æ–‡ä»¶å¤§å°è¿˜åŒ…å«äº†å•ä½ kï¼ˆåƒå­—èŠ‚ï¼‰â€‹ã€‚å¦‚æœå•ä½æ˜¯ cï¼Œåˆ™è¡¨ç¤ºå­—èŠ‚ï¼ˆæˆ–å­—ç¬¦ï¼‰â€‹ã€‚å¦‚æœä½¿ç”¨ b ä½œä¸ºå•ä½æˆ–è€…ä¸å†™ä»»ä½•å•ä½ï¼Œåˆ™è¡¨ç¤ºå—ã€‚ <br>å¯¹äºç¢°åˆ°çš„æ¯ä¸ªæ–‡ä»¶ï¼Œå…ˆæµ‹è¯•å…¶æ˜¯å¦ä¸ºç›®å½•ï¼Œå¦‚æœæ˜¯ï¼Œæ‰æµ‹è¯•åç§°æ˜¯å¦ç¬¦åˆæ¨¡å¼ã€‚ <br>æ‰€ä»¥ typeæ”¾åˆ°nameå‰é¢ä½¿ç”¨èƒ½ç•¥å¾®æé«˜æœç´¢æ•ˆç‡ã€‚</p></blockquote></li></ul></li><li><p><strong>locate</strong></p></li><li><p><strong>æŸ¥æ‰¾å‘½ä»¤</strong></p><ul><li><code>which</code><ul><li>åœ¨å„ç‰ˆæœ¬linuxè¡¨ç°ä¸åŒï¼Œä¸”ä¸æ˜¯å†…å»ºå‘½ä»¤</li></ul></li><li><code>type -P</code><ul><li>shellå†…å»ºå‘½ä»¤ï¼Œå‘½ä»¤ä¸å­˜åœ¨æ—¶ä¸ä¼šè¾“å‡ºé”™è¯¯æ¶ˆæ¯ï¼Œè„šæœ¬ä¸­å»ºè®®ç”¨</li></ul></li><li><code>command -v/-V</code><ul><li>shellå†…å»ºå‘½ä»¤ï¼Œ<code>v</code>æ‰¾ä¸åˆ°æ—¶ä¸è¾“å‡ºé”™è¯¯æ¶ˆæ¯ï¼Œ<code>V</code>æ‰¾ä¸åˆ°æ—¶è¾“å‡ºé”™è¯¯æ¶ˆæ¯</li></ul></li></ul></li><li><p><strong>å‡½æ•°å‚æ•°åŠè¿”å›å€¼</strong></p><ul><li>å‘å‡½æ•°å†…éƒ¨çš„å˜é‡èµ‹å€¼</li><li>ç”¨<code>echo</code>æˆ–<code>printf</code>å°†è¾“å‡ºå‘é€åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¹¶ç”¨<code>$()</code>æˆ–è€…<code>``</code>è°ƒç”¨å‡½æ•°<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šfunc_max.1</span><br><br><span class="hljs-comment"># å®šä¹‰å‡½æ•°ï¼š</span><br><span class="hljs-comment">## å‡½æ•°å†…éƒ¨æ²¡æœ‰ç”¨localå£°æ˜çš„å˜é‡éƒ½æ˜¯å…¨å±€å˜é‡</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">max</span></span> ()<br>&#123;<br>    <span class="hljs-built_in">local</span> HIDN<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> -gt <span class="hljs-variable">$2</span> ]<br>    <span class="hljs-keyword">then</span><br>        BIGR=<span class="hljs-variable">$1</span><br>    <span class="hljs-keyword">else</span><br>        BIGR=<span class="hljs-variable">$2</span><br>    <span class="hljs-keyword">fi</span><br>    HIDN=5<br>&#125;<br><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šfunc_max.2</span><br><br><span class="hljs-comment"># å®šä¹‰å‡½æ•°ï¼š</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">max</span></span> ()<br>&#123;<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$1</span> -gt <span class="hljs-variable">$2</span> ]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$1</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$2</span><br>    <span class="hljs-keyword">fi</span><br>&#125;<br><span class="hljs-comment"># è°ƒç”¨å‡½æ•°</span><br>max 10 20<br><span class="hljs-comment"># è°ƒç”¨å‡½æ•°å¹¶å°†ç»“æœèµ‹å€¼ç»™å˜é‡</span><br>BIGR=$(max 10 20)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$BIGR</span><br><span class="hljs-comment"># è°ƒç”¨å‡½æ•°å¹¶å°†ç»“æœèµ‹å€¼ç»™å˜é‡</span><br>BIGR=`max 10 20`<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$BIGR</span><br></code></pre></td></tr></table></figure><blockquote><p>åœ¨å‡½æ•°ä¸­å¼•ç”¨å‚æ•°ä¹Ÿæ˜¯ä½¿ç”¨ $1ã€$2 ç­‰ã€‚ä½†æ˜¯ï¼Œ$0 ä¿æŒä¸å˜ï¼Œå…¶ä¸­åŒ…å«çš„è¿˜æ˜¯æ‰€è°ƒç”¨è„šæœ¬çš„åç§°ã€‚</p><p>$FUNCNAME æœ¬èº«å¼•ç”¨çš„æ˜¯è¯¥æ•°ç»„çš„ç¬¬ 0 ä¸ªå…ƒç´ ï¼Œå…¶ä¸­åŒ…å«çš„æ˜¯å½“å‰æ‰§è¡Œå‡½æ•°çš„åç§°ã€‚</p><p>$FUNCNAME ä»…å­˜åœ¨äºå‡½æ•°æ‰§è¡ŒæœŸé—´ã€‚</p></blockquote></li></ul></li><li><p><strong>ä¿¡å·æ•è·</strong><br>å…¶å®<code>-SIGKILLï¼ˆ-9ï¼‰</code>æ— æ³•æ•è·ã€‚è¯¥ä¿¡å·å¯ä»¥ç«‹åˆ»â€œæ€æ­»â€è¿›ç¨‹ï¼Œå‹æ ¹æ²¡æœºä¼šæ•è·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆ—å‡ºæ‰€æœ‰å¯æ•è·çš„ä¿¡å·</span><br><span class="hljs-built_in">trap</span> -l<br><br><span class="hljs-comment">## ç¬¬ä¸€ä¸ªå‚æ•°å¡«æ•è·åˆ°å¯¹åº”ä¿¡å·åçš„è¡Œä¸º</span><br><span class="hljs-comment">## æ¯”å¦‚æ•è·é€€å‡ºä¿¡å·æ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶</span><br><span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;Clean tmp files&quot;</span> EXIT<br><br><span class="hljs-comment">## å¦‚æœå‘½ä»¤æ˜¯è¢«ä¿¡å· signal number ç»ˆæ­¢çš„ï¼Œåˆ™è„šæœ¬çš„é€€å‡ºçŠ¶æ€ç ä¸º 128+signal numberã€‚</span><br></code></pre></td></tr></table></figure></li><li><p><strong>alias</strong></p><ul><li><code>&#39;&#39;</code> å•å¼•å·åŒ…æ‹¬çš„å˜é‡ä¼šåœ¨æ‰§è¡Œåˆ«åå‘½ä»¤æ—¶ç”Ÿæ•ˆå˜é‡å€¼</li><li><code>&quot;&quot;</code> åŒå¼•å·åŒ…æ‹¬çš„å˜é‡ï¼Œåœ¨è®¾ç½®åˆ«åæ—¶å°±ä¼šä½¿å€¼ç”Ÿæ•ˆï¼Œå†™æ­»<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆ é™¤åˆ«å h</span><br><span class="hljs-comment">## \ å¯ä»¥ä½¿åˆ«åå¤±æ•ˆï¼Œé˜²æ­¢æœ‰äººå°†unaliaså‘½ä»¤è®¾ç½®æˆåˆ«åï¼Œå¦‚æœæœ‰äººå°†å…¶è®¾ç½®ä¸º : å°±ä¼šä½¿å…¶å¤±æ•ˆ</span><br>\<span class="hljs-built_in">unalias</span> h<br><span class="hljs-comment">## åˆ é™¤æ‰€æœ‰åˆ«å</span><br><span class="hljs-built_in">unalias</span> -a <br><span class="hljs-comment"># å®šä¹‰åˆ«åæ—¶ä¸å…è®¸ä½¿ç”¨å‚æ•°ï¼Œå¦‚ $1, $2</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>é¿å¼€åˆ«åå’Œå‡½æ•°</strong></p><ul><li>ä½¿ç”¨ bash shell çš„ builtin å‘½ä»¤æ¥å¿½ç•¥ shell å‡½æ•°å’Œåˆ«åï¼Œæ‰§è¡Œå®é™…çš„å†…å»ºå‘½ä»¤ã€‚</li><li>ä½¿ç”¨ <code>command</code> å‘½ä»¤æ¥å¿½ç•¥ shell å‡½æ•°å’Œåˆ«åï¼Œå¹¶æ‰§è¡Œå®é™…çš„å¤–éƒ¨å‘½ä»¤ã€‚</li><li>å¦‚æœåªæ˜¯æƒ³é¿å¼€åˆ«åæ‰©å±•ï¼Œä½†ä»å…è®¸æ‰§è¡Œå‡½æ•°ï¼Œåœ¨å‘½ä»¤å‰åŠ ä¸Š <code>\</code> å‰ç¼€å³å¯ã€‚<blockquote><p>type -a cmd ä¼šæ˜¾ç¤ºæ‰€æœ‰åŒ…å«cmdå‘½ä»¤çš„åœ°æ–¹ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œè¿˜ä¼šæ˜¾ç¤ºå‡ºå‡½æ•°ä»£ç </p></blockquote></li></ul></li><li><p><strong>è®¡ç®—å·²è¿‡å»çš„æ—¶é—´</strong></p><ul><li>ä½¿ç”¨å†…å»ºå‘½ä»¤ <code>time</code> æˆ– bash å˜é‡ <code>$SECONDS</code></li><li><code>$SECONDS</code> ä¼šè®°å½• shell å¯åŠ¨ä»¥æ¥çš„æ—¶é•¿ï¼ˆç§’æ•°ï¼‰â€‹ã€‚å¦‚æœä¸ºå…¶èµ‹å€¼ï¼Œé‚£ä¹ˆéšååœ¨æ‰©å±•è¯¥å˜é‡æ—¶ï¼Œå¾—åˆ°çš„å€¼å°±æ˜¯å…ˆå‰çš„èµ‹å€¼ä¸èµ‹å€¼æ“ä½œä»¥åçš„æ—¶é•¿ï¼ˆç§’æ•°ï¼‰ä¹‹å’Œã€‚</li></ul></li><li><p><strong>è‡ªå®šä¹‰æ–‡ä»¶æè¿°ç¬¦åŠé‡å®šå‘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°†æ ‡å‡†è¾“å‡ºå®šå‘åˆ° out.logæ–‡ä»¶</span><br><span class="hljs-built_in">exec</span> 1&gt; out.log<br><span class="hljs-comment"># å°†é”™è¯¯è¾“å‡ºé‡å®šå‘æ ‡å‡†è¾“å‡º</span><br><span class="hljs-built_in">exec</span> 2&gt;&amp;1<br><span class="hljs-comment"># å®šä¹‰æ–‡ä»¶æè¿°ç¬¦ 3 è¾“å‡ºåˆ°other.logæ–‡ä»¶</span><br><span class="hljs-built_in">exec</span> 3&gt; other.log<br><span class="hljs-comment"># å…³é—­æ–‡ä»¶æè¿°ç¬¦ 3</span><br><span class="hljs-built_in">exec</span> 3&gt;&amp;- <br><br><span class="hljs-comment">## å‡½æ•°ä¹Ÿå¯é‡å®šå‘è¾“å‡º</span><br><span class="hljs-comment"># æ ¹æ®ä¼ è¿›å‚æ•°ä¼šåˆ†åˆ«è¿›è¡Œè¾“å‡ºï¼Œæ— éœ€å†™è¿­ä»£å¾ªç¯</span><br><span class="hljs-function"><span class="hljs-title">ERROUT</span></span>()&#123;<br>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Error: %b\n&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>&#125; &gt;&amp;2<br><span class="hljs-comment">## printf å°æŠ€å·§</span><br><span class="hljs-built_in">test</span>=<span class="hljs-string">&quot;a b c&quot;</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;Print %b\n&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;test[@]&#125;</span>&quot;</span><br><span class="hljs-comment">## ä¼šæ‰“å°ä¸‰æ¡è¾“å‡º</span><br><br></code></pre></td></tr></table></figure><p>é‡å®šå‘çš„é¡ºåºé€šå¸¸å¾ˆé‡è¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ ‡å‡†è¾“å‡ºè¢«é‡å®šå‘åˆ°æ–‡ä»¶ my.fileï¼Œç„¶åæ ‡å‡†é”™è¯¯è¢«é‡å®šå‘åˆ°å’Œæ ‡å‡†è¾“å‡ºç›¸åŒçš„åœ°æ–¹ã€‚æ‰€æœ‰çš„è¾“å‡ºéƒ½ä¼šå‡ºç°åœ¨ my.file ä¸­</span><br>somecmd &gt;my.file 2&gt;&amp;1<br><span class="hljs-comment"># æ ‡å‡†é”™è¯¯è¢«é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼ˆæ­¤æ—¶æ ‡å‡†è¾“å‡ºæŒ‡å‘çš„æ˜¯å±å¹•ï¼‰â€‹ï¼Œç„¶åæ ‡å‡†è¾“å‡ºè¢«é‡å®šå‘åˆ° my.fileã€‚å› æ­¤ï¼Œåªæœ‰æ ‡å‡†è¾“å‡ºæ¶ˆæ¯ä¼šå‡ºç°åœ¨æ–‡ä»¶ä¸­ï¼Œè€Œé”™è¯¯æ¶ˆæ¯ä»æ—§ä¼šå‡ºç°åœ¨å±å¹•ä¸Šã€‚</span><br>somecmd 2&gt;&amp;1 &gt;my.file<br><br>somecmd 2&gt;&amp;1 | othercmd<br><span class="hljs-comment"># bash 4.x ç‰ˆæœ¬ä¸­çš„ä¸€ç§ä¾¿æ·è¯­æ³•å¯ä»¥åŒæ—¶å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¿å…¥ç®¡é“ã€‚</span><br>somecmd |&amp; othercmd<br></code></pre></td></tr></table></figure></li><li><p><strong>å¤„ç†æ—¥æœŸå’Œæ—¶é—´</strong></p><ul><li><code>date</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°†æ—¥æœŸè½¬ä¸ºçºªå…ƒç§’æ ¼å¼</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;20230113&quot;</span> <span class="hljs-string">&quot;+%s&quot;</span> <br><span class="hljs-comment"># çºªå…ƒç§’æ ¼å¼è½¬æ¢éœ€è¦åŠ  @ç¬¦å·</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&quot;@1673000000&quot;</span><br><br><span class="hljs-comment"># æ›´å¤šå½¢å¼æŸ¥é˜…å…¶ä»–æ–‡æ¡£</span><br><span class="hljs-built_in">date</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:%M:%S %z&#x27;</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;today&#x27;</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:%M:%S %z&#x27;</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;tomorrow&#x27;</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:%M:%S %z&#x27;</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;yesterday&#x27;</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:%M:%S %z&#x27;</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;1 day ago&#x27;</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:%M:%S %z&#x27;</span><br><span class="hljs-built_in">date</span> -d <span class="hljs-string">&#x27;-1 days&#x27;</span> <span class="hljs-string">&#x27;+%Y-%m-%d %H:</span><br><span class="hljs-string">%M:%S %z&#x27;</span><br></code></pre></td></tr></table></figure><ul><li><code>printf</code><ul><li><code>printf</code> æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶ç‰ˆæœ¬</li><li>è¿™é‡Œçš„<code>printf</code>æŒ‡çš„æ˜¯bashå†…å»ºç‰ˆæœ¬<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¾“å‡ºæ—¥æœŸ</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%(%F %T)T\n&#x27;</span> <span class="hljs-string">&#x27;-1&#x27;</span><br><span class="hljs-comment"># å¯ä»¥ä¸ºå˜é‡èµ‹å€¼</span><br><span class="hljs-built_in">printf</span> -v today <span class="hljs-string">&#x27;%(%F)T&#x27;</span> <span class="hljs-string">&#x27;-1&#x27;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$today</span><br><span class="hljs-comment"># æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å‚æ•°å€¼å¯ä»¥ä½¿ç”¨ï¼š-1ä»£è¡¨å½“å‰æ—¶é—´ï¼Œ-2 ä»£è¡¨ shell è¢«è°ƒç”¨çš„æ—¶é—´ã€‚</span><br></code></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><strong>æ¯”è¾ƒæ–‡ä»¶</strong></p><ul><li>æ¯”è¾ƒçº¯æ–‡æœ¬æ–‡ä»¶</li><li>æ¯”è¾ƒäºŒè¿›åˆ¶æ–‡ä»¶</li></ul><p>é€šç”¨æ–¹æ³•ï¼š<br>ä»¥ä¸Šä¸¤ç§æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡è®¡ç®—shaå€¼æ¥ç¡®è®¤æ˜¯å¦ç›¸åŒã€‚</p><p>æ¯”è¾ƒçº¯æ–‡æœ¬æ–‡ä»¶æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä½¿ç”¨ <code>diff</code> å‘½ä»¤å³å¯ã€‚<br>diff å¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li><code>-b</code> å¿½ç•¥ç©ºç™½è¡Œ</li><li><code>-c</code> æ˜¾ç¤ºå·®å¼‚çš„ä¸Šä¸‹æ–‡</li><li><code>-u</code> æ˜¾ç¤ºå·®å¼‚çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ˜¾ç¤ºå·®å¼‚çš„è¡Œå·</li><li><code>-y</code> æ˜¾ç¤ºå·®å¼‚çš„ä¸Šä¸‹è¡Œ</li><li><code>-B</code> å¿½ç•¥å¤§å°å†™</li><li><code>-i</code> å¿½ç•¥å¤§å°å†™</li><li><code>-q</code> ä¸æ˜¾ç¤ºå·®å¼‚çš„ä¸Šä¸‹æ–‡</li><li><code>-r</code> é€’å½’æ¯”è¾ƒç›®å½•</li></ul><p>diff æ¯”è¾ƒäºŒè¿›åˆ¶æ–‡ä»¶ä¸ä¼šæ˜¾ç¤ºå¤ªå¤šä¿¡æ¯ï¼Œåªä¼šå‘Šè¯‰ä¸¤ä¸ªæ–‡ä»¶ä¸ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨ <code>cmp</code> å‘½ä»¤ã€‚</p><p>æˆ–è€…é€šè¿‡è§£å‹wordæ–‡æ¡£ï¼Œç”¨è§£å‹å‡ºæ¥çš„xmlæ–‡ä»¶è¿›è¡Œå¯¹æ¯”ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ­¤è¡Œ sedå¯ä»¥å°†æ¯ä¸ª&lt;&gt;æ›¿æ¢ä¸ºè‡ªèº«åŠ ä¸Šæ¢è¡Œç¬¦ï¼Œä»è€Œå°†åŒ…å«å†…å®¹çš„è¡Œç‹¬ç«‹å‡ºæ¥</span><br>sed -e <span class="hljs-string">&#x27;s/&gt;/&gt;\</span><br><span class="hljs-string">/g; s/&lt;/\</span><br><span class="hljs-string">&lt;/g&#x27;</span> document.xml &gt; word.xml<br></code></pre></td></tr></table></figure><blockquote><p>wordæ–‡æ¡£å®é™…ä¸Šæ˜¯ç”±é‡Œé¢çš„å›¾ç‰‡å’Œxmlæ–‡ä»¶å‹ç¼©æ‰€å¾—ï¼Œå¯ä»¥å°è¯•ç”¨zipè§£å‹å‡ºæ¥çœ‹çœ‹</p></blockquote></li></ol>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell å®ç”¨æŠ€å·§ï¼ˆä¸€ï¼‰</title>
    <link href="/2024/08/06/shell-action/"/>
    <url>/2024/08/06/shell-action/</url>
    
    <content type="html"><![CDATA[<h1 id="Shell-å®ç”¨æŠ€å·§"><a href="#Shell-å®ç”¨æŠ€å·§" class="headerlink" title="Shell å®ç”¨æŠ€å·§"></a>Shell å®ç”¨æŠ€å·§</h1><ol><li><p><strong>ä¿å­˜å¤šä¸ªå‘½ä»¤çš„è¾“å‡º</strong></p><ul><li>ä½¿ç”¨<code>&#123;&#125;</code>å°†å‘½ä»¤ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åé‡å®šå‘<ul><li>èŠ±æ‹¬å·å®é™…ä¸Šæ˜¯ä¿ç•™å­—ï¼Œä¸¤ä¾§å¿…é¡»æœ‰ç©ºç™½å­—ç¬¦ï¼Œé—­åˆæ‹¬å·å‰é¢çš„å‘½ä»¤çš„åˆ†å·ä¸èƒ½å°‘</li></ul></li><li>ä½¿ç”¨<code>()</code>å°†å‘½ä»¤æ”¾å…¥å­shellé‡å®šå‘è¾“å‡º</li></ul><p> ç”¨å­shellçš„æ–¹å¼ä¸ä¼šæ”¹å˜å½“å‰shellçš„ç¯å¢ƒï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤ç»„åŒ…å«<code>cd ..</code>ï¼Œåœ¨ç”¨èŠ±æ‹¬å·çš„æ–¹å¼ä¸­ä¼šåˆ‡æ¢å½“å‰è·¯å¾„ï¼Œè€Œå­shellæ–¹å¼ä¸­ä¸ä¼šåˆ‡æ¢å½“å‰shellçš„è·¯å¾„ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½åœ¨å­shellå½“ä¸­æ‰§è¡Œï¼Œä¸å½±å“å½“å‰shellç¯å¢ƒã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¯ä»¥ç”¨&#123;&#125; or ()</span><br>&#123; <span class="hljs-built_in">ls</span>; <span class="hljs-built_in">cd</span> ..; <span class="hljs-built_in">pwd</span>; <span class="hljs-built_in">ls</span>; &#125; &gt; /tmp/all.out<br>(<span class="hljs-built_in">ls</span>; <span class="hljs-built_in">cd</span> ..; <span class="hljs-built_in">pwd</span>; <span class="hljs-built_in">ls</span>) &gt; /tmp/all.out<br><br><span class="hljs-built_in">test</span> <span class="hljs-variable">$result</span> -eq 1 &amp;&amp; &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Result&quot;</span> is 1; <span class="hljs-built_in">exit</span> 0; &#125; \<br>    || &#123; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Run Away!&quot;</span>; <span class="hljs-built_in">exit</span> 120; &#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>è·³è¿‡æ–‡ä»¶æ ‡é¢˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æ˜¾ç¤ºååè¡Œ</span><br><span class="hljs-built_in">tail</span> -n 10<br><span class="hljs-built_in">tail</span> -10 <br><span class="hljs-comment">## è·³è¿‡ç¬¬ä¸€è¡Œ, å¯ç”¨äºä¸€äº›è·³è¿‡æ ‡é¢˜çš„æƒ…å†µ</span><br><span class="hljs-built_in">tail</span> -n +2<br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨æˆ–æ›¿æ¢å†…å»ºå‘½ä»¤ä¸å¤–éƒ¨å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## type å¯æŸ¥çœ‹å‘½ä»¤å±äºå“ªç§,builtinå±äºå†…å»ºå‘½ä»¤</span><br>root@localhost:~# <span class="hljs-built_in">type</span> <span class="hljs-built_in">cd</span><br><span class="hljs-built_in">cd</span> is a shell <span class="hljs-built_in">builtin</span><br><br><span class="hljs-comment">## å¯æŸ¥çœ‹æœ‰å“ªäº›å†…å»ºå‘½ä»¤</span><br><span class="hljs-built_in">enable</span> -a<br><span class="hljs-comment">## å…³é—­shellå†…å»ºå‘½ä»¤</span><br><span class="hljs-built_in">enable</span> -n <span class="hljs-variable">$cmd</span><br><span class="hljs-comment">## å¿½ç•¥shellå‡½æ•°çš„ls,æ‰§è¡Œå†…å»ºlså‘½ä»¤</span><br><span class="hljs-built_in">command</span> <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure></li><li><p><strong>äº¤æ¢STDERRå’ŒSTDOUT</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">./myscript 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3<br><br><span class="hljs-comment">## æ“ä½œå®Œæˆåå…³é—­æ–‡ä»¶æè¿°ç¬¦3</span><br>./myscript 3&gt;&amp;1 1&gt;stdout.logfile 2&gt;&amp;3- | <span class="hljs-built_in">tee</span> -a stderr.logfile<br></code></pre></td></tr></table></figure></li><li><p><strong>é¿å…æ„å¤–è¦†ç›–æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å‘Šè¯‰bashé‡å®šå‘è¾“å‡ºæ—¶ä¸è¦è¦†ç›–ä»»ä½•ç°æœ‰æ–‡ä»¶</span><br><span class="hljs-built_in">set</span> -o noclobber<br><span class="hljs-comment">## å…³é—­è¯¥é€‰é¡¹</span><br><span class="hljs-built_in">set</span> +o noclobber<br><span class="hljs-comment">## ä½¿ç”¨ &gt;| é‡å®šå‘è¾“å‡ºã€‚å³ä¾¿æ˜¯è®¾ç½®äº† noclobberï¼Œbash ä¹Ÿä¼šå¿½ç•¥è¯¥é€‰é¡¹ï¼Œå¹¶è¦†ç›–æ–‡ä»¶</span><br><span class="hljs-built_in">echo</span> rewrite &gt;| tmp.txt<br></code></pre></td></tr></table></figure><blockquote><p>noclobber é€‰é¡¹ä»…é’ˆå¯¹ shell é‡å®šå‘è¾“å‡ºæ—¶çš„æ–‡ä»¶è¦†ç›–è¡Œä¸ºã€‚å®ƒå¹¶ä¸èƒ½é˜»æ­¢å…¶ä»–ç¨‹åºè¦†ç›–æ–‡ä»¶</p></blockquote></li><li><p><strong>å°†æ•°æ®ä¸è„šæœ¬å­˜æ”¾åœ¨ä¸€èµ·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> ext<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ä¸‹é¢æ˜¯here-document</span><br><span class="hljs-comment">#</span><br>grep <span class="hljs-variable">$1</span> &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">mike x.123</span><br><span class="hljs-string">joe  x.234</span><br><span class="hljs-string">sue  x.555</span><br><span class="hljs-string">pete x.818</span><br><span class="hljs-string">sara x.822</span><br><span class="hljs-string">bill x.919</span><br><span class="hljs-string">EOF</span><br><br>$ <span class="hljs-built_in">cat</span> donors<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># é‡Œé¢çš„$100ä¸­çš„$1ä¼šè¢«è¯¯è§£é‡Šä¸ºå‚æ•°$1, å› æ­¤éœ€è¦åŠ &#x27;&#x27;æˆ–\EOF</span><br><span class="hljs-comment"># </span><br>grep <span class="hljs-variable">$1</span> &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-comment"># æèµ äººåŠå…¶æèµ é¢</span><br>pete <span class="hljs-variable">$100</span><br>joe  <span class="hljs-variable">$200</span><br>sam  $ 25<br>bill $ 9<br>EOF<br><br>$ <span class="hljs-built_in">cat</span> myscript.sh<br><span class="hljs-comment">## ä½¿ç”¨ &lt;&lt;-ï¼Œç„¶åå°±å¯ä»¥åœ¨æ¯è¡Œçš„å¼€å¤´ç”¨åˆ¶è¡¨ç¬¦ï¼ˆä»…é™åˆ¶è¡¨ç¬¦ï¼ï¼‰ç¼©è¿›shell è„šæœ¬ä¸­çš„ here-document éƒ¨åˆ†</span><br>...<br>    grep <span class="hljs-variable">$1</span> &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>        lots of data<br>        can go here<br>        it<span class="hljs-string">&#x27;s indented with tabs</span><br><span class="hljs-string">        to match the script&#x27;</span>s indenting<br>        but the leading tabs are<br>        discarded when <span class="hljs-built_in">read</span><br>        EOF<br>    <span class="hljs-built_in">ls</span><br>...<br></code></pre></td></tr></table></figure></li><li><p><strong>until, select</strong></p><p> until å¾ªç¯ç”¨äºåœ¨æ¡ä»¶ä¸ºå‡æ—¶é‡å¤æ‰§è¡Œä¸€ç»„å‘½ä»¤ã€‚ä¸ while å¾ªç¯ç›¸åï¼Œå®ƒåœ¨æ¯æ¬¡è¿­ä»£å¼€å§‹æ—¶æ£€æŸ¥æ¡ä»¶ã€‚</p><p> select å¾ªç¯ç”¨äºåˆ›å»ºä¸€ä¸ªç®€å•çš„èœå•é€‰æ‹©ã€‚å®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªèœå•å¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥é€‰æ‹©ï¼Œç„¶åæ ¹æ®é€‰æ‹©æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚<br> select è¯­å¥èƒ½å¤Ÿè½»æ¾åœ°åœ¨ STDERR ä¸Šä¸ºç”¨æˆ·ç”Ÿæˆç¼–å·åˆ—è¡¨ã€‚<br> ç”¨æˆ·æ‰€è¾“å…¥çš„é€‰é¡¹ç¼–å·ä¿å­˜åœ¨ $REPLY ä¸­ï¼Œé€‰é¡¹å€¼ä¿å­˜åœ¨ select è¯­å¥æŒ‡å®šçš„å˜é‡ä¸­ã€‚</p></li><li><p><strong>åŒæ—¶æ‰§è¡Œå¤šä¸ªå‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 3 ä¸ªå‘½ä»¤çš„è¾“å‡ºä¼šåœ¨å±å¹•ä¸Šäº¤é”™å‡ºç°</span><br><span class="hljs-comment">## æœ€åä¸€æ¡å‘½ä»¤ä¸åœ¨åå°è¿è¡Œ</span><br><span class="hljs-built_in">ls</span> &amp; <span class="hljs-built_in">date</span> &amp; <span class="hljs-built_in">cd</span> <br><span class="hljs-comment">## ä¸‰æ¡å‘½ä»¤éƒ½åœ¨åå°è¿è¡Œ</span><br><span class="hljs-built_in">ls</span> &amp; <span class="hljs-built_in">date</span> &amp; <span class="hljs-built_in">cd</span> &amp;<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨shellè„šæœ¬ä¸­åµŒå…¥æ–‡æ¡£</strong></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">:&lt;&lt;<span class="hljs-string">&#x27;DOC&#x27;</span><br>    Write some notes.<br>DOC<br></code></pre></td></tr></table></figure><ol start="10"><li><strong>å¯¼å‡ºå˜é‡</strong></li></ol><blockquote><p>bash ä¸­ä¸€åˆ‡éƒ½æ˜¯å­—ç¬¦ä¸²</p></blockquote><p>å°†å¸Œæœ›ä¼ ç»™å…¶ä»–è„šæœ¬çš„å˜é‡å¯¼å‡º<br>è¦æƒ³æŸ¥çœ‹æ‰€æœ‰å·²å¯¼å‡ºçš„å˜é‡ï¼Œæ•²å…¥å‘½ä»¤ envï¼ˆæˆ–è€…å†…å»ºå‘½ä»¤export -pï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> MYVAR<br><span class="hljs-built_in">export</span> NAME=value<br></code></pre></td></tr></table></figure><p>env ç”Ÿæˆçš„åˆ—è¡¨æ˜¯ set ç”Ÿæˆçš„åˆ—è¡¨çš„å­é›†ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰å˜é‡éƒ½è¢«å¯¼å‡ºäº†ã€‚</p><ol start="11"><li><strong>å¤„ç†åŒ…å«ç©ºæ ¼çš„å‚æ•°</strong></li></ol><p>å°†æ‰€æœ‰å¯èƒ½åŒ…å«æ–‡ä»¶åçš„å‘½ä»¤å‚æ•°å…¨éƒ¨åŠ ä¸Šå¼•å·ã€‚å¼•ç”¨å˜é‡æ—¶ï¼Œå°†å…¶æ”¾å…¥åŒå¼•å·ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> quoted.sh<br><span class="hljs-comment"># note the quotes</span><br><span class="hljs-built_in">ls</span> -l <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;1&#125;</span>&quot;</span><br>$<br>$ ./quoted.sh <span class="hljs-string">&quot;Oh the Waste&quot;</span><br>-rw-r--r--  1 smith <span class="hljs-built_in">users</span> 28470 2007-01-11 19:22 Oh the Waste<br>$<br></code></pre></td></tr></table></figure><ol start="12"><li><strong>è·å–é»˜è®¤å€¼</strong></li></ol><p>å¦‚æœæŒ‡å®šå‚æ•°ï¼ˆè¿™é‡Œæ˜¯ $1ï¼‰ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ™å°†è¿ç®—ç¬¦ä¹‹åçš„å†…å®¹ï¼ˆæœ¬ä¾‹ä¸º &#x2F;tmpï¼‰ä½œä¸ºå€¼ã€‚å¦åˆ™ï¼Œä½¿ç”¨å·²ç»è®¾ç½®å¥½çš„å‚æ•°å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¦‚æœå€¼ä¸ºè·¯å¾„ç›´æ¥å†™ï¼Œæˆ–è€…åŠ  &quot;&quot;åŒå¼•å·ï¼Œç”¨å•å¼•å·ä¼šå¯¼è‡´è·¯å¾„å¤±æ•ˆ</span><br><span class="hljs-variable">$&#123;1:-/tmp&#125;</span><br></code></pre></td></tr></table></figure><ol start="13"><li><strong>è®¾ç½®é»˜è®¤å€¼</strong></li></ol><p>é¦–æ¬¡å¼•ç”¨ shell å˜é‡æ—¶ï¼Œå¦‚æœè¯¥å˜é‡æ²¡æœ‰å€¼ï¼Œåˆ™ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ä¸ºå…¶èµ‹å€¼</p><p>èµ‹å€¼è¿ç®—ç¬¦æœ‰ä¸€ä¸ªé‡è¦çš„ä¾‹å¤–ï¼šä¸èƒ½å¯¹ä½ç½®å‚æ•°ï¼ˆå¦‚ $1æˆ– $*ï¼‰èµ‹å€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;HOME:=/tmp&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>:&#x3D; æ‰§è¡Œèµ‹å€¼æ“ä½œï¼ŒåŒæ—¶è¿”å›è¿ç®—ç¬¦å³ä¾§çš„å€¼ã€‚:- åªåšäº†å‰è€…ä¸€åŠçš„å·¥ä½œï¼šè¿”å›å€¼ï¼Œä½†ä¸èµ‹å€¼</p></blockquote><ol start="14"><li><strong>ä½¿ç”¨ç©ºå€¼ä½œä¸ºæœ‰æ•ˆçš„é»˜è®¤å€¼</strong></li></ol><p>å¦‚æœå†™æˆä¸å¸¦å†’å·çš„ ${HOME&#x3D;&#x2F;tmp}ï¼Œé‚£ä¹ˆèµ‹å€¼æ“ä½œä»…ä¼šåœ¨è¯¥å˜é‡ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼ˆä»æœªè®¾ç½®æˆ–å·²æ˜ç¡®åˆ é™¤ï¼‰å‘ç”Ÿ</p><ol start="15"><li><strong>ä¸åªä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡ä½œä¸ºé»˜è®¤å€¼</strong></li></ol><p>èƒ½å‡ºç°åœ¨ shell å˜é‡å¼•ç”¨å³ä¾§çš„å†…å®¹å¹¶ä¸å±€é™äºå­—ç¬¦ä¸²å¸¸é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;BASE:=&quot;$(pwd)&quot;&#125;</span><br></code></pre></td></tr></table></figure><ol start="16"><li><strong>å¯¹ä¸å­˜åœ¨çš„å‚æ•°è¾“å‡ºé”™è¯¯æ¶ˆæ¯</strong></li></ol><p>ä½¿ç”¨ set -u å‘½ä»¤ï¼Œâ€‹â€œåœ¨å˜é‡æ›¿æ¢æ—¶ï¼Œå°†ä¸å­˜åœ¨çš„å˜é‡è§†ä¸ºä¸€ç§é”™è¯¯â€â€‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"> <span class="hljs-comment">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼šcheck_unset_parms</span><br><span class="hljs-comment">#</span><br>USAGE=<span class="hljs-string">&quot;usage: myscript scratchdir sourcefile conversion&quot;</span><br>FILEDIR=<span class="hljs-variable">$&#123;1:?&quot;Error. You must supply a scratch directory.&quot;&#125;</span><br>FILESRC=<span class="hljs-variable">$&#123;2:?&quot;Error. You must supply a source file.&quot;&#125;</span><br>CVTTYPE=<span class="hljs-variable">$&#123;3:?&quot;Error. <span class="hljs-variable">$&#123;USAGE&#125;</span>&quot;&#125;</span><br> <br> <span class="hljs-comment">## è¿˜å¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œå…¶ä»–å‘½ä»¤</span><br> CVTTYPE=<span class="hljs-variable">$&#123;3:?&quot;Error. $USAGE. $(rm $SCRATCHFILE)&quot;&#125;</span><br></code></pre></td></tr></table></figure><ol start="17"><li><strong>å˜é‡å­—ç¬¦ä¸²æ›¿æ¢</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä»å­—ç¬¦ä¸²nameçš„ç´¢å¼•ä½ç½®startå¼€å§‹ï¼Œè¿”å›é•¿åº¦ä¸ºnumberçš„å­ä¸²</span><br><span class="hljs-comment"># å¦‚æœå­ä¸²ä¸ºç©ºæ ¼åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè½¬ä¸ºæ•°ç»„ï¼Œæ¯”å¦‚ name=&quot;jack rose lucy&quot;, name=($&#123;name&#125;)</span><br><span class="hljs-comment"># ç„¶åç”¨ $&#123;name[@]:0:1&#125;å½¢å¼è¿›è¡Œå¼•ç”¨ï¼Œä¸ç„¶ä¼šæŒ‰å­—ç¬¦ä¸²æ•°é‡è®¡æ•°å–å­é›†</span><br><span class="hljs-comment"># å¦‚æœä¸è½¬æ¢ä¸ºæ•°ç»„ï¼Œç›´æ¥ $&#123;name:0:1&#125; ä¼šè¾“å‡º j</span><br><span class="hljs-variable">$&#123;name:start:number&#125;</span><br><span class="hljs-comment"># è¿”å›å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="hljs-variable">$&#123;#name&#125;</span><br><span class="hljs-comment">## ä»å­—ç¬¦ä¸²èµ·å§‹ä½ç½®å¼€å§‹ï¼Œåˆ é™¤åŒ¹é…patternçš„æœ€çŸ­å­ä¸²</span><br><span class="hljs-variable">$&#123;name#pattern&#125;</span><br><span class="hljs-comment">## ä»å­—ç¬¦ä¸²èµ·å§‹ä½ç½®å¼€å§‹ï¼Œåˆ é™¤åŒ¹é…patternçš„æœ€é•¿å­ä¸²</span><br><span class="hljs-variable">$&#123;name##pattern&#125;</span><br><span class="hljs-comment">## ä»å­—ç¬¦ä¸²ç»“æŸä½ç½®å¼€å§‹ï¼Œåˆ é™¤åŒ¹é…patternçš„æœ€çŸ­å­ä¸²</span><br><span class="hljs-variable">$&#123;name%pattern&#125;</span><br><span class="hljs-comment">## ä»å­—ç¬¦ä¸²ç»“æŸä½ç½®å¼€å§‹ï¼Œåˆ é™¤åŒ¹é…patternçš„æœ€é•¿å­ä¸²</span><br><span class="hljs-variable">$&#123;name%%pattern&#125;</span><br><span class="hljs-comment">## æ›¿æ¢å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„pattern</span><br><span class="hljs-variable">$&#123;name/pattern/string&#125;</span><br><span class="hljs-comment">## æ›¿æ¢å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ‰€æœ‰pattern</span><br><span class="hljs-variable">$&#123;name//pattern/string&#125;</span><br><br><span class="hljs-comment">## å˜é‡ä¸ä¸ºç©ºï¼Œæ›¿æ¢ä¸ºé€—å·</span><br><span class="hljs-variable">$&#123;LIST:+,&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>FILE&#x3D;${FULLPATHTOFILE##*&#x2F;}<br>ç­‰ä»·äºï¼ˆç»“å°¾å¤„ä¸å«&#x2F;æ—¶ï¼‰<br>basename $FULLPATHTOFILE</p></blockquote><ol start="18"><li><strong>å˜é‡å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è½¬æ¢æˆå°å†™</span><br><span class="hljs-variable">$&#123;name,,&#125;</span><br><span class="hljs-comment"># è½¬æ¢æˆå¤§å†™</span><br><span class="hljs-variable">$&#123;name^^&#125;</span><br><span class="hljs-comment"># é¦–å­—æ¯è½¬æ¢æˆå¤§å†™</span><br><span class="hljs-variable">$&#123;name^&#125;</span><br><span class="hljs-comment"># å¤§å†™è½¬æˆå°å†™ï¼Œå°å†™è½¬å¤§å†™</span><br><span class="hljs-variable">$&#123;name~~&#125;</span><br><span class="hljs-comment"># å˜é‡å†…å®¹ä¼šè½¬æ¢æˆå°å†™å­—æ¯</span><br><span class="hljs-built_in">declare</span> -l name<br><span class="hljs-comment"># å…¨éƒ¨å¤§å†™</span><br><span class="hljs-built_in">declare</span> -u name<br><span class="hljs-comment"># ä»…é¦–å­—æ¯å¤§å†™</span><br><span class="hljs-built_in">declare</span> -c name<br></code></pre></td></tr></table></figure><ol start="19"><li><strong>ç®€å•ç®—æ•°</strong></li></ol><p>ç”¨ <code>$(( ))</code> æˆ– <code>let</code> è¿›è¡Œæ•´æ•°è¿ç®—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##  $(( ))å¯ä»¥ç”¨ ** è¿›è¡Œå¹‚è¿ç®—</span><br>COUNT=$((COUNT + <span class="hljs-number">5</span> + MAX * <span class="hljs-number">2</span>))<br><span class="hljs-built_in">let</span> COUNT+=<span class="hljs-string">&#x27;5+MAX*2&#x27;</span><br><br><span class="hljs-built_in">let</span> COUNT+=5<br></code></pre></td></tr></table></figure><ol start="20"><li><strong>æµ‹è¯•æ–‡ä»¶å±æ€§</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ˜¯å¦æ›´æ–°ï¼ˆæ£€æŸ¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼‰â€‹ã€‚ç°æœ‰æ–‡ä»¶è¦æ¯”ä¸å­˜åœ¨çš„æ–‡ä»¶â€œæ–°â€â€‹ã€‚</span><br><span class="hljs-built_in">test</span> FILE1 -nt FILE2ã€€ã€€<br><span class="hljs-comment"># æ˜¯å¦æ›´æ—§ã€‚åŒæ ·ï¼Œä¸å­˜åœ¨çš„æ–‡ä»¶è¦æ¯”ç°æœ‰æ–‡ä»¶â€œæ—§â€â€‹ã€‚</span><br><span class="hljs-built_in">test</span> FILE1 -ot FILE2ã€€ã€€<br><span class="hljs-comment"># å…·æœ‰ç›¸åŒè®¾å¤‡å’Œ inode ç¼–å·ï¼ˆå³ä¾¿ç”±ä¸åŒé“¾æ¥æ‰€æŒ‡å‘ï¼Œä¹Ÿè§†ä¸ºç›¸åŒçš„æ–‡ä»¶ï¼‰â€‹ã€‚</span><br><span class="hljs-built_in">test</span> FILE1 -ef FILE2ã€€ã€€<br><span class="hljs-comment"># æµ‹è¯•æ–‡ä»¶å¤§å°æ˜¯å¦ä¸ä¸ºç©º</span><br><span class="hljs-built_in">test</span> -s FILE<br></code></pre></td></tr></table></figure><ol start="21"><li><strong>ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</strong></li></ol><blockquote><p>bash 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬</p></blockquote><p>ä½¿ç”¨ &#x3D;~ è¿ç®—ç¬¦è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚åªè¦èƒ½å¤ŸåŒ¹é…åˆ°æŸä¸ªå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥åœ¨ shell æ•°ç»„å˜é‡ $BASH_REMATCH ä¸­æ‰¾åˆ°æ¨¡å¼ä¸­çš„å„ä¸ªéƒ¨åˆ†æ‰€åŒ¹é…åˆ°çš„å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><span class="hljs-comment"># å®ä¾‹æ–‡ä»¶ï¼štrackmatch</span><br><span class="hljs-comment">#</span><br><span class="hljs-keyword">for</span> CDTRACK <span class="hljs-keyword">in</span> *<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$CDTRACK</span>&quot;</span> =~ <span class="hljs-string">&quot;([[:alpha:][:blank:]]*)- ([[:digit:]]*) - (.*)$&quot;</span> ]]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> Track <span class="hljs-variable">$&#123;BASH_REMATCH[2]&#125;</span> is <span class="hljs-variable">$&#123;BASH_REMATCH[3]&#125;</span><br>        <span class="hljs-built_in">mv</span> <span class="hljs-string">&quot;<span class="hljs-variable">$CDTRACK</span>&quot;</span> <span class="hljs-string">&quot;Track<span class="hljs-variable">$&#123;BASH_REMATCH[2]&#125;</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><ol start="22"><li><strong>å¾ªç¯</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## while å¾ªç¯</span><br>$ svn status bcb<br>M      bcb/amin.c<br>?      bcb/dmin.c<br>?      bcb/mdiv.tmp<br>A      bcb/optrn.c<br>M      bcb/optson.c<br>?      bcb/prtbout.4161<br>?      bcb/rideaslist.odt<br>?      bcb/x.maxc<br><br><span class="hljs-comment">## cutæå–ä»ç¬¬ 8 åˆ—å¼€å§‹ï¼ˆä¸€ç›´åˆ°è¡Œå°¾ï¼‰çš„å­—ç¬¦ä¸²</span><br>svn status mysrc | grep <span class="hljs-string">&#x27;^?&#x27;</span> | <span class="hljs-built_in">cut</span> -c8- |<br>  <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> FN; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$FN</span>&quot;</span>; <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">&quot;<span class="hljs-variable">$FN</span>&quot;</span>; <span class="hljs-keyword">done</span><br><br><span class="hljs-comment">## å°†è¾“å…¥ä¼ ç»™ä¸¤ä¸ªå˜é‡ï¼Œæœ€åä¸€ä¸ªå˜é‡è·å¾—è¾“å…¥è¡Œä¸­å‰©ä½™çš„æ‰€æœ‰å†…å®¹</span><br>svn status mysrc |<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> TAG FN<br><span class="hljs-keyword">do</span><br>    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$TAG</span> == \? ]]<br>    <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-variable">$FN</span><br>        <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">&quot;<span class="hljs-variable">$FN</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">## for å¾ªç¯</span><br><span class="hljs-comment">## åŒæ‹¬å·è¡¨æ˜è¿™æ˜¯ç®—æœ¯è¡¨è¾¾å¼ï¼Œåœ¨å…¶ä¸­å¼•ç”¨å˜é‡æ—¶ï¼Œä¸ç”¨åŠ  $ï¼ˆä½† $1 ç­‰ä½ç½®å‚æ•°é™¤å¤–ï¼‰â€‹ï¼Œåªè¦æ˜¯ bash ä¸­å‡ºç°åŒæ‹¬å·çš„åœ°æ–¹ï¼Œå‡æ˜¯å¦‚æ­¤</span><br><span class="hljs-keyword">for</span> (( expr1 ; expr2 ; expr3 )) ; <span class="hljs-keyword">do</span> list ; <span class="hljs-keyword">done</span><br><br><span class="hljs-keyword">for</span> (( i=<span class="hljs-number">0</span>, j=<span class="hljs-number">0</span> ; i+j &lt; <span class="hljs-number">10</span> ; i++, j++ ))<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> $((i*j))<br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">## seq å¯ä»¥ç”Ÿæˆæµ®ç‚¹å€¼ï¼Œå‚æ•°ä¾æ¬¡æ˜¯èµ·å§‹å€¼ã€å¢é‡ã€ç»“æŸå€¼</span><br><span class="hljs-keyword">for</span> fp <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1.0 .01 1.1)<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$fp</span>; other stuff too<br><span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">seq</span> 1.0 .01 1.1 |<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> fp<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$fp</span>; other stuff too<br><span class="hljs-keyword">done</span><br><span class="hljs-comment">## $() åœ¨å­ shell ä¸­æ‰§è¡Œå‘½ä»¤</span><br><br><span class="hljs-comment">## åœ¨ç¬¬ä¸€ä¸ªä¾‹å­çš„for å¾ªç¯ä¸­ï¼Œseq å¿…é¡»å…ˆè¿è¡Œå®Œæ¯•ï¼Œç„¶åç”¨å…¨éƒ¨çš„è¾“å‡ºç»“æœæ›¿æ¢æ‰ $()ã€‚å¯¹äºå†—é•¿çš„æ•°å€¼åºåˆ—æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•çš„æ—¶é—´å¼€é”€å’Œå†…å­˜å¼€é”€éƒ½ä¸å°ã€‚</span><br><span class="hljs-comment">## åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œseq ä½œä¸ºå•ç‹¬çš„å‘½ä»¤è¿è¡Œï¼Œé€šè¿‡ç®¡é“å°†å…¶è¾“å‡ºä¼ å…¥ while å¾ªç¯ï¼Œåè€…è¯»å–å…¶ä¸­çš„æ¯ä¸€è¡Œå¹¶åšç›¸åº”å¤„ç†ï¼Œseq å‘½ä»¤æ˜¯ä¸ while å¹¶è¡Œè¿è¡Œçš„</span><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoéƒ¨ç½²GitHubä¸ªäººåšå®¢</title>
    <link href="/2024/08/05/deploy-hexo/"/>
    <url>/2024/08/05/deploy-hexo/</url>
    
    <content type="html"><![CDATA[<h1 id="Hexoéƒ¨ç½²GitHubä¸ªäººåšå®¢"><a href="#Hexoéƒ¨ç½²GitHubä¸ªäººåšå®¢" class="headerlink" title="Hexoéƒ¨ç½²GitHubä¸ªäººåšå®¢"></a>Hexoéƒ¨ç½²GitHubä¸ªäººåšå®¢</h1><h2 id="1-å®‰è£…Hexo"><a href="#1-å®‰è£…Hexo" class="headerlink" title="1. å®‰è£…Hexo"></a>1. å®‰è£…Hexo</h2><p>å®‰è£…Hexoéœ€è¦</p><ul><li>nodejs</li><li>npm</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ³¨æ„nodejsç‰ˆæœ¬</span><br><span class="hljs-comment"># éœ€è¦ ubuntu nobleç‰ˆæœ¬</span><br>apt install nodejs npm<br><span class="hljs-comment"># npm ä¸‹è½½æ…¢éœ€è¦è·Ÿæ¢å›½å†…æºï¼Œæˆ–è€…æ·»åŠ ä»£ç†</span><br>npm install -g hexo<br></code></pre></td></tr></table></figure><h2 id="2-Hexo-å¸¸ç”¨å‘½ä»¤"><a href="#2-Hexo-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2. Hexo å¸¸ç”¨å‘½ä»¤"></a>2. Hexo å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># éœ€è¦ä¸€ç‚¹æ—¶é—´</span><br>hexo init <span class="hljs-variable">$proj_name</span><br><br><span class="hljs-comment">## æ–°å»ºpost</span><br>hexo new <span class="hljs-string">&quot;My First Blog&quot;</span><br><br><span class="hljs-comment">## å¯åŠ¨æœ¬åœ°server</span><br>hexo server<br><br><span class="hljs-comment">## ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²åˆ°github</span><br>hexo generate &amp;&amp; hexo deploy<br><span class="hljs-comment">## å¯ç®€å†™</span><br>hexo g<br>hexo d<br></code></pre></td></tr></table></figure><h2 id="3-é…ç½®-GitHub"><a href="#3-é…ç½®-GitHub" class="headerlink" title="3. é…ç½® GitHub"></a>3. é…ç½® GitHub</h2><ol><li><p>æ–°å»ºä¸€ä¸ªgithubé¡¹ç›®</p></li><li><p>ç‚¹è¿›é¡¹ç›®æ‰¾åˆ°Settings -&gt; Pages è¿›è¡Œé…ç½® GitHub Pages</p><p><img src="/../images/deploy-hexo/page.png" alt="page"></p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°†é¡¹ç›®cloneä¸‹æ¥</span><br><span class="hljs-comment"># æ­¤å¤„æœ€å¥½é…ç½®sshç±»å‹, ä¸ç„¶åé¢æ¯æ¬¡éƒ¨ç½²æ¨é€éƒ½éœ€è¦è¾“å…¥è´¦å·å’Œtokenï¼Œä¸”sshä¸å®¹æ˜“å‡ºç°æŸäº›ç½‘ç»œé—®é¢˜</span><br>git <span class="hljs-built_in">clone</span> <span class="hljs-variable">$url</span><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ç”¨æ¥å­˜å‚¨hexoæºä»£ç </span><br>git checkout -b hexo<br></code></pre></td></tr></table></figure><p><strong>é…ç½®SSHæ–¹å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç”Ÿæˆsshkey</span><br>ssh-keygen -t rsa<br><span class="hljs-comment">## å°†å…¬é’¥å¤åˆ¶åˆ°githubçš„é¡¹ç›®settings -&gt; Deploy keysé‡Œ</span><br><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub<br></code></pre></td></tr></table></figure><blockquote><p>GitHubä»2021å¹´8æœˆ13å·å¼€å§‹ä¸èƒ½ç”¨å¯†ç æ¨é€ï¼Œéœ€è¦ç”¨tokenã€‚</p><p>tokenéœ€è¦åœ¨å³ä¸Šè§’ä¸ªäººSettings -&gt; <a href="https://github.com/settings/apps">Developer Settings</a> -&gt; <a href="https://github.com/settings/tokens">Personal access tokens</a>é‡Œç”Ÿæˆã€‚</p><p>æ³¨æ„ä¿ç®¡ï¼Œä¸¢å¤±äº†éœ€è¦é‡æ–°ç”Ÿæˆã€‚</p></blockquote><h2 id="4-é…ç½®-Hexo"><a href="#4-é…ç½®-Hexo" class="headerlink" title="4. é…ç½® Hexo"></a>4. é…ç½® Hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æŸ¥çœ‹ç›®å½•ç»“æ„</span><br>tree -L 1 <br><span class="hljs-comment">## è¾“å‡ºå¦‚ä¸‹</span><br>MyBlog/<br>â”œâ”€â”€ _config.landscape.yml <span class="hljs-comment">## ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤ä¸»é¢˜landscapeï¼Œä¸»é¢˜å¯åœ¨ https://hexo.io/themes/ å®˜ç½‘è‡ªè¡Œå¯»æ‰¾</span><br>â”œâ”€â”€ _config.yml <span class="hljs-comment">## hexoé…ç½®æ–‡ä»¶</span><br>â”œâ”€â”€ node_modules<br>â”œâ”€â”€ package-lock.json<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ scaffolds<br>â”œâ”€â”€ <span class="hljs-built_in">source</span> <span class="hljs-comment">## postå­˜æ”¾ç›®å½•ï¼Œå¯åœ¨åŒçº§å»ºç«‹imageå­˜æ”¾å›¾ç‰‡</span><br>â””â”€â”€ themes<br></code></pre></td></tr></table></figure><p>æ­¤å¤„<code>_config.yml</code>é…ç½®è‡ªè¡Œä¿®æ”¹ï¼Œæ³¨æ„urlå¡«å†™ä½ çš„ GitHub Pagesåœ°å€ã€‚</p><p><img src="/../images/deploy-hexo/config.png" alt="config"></p><p>åœ¨<code>_config.yml</code>æœ€åæœ‰deployçš„é…ç½®é€‰é¡¹ï¼Œé»˜è®¤å¦‚å›¾ï¼š</p><p><img src="/../images/deploy-hexo/deploy-config.png"></p><p>ä¿®æ”¹ä¸ºï¼š</p><p><img src="/../images/deploy-hexo/deploy-git.png"></p><p>branchå¡«å†™ä½ éœ€è¦éƒ¨ç½²çš„åˆ†æ”¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©masterï¼›</p><p>repo å¡«å†™gitåœ°å€ï¼Œå¯ä»¥æ˜¯httpså½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯sshå½¢å¼ã€‚</p><h2 id="5-éƒ¨ç½²-æ¨é€åˆ°ä»“åº“"><a href="#5-éƒ¨ç½²-æ¨é€åˆ°ä»“åº“" class="headerlink" title="5. éƒ¨ç½²&amp;æ¨é€åˆ°ä»“åº“"></a>5. éƒ¨ç½²&amp;æ¨é€åˆ°ä»“åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## hexo ä¼šç”Ÿæˆä¸€ä¸ª .deploy_git</span><br><span class="hljs-comment">## æ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å†™å…¥ .gitignore</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;.deploy_git/&quot;</span> &gt;&gt; .gitignore<br><span class="hljs-comment">## å¦‚æœä¹‹å‰æœ‰è¿‡æ¨é€éœ€è¦åˆ æ‰</span><br>git <span class="hljs-built_in">rm</span> -r --cached .deploy_git<br><br><span class="hljs-comment">## ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²ï¼Œå› ä¸ºé…ç½®è¿‡gitä»“åœ°å€ï¼Œä¼šè‡ªåŠ¨è§¦å‘github action è¿›è¡Œéƒ¨ç½²</span><br>hexo g &amp;&amp; hexo d<br><br><span class="hljs-comment">## å°†æºæ–‡ä»¶æ¨é€åˆ°hexoåˆ†æ”¯</span><br>git push origin hexo<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSLå¯åŠ¨Linuxå¹¶åˆå§‹åŒ–åŠä»£ç†é…ç½®</title>
    <link href="/2024/08/04/WSL-Linux-init-proxy/"/>
    <url>/2024/08/04/WSL-Linux-init-proxy/</url>
    
    <content type="html"><![CDATA[<h2 id="WSL-å¯åŠ¨-Ubuntu"><a href="#WSL-å¯åŠ¨-Ubuntu" class="headerlink" title="WSL å¯åŠ¨ Ubuntu"></a>WSL å¯åŠ¨ Ubuntu</h2><p>ç”±äº22.04 jammyä¸æ”¯æŒé«˜ç‰ˆæœ¬nodejsï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹è½½24.04 nobleç‰ˆæœ¬çš„Ubuntuã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## æŸ¥çœ‹å¯ä¸‹è½½çš„å‘è¡Œç‰ˆ</span><br>wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-o</span><br><br>wsl <span class="hljs-literal">--install</span> <span class="hljs-literal">-d</span> Ubuntu<span class="hljs-literal">-24</span>.<span class="hljs-number">04</span> <br></code></pre></td></tr></table></figure><p><img src="/../images/wsl-linux-init/available_list.png" alt="list"></p><p>ç­‰å¾…ä¸‹è½½å®Œæˆå°±ä¼šè‡ªåŠ¨è¿›å…¥ã€‚</p><h3 id="é…ç½®-apté˜¿é‡Œæº"><a href="#é…ç½®-apté˜¿é‡Œæº" class="headerlink" title="é…ç½® apté˜¿é‡Œæº"></a>é…ç½® apté˜¿é‡Œæº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br><br><span class="hljs-comment">## æŸ¥çœ‹ç‰ˆæœ¬codename</span><br><span class="hljs-built_in">cat</span> /etc/os-release | grep UBUNTU_CODENAME<br><span class="hljs-comment">## å¦‚ç”¨å…¶ä»–ç‰ˆæœ¬ï¼Œå¦‚22.04 jammyï¼Œå°†nobleæ›¿æ¢ä¸ºjammyå³å¯</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/apt/sources.list &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse</span><br><span class="hljs-string">deb http://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse</span><br><span class="hljs-string">deb-src http://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment">## é…ç½®å®Œåupdate</span><br>apt update<br><br>apt install nodejs npm<br></code></pre></td></tr></table></figure><h2 id="WSL-æœ¬åœ°å¯¼å…¥CentOS"><a href="#WSL-æœ¬åœ°å¯¼å…¥CentOS" class="headerlink" title="WSL æœ¬åœ°å¯¼å…¥CentOS"></a>WSL æœ¬åœ°å¯¼å…¥CentOS</h2><p>WSLæ²¡æœ‰CentOSçš„å‘è¡Œç‰ˆï¼Œå› æ­¤éœ€è¦è‡ªè¡Œå¯¼å‡ºä¸€ä¸ªã€‚</p><p>centosçš„taråŒ…ä»dockerå®¹å™¨å¯¼å‡ºã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wsl <span class="hljs-literal">--import</span> CentOS D:\wsl\centos\ .\centos.tar<br>wsl <span class="hljs-literal">-d</span> CentOS<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/wsl.conf &lt;&lt;EOF<br>[<span class="hljs-type">boot</span>]<br>systemd=true<br>EOF<br></code></pre></td></tr></table></figure><h3 id="é…ç½®-yumé˜¿é‡Œæº"><a href="#é…ç½®-yumé˜¿é‡Œæº" class="headerlink" title="é…ç½® yumé˜¿é‡Œæº"></a>é…ç½® yumé˜¿é‡Œæº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak<br>curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<br>yum clean all &amp;&amp; yum makecache<br><br>yum install initscripts<br>yum install net-tools<br>yum install <span class="hljs-built_in">which</span><br>yum install <span class="hljs-built_in">sudo</span><br>yum install tmux<br></code></pre></td></tr></table></figure><h2 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h2><p>æ­¤å¤„æˆ‘å°†è‡ªå·±çš„WSLç½‘ç»œè®¾ç½®æˆäº†<code>mirrored</code>ï¼Œå› æ­¤åœ¨è®¿é—®ä¸€äº›æœåŠ¡çš„æ—¶å€™å¯ä»¥é€šè¿‡127.0.0.1æ¥è®¿é—®ã€‚</p><p>æ¯”å¦‚ sshå¯ä»¥é€šè¿‡<code>ssh root@127.0.0.1</code>æ¥è¿œç¨‹è¿æ¥ï¼Œæ–¹ä¾¿ä½¿ç”¨å…¶ä»–ç»ˆç«¯ç¨‹åºï¼›WebæœåŠ¡å¯ä»¥é€šè¿‡<a href="http://127.0.0.1/">http://127.0.0.1:80</a> è®¿é—®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## è®¾ç½®ç½‘ç»œä¸ºé•œåƒç½‘ç»œï¼Œå®Œæˆåå…³é—­è™šæ‹Ÿæœºï¼Œç­‰å¾…8ç§’åå†å¯åŠ¨</span><br><span class="hljs-built_in">cat</span> &gt;&gt;/mnt/c/Users/xxx/.wslconfig &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[experimental]</span><br><span class="hljs-string">networkingMode=mirrored</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment">## é…ç½®ä»£ç†</span><br><span class="hljs-comment">## æ ¹æ®è‡ªå·±é€‰æ‹©çš„å·¥å…·å¡«å†™ç«¯å£å·</span><br><span class="hljs-built_in">cat</span> &gt;&gt; ~/.bashrc &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">alias proxy=&#x27;export all_proxy=http://127.0.0.1:7890&#x27;</span><br><span class="hljs-string">alias unproxy=&#x27;unset all_proxy&#x27;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-built_in">source</span> ~/.bashrc<br><span class="hljs-comment">## è¿è¡Œå³å¯å¯åŠ¨ä»£ç†</span><br>proxy<br><br><span class="hljs-comment">## é…ç½®npmä»£ç†</span><br>npm config <span class="hljs-built_in">set</span> proxy=http://127.0.0.1:7890<br><span class="hljs-comment">## é»˜è®¤registryåœ°å€ï¼Œå¯æ¢æˆå…¶ä»–å›½å†…æº</span><br>npm config <span class="hljs-built_in">set</span> registry=http://registry.npmjs.org<br><br>npm install -g hexo<br><br><span class="hljs-comment"># æˆ–è®¾ç½®ä»£ç†</span><br>npm config <span class="hljs-built_in">set</span> proxy http://127.0.0.1:7890<br>npm config <span class="hljs-built_in">set</span> https-proxy http://127.0.0.1:7890<br>npm config <span class="hljs-built_in">set</span> strict-ssl <span class="hljs-literal">false</span><br><span class="hljs-comment"># å–æ¶ˆä»£ç†</span><br>npm config delete proxy<br>npm config delete https-proxy<br></code></pre></td></tr></table></figure><h2 id="é…ç½®-githubåŠ é€Ÿ"><a href="#é…ç½®-githubåŠ é€Ÿ" class="headerlink" title="é…ç½® githubåŠ é€Ÿ"></a>é…ç½® githubåŠ é€Ÿ</h2><p>åœ¨<code>/etc/hosts</code>ä¸‹æ·»åŠ </p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">199.96.58.157</span> github.global.ssl.fastly.net<br><span class="hljs-number">20.205.243.166</span> github.com<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²</title>
    <link href="/2024/08/04/local-llm-deploy/"/>
    <url>/2024/08/04/local-llm-deploy/</url>
    
    <content type="html"><![CDATA[<h1 id="æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²"><a href="#æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²" class="headerlink" title="æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²"></a>æœ¬åœ°å¤§æ¨¡å‹éƒ¨ç½²</h1><blockquote><p>Windowsæ ¹æ®å®˜ç½‘ä¸‹è½½å®‰è£…å³å¯</p><p><a href="https://github.com/ollama/ollama/blob/main/docs/linux.md">Linux å®˜æ–¹å®‰è£…æ­¥éª¤</a></p></blockquote><h2 id="1-å®‰è£…ollama"><a href="#1-å®‰è£…ollama" class="headerlink" title="1. å®‰è£…ollama"></a>1. å®‰è£…ollama</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œéœ€è¦magic</span><br>curl -fsSL https://ollama.com/install.sh | sh<br><span class="hljs-comment">## ä¹Ÿå¯å…ˆæŠŠollama-linux-amd64ä¸‹è½½åˆ°æœ¬åœ°</span><br><span class="hljs-comment">## ç„¶åä¸Šä¼ åˆ°linux</span><br><span class="hljs-comment">## ä¿®æ”¹å®‰è£…è„šæœ¬ä¸¤å¤„åœ°æ–¹å†å®‰è£…</span><br>curl -fsSL https://ollama.com/install.sh &gt;&gt; ollama_install.sh<br>sed -i.bak -e <span class="hljs-string">&#x27;/TEMP_DIR=/c TEMP_DIR=/tmp&#x27;</span> -e <span class="hljs-string">&#x27;/curl --fail.*-o/s/^/#/&#x27;</span> ollama_install.sh<br><span class="hljs-comment">## å°† ollama-linux-amd64æ”¾åˆ°tmpä¸‹ï¼Œå¹¶é‡å‘½åä¸ºollama</span><br><span class="hljs-built_in">mv</span> ollama-linux-amd64 /tmp/ollama<br><span class="hljs-comment">## è¿è¡Œollama_install.shå³å¯</span><br>sh ollama_install.sh<br><span class="hljs-comment">## æŸ¥çœ‹ollamaçŠ¶æ€</span><br>systemctl status ollama<br></code></pre></td></tr></table></figure><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python-repl">root@localhost:~/mp_mount/llm# sh ollama_install.sh<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Downloading ollama...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Installing ollama to /usr/local/<span class="hljs-built_in">bin</span>...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Creating ollama user...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Adding ollama user to render group...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Adding ollama user to video group...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Adding current user to ollama group...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Creating ollama systemd service...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Enabling <span class="hljs-keyword">and</span> starting ollama service...</span><br>Created symlink /etc/systemd/system/default.target.wants/ollama.service â†’ /etc/systemd/system/ollama.service.<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">The Ollama API <span class="hljs-keyword">is</span> now available at <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">11434.</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Install complete. Run <span class="hljs-string">&quot;ollama&quot;</span> <span class="hljs-keyword">from</span> the command line.</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—®<code>127.0.0.1:11434</code>æ˜¾ç¤º<code>Ollama is running</code>ï¼Œåˆ™éƒ¨ç½²æˆåŠŸã€‚</p><p>å®¹å™¨å½¢å¼:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -v ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama<br></code></pre></td></tr></table></figure><h2 id="2-é€‰æ‹©æ¨¡å‹"><a href="#2-é€‰æ‹©æ¨¡å‹" class="headerlink" title="2. é€‰æ‹©æ¨¡å‹"></a>2. é€‰æ‹©æ¨¡å‹</h2><p><a href="https://ollama.com/">https://ollama.com/</a> å®˜ç½‘å³ä¸Šè§’ model</p><p><img src="/../images/local-llm-deploy/select-model.png" alt="select-model"></p><p>è¿™é‡Œæ¨¡å‹æˆ‘ä»¬é€‰æ‹©é˜¿é‡Œçš„åƒé—®2ï¼Œå¤åˆ¶å‘½ä»¤<code>ollama run qwen2</code>åœ¨linuxä¸Šè¿è¡Œå³å¯ï¼Œä¸‹è½½æ—¶é—´ä¼šæœ‰ç‚¹é•¿ï¼Œè€å¿ƒç­‰å¾…ã€‚</p><p><img src="/../images/local-llm-deploy/qwen2.png" alt="open-webui"></p><h2 id="3-å®‰è£…open-webui"><a href="#3-å®‰è£…open-webui" class="headerlink" title="3. å®‰è£…open-webui"></a>3. å®‰è£…open-webui</h2><p><a href="https://github.com/open-webui/open-webui">https://github.com/open-webui/open-webui</a></p><p>é€šè¿‡å®¹å™¨åŒ–éƒ¨ç½²ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 3000:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main<br></code></pre></td></tr></table></figure><p><a href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a> è®¿é—®ï¼Œéœ€è¦æ³¨å†Œï¼Œéšä¾¿å¡«å†™å³å¯ã€‚</p><p>ç™»å½•åæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="/../images/local-llm-deploy/open-webui.png" alt="open-webui"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æˆåŠŸéƒ¨ç½²äº†ä¸€ä¸ªç”±CPUæä¾›ç®—åŠ›çš„å¤§è¯­è¨€æ¨¡å‹ã€‚</p><p>ç”±äºCPUå’ŒGPUè®¾è®¡ç»“æ„çš„ä¸åŒï¼ŒCPUåœ¨å¤„ç†å¤§æ¨¡å‹è¯­è¨€æ—¶æ•ˆæœå¹¶ä¸ç†æƒ³ã€‚</p><p>æ ¹æ®å‰é¢éƒ¨ç½²å®Œåï¼Œä½¿ç”¨æ—¶ä¼šå‘ç°æ¨¡å‹ç»™å‡ºå›å¤çš„æ—¶å€™ååº”å¾ˆæ…¢ï¼Œä¸”æ˜¯ä¸€ä¸ªå­—ä¸€ä¸ªå­—è¹¦å‡ºæ¥çš„ã€‚</p><p>ç„¶è€ŒGPUé©±åŠ¨å¤§æ¨¡å‹èƒ½å¤Ÿæ˜¾è‘—æé«˜å…¶ååº”é€Ÿåº¦ï¼Œå›å¤ä¹Ÿæ˜¯ä¸€æ®µä¸€æ®µæ˜¾ç¤ºã€‚</p><p>ä¸‹é¢å®¹å™¨åŒ–éƒ¨ç½²ä¸€å¹¶ä»‹ç»å¦‚ä½•ä½¿ç”¨GPUæä¾›ç®—åŠ›ã€‚</p><h2 id="4-å®¹å™¨åŒ–éƒ¨ç½²"><a href="#4-å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="4. å®¹å™¨åŒ–éƒ¨ç½²"></a>4. å®¹å™¨åŒ–éƒ¨ç½²</h2><p>ä½¿ç”¨Nvidiaæ˜¾å¡éœ€è¦ä¸‹è½½é©±åŠ¨</p><blockquote><p>Nvidia å®˜ç½‘</p><p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## é…ç½®aptåŒ…ä»“åº“åœ°å€</span><br>curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | <span class="hljs-built_in">sudo</span> gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \<br>  &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \<br>    sed <span class="hljs-string">&#x27;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#x27;</span> | \<br>    <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list<br>    <br><span class="hljs-comment">## æ›´æ–°ä»“åº“åŒ…åˆ—è¡¨</span><br><span class="hljs-built_in">sudo</span> apt-get update<br><br><span class="hljs-comment">## å®‰è£…å·¥å…·</span><br><span class="hljs-built_in">sudo</span> apt-get install -y nvidia-container-toolkit<br><br><span class="hljs-comment">## å¯ä½¿ç”¨è¯¥å‘½ä»¤æŸ¥çœ‹gpu</span><br>nvidia-smi<br><span class="hljs-comment">## æŸ¥çœ‹æ˜¾å¡åˆ—è¡¨</span><br>nvidia-smi -L<br><span class="hljs-comment">## åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯è§‚å¯Ÿgpuè¿è¡Œæƒ…å†µå˜åŒ–</span><br>watch -n 1 nvidia-smi<br><span class="hljs-comment"># æˆ–</span><br>nvidia-smi -l<br><br><span class="hljs-comment">## è¿è¡Œç”±gpué©±åŠ¨çš„ollamaï¼Œå°†å¤§æ¨¡å‹å­˜æ”¾è·¯å¾„æŒä¹…åŒ–ï¼Œ--gpus allå°†æ‰€æœ‰gpuè®¾å¤‡åŠ å…¥å®¹å™¨</span><br>docker run --gpus all -d -v /opt/ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama<br><br><span class="hljs-comment">## ä¸‹è½½å¤§æ¨¡å‹</span><br>docker <span class="hljs-built_in">exec</span> -it ollama ollama pull qwen2:7b<br></code></pre></td></tr></table></figure><p><strong>å…¶ä»–åŒ…ç®¡ç†å·¥å…·é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## yum åœ°å€</span><br>curl -s -L https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo | \<br>  <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/yum.repos.d/nvidia-container-toolkit.repo<br>  <br><span class="hljs-comment">## zypperåœ°å€</span><br><span class="hljs-built_in">sudo</span> zypper ar https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo<br><span class="hljs-built_in">sudo</span> zypper --gpg-auto-import-keys install -y nvidia-container-toolkit<br></code></pre></td></tr></table></figure><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><h3 id="mac-ç¯å¢ƒä¸‹éƒ¨ç½²"><a href="#mac-ç¯å¢ƒä¸‹éƒ¨ç½²" class="headerlink" title="mac ç¯å¢ƒä¸‹éƒ¨ç½²"></a>mac ç¯å¢ƒä¸‹éƒ¨ç½²</h3><p>Docker Desktop åœ¨ macOS ä¸Šè¿è¡Œæ—¶ï¼Œä¼šé€šè¿‡ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºï¼ˆå¦‚ colima æˆ–åŸºäº HyperKit çš„è™šæ‹Ÿæœºï¼‰æ¥è¿è¡Œ Docker å®¹å™¨ã€‚è¿™ç§æ–¹å¼ç¡®ä¿å®¹å™¨è¿è¡Œåœ¨ä¸€ä¸ª Linux å†…æ ¸ä¸Šï¼Œè€Œä¸æ˜¯ macOS çš„å†…æ ¸ã€‚å› æ­¤ï¼Œ&#x2F;var&#x2F;lib&#x2F;docker å®é™…ä¸Šå­˜åœ¨äºè™šæ‹Ÿæœºå†…ï¼Œè€Œä¸æ˜¯ macOS æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>è¿›å…¥ Docker Desktop çš„è™šæ‹Ÿæœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker context use default<br>docker run --<span class="hljs-built_in">rm</span> -it --privileged --pid=host justincormack/nsenter1<br></code></pre></td></tr></table></figure><p>æ•°æ®ä½ç½®é€šå¸¸åœ¨:  <code>~/Library/Containers/com.docker.docker/Data/vms/0/</code></p><p>è°ƒæ•´ Docker Desktop è™šæ‹Ÿæœºçš„ç£ç›˜å¤§å°:<br><code>settings -&gt; resuorces -&gt; advanced -&gt; Disk usage limit</code></p>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSL åŸºç¡€ç”¨æ³•</title>
    <link href="/2024/08/04/wsl-base/"/>
    <url>/2024/08/04/wsl-base/</url>
    
    <content type="html"><![CDATA[<h1 id="WSL-åŸºç¡€ç”¨æ³•"><a href="#WSL-åŸºç¡€ç”¨æ³•" class="headerlink" title="WSL åŸºç¡€ç”¨æ³•"></a>WSL åŸºç¡€ç”¨æ³•</h1><h2 id="æ£€æŸ¥-WSLæ˜¯å¦å®‰è£…"><a href="#æ£€æŸ¥-WSLæ˜¯å¦å®‰è£…" class="headerlink" title="æ£€æŸ¥ WSLæ˜¯å¦å®‰è£…"></a>æ£€æŸ¥ WSLæ˜¯å¦å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## æ£€æŸ¥ç‰ˆæœ¬</span><br>wsl <span class="hljs-literal">--version</span><br></code></pre></td></tr></table></figure><p><img src="/../images/wsl-base/wsl-version.png" alt="wsl-version"></p><p>æœ‰è¾“å‡ºå¦‚å›¾åˆ™ä¸ºå·²å®‰è£…ã€‚</p><h2 id="å®‰è£…-WSL"><a href="#å®‰è£…-WSL" class="headerlink" title="å®‰è£… WSL"></a>å®‰è£… WSL</h2><blockquote><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/install-manual">æ—§ç‰ˆå®‰è£…æ–¹å¼</a></p></blockquote><p>å®‰è£… WSL 2 ä¹‹å‰ï¼Œå¿…é¡»å¯ç”¨â€œè™šæ‹Ÿæœºå¹³å°â€å¯é€‰åŠŸèƒ½ã€‚</p><p>è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">dism.exe /online /<span class="hljs-built_in">enable-feature</span> /featurename:VirtualMachinePlatform /all /norestart<br></code></pre></td></tr></table></figure><p>å¿…é¡»è¿è¡Œ Windows 10 ç‰ˆæœ¬ 2004 åŠæ›´é«˜ç‰ˆæœ¬ï¼ˆå†…éƒ¨ç‰ˆæœ¬ 19041 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰æˆ– Windows 11 æ‰èƒ½ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚ </p><p>åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹æ‰“å¼€ PowerShell æˆ– Windows å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œç„¶åé‡å¯è®¡ç®—æœºã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># æ­¤å‘½ä»¤å°†å¯ç”¨è¿è¡Œ WSL å¹¶å®‰è£… Linux çš„ Ubuntu å‘è¡Œç‰ˆæ‰€éœ€çš„åŠŸèƒ½</span><br>wsl <span class="hljs-literal">--install</span><br><br><span class="hljs-comment">## æ›´æ–°å†…æ ¸</span><br><span class="hljs-comment">## Linux å†…æ ¸æ›´æ–°åŒ…ä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ WSL 2 Linux å†…æ ¸ï¼Œä»¥ä¾¿åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­è¿è¡Œ WSL</span><br>wsl <span class="hljs-literal">--update</span><br><br><span class="hljs-comment">## è®¾ç½®é»˜è®¤ç‰ˆæœ¬</span><br>wsl <span class="hljs-literal">--set-default-version</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬"><a href="#æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬"></a>æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## æŸ¥çœ‹å¯å®‰è£…å‘è¡Œç‰ˆ</span><br>wsl <span class="hljs-literal">--list</span> <span class="hljs-literal">--online</span><br>wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-o</span><br><span class="hljs-comment">## æŸ¥çœ‹å·²å®‰è£…å‘è¡Œç‰ˆ</span><br>wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-v</span><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ä¸€ä¸ªå‘è¡Œç‰ˆ"><a href="#å®‰è£…ä¸€ä¸ªå‘è¡Œç‰ˆ" class="headerlink" title="å®‰è£…ä¸€ä¸ªå‘è¡Œç‰ˆ"></a>å®‰è£…ä¸€ä¸ªå‘è¡Œç‰ˆ</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## å¯ç›´æ¥è¿è¡Œä¸‹è½½å®‰è£…</span><br>wsl <span class="hljs-literal">--install</span> <span class="hljs-literal">-d</span> &lt;Distribution Name&gt;<br>wsl <span class="hljs-literal">--install</span> <span class="hljs-literal">--web-download</span> <span class="hljs-literal">-d</span> &lt;Distribution Name&gt;<br><span class="hljs-comment">## ä¹Ÿå¯ç›´æ¥æœ¬åœ°å¯¼å…¥</span><br><span class="hljs-comment">## dockerå¯¼å‡ºçš„å®¹å™¨taråŒ…å¯ç”¨åœ¨wsl</span><br>docker export <span class="hljs-variable">$container</span> <span class="hljs-literal">-o</span> <span class="hljs-variable">$container</span>.tar<br>wsl <span class="hljs-literal">--import</span> centos D:\wsl\centos\ .\centos.tar<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/use-custom-distro">å¯¼å…¥ä»»æ„å‘è¡Œç‰ˆ</a></p></blockquote><h2 id="æ“ä½œè™šæ‹Ÿæœº"><a href="#æ“ä½œè™šæ‹Ÿæœº" class="headerlink" title="æ“ä½œè™šæ‹Ÿæœº"></a>æ“ä½œè™šæ‹Ÿæœº</h2><p>ä½¿ç”¨<code>wsl -l -v</code>å¯çœ‹åˆ°å¦‚å›¾æœ‰å››ä¸ªå·²å®‰è£…å‘è¡Œç‰ˆ</p><p><img src="/../images/wsl-base/installed.png" alt="installed"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## è¿›å…¥centosç‰ˆæœ¬linux</span><br>wsl <span class="hljs-literal">-d</span> centos<br></code></pre></td></tr></table></figure><p>è¦è®¾ç½®ä¸ <code>wsl</code> å‘½ä»¤ä¸€èµ·ä½¿ç”¨çš„é»˜è®¤ Linux å‘è¡Œç‰ˆï¼Œè¾“å…¥ <code>wsl -s </code> æˆ– <code>wsl --set-default </code>ã€‚</p><p>ä¾‹å¦‚ï¼Œä» PowerShell&#x2F;CMD è¾“å…¥ <code>wsl -s Debian</code>ï¼Œå°†é»˜è®¤å‘è¡Œç‰ˆè®¾ç½®ä¸º Debianã€‚ ç°åœ¨ä» Powershell è¿è¡Œ <code>wsl npm init</code> å°†åœ¨ Debian ä¸­è¿è¡Œ <code>npm init</code> å‘½ä»¤ã€‚</p><h2 id="ä¿®æ”¹-WSLé…ç½®"><a href="#ä¿®æ”¹-WSLé…ç½®" class="headerlink" title="ä¿®æ”¹ WSLé…ç½®"></a>ä¿®æ”¹ WSLé…ç½®</h2><ol><li><p>æœºå™¨å†…é…ç½®</p><p>è¿›å…¥è™šæ‹Ÿæœºåï¼Œè¿è¡Œ<code>df -h</code>å¯ä»¥æŸ¥çœ‹åˆ°å®¿ä¸»æœºçš„å„ä¸ªç›˜ç¬¦éƒ½å·²æŒ‚è½½åˆ°è¯¥æœºå™¨ä¸Šã€‚</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## é»˜è®¤ä¸å¯ç”¨systemctlæ§åˆ¶æœåŠ¡ï¼Œéœ€è¦WSLç‰ˆæœ¬0.67.6ä»¥ä¸Š</span><br><span class="hljs-comment">## é»˜è®¤windowsè®¿é—®wsl linux ä»¥é»˜è®¤ç”¨æˆ·è®¿é—®ï¼Œå› æ­¤æ— æ³•è®¿é—®rootç”¨æˆ·æ–‡ä»¶</span><br><span class="hljs-comment">## ä¿®æ”¹ä¸ºå¯ç”¨systemdåŠé»˜è®¤rootç”¨æˆ·ç™»å½•</span><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/wsl.conf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[boot]</span><br><span class="hljs-string">systemd=true</span><br><span class="hljs-string">[user]</span><br><span class="hljs-string">default=root</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><ol start="2"><li><p>WSL å…¨å±€é…ç½®</p><p>å¼€å¯é•œåƒipåœ°å€ï¼Œè™šæ‹Ÿæœºåœ°å€ä¼šå˜æ›´ä¸ºå®¿ä¸»æœºåŒä¸€ä¸ªipã€‚</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt;/mnt/c/Users/xxx/.wslconfig &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[experimental]</span><br><span class="hljs-string">networkingMode=mirrored</span><br><span class="hljs-string">autoProxy=true</span><br><span class="hljs-string">dnsTunneling=true</span><br><span class="hljs-string">firewall=true</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åéœ€è¦è¿è¡Œ<code>wsl --shutdown</code>ï¼Œå¹¶éœ€è¦<strong>é—´éš”8ç§’</strong>åå†å¯åŠ¨è™šæ‹Ÿæœºã€‚</p><blockquote><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config">é«˜çº§è®¾ç½®é…ç½®</a></p></blockquote><h2 id="åˆ é™¤ä¸éœ€è¦çš„å‘è¡Œç‰ˆ"><a href="#åˆ é™¤ä¸éœ€è¦çš„å‘è¡Œç‰ˆ" class="headerlink" title="åˆ é™¤ä¸éœ€è¦çš„å‘è¡Œç‰ˆ"></a>åˆ é™¤ä¸éœ€è¦çš„å‘è¡Œç‰ˆ</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wsl <span class="hljs-literal">--unregister</span> &lt;Distro&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux ç£ç›˜åŸºç¡€</title>
    <link href="/2024/07/17/Linux-disk-base/"/>
    <url>/2024/07/17/Linux-disk-base/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-ç£ç›˜åŸºç¡€"><a href="#Linux-ç£ç›˜åŸºç¡€" class="headerlink" title="Linux ç£ç›˜åŸºç¡€"></a>Linux ç£ç›˜åŸºç¡€</h1><p>å…ˆä»å¦‚ä½•ä½¿ç”¨å¼€å§‹</p><ul><li><p>å¦‚ä½•æŸ¥ç£ç›˜å ç”¨å¤§å°åŠåŸºæœ¬ä¿¡æ¯</p><p>å°†ä¼šç”¨åˆ°çš„å‘½ä»¤ï¼š</p><ul><li>df</li><li>lsblk</li><li>du</li><li>blkid</li></ul></li><li><p>å¦‚ä½•è¿›è¡Œç£ç›˜åˆ†åŒºã€åˆ¶ä½œé€»è¾‘å·ã€æ ¼å¼åŒ–ã€æŒ‚è½½</p><p>å°†ä¼šç”¨åˆ°çš„å‘½ä»¤ï¼š</p><ul><li>fdisk</li><li>gdisk</li><li>parted</li><li>pvcreate</li><li>vgcreate</li><li>lvcreate</li><li>mkfs</li><li>mount</li></ul></li></ul><p>ç„¶åç®€å•äº†è§£ç£ç›˜åˆ†åŒºçš„åŸç†</p><ul><li>MBR</li><li>GPT</li></ul><p>æœ€åæ˜¯æ“ä½œç£ç›˜æ—¶å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ã€‚ä¾‹å¦‚æœºå™¨æ·»åŠ ç£ç›˜åç³»ç»Ÿå±‚é¢æ²¡æœ‰æ˜¾ç¤ºã€å·²åˆ†åŒºæ²¡åšé€»è¾‘å·çš„ç£ç›˜æ‰©å®¹ã€æ›¾ç»ä½¿ç”¨è¿‡çš„ç£ç›˜æ¢åˆ°æ–°æœºå™¨ä½¿ç”¨æŠ¥é”™ã€å·²åˆ é™¤æ–‡ä»¶<code>df -h</code>ä»ç„¶æ˜¾ç¤ºå ç”¨ã€æŒ‚è½½ç±»ä¼¼nfsç­‰ç½‘ç»œç›˜æ—¶æ“ä½œå¡é¡¿ã€å®é™…å ç”¨ä¸æ˜¾ç¤ºä¸ç¬¦ç­‰ç­‰â€¦</p><h2 id="ç£ç›˜ä¿¡æ¯æŸ¥çœ‹"><a href="#ç£ç›˜ä¿¡æ¯æŸ¥çœ‹" class="headerlink" title="ç£ç›˜ä¿¡æ¯æŸ¥çœ‹"></a>ç£ç›˜ä¿¡æ¯æŸ¥çœ‹</h2><h3 id="1-æŸ¥çœ‹ç£ç›˜ä½¿ç”¨é‡-â€“-display-file-system"><a href="#1-æŸ¥çœ‹ç£ç›˜ä½¿ç”¨é‡-â€“-display-file-system" class="headerlink" title="1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨é‡ â€“ display file system"></a>1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨é‡ â€“ display file system</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h <span class="hljs-comment"># äºŒè¿›åˆ¶è®¡ç®—æ–¹å¼ï¼Œä»¥äººç±»å‹å¥½å½¢å¼æ˜¾ç¤ºï¼Œå¦‚1024M=1G</span><br><span class="hljs-built_in">df</span> -l <span class="hljs-comment"># åªåˆ—å‡ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå³æ’é™¤nfsæˆ–å…¶ä»–ç±»ä¼¼çš„å¦‚nasç›˜å­˜å‚¨æŒ‚è½½</span><br><span class="hljs-built_in">df</span> -T <span class="hljs-comment"># æ˜¾ç¤ºæŒ‚è½½ç±»å‹</span><br><span class="hljs-built_in">df</span> -H <span class="hljs-comment"># åè¿›åˆ¶è®¡ç®—æ–¹å¼ï¼Œä»¥äººç±»å‹å¥½å½¢å¼æ˜¾ç¤ºï¼Œå¦‚1000M=1G</span><br><span class="hljs-built_in">df</span> -t xfs <span class="hljs-comment"># æŒ‡å®šæ˜¾ç¤ºxfsç±»å‹çš„æŒ‚è½½</span><br><span class="hljs-built_in">df</span> -i<br></code></pre></td></tr></table></figure><h3 id="2-æŸ¥çœ‹ç£ç›˜åˆ†åŒºæŒ‚è½½ä¿¡æ¯-â€“-list-block"><a href="#2-æŸ¥çœ‹ç£ç›˜åˆ†åŒºæŒ‚è½½ä¿¡æ¯-â€“-list-block" class="headerlink" title="2. æŸ¥çœ‹ç£ç›˜åˆ†åŒºæŒ‚è½½ä¿¡æ¯ â€“ list block"></a>2. æŸ¥çœ‹ç£ç›˜åˆ†åŒºæŒ‚è½½ä¿¡æ¯ â€“ list block</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br>lsblk -l <br></code></pre></td></tr></table></figure><p>   ä½¿ç”¨<code>lsblk</code>è¾“å‡ºå¦‚ä¸‹:</p>   <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tap">NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda       8:0   <span class="hljs-number"> 0 </span>  15G <span class="hljs-number"> 0 </span>disk<br>â”œâ”€sda1    8:1   <span class="hljs-number"> 0 </span>  14G <span class="hljs-number"> 0 </span>part /<br>â”œâ”€sda14   8:14  <span class="hljs-number"> 0 </span>   4M <span class="hljs-number"> 0 </span>part<br>â”œâ”€sda15   8:15  <span class="hljs-number"> 0 </span> 106M <span class="hljs-number"> 0 </span>part /boot/efi<br>â””â”€sda16 259:0   <span class="hljs-number"> 0 </span> 913M <span class="hljs-number"> 0 </span>part /boot<br>sr0      11:0   <span class="hljs-number"> 1 </span>  54K <span class="hljs-number"> 0 </span>rom<br></code></pre></td></tr></table></figure><h3 id="3-æŸ¥çœ‹å…·ä½“æ–‡ä»¶æˆ–ç›®å½•å¤§å°-â€“-disk-usage"><a href="#3-æŸ¥çœ‹å…·ä½“æ–‡ä»¶æˆ–ç›®å½•å¤§å°-â€“-disk-usage" class="headerlink" title="3. æŸ¥çœ‹å…·ä½“æ–‡ä»¶æˆ–ç›®å½•å¤§å° â€“ disk usage"></a>3. æŸ¥çœ‹å…·ä½“æ–‡ä»¶æˆ–ç›®å½•å¤§å° â€“ disk usage</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">du</span> -sh <span class="hljs-comment"># è®¡ç®—æ€»å¤§å°</span><br><span class="hljs-built_in">du</span> -ahd 0 <span class="hljs-comment"># ä¸ä¸Šè¿°ç›¸åŒ</span><br><span class="hljs-built_in">du</span> -sh * <span class="hljs-comment"># è®¡ç®—å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å…·ä½“å¤§å°ï¼Œæœ€åè®¡ç®—å‡ºæ€»å€¼ï¼Œå¹¶ä»¥äººç±»å‹å¥½å½¢å¼è¾“å‡º</span><br><span class="hljs-built_in">du</span> -ahd 1 <span class="hljs-comment"># ä¸ä¸Šè¿°ç›¸åŒ</span><br><span class="hljs-comment"># -d åœ¨æœ‰æŸäº›ç‰ˆæœ¬ä¸å¯ç”¨ï¼Œéœ€è¦æ¢æˆ--max-depth 1</span><br><span class="hljs-built_in">du</span> -ahd 1 --time <span class="hljs-comment"># æ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•ä¿®æ”¹æ—¶é—´</span><br><span class="hljs-built_in">du</span> -ahd 1 --time | <span class="hljs-built_in">sort</span> -h <span class="hljs-comment">## ä»¥äººç±»å‹å¥½å½¢å¼è¿›è¡Œæ’åºè¾“å‡º</span><br><span class="hljs-built_in">du</span> -ahd 1 ./ -x ./ <span class="hljs-comment"># è·³è¿‡ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ï¼Œç»å¸¸å¯ä»¥ç”¨æ¥è§„é¿nfsè¿™ç±»ç½‘ç»œæŒ‚è½½</span><br></code></pre></td></tr></table></figure><h3 id="4-å…¶ä»–å‘½ä»¤"><a href="#4-å…¶ä»–å‘½ä»¤" class="headerlink" title="4. å…¶ä»–å‘½ä»¤"></a>4. å…¶ä»–å‘½ä»¤</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">blkid <span class="hljs-comment">## block id, å¯ä»¥ç”¨æ¥æŸ¥çœ‹uuidåŠæ–‡ä»¶ç³»ç»Ÿç±»å‹</span><br><span class="hljs-comment">## ä»¥ä¸‹å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥çœ‹åˆ†åŒºæƒ…å†µ</span><br>fdisk -l <br>gdisk -l<br>parted /dev/vda <span class="hljs-built_in">print</span><br></code></pre></td></tr></table></figure><h2 id="ç£ç›˜åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½"><a href="#ç£ç›˜åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½" class="headerlink" title="ç£ç›˜åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½"></a>ç£ç›˜åˆ†åŒºã€æ ¼å¼åŒ–ã€æŒ‚è½½</h2><blockquote><p>ç£ç›˜æœ‰ä»·ï¼Œæ•°æ®æ— ä»·ï¼Œå¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºã€æ‰©å®¹æ“ä½œæ—¶è¯·åŠ¡å¿…åšå¥½æ•°æ®å¤‡ä»½ï¼ï¼ï¼</p></blockquote><h3 id="1-åˆ†åŒº"><a href="#1-åˆ†åŒº" class="headerlink" title="1. åˆ†åŒº"></a>1. åˆ†åŒº</h3><p>ä¸€èˆ¬åˆ†åŒºæœ‰ä¸¤ç§å¸¸ç”¨å½¢å¼ï¼Œ<code>GPT</code>å’Œ<code>MBR</code></p><p>MBRæ ¼å¼æœ€å¤šåªèƒ½æœ‰å››ä¸ªä¸»åˆ†åŒºï¼Œè‹¥æƒ³ç»§ç»­åˆ†åŒºå°±éœ€è¦å»ºç«‹é€»è¾‘åˆ†åŒºã€‚</p><p>GPTæ ¼å¼æ²¡æœ‰åˆ†åŒºé™åˆ¶ï¼Œå»ºè®®ä½¿ç”¨GPTåˆ†åŒº</p><ol><li><strong>fdisk</strong></li></ol><p>fdiskä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œè¿›å…¥äº¤äº’å¼å‘½ä»¤è¡Œåï¼Œç”¨<code>p</code>æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼Œ<code>n</code>æ–°å»ºåˆ†åŒºï¼Œä¸‹é¢çš„æ“ä½œæ— ç‰¹æ®ŠæŒ‡å®šå›è½¦å³å¯ã€‚</p><p>å¦‚æœ‰æŒ‡å®šï¼Œä¸€èˆ¬èµ·å§‹æ‰‡åŒºé»˜è®¤å³å¯ï¼Œç»“æŸæ‰‡åŒºå¯ç”¨<code>+10G</code>ç±»ä¼¼å†™æ³•æŒ‡å®šï¼Œ<code>+</code>å·æ˜¯åœ¨ç°æœ‰åŸºç¡€ä¸Šå¢åŠ ç©ºé—´ã€‚</p><p>æœ‰æ—¶å€™ç¼©å®¹æ“ä½œï¼ˆä¸€èˆ¬ä¸è€ƒè™‘ç¼©å®¹ï¼‰ä¸ä¼šæŒ‡å®š+å·ï¼Œç›´æ¥æŒ‡å®šå¤§å°è€Œä¸æ˜¯åœ¨åŸåŸºç¡€ä¸Šå¢åŠ ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@docker:~# fdisk /dev/sda<br><br>Welcome to fdisk (util-linux 2.39.3).<br>Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide to write them.<br>Be careful before using the write <span class="hljs-built_in">command</span>.<br><br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n<br>Partition number (2-13,17-128, default 2):<br>First sector (33556480-52428766, default 33556480):<br>Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (33556480-52428766, default 52426751):<br><br>Created a new partition 2 of <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;Linux filesystem&#x27;</span> and of size 9 GiB.<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p<br>Disk /dev/sda: 25 GiB, 26843545600 bytes, 52428800 sectors<br>Disk model: VBOX HARDDISK<br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: gpt<br>Disk identifier: A102F557-254C-4E8A-BB7B-5CE2CBC42B40<br><br>Device        Start      End  Sectors  Size Type<br>/dev/sda1   2099200 33556479 31457280   15G Linux filesystem<br>/dev/sda2  33556480 52426751 18870272    9G Linux filesystem<br>/dev/sda14     2048    10239     8192    4M BIOS boot<br>/dev/sda15    10240   227327   217088  106M EFI System<br>/dev/sda16   227328  2097152  1869825  913M Linux extended boot<br><br>Partition table entries are not <span class="hljs-keyword">in</span> disk order.<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br>The partition table has been altered.<br>Syncing disks.<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>gdisk</strong></li></ol><p>gdiskçš„æ“ä½œç±»ä¼¼äºfdiskï¼Œå¤šäº†ä¸€æ­¥éœ€è¦è¾“å…¥Hex codeï¼Œå¯å›è½¦é»˜è®¤ã€‚</p><p>å¦‚æœä¿å­˜é€€å‡ºå<code>lsblk</code>æŸ¥çœ‹ä¸åˆ°åˆ†åŒºï¼Œå¯ä½¿ç”¨<code>partprobe</code>åˆ·æ–°åˆ†åŒºè¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@docker:~# gdisk /dev/sda<br>GPT fdisk (gdisk) version 1.0.10<br><br>Partition table scan:<br>  MBR: protective<br>  BSD: not present<br>  APM: not present<br>  GPT: present<br><br>Found valid GPT with protective MBR; using GPT.<br><br>Command (? <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p<br>Disk /dev/sda: 52428800 sectors, 25.0 GiB<br>Model: VBOX HARDDISK<br>Sector size (logical/physical): 512/512 bytes<br>Disk identifier (GUID): A102F557-254C-4E8A-BB7B-5CE2CBC42B40<br>Partition table holds up to 128 entries<br>Main partition table begins at sector 2 and ends at sector 33<br>First usable sector is 34, last usable sector is 52428766<br>Partitions will be aligned on 2048-sector boundaries<br>Total free space is 18876348 sectors (9.0 GiB)<br><br>Number  Start (sector)    End (sector)  Size       Code  Name<br>   1         2099200        33556479   15.0 GiB    8300<br>  14            2048           10239   4.0 MiB     EF02<br>  15           10240          227327   106.0 MiB   EF00<br>  16          227328         2097152   913.0 MiB   EA00<br><br>Command (? <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n<br>Partition number (2-128, default 2):<br>First sector (34-52428766, default = 33556480) or &#123;+-&#125;size&#123;KMGTP&#125;:<br>Last sector (33556480-52428766, default = 52426751) or &#123;+-&#125;size&#123;KMGTP&#125;: +8G<br>Current <span class="hljs-built_in">type</span> is 8300 (Linux filesystem)<br>Hex code or GUID (L to show codes, Enter = 8300): 8e00<br>Changed <span class="hljs-built_in">type</span> of partition to <span class="hljs-string">&#x27;Linux LVM&#x27;</span><br><br>Command (? <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): p<br>Disk /dev/sda: 52428800 sectors, 25.0 GiB<br>Model: VBOX HARDDISK<br>Sector size (logical/physical): 512/512 bytes<br>Disk identifier (GUID): A102F557-254C-4E8A-BB7B-5CE2CBC42B40<br>Partition table holds up to 128 entries<br>Main partition table begins at sector 2 and ends at sector 33<br>First usable sector is 34, last usable sector is 52428766<br>Partitions will be aligned on 2048-sector boundaries<br>Total free space is 2099132 sectors (1025.0 MiB)<br><br>Number  Start (sector)    End (sector)  Size       Code  Name<br>   1         2099200        33556479   15.0 GiB    8300<br>   2        33556480        50333695   8.0 GiB     8E00  Linux LVM<br>  14            2048           10239   4.0 MiB     EF02<br>  15           10240          227327   106.0 MiB   EF00<br>  16          227328         2097152   913.0 MiB   EA00<br><br>Command (? <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br><br>Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING<br>PARTITIONS!!<br><br>Do you want to proceed? (Y/N): y<br>OK; writing new GUID partition table (GPT) to /dev/sda.<br>Warning: The kernel is still using the old partition table.<br>The new table will be used at the next reboot or after you<br>run partprobe(8) or kpartx(8)<br>The operation has completed successfully.<br><br>root@docker:~# lsblk<br>NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>loop0     7:0    0    4K  1 loop /snap/bare/5<br>loop1     7:1    0 74.2M  1 loop /snap/core22/1380<br>loop2     7:2    0    1M  1 loop /snap/multipass-sshfs/145<br>loop3     7:3    0 38.8M  1 loop /snap/snapd/21759<br>sda       8:0    0   25G  0 disk<br>â”œâ”€sda1    8:1    0   15G  0 part /<br>â”œâ”€sda14   8:14   0    4M  0 part<br>â”œâ”€sda15   8:15   0  106M  0 part /boot/efi<br>â””â”€sda16 259:0    0  913M  0 part /boot<br>sr0      11:0    1   54K  0 rom<br>root@docker:~# partprobe -s<br></code></pre></td></tr></table></figure><ol start="3"><li><strong>parted</strong></li></ol><blockquote><p>éœ€è°¨æ…ä½¿ç”¨ï¼Œè¯¥å‘½ä»¤æ“ä½œä¼šç›´æ¥ç”Ÿæ•ˆï¼Œä¸åƒgdiskã€fdiskå…ˆå°†æ•°æ®å†™å…¥å†…å­˜</p></blockquote><p><code>parted</code> å‘½ä»¤ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œè¿›å…¥ç±»ä¼¼<code>fdisk</code>çš„äº¤äº’å¼ç•Œé¢ï¼Œä½†æœ¬äººæ›´ä¹ æƒ¯ç›´æ¥å‘½ä»¤è¡Œæ“ä½œ</p><p>åˆ†åŒºä¸‰æ­¥æ³•ï¼š</p><ol><li>è®¾ç½®åˆ†åŒºå½¢å¼ - mklabel</li><li>è®¾ç½®åˆ†åŒºå¤§å° - mkpart<ul><li>mkpartçš„å¼€å§‹åˆ†åŒºä»ç¬¬2048ä¸ªæ‰‡åŒºå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯1024kb,ç»™å¤´éƒ¨ä¿¡æ¯ç•™è¶³ç©ºé—´</li></ul></li><li>æŒ‰éœ€æ ¼å¼åŒ–ç£ç›˜æˆ–åšæˆpvå·æ‰©å®¹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æŒ‡å®šåˆ†åŒºå½¢å¼ä»¥åŠåˆ†åŒºåå’Œå¤§å°</span><br>parted /dev/sda mklabel gpt mkpart primary 1024kb 100%<br><span class="hljs-comment">## æ›´å€¾å‘äºç”¨æ‰‡åŒºæ¥æŒ‡å®šå¤§å°ï¼Œå‡è®¾ä¸Šä¸€ä¸ªåˆ†åŒºçš„ç»“æŸæ‰‡åŒºä¸º227328ï¼Œåˆ™æ–°åˆ†åŒºå¯ä»¥+1ä»227329æ‰‡åŒºå¼€å§‹ã€‚</span><br><span class="hljs-comment">## æ­¤å¤„ä¼šè‡ªåŠ¨è°ƒæ•´ç»“æŸæ‰‡åŒºï¼Œå› ä¸ºç£ç›˜å°¾è¿˜éœ€è¦å­˜æ”¾GPTå¤‡ä»½è¡¨</span><br>parted /dev/sda mklabel gpt mkpart primary 227329s 100%<br></code></pre></td></tr></table></figure><h3 id="2-æ ¼å¼åŒ–"><a href="#2-æ ¼å¼åŒ–" class="headerlink" title="2. æ ¼å¼åŒ–"></a>2. æ ¼å¼åŒ–</h3><p>ä¸€ä¸ªç£ç›˜åˆ†åŒºå®Œåè¿˜ä¸èƒ½ç›´æ¥æŒ‚è½½ä½¿ç”¨ï¼Œè¿˜éœ€è¦è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ–å®Œæˆåæ‰èƒ½æŒ‚è½½ä½¿ç”¨ã€‚</p><p>ä¸€èˆ¬å¸¸è§çš„ä¸ºxfsã€ext4æ ¼å¼ï¼Œå»ºè®®ä½¿ç”¨xfsæ ¼å¼ï¼Œå¯¹åº”çš„å‘½ä»¤ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkfs.xfs /dev/sda1<br>mkfs.ext4 /dev/sda1<br><br><span class="hljs-comment">## æ ¼å¼åŒ–å®Œæˆåå¯ä»¥ç”¨blkidæŸ¥çœ‹ä¿¡æ¯</span><br>blkid /dev/sda1 <br></code></pre></td></tr></table></figure><h3 id="3-æŒ‚è½½"><a href="#3-æŒ‚è½½" class="headerlink" title="3. æŒ‚è½½"></a>3. æŒ‚è½½</h3><p>æŒ‚è½½å¯ä»¥æ˜¯ä¸´æ—¶æŒ‚è½½ï¼Œä¹Ÿå¯ä»¥å¼€æœºè‡ªåŠ¨æŒ‚è½½</p><ul><li><p>ä¸´æ—¶æŒ‚è½½</p><p>å…³æœºé‡å¯æŒ‚è½½æ¶ˆå¤±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount -t xfs /dev/sda2 /tmp<br></code></pre></td></tr></table></figure></li><li><p>å¼€æœºè‡ªåŠ¨æŒ‚è½½</p><p>å°†æŒ‚è½½å†™å…¥<code>/etc/fstab</code>æ–‡ä»¶å³å¯å®ç°å¼€æœºè‡ªæŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/dev/sda2   /tmp        xfs   defaults     0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-åˆ¶ä½œé€»è¾‘å·"><a href="#4-åˆ¶ä½œé€»è¾‘å·" class="headerlink" title="4. åˆ¶ä½œé€»è¾‘å·"></a>4. åˆ¶ä½œé€»è¾‘å·</h3><p>LVMå…è®¸ç³»ç»Ÿå°†å¤šä¸ªç‰©ç†ç¡¬ç›˜æˆ–åˆ†åŒºç»„åˆæˆä¸€ä¸ªé€»è¾‘å·ç»„ï¼Œâ€Œä»è€Œå½¢æˆä¸€ä¸ªå¤§çš„å­˜å‚¨æ± ã€‚åˆ©ç”¨é€»è¾‘å·çš„ç‰¹æ€§å¯ä»¥å®ç°è·¨ç›˜æ‰©å®¹ï¼Œå› æ­¤åœ¨åˆ¶ä½œé€»è¾‘å·çš„æ—¶å€™æœ€å¥½ä½¿ç”¨æ€§èƒ½ç›¸è¿‘çš„ç£ç›˜ï¼Œå¦åˆ™å°†ä¼šå½±å“é€»è¾‘å·æ•´ä½“æ€§èƒ½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å…ˆå°†æŸå—ç£ç›˜æˆ–åˆ†åŒºåˆ›å»ºä¸ºPV</span><br>pvcreate /dev/sda<br><span class="hljs-comment">## å°†sdaåˆ›å»ºä¸€ä¸ªåä¸ºvg1çš„å·ç»„</span><br>vgcreate vg1 /dev/sda<br><span class="hljs-comment">## åœ¨vg1å·ç»„åˆ›å»ºä¸€ä¸ªåä¸ºlv1çš„é€»è¾‘å·ï¼Œå°†æ‰€æœ‰vg1ç©ºé—´éƒ½ä½¿ç”¨</span><br>lvcreate -l +100%free -n lv1 vg1<br><span class="hljs-comment">## åœ¨vg1å·ç»„åˆ›å»ºä¸€ä¸ªåä¸ºlv1,å¤§å°ä¸º40Gçš„é€»è¾‘å·</span><br>lvcreate -L 40G -n lv1 vg1<br><span class="hljs-comment">## åˆ¶ä½œæ–‡ä»¶ç³»ç»Ÿ</span><br>mkfs.xfs /dev/vg1/lv1<br><span class="hljs-comment">## æŒ‚è½½ï¼ŒåŒæ ·å¯ä»¥å†™å…¥fstab</span><br>mount /dev/vg1/lv1 /root/tmp/<br></code></pre></td></tr></table></figure><h3 id="5-ç£ç›˜æ‰©å®¹"><a href="#5-ç£ç›˜æ‰©å®¹" class="headerlink" title="5. ç£ç›˜æ‰©å®¹"></a>5. ç£ç›˜æ‰©å®¹</h3><p>é€šå¸¸ç£ç›˜éœ€è¦åšé€»è¾‘å·æˆ–è€…å¤„äºæœ€åä¸€ä¸ªåˆ†åŒºçš„æ—¶å€™è¿›è¡Œæ‰©å®¹æ˜¯æœ€æ–¹ä¾¿çš„ã€‚</p><p>æ‰©å®¹å‰ä¸€å®šå¿…é¡»åšå¥½å¤‡ä»½ï¼ï¼ï¼</p><ol><li>é€»è¾‘å·æ‰©å®¹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## é¦–å…ˆåŠ å…¥pv</span><br>pvcreate /dev/sda<br><span class="hljs-comment">## ç„¶åæ‰©å±•vg</span><br>vgextend vg1 /dev/sda<br><span class="hljs-comment">## æ‰©å……lv</span><br><span class="hljs-comment">## +å·å¿…é¡»æœ‰ï¼Œä¸ç„¶å°±å˜æˆäº†è°ƒæ•´lvå¤§å°ï¼Œé€ æˆæ•°æ®ä¸¢å¤±</span><br>lvextend -l +100%free /dev/vg1/lv1<br>lvextend -L +20G /dev/vg1/lv1<br><span class="hljs-comment">## åŒæ­¥æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="hljs-comment">## xfs </span><br>xfs_growfs /dev/vg1/lv1<br><span class="hljs-comment">## ext4</span><br>resize2fs /dev/vg1/lv1<br></code></pre></td></tr></table></figure><ol start="2"><li>æ²¡åˆ†åŒºçš„æ•´å—ç›˜</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¯ä»¥ç›´æ¥åŒæ­¥æ–‡ä»¶ç³»ç»Ÿ</span><br>xfs_growfs /dev/sda<br>resize2fs /dev/sda<br></code></pre></td></tr></table></figure><h2 id="ç£ç›˜åˆ†åŒºç±»å‹åŠåŸç†"><a href="#ç£ç›˜åˆ†åŒºç±»å‹åŠåŸç†" class="headerlink" title="ç£ç›˜åˆ†åŒºç±»å‹åŠåŸç†"></a>ç£ç›˜åˆ†åŒºç±»å‹åŠåŸç†</h2><h4 id="MBRï¼ˆMaster-Boot-Recordï¼‰åˆ†åŒºæ ¼å¼"><a href="#MBRï¼ˆMaster-Boot-Recordï¼‰åˆ†åŒºæ ¼å¼" class="headerlink" title="MBRï¼ˆMaster Boot Recordï¼‰åˆ†åŒºæ ¼å¼"></a>MBRï¼ˆMaster Boot Recordï¼‰åˆ†åŒºæ ¼å¼</h4><p>æ—©æœŸç£ç›˜ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼ˆ<code>521bytes</code>ï¼‰é‡Œé¢åŒ…å«é‡è¦çš„ä¿¡æ¯<code>MBRï¼ˆMaster Boot Recordï¼‰</code>ï¼Œå…¶ä¸­<code>446 bytes</code>ï¼Œå®‰è£…å¼€æœºç®¡ç†ç¨‹åºçš„åœ°æ–¹ï¼›å‰©ä¸‹çš„<code>64bytes</code>è®°å½•ç¡¬ç›˜åˆ†åŒºçš„æ•°æ®ï¼Œå³åˆ†åŒºè¡¨ï¼Œå¦‚å›¾</p><p><img src="/../images/Linux-disk-base/MBR.png" alt="mbr"></p><p>ç”±äºåˆ†åŒºè¡¨æ‰€åœ¨åŒºå—ä»…æœ‰64byteså®¹é‡ï¼Œå› æ­¤æœ€å¤šä»…èƒ½æœ‰å››ç»„è®°å½•åŒºï¼Œæ¯ç»„è®°å½•åŒºè®°å½•äº†è¯¥åŒºæ®µçš„èµ·å§‹ä¸ç»“æŸçš„ç£æŸ±å·ç ã€‚</p><p>ä¹Ÿå°±æ˜¯MBRåªæ”¯æŒå››ä¸ªä¸»åˆ†åŒºï¼Œä¸”æœ€å¤§åªæ”¯æŒ2TBçš„ç¡¬ç›˜ã€‚</p><p>è‹¥æƒ³å¤šä¸ªåˆ†åŒºï¼Œéœ€è¦ä½¿ç”¨æ‰©å±•åˆ†åŒºï¼Œæ‰©å±•åˆ†åŒºä»5å¼€å§‹è®¡æ•°ã€‚</p><h4 id="GPTï¼ˆGUID-Partition-Tableï¼‰åˆ†åŒºæ ¼å¼"><a href="#GPTï¼ˆGUID-Partition-Tableï¼‰åˆ†åŒºæ ¼å¼" class="headerlink" title="GPTï¼ˆGUID Partition Tableï¼‰åˆ†åŒºæ ¼å¼"></a>GPTï¼ˆGUID Partition Tableï¼‰åˆ†åŒºæ ¼å¼</h4><p>GPTå°†ç£ç›˜åˆ’åˆ†ä¸ºä¸€å—å—çš„<code>é€»è¾‘åŒºå—åœ°å€ï¼ˆLogical Block Addressï¼Œç®€ç§°LBAï¼‰</code> æ¥å¤„ç†ï¼Œæ¯ä¸ªLBAé¢„è®¾è®¡ä¸º512bytesï¼Œå³ä¸€ä¸ªæ‰‡åŒºçš„å¤§å°ï¼›åŒæ—¶æ”¹è¿›MBRä¹‹ç”¨ä¸€å—æ‰‡åŒºæ¥æ ‡è¯†åˆ†åŒºè¡¨çš„å¼Šç«¯ï¼ŒGPTä½¿ç”¨äº†å‰åå„34ä¸ªLBAæ¥æ ‡è¯†åˆ†åŒºè¡¨ä¿¡æ¯ï¼ˆæœ€åçš„34å„åŒºå¯ä»¥ç†è§£ä¸ºå¤‡ä»½ï¼Œè¾¾åˆ°é«˜å¯ç”¨ï¼‰ï¼Œå¦‚å›¾</p><p><img src="/../images/Linux-disk-base/GPT.png" alt="gpt"></p><p> LBAçš„æ ‡è¯†æ˜¯ä»0å¼€å§‹çš„ï¼ŒLBA0-34å…±35å—ï¼Œè¿™é‡Œåˆ†åˆ«é˜è¿°ä¸‹å…¶å«ä¹‰:</p><ul><li><code>LBA0</code> :åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç±»ä¼¼MBRçš„446bytes,å­˜å‚¨å¼€æœºç®¡ç†ç¨‹åºï¼Œç¬¬äºŒéƒ¨åˆ†åˆ™æ˜¯å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ï¼Œæ ‡è¯†è¯¥ç£ç›˜ä¸ºGPTæ ¼å¼ï¼Œè€Œçœ‹ä¸æ‡‚GPTåˆ†åŒºçš„ç¨‹åºåˆ™æ— æ³•æ“ä½œè¯¥ç£ç›˜ï¼Œèµ·åˆ°ä¿æŠ¤ä½œç”¨ï¼Œæ”¾å¿ƒï¼Œç›®å‰åŸºæœ¬çš„ç®¡ç†ç¨‹åºéƒ½èƒ½è¯†åˆ«GPTæ ¼å¼ï¼Œæ‰€ä»¥è¯¥LBAå—å®é™…ä¸Šä¸åˆ†åŒºä¿¡æ¯å¹¶æ— ç›´æ¥å…³è”ï¼Œè¿™å°±æ˜¯ä¸ºå•¥ä¸ç®—å…¥34LBAçš„åŸå› </li><li><code>LBA1</code> :GPTçš„è¡¨å¤´ï¼Œè®°å½•åˆ†åŒºæœ¬èº«çš„ä½ç½®ä¸å¤§å°ï¼ŒåŒæ—¶è®°å½•åˆ†åŒºåœ¨å¤‡ä»½ä¸­æœ€å34ä¸ªLBAä¸­çš„ä½ç½®ï¼Œæ–¹ä¾¿æ¢å¤</li><li><code>LBA2-34</code>:å…±32å—LBAï¼Œæ¯å—LBAè®°å½•4ç¬”åˆ†åŒºè¡¨ï¼Œå…±æ”¯æŒ4*32&#x3D;128ç¬”åˆ†åŒºï¼›è€Œæ¯ä¸ªLBAé»˜è®¤ä¸º512bytesï¼Œåˆ™æ¯ç¬”è®°å½•ç”¨åˆ°512&#x2F;4&#x3D;128bytes,æ¯ç¬”è®°å½•æ‹¿å‡º64bytesæ¥è®°å½•å¼€å§‹ã€ç»“æŸçš„æ‰‡åŒºå·ç ï¼Œå› æ­¤å¯¹ä¸€ä¸ªå•ä¸€åˆ†åŒºæ§½è€Œè¨€ï¼Œæ”¯æŒçš„æœ€å¤§å®¹é‡ä¸º2^64âˆ—512bytes&#x3D;2^63âˆ—1Kbytes&#x3D;2^33TB&#x3D;8ZB</li></ul><blockquote><p>1024TB&#x3D;1PB <br>1024PB&#x3D;1EB <br>1024EB&#x3D;1ZB</p></blockquote><h1 id="å…¶ä»–äº‹é¡¹"><a href="#å…¶ä»–äº‹é¡¹" class="headerlink" title="å…¶ä»–äº‹é¡¹"></a>å…¶ä»–äº‹é¡¹</h1><h2 id="1-å·²æ·»åŠ ç£ç›˜æ— æ³•è¯†åˆ«"><a href="#1-å·²æ·»åŠ ç£ç›˜æ— æ³•è¯†åˆ«" class="headerlink" title="1. å·²æ·»åŠ ç£ç›˜æ— æ³•è¯†åˆ«"></a>1. å·²æ·»åŠ ç£ç›˜æ— æ³•è¯†åˆ«</h2><p>æœ‰æ—¶å€™æœºæˆ¿åŠ äº†ç£ç›˜å¯èƒ½ä¸ä¼šåœ¨ç³»ç»Ÿå±‚é¢ç«‹å³æ˜¾ç¤ºå‡ºæ¥ï¼Œéœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥é‡æ–°æ‰«æä¸‹scsiæ€»çº¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> /sys/class/scsi_host/*/scan; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>;<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;- - -&quot;</span> &gt; <span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="2-å·²åˆ†åŒºæ²¡åšlvmçš„ç£ç›˜æ‰©å®¹"><a href="#2-å·²åˆ†åŒºæ²¡åšlvmçš„ç£ç›˜æ‰©å®¹" class="headerlink" title="2. å·²åˆ†åŒºæ²¡åšlvmçš„ç£ç›˜æ‰©å®¹"></a>2. å·²åˆ†åŒºæ²¡åšlvmçš„ç£ç›˜æ‰©å®¹</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°é¡¹ç›®ç»„åœ¨åŸç£ç›˜ä¸ŠåŠ ç©ºé—´ï¼Œè€Œæƒ³è¦æ‰©å®¹çš„é‚£ä¸ªåˆ†åŒºæ˜¯æ²¡æœ‰åšé€»è¾‘å·çš„ï¼Œä»¥è‡³äºåŠ çš„ç©ºé—´ä¼šæµªè´¹ï¼Œä¸‹é¢æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œå…¶ä¸€æ˜¯<code>fdisk</code>çš„ä¸€ç§ç‰¹æ®Šç”¨æ³•ï¼Œå…¶äºŒæ˜¯æä¾›ä¸€ä¸ªå·¥å…·<code>growpart</code>ï¼Œå¯ä»¥å¯¹æ²¡æœ‰åšè¿‡é€»è¾‘å·çš„åˆ†åŒºè¿›è¡Œæ‰©å®¹ã€‚</p><p>ä¸¤ç§æ–¹æ¡ˆéƒ½éœ€è¦è¯¥åˆ†åŒºå¿…éœ€æ˜¯æ•´ä¸ªç£ç›˜çš„æœ€åä¸€ä¸ªåˆ†åŒº</p><ul><li><p>å…¶ä¸€ï¼Œä½¿ç”¨<code>fdisk</code>æ‰©å®¹ã€‚å› ä¸ºfdiskåœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™åˆ†åŒºæ•°æ®ä¸ä¼šç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å…ˆä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ç‚¹æ¥è¿›è¡Œæ‰©å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">fdisk /dev/sda<br><span class="hljs-comment">## è¿›å…¥åç”¨pæŸ¥çœ‹åˆ†åŒº</span><br><span class="hljs-comment">## æŒ‰d åˆ é™¤æœ€åä¸€ä¸ªåˆ†åŒº</span><br><span class="hljs-comment">## ç„¶åå†nï¼Œåˆ›å»ºæ–°åˆ†åŒºã€‚</span><br><span class="hljs-comment">## æ–°åˆ†åŒºçš„å¤§å°å¿…é¡»æ¯”åŸæ¥çš„åˆ†åŒºå¤§ï¼Œä¸èƒ½ç¼©å°ï¼Œå¦åˆ™ä¼šé€ æˆæ•°æ®ä¸¢å¤±</span><br><span class="hljs-comment">## æœ€åwä¿å­˜ï¼Œç„¶åxfs_growfæˆ–resize2fsåŒæ­¥å¯¹åº”æ–‡ä»¶ç³»ç»Ÿå³å¯</span><br></code></pre></td></tr></table></figure></li><li><p>å…¶äºŒï¼Œå¯ä½¿ç”¨<code>growpart</code>æ¥è¿›è¡Œæ‰©å®¹</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è”ç½‘æ¡ä»¶ä¸‹</span><br>yum install cloud-utils-growpart<br><span class="hljs-comment"># æ²¡è”ç½‘å°±ä¼ åŒ…å§</span><br>rpm -ivhU cloud-utils-growpart.rpm<br><span class="hljs-comment"># å¦‚æœåŠ¡å™¨æœ‰ä¸€å—ç›˜vdaï¼Œä»…æœ‰ä¸€ä¸ªåˆ†åŒºvda1ï¼Œä¸”æ²¡åšè¿‡é€»è¾‘å·</span><br><span class="hljs-comment"># å…ˆç”¨growpartå°†ç©ºé—´åŠ åˆ°vda1ä¸Š</span><br><span class="hljs-comment">## è¡¨ç¤ºå¯¹/dev/sdaçš„åˆ†åŒº1è¿›è¡Œæ‰©å®¹</span><br>growpart /dev/vda 1<br><span class="hljs-comment">## å¦‚æœæŠ¥é”™ unexpected output in sfdisk --version</span><br><span class="hljs-comment">## LANG=en_US.UTF-8 å°±å¯ä»¥äº†,ä¸è¡Œå¯ä»¥é‡å¯ä¸‹ç‰©ç†æœºè¯•ä¸€ä¸‹.(ç¼–ç é—®é¢˜)</span><br><span class="hljs-comment"># ç„¶ååŒæ­¥æ–‡ä»¶ç³»ç»Ÿå³å¯</span><br>xfs_growfs /<br>resize2fs /dev/vda1<br></code></pre></td></tr></table></figure></li></ul><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>ç”±äºæ²¡æœ‰æ‰¾åˆ°ç°æˆçš„åšäº†åˆ†åŒºè€Œæ²¡åšlvmçš„é¡¹ç›®ï¼Œä½†æ˜¯æ­¥éª¤æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><p><img src="/../images/Linux-disk-base/20221031165313.jpg" alt="gdisk_caution"></p><h2 id="3-æ—§ç£ç›˜æ¢åˆ°æ–°æœºå™¨æ— æ³•ä½¿ç”¨"><a href="#3-æ—§ç£ç›˜æ¢åˆ°æ–°æœºå™¨æ— æ³•ä½¿ç”¨" class="headerlink" title="3. æ—§ç£ç›˜æ¢åˆ°æ–°æœºå™¨æ— æ³•ä½¿ç”¨"></a>3. æ—§ç£ç›˜æ¢åˆ°æ–°æœºå™¨æ— æ³•ä½¿ç”¨</h2><p>é¢å¯¹è¿™ä¸ªæƒ…å†µå…¶å®å¦‚æœåœ¨ç¡®å®šç£ç›˜é‡Œé¢çš„æ•°æ®è¿›è¡Œäº†å¤‡ä»½ï¼Œæˆ–è€…ä¸éœ€è¦çš„æ—¶å€™å¯ä»¥ç›´æ¥è¿›è¡Œå¼ºåˆ¶æ ¼å¼åŒ–ã€‚</p><p>ä¹Ÿå¯ä»¥<code>dd</code>å»å¤‡ä»½ä¸€ä¸‹ç£ç›˜å¤´å’Œç£ç›˜å°¾ä¿¡æ¯ï¼Œæˆ–è€…æ•´ä¸ªç£ç›˜ã€‚</p><p>å¦‚ä¸‹æœ‰ä¸€ä¸ªç£ç›˜sdaï¼Œé€šè¿‡partedæŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼Œè¿™é‡Œå»ºè®®æŠŠunitåˆ‡æ¢æˆså•ä½æ¥çœ‹ä¼šæ›´ç²¾ç¡®æ›´æ¸…æ¥šäº›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@docker:~# parted /dev/sda u s p<br>Model: ATA VBOX HARDDISK (scsi)<br>Disk /dev/sda: 31457280s<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags:<br><br>Number  Start     End        Size       File system  Name  Flags<br>14      2048s     10239s     8192s                         bios_grub<br>15      10240s    227327s    217088s    fat32              boot, esp<br>16      227328s   2097152s   1869825s   ext4               bls_boot<br> 1      2099200s  31457246s  29358047s  ext4<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ç£ç›˜æ€»å¤§å°31457280ä¸ªæ‰‡åŒºï¼Œç£ç›˜å®é™…åˆ†é…åˆ°ç¬¬31457246ä¸ªæ‰‡åŒºç»“æŸï¼Œ<code>31457280-31457246=34</code>ï¼Œä¹Ÿå°±æ˜¯åˆšå¥½ç•™ä¸‹äº†GPTæ ¼å¼å¤‡ä»½çš„34ä¸ªLBAã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## ddé»˜è®¤1countä¸º512Bï¼Œä¸æ‰‡åŒºsizeå¯¹åº”</span><br><span class="hljs-comment">## å¤‡ä»½å‰34ä¸ªæ‰‡åŒº</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/sda of=~/sda.img.bak count=34<br><span class="hljs-comment">## è·³è¿‡å‰é¢31457246ä¸ªæ‰‡åŒºè¿›è¡Œå¤‡ä»½</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/sda of=~/sda.img.bak skip=31457246<br></code></pre></td></tr></table></figure><p>å¦‚ä¸‹è¾“å‡ºå¯è§å¤‡ä»½äº†æœ€å34ä¸ªæ‰‡åŒº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@docker:~# dd if=/dev/sda of=~/sda.end.bak skip=31457246<br>34+0 records in<br>34+0 records out<br>17408 bytes (17 kB, 17 KiB) copied, 0.000214267 s, 81.2 MB/s<br></code></pre></td></tr></table></figure><p>å¤‡ä»½å¥½åå¯ä»¥ç›´æ¥ç”¨<code>dd</code>å‘½ä»¤æŠŠç£å¤´ç£å°¾æ¸…ç©ºå³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sda count=34<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sda skip=31457246<br></code></pre></td></tr></table></figure><h2 id="4-å·²åˆ é™¤æ–‡ä»¶å ç”¨ç©ºé—´"><a href="#4-å·²åˆ é™¤æ–‡ä»¶å ç”¨ç©ºé—´" class="headerlink" title="4. å·²åˆ é™¤æ–‡ä»¶å ç”¨ç©ºé—´"></a>4. å·²åˆ é™¤æ–‡ä»¶å ç”¨ç©ºé—´</h2><p>è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯æœ‰è¿›ç¨‹åœ¨å ç”¨è¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´ç©ºé—´æœªé‡Šæ”¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¯ä½¿ç”¨lsofæ¥æ’æŸ¥ï¼Œæ‰¾åˆ°å¯¹åº”çš„pid</span><br>lsof | grep deleted<br><span class="hljs-comment">## éä¸šåŠ¡æ—¶é—´æ®µå¯ä»¥é€šè¿‡ killå¯¹åº”è¿›ç¨‹æ¥é‡Šæ”¾</span><br><span class="hljs-comment">## ä½†ä¸šåŠ¡æ—¶é—´æ®µè‚¯å®šä¸èƒ½è¿™æ ·æ“ä½œ</span><br><span class="hljs-comment">## æ‰€ä»¥æœ‰äº†ç¬¬äºŒç§æ–¹æ³•</span><br><span class="hljs-built_in">ls</span> -l /proc/<span class="hljs-variable">$pid</span>/fd/* | grep <span class="hljs-variable">$filename</span><br><span class="hljs-built_in">echo</span> &gt; /proc/<span class="hljs-variable">$pid</span>/fd/<span class="hljs-variable">$fdnum</span><br></code></pre></td></tr></table></figure><h2 id="5-å®é™…å ç”¨ä¸æ˜¾ç¤ºä¸ç¬¦"><a href="#5-å®é™…å ç”¨ä¸æ˜¾ç¤ºä¸ç¬¦" class="headerlink" title="5. å®é™…å ç”¨ä¸æ˜¾ç¤ºä¸ç¬¦"></a>5. å®é™…å ç”¨ä¸æ˜¾ç¤ºä¸ç¬¦</h2><p>ä¸€å¯èƒ½æ˜¯å‰é¢è¯´çš„å·²åˆ é™¤æ–‡ä»¶å<code>df</code>æ²¡æœ‰å˜åŒ–</p><p>äºŒå¯èƒ½æ˜¯è¦†ç›–æŒ‚è½½</p><p>ä¸‰å¯èƒ½æ˜¯è®¡ç®—çš„æ—¶å€™æ²¡æœ‰æ’é™¤ç½‘ç»œæŒ‚è½½</p><p>å‰é¢å·²ç»ä»‹ç»è¿‡ç¬¬ä¸€ç§å¤„ç†åŠæ³•ï¼Œä¸‹é¢ä»‹ç»åé¢ä¸¤ç§</p><p>å¯¹äºè¦†ç›–æŒ‚è½½å¯ä»¥åœ¨éä¸šåŠ¡æ—¶é—´å°†å¼‚å¸¸æŒ‚è½½çš„ç›®å½•å…ˆå¸è½½ä¸‹æ¥ï¼Œç„¶åå»çœ‹çœ‹å¸è½½åçš„è¯¥ç›®å½•ä¸‹é¢æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œå¦‚æœ‰æ–‡ä»¶å ç”¨ç©ºé—´åˆ™å±äºè¦†ç›–æŒ‚è½½ã€‚</p><p>å¯¹äºç½‘ç»œæŒ‚è½½ï¼Œå¯ä»¥åœ¨ä½¿ç”¨<code>du</code>å‘½ä»¤çš„æ—¶å€™ä½¿ç”¨<code>-x</code>é€‰é¡¹æ¥è¿›è¡Œæ’é™¤ï¼ˆå‰é¢æœ‰ä»‹ç»è¿‡ï¼‰ï¼Œä¾¿å¯è®¡ç®—å‡ºå½“å‰æœ¬åœ°çš„å‡†ç¡®å€¼ã€‚</p><h2 id="6-ç”±MBR-MSDOS-æ ¼å¼è½¬GPT"><a href="#6-ç”±MBR-MSDOS-æ ¼å¼è½¬GPT" class="headerlink" title="6. ç”±MBR (MSDOS) æ ¼å¼è½¬GPT"></a>6. ç”±MBR (MSDOS) æ ¼å¼è½¬GPT</h2><p><strong>åœºæ™¯</strong></p><p>MBRåˆ†åŒºåªæ”¯æŒå››ä¸ªä¸»åˆ†åŒºï¼Œå› æ­¤ï¼Œå½“æœ‰äººåœ¨ç¬¬å››ä¸ªåˆ†åŒºä¸ç”¨é€»è¾‘åˆ†åŒºè€Œç»§ç»­ç”¨ä¸»åˆ†åŒºçš„è¯å°†æ— æ³•å†è¿›è¡Œåˆ†åŒºï¼Œä¸”æœ€å¤§åªèƒ½æ“ä½œ2Tç©ºé—´çš„ç£ç›˜ï¼Œæ‰€ä»¥åœ¨é¢å¯¹è¿™ç§å››ä¸ªä¸»åˆ†åŒºéƒ½ç”¨æ»¡æˆ–ç£ç›˜ç©ºé—´è¶…è¿‡2Tçš„æƒ…å†µä¸‹ï¼Œéœ€è¦å°†ç£ç›˜æ ¼å¼è½¬æˆGPTåæ‰èƒ½è¿›ä¸€æ­¥è¿›è¡Œåˆ†åŒºå’Œæ‰©å®¹ã€‚</p><p><strong>å‰ææ¡ä»¶</strong></p><p>ç£ç›˜å¤´ä¿¡æ¯éœ€è¦ç•™è¶³ç©ºé—´è½¬æ¢æˆGPTåˆ†åŒºï¼Œstartæœ€å°éœ€è¦ä»ç¬¬63ä¸ªæ‰‡åŒºå¼€å§‹ã€‚</p><p>å¯ä»¥è‡ªå·±æ¨¡æ‹Ÿä¸‹ï¼Œç”¨partedå·¥å…·è¿›è¡Œåˆ†åŒºï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºå¤´ä»0å¼€å§‹ï¼Œå‘½ä»¤å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">parted /dev/vdx mklabel msdos/gpt mkpart primary 0 100%<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨çš„labelæ˜¯mbråˆ™ä¼šé»˜è®¤ä»63så¼€å§‹ï¼Œå¦‚æœæ˜¯gptï¼Œåˆ™ä¼šä»34så¼€å§‹ã€‚</p><p><img src="/../images/Linux-disk-base/078092image.png" alt="mbr_default"></p><p><img src="/../images/Linux-disk-base/098712image.png" alt="gpt_default"></p><p>å¦‚æœç”¨çš„æ˜¯gdiskå’Œfdiskåˆ†åŒºï¼Œé»˜è®¤æ˜¯ä»2048så¼€å§‹ï¼Œæ‰€ä»¥å®Œå…¨å¤Ÿä»mbrè½¬æ¢æˆgptæ ¼å¼ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„ç£ç›˜æœ«å°¾æ˜¯å¦è¿˜æœ‰ç©ºé—´ï¼Œå› ä¸ºMBRæœ«å°¾å¹¶ä¸è®°å½•ä¿¡æ¯ï¼Œæ‰€ä»¥å½“ç£ç›˜100%æ—¶ä¹Ÿå°±æ˜¯ç©ºé—´å®Œå…¨æ²¡æœ‰äº†ï¼Œæ­¤æ—¶è¿›è¡Œgptè½¬æ¢å¯èƒ½é€ æˆå°¾éƒ¨æ•°æ®ä¸¢å¤±ã€‚</p><p><img src="/../images/Linux-disk-base/052384image.png" alt="fdisk_default"></p><ul><li>å…ˆå¤‡ä»½åˆ†åŒºè¡¨ä¿¡æ¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¤‡ä»½åˆ†åŒºè¡¨ä¿¡æ¯</span><br><span class="hljs-comment"># æœ€å¥½é€‰æ‹©å¦å¤–çš„ç›˜è¿›è¡Œå¤‡ä»½</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/vda of=/xxxx/xxx.mbr.bak  bs=1024 count=2000<br><span class="hljs-comment"># æ¢å¤åˆ†åŒºè¡¨ä¿¡æ¯</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/home/xxx.mbr.bak  of=/dev/vda bs=1024 count=2000<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨gdiskå°†åˆ†åŒºæ ¼å¼è½¬æ¢ä¸ºgpt</li></ul><p><img src="/../images/Linux-disk-base/016511image.png" alt="gdisk_default"></p><h2 id="7-æ–°ç£ç›˜æ®‹ç•™GPTåˆ†åŒºä¿¡æ¯å¯¼è‡´æ— æ³•åˆ†åŒºæ‰©å®¹"><a href="#7-æ–°ç£ç›˜æ®‹ç•™GPTåˆ†åŒºä¿¡æ¯å¯¼è‡´æ— æ³•åˆ†åŒºæ‰©å®¹" class="headerlink" title="7. æ–°ç£ç›˜æ®‹ç•™GPTåˆ†åŒºä¿¡æ¯å¯¼è‡´æ— æ³•åˆ†åŒºæ‰©å®¹"></a>7. æ–°ç£ç›˜æ®‹ç•™GPTåˆ†åŒºä¿¡æ¯å¯¼è‡´æ— æ³•åˆ†åŒºæ‰©å®¹</h2><blockquote><p>ç±»ä¼¼ç¬¬ä¸‰ç‚¹</p></blockquote><p>å½“é¡¹ç›®ç»„æ‹¿æ¥æ–°ç£ç›˜ï¼Œè¦æ±‚åˆ†åŒºæ‰©å®¹æ—¶ï¼Œç¢°åˆ°å¦‚ä¸‹æç¤ºgptå¤‡ä»½åŒºä¿¡æ¯ä¸ä¸»åˆ†åŒºä¿¡æ¯ä¸ä¸€è‡´çš„æç¤ºæ—¶ï¼Œè€ƒè™‘æ˜¯è¯¥ç£ç›˜æ˜¯æ›¾ç»åšè¿‡åˆ†åŒºçš„ç›˜ã€‚</p><p><img src="/../images/Linux-disk-base/20221029005856.png" alt="gdisk_caution"></p><p>å…ˆä¸é¡¹ç›®ç»„ç¡®è®¤æ˜¯å¦æ˜¯æ–°ç›˜æ— æ•°æ®ï¼Œå½“ç¡®è®¤æ˜¯æ–°ç›˜æ— æ•°æ®åï¼Œå¯ç”¨<code>dd</code>å‘½ä»¤å»æ¸…ç©ºå¤´å°¾è®°å½•çš„åˆ†åŒºä¿¡æ¯ï¼Œä¸€èˆ¬å–é¦–å°¾1Må·¦å³å³å¯ï¼Œæ¸…ç©ºå®Œåå°±å¯ä»¥æŒ‰æ­£å¸¸æµç¨‹è¿›è¡Œåˆ†åŒºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¦‚é¡¹ç›®ç»„æœ‰893Gç£ç›˜</span><br><span class="hljs-comment"># æ¸…ç©ºå¤´éƒ¨ä¿¡æ¯</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sdb bs=512 count=4000<br><span class="hljs-comment"># æ¸…ç©ºå°¾éƒ¨ä¿¡æ¯</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sdb bs=1M seek=890000<br><span class="hljs-comment"># seekå‚æ•°ä¸ºè·³è¿‡sdbçš„ç¬¬890000ä¸ªblockï¼Œå³å°†ifçš„å†…å®¹ä»ç¬¬890000ä¸ªblockåå¼€å§‹å†™å…¥</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible ad-hocç®€ä»‹</title>
    <link href="/2024/07/12/ansible-ad-hoc/"/>
    <url>/2024/07/12/ansible-ad-hoc/</url>
    
    <content type="html"><![CDATA[<h1 id="Ansible-Ad-Hoc"><a href="#Ansible-Ad-Hoc" class="headerlink" title="Ansible Ad-Hoc"></a>Ansible Ad-Hoc</h1><p>Ad-Hocå½¢å¼åº”ç”¨åœºæ™¯ä¸»è¦åœ¨ä¸´æ—¶æ‰§è¡Œä¸€äº›æ“ä½œæ—¶ä¼šç”¨åˆ°ï¼Œæ›´æ³¨é‡è§£å†³ä¸€äº›ç®€å•æˆ–ä¸´æ—¶ä»»åŠ¡ï¼Œå¤æ‚æ“ä½œä¼šä½¿ç”¨playbookæ¥å®ç°ã€‚<br>æ¯”å¦‚æƒ³ä¸´æ—¶ä¼ ä¸€ä¸ªæ–‡ä»¶åˆ°è¢«æ§æœºä¸Šå°±å¯ä»¥ä½¿ç”¨ad-hocå½¢å¼æ¥å®Œæˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible all -m copy -a <span class="hljs-string">&quot;src=/root/monitor.sh dest=/root/ backup=yes&quot;</span><br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨é€‰é¡¹"><a href="#å¸¸ç”¨é€‰é¡¹" class="headerlink" title="å¸¸ç”¨é€‰é¡¹"></a>å¸¸ç”¨é€‰é¡¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># -v å¯ä½¿ç”¨-vvvè¾“å‡ºæ›´è¯¦ç»†å†…å®¹</span><br><span class="hljs-comment"># -i æŒ‡å®šinventory</span><br><span class="hljs-comment"># -f æŒ‡å®šå¹¶å‘çº¿ç¨‹æ•°</span><br><span class="hljs-comment"># --private-key æŒ‡å®šå¯†é’¥æ–‡ä»¶</span><br><span class="hljs-comment"># -m æŒ‡å®šæ‰§è¡Œæ¨¡å—</span><br><span class="hljs-comment"># -M æŒ‡å®šæ¨¡å—å­˜æ”¾è·¯å¾„</span><br><span class="hljs-comment"># -a æ¨¡å—å‚æ•°ï¼Œé»˜è®¤commandæ¨¡å—</span><br><span class="hljs-comment"># -t è¾“å‡ºä¿¡æ¯åˆ°æŒ‡å®šç›®å½•ï¼Œæ–‡ä»¶ä»¥ä¸»æœºåå‘½å</span><br><span class="hljs-comment"># -T æŒ‡å®šæœ€å¤§è¶…æ—¶æ—¶é—´</span><br><span class="hljs-comment"># -B åå°æ‰§è¡Œå‘½ä»¤ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´åä¸­æ­¢æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="hljs-comment"># -P å®šæœŸä»¥æŒ‡å®šæ—¶é—´é—´éš”è¿”å›åå°ä»»åŠ¡è¿›åº¦</span><br><span class="hljs-comment"># --list-hosts åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„ä¸»æœºï¼Œä¸æ‰§è¡Œä»»ä½•å‘½ä»¤</span><br>ansible -i hosts all -f 20 -B 10 -P 2 -T 1 -m shell -a <span class="hljs-string">&quot;df -h&quot;</span> -vvv<br>ansible all --list-hosts<br></code></pre></td></tr></table></figure><p>success è¡¨ç¤ºå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œchanged æ˜¯å¦å¯¹ä¸»æœºåšå‡ºå˜æ›´</p><blockquote><p>å»ºè®®å¹¶å‘æ•°é…ç½®ä¸ºCPUæ ¸æ•°å¶æ•°å€å°±è¡Œã€‚å¦‚4C 8Gçš„æœºå™¨ï¼Œæœ€å¤šå¹¶å‘20ä¸ªçº¿ç¨‹</p></blockquote><h2 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h2><p>å¦‚æœä¸çŸ¥é“æœ‰å“ªäº›æ¨¡å—ä»¥åŠæ¨¡å—æœ‰å“ªäº›å‚æ•°å¯ç”¨ï¼Œå°±å¯ä½¿ç”¨æ­¤å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ansible-doc -l<br>ansible-doc -s shell<br></code></pre></td></tr></table></figure><ul><li><code>-l</code> é€‰é¡¹åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡å—</li><li><code>-s</code> åªæ˜¾ç¤ºplaybookè¯´æ˜çš„ä»£ç æ®µ</li></ul><h2 id="æŒ‡å®šä¸»æœºæ‰§è¡Œä»»åŠ¡"><a href="#æŒ‡å®šä¸»æœºæ‰§è¡Œä»»åŠ¡" class="headerlink" title="æŒ‡å®šä¸»æœºæ‰§è¡Œä»»åŠ¡"></a>æŒ‡å®šä¸»æœºæ‰§è¡Œä»»åŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># --limit </span><br>ansible all -m shell -a <span class="hljs-string">&quot;ls -l&quot;</span> --<span class="hljs-built_in">limit</span> <span class="hljs-string">&quot;192.168.3.27&quot;</span><br><span class="hljs-comment"># æŒ‡å®šIP</span><br>ansible 192.168.3.27 -m shell -a <span class="hljs-string">&quot;ls -l&quot;</span><br><span class="hljs-comment"># : åˆ†éš”ç¬¦æŒ‡å®šå¤šå°æœºå™¨åšå˜æ›´ï¼Œä½†&quot;&quot;å¿…é¡»ä½¿ç”¨</span><br>ansible <span class="hljs-string">&quot;192.168.3.27:192.168.33.22&quot;</span> -m shell -a <span class="hljs-string">&quot;ls -l&quot;</span><br><span class="hljs-comment"># * é€šé…ç¬¦åŒ¹é…å¤šå°æœºå™¨</span><br>ansible 192.168.3.* -m shell -a <span class="hljs-string">&quot;ls -l&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ansible Inventory Intro</title>
    <link href="/2024/07/12/Ansible-Inventory-Intro/"/>
    <url>/2024/07/12/Ansible-Inventory-Intro/</url>
    
    <content type="html"><![CDATA[<h1 id="ansible-inventory-æ–‡ä»¶åŸºæœ¬ä»‹ç»"><a href="#ansible-inventory-æ–‡ä»¶åŸºæœ¬ä»‹ç»" class="headerlink" title="ansible inventory æ–‡ä»¶åŸºæœ¬ä»‹ç»"></a>ansible inventory æ–‡ä»¶åŸºæœ¬ä»‹ç»</h1><blockquote><p>é»˜è®¤é…ç½®è·¯å¾„</p><p><code>/etc/ansible/hosts</code></p></blockquote><h2 id="å®šä¹‰ä¸»æœºå’Œç»„"><a href="#å®šä¹‰ä¸»æœºå’Œç»„" class="headerlink" title="å®šä¹‰ä¸»æœºå’Œç»„"></a>å®šä¹‰ä¸»æœºå’Œç»„</h2><p>ansible æ”¯æŒå°†åŒä¸€ä¸ªä¸»æœºåŒæ—¶å½’å¹¶åˆ°å¤šä¸ªä¸åŒçš„ç»„ä¸­</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># å¯ä»¥ç›´æ¥å†™IPåœ°å€</span><br>192.168.3.27<br><span class="hljs-comment"># æ”¯æŒhostname</span><br>ntp.example.com<br><span class="hljs-comment"># æ”¯æŒ:+port</span><br>192.168.3.27:22<br>ntp.example.com:222<br><span class="hljs-comment"># []è¡¨ç¤ºä¸€ä¸ªåˆ†ç»„</span><br><span class="hljs-section">[ntpserver]</span><br>ntp1.example.com<br>ntp2.example.com<br><span class="hljs-comment"># è¡¨ç¤º3-4ä¹‹é—´çš„æ‰€æœ‰æ•°å­—,åŒ…å«3,4</span><br>ntp<span class="hljs-section">[3:4]</span>.example.com<br><span class="hljs-comment"># è¡¨ç¤ºa-cä¹‹é—´æ‰€æœ‰æ•°å­—,åŒ…å«a,c</span><br>ntp<span class="hljs-section">[a:c]</span>.example.com<br></code></pre></td></tr></table></figure><h2 id="å®šä¹‰ä¸»æœºå˜é‡"><a href="#å®šä¹‰ä¸»æœºå˜é‡" class="headerlink" title="å®šä¹‰ä¸»æœºå˜é‡"></a>å®šä¹‰ä¸»æœºå˜é‡</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[webservers]</span><br>web1.example.com <span class="hljs-attr">http_port</span>=<span class="hljs-number">808</span><br><span class="hljs-attr">maxRequestsPerChild</span>=<span class="hljs-number">801</span> <br><span class="hljs-comment"># è‡ªå®šä¹‰http_portçš„ç«¯å£å·ä¸º808ï¼Œé…ç½®maxRequestsPerChildä¸º801</span><br></code></pre></td></tr></table></figure><blockquote><p>Ansibleå…¶å®æ”¯æŒå¤šç§æ–¹å¼ä¿®æ”¹æˆ–è‡ªå®šä¹‰å˜é‡ï¼ŒInventoryæ˜¯å…¶ä¸­çš„ä¸€ç§ä¿®æ”¹æ–¹å¼</p></blockquote><h2 id="å®šä¹‰ç»„å˜é‡"><a href="#å®šä¹‰ç»„å˜é‡" class="headerlink" title="å®šä¹‰ç»„å˜é‡"></a>å®šä¹‰ç»„å˜é‡</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[groupservers]</span><br>web1.example.com<br>web2.example.com<br><span class="hljs-section">[groupservers:vars]</span><br><span class="hljs-attr">ntp_server</span>=ntp.example.com  <br><span class="hljs-comment"># å®šä¹‰groupserversç»„ä¸­æ‰€æœ‰ä¸»æœºntp_serverå€¼ä¸ºntp.magedu.com</span><br><span class="hljs-attr">nfs_server</span>=nfs.example.com <br><span class="hljs-comment"># å®šä¹‰groupserversç»„ä¸­æ‰€æœ‰ä¸»æœºnfs_serverå€¼ä¸ºnfs.magedu.com</span><br></code></pre></td></tr></table></figure><h2 id="å®šä¹‰ç»„åµŒå¥—åŠç»„å˜é‡"><a href="#å®šä¹‰ç»„åµŒå¥—åŠç»„å˜é‡" class="headerlink" title="å®šä¹‰ç»„åµŒå¥—åŠç»„å˜é‡"></a>å®šä¹‰ç»„åµŒå¥—åŠç»„å˜é‡</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[apache]</span><br>httpd1.example.com<br>httpd2.example.com<br><span class="hljs-section">[nginx]</span><br>ngx1.example.com<br>ngx2.example.com<br><span class="hljs-section">[webservers:children]</span><br>apache<br>nginx<br><span class="hljs-section">[webservers:vars]</span><br><span class="hljs-attr">ntp_server</span>=ntp.example.com<br></code></pre></td></tr></table></figure><h2 id="å¤šé‡å˜é‡å®šä¹‰"><a href="#å¤šé‡å˜é‡å®šä¹‰" class="headerlink" title="å¤šé‡å˜é‡å®šä¹‰"></a>å¤šé‡å˜é‡å®šä¹‰</h2><p>å˜é‡é™¤äº†åœ¨inventoryä¸­å®šä¹‰,è¿˜å¯ä»¥åœ¨å…¶ä»–æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¦‚ï¼šymlã€json</p><p>é€šå¸¸åœ¨ä»¥ä¸‹å››ä¸ªä½ç½®æ£€ç´¢</p><ul><li>inventoryé…ç½®æ–‡ä»¶</li><li>playbookä¸­varså®šä¹‰çš„åŒºåŸŸ</li><li>rolesä¸­varsç›®å½•ä¸‹çš„æ–‡ä»¶</li><li>rolesåŒçº§ç›®å½•group_varså’Œhosts_varsç›®å½•ä¸‹çš„æ–‡ä»¶</li></ul><h2 id="å…¶ä»–å‚æ•°åˆ—è¡¨"><a href="#å…¶ä»–å‚æ•°åˆ—è¡¨" class="headerlink" title="å…¶ä»–å‚æ•°åˆ—è¡¨"></a>å…¶ä»–å‚æ•°åˆ—è¡¨</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ansible_ssh_host</span>=<br><span class="hljs-attr">ansible_ssh_user</span>=root<br><span class="hljs-attr">ansible_ssh_pass</span>=xxx<br><span class="hljs-attr">ansible_ssh_port</span>=<span class="hljs-number">22</span><br><span class="hljs-comment"># æŒ‡å®šç‰¹æœ‰ç§é’¥æ–‡ä»¶</span><br>ansible_ssh_private_key_file=<br></code></pre></td></tr></table></figure><blockquote><p>æ›´å¤šå‚æ•°æŸ¥è¯¢å®˜ç½‘</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TMUX åŸºç¡€æ“ä½œ</title>
    <link href="/2024/07/11/tmux/"/>
    <url>/2024/07/11/tmux/</url>
    
    <content type="html"><![CDATA[<ul><li>ä¸‰ä¸ªæ¦‚å¿µ<ul><li>session - ä¼šè¯<ul><li>æ¯è¿è¡Œä¸€æ¬¡<code>tmux</code>ä¼šåˆ›å»ºä¸€ä¸ªsession</li></ul></li><li>window - çª—å£<ul><li>åœ¨sessionå†…æŒ‰å‰ç¼€é”®åï¼Œ<code>c</code>é”®åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ªwindow</li></ul></li><li>pane - çª—æ ¼<ul><li>å°†windowè¿›è¡Œåˆ†å‰²åå¾—åˆ°çš„å°±æ˜¯pane</li></ul></li></ul></li></ul><h2 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h2><h3 id="1-ä¼šè¯å¤–æ“ä½œ"><a href="#1-ä¼šè¯å¤–æ“ä½œ" class="headerlink" title="1. ä¼šè¯å¤–æ“ä½œ"></a>1. ä¼šè¯å¤–æ“ä½œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">tmux attach -t 0 <span class="hljs-comment">## è¿›å…¥ä¸€ä¸ªä¼šè¯</span><br>tmux <span class="hljs-built_in">ls</span> <span class="hljs-comment">## æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„tmuxä¼šè¯</span><br>tmux kill-session -t 0<br>tmux kill-pane -t 0<br>tmux kill-window -t 0<br><br>tmux list-commands <span class="hljs-comment">## æ˜¾ç¤ºtmuxæ‰€æœ‰å‘½ä»¤ </span><br>tmux show-options -g <span class="hljs-comment">## æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹</span><br></code></pre></td></tr></table></figure><h3 id="2-ä¼šè¯å†…æ“ä½œ"><a href="#2-ä¼šè¯å†…æ“ä½œ" class="headerlink" title="2. ä¼šè¯å†…æ“ä½œ"></a>2. ä¼šè¯å†…æ“ä½œ</h3><p>é»˜è®¤å‰ç¼€é”®<code>ctrl+b</code></p><blockquote><p>ä»¥ä¸‹æ“ä½œéƒ½åœ¨æŸä¸ªtmux sessionä¸­æ“ä½œï¼Œéœ€è¦å…ˆæŒ‰å‰ç¼€é”®</p></blockquote><p><code>&quot;</code> ä¸Šä¸‹åˆ†å±</p><p><code>%</code>å·¦å³åˆ†å±</p><p><code>c</code>åˆ›å»ºæ–°çª—å£</p><p><code>d</code>æš‚æ—¶é€€å‡ºtmuxçª—å£</p><p><code>s</code>åˆ—å‡ºä¼šè¯ï¼Œé€‰æ‹©åˆ‡æ¢ä¼šè¯</p><blockquote><p>åˆ‡æ¢ä¼šè¯ä¹Ÿå¯ç”¨<code>:</code> ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¯tabè¡¥å…¨</p><p>switch-client -t 0  </p><p>attach-session -t 0 </p></blockquote><p>æ•°å­—0-9åˆ‡æ¢çª—å£</p><p><code>z</code>æ”¾å¤§ç¼©å°çª—æ ¼</p><p><code>n</code>åˆ‡æ¢ä¸‹ä¸€ä¸ªçª—å£</p><p><code>p</code>åˆ‡æ¢ä¸Šä¸€ä¸ªçª—å£</p><p><code>q</code>æ˜¾ç¤ºçª—æ ¼ç¼–å·ï¼Œæ ¹æ®æç¤ºè¾“å…¥å¯¹åº”æ•°å­—åˆ‡æ¢pane</p><p><code>o</code>åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—æ ¼ï¼Œæ–¹å‘é”®äº¦å¯</p><p><code>space</code>å¾ªç¯åˆ‡æ¢çª—æ ¼å¸ƒå±€</p><p><code>&amp;</code>å…³é—­å½“å‰çª—å£</p><p><code>[</code>å¼€å¯å¤åˆ¶æ¨¡å¼</p><p><code>&#123;</code>å°†paneå¸ƒå±€å¾€å‰ç§»åŠ¨</p><p><code>&#125;</code>å°†paneå¸ƒå±€å¾€åç§»åŠ¨</p><p><code>?</code>æŸ¥çœ‹å¸®åŠ©é¡µ</p><h2 id="ä¸ªæ€§åŒ–"><a href="#ä¸ªæ€§åŒ–" class="headerlink" title="ä¸ªæ€§åŒ–"></a>ä¸ªæ€§åŒ–</h2><blockquote><p>ä»¥ä¸‹é…ç½®å°†ä¼šä¿®æ”¹</p><p>â€‹å‰ç¼€é”®ä¸ºctrl+x</p><p>â€‹å¼€å¯é¼ æ ‡æ¨¡å¼</p><p>â€‹ç»‘å®škjhlä¸ºä¸Šä¸‹å·¦å³ï¼Œç±»ä¼¼vim</p><p>â€‹è®¾ç½®vié£æ ¼æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>[</code>å¤åˆ¶æ¨¡å¼ä¸‹<code>/</code>æ¥æŸ¥æ‰¾è¾“å‡ºä¿¡æ¯çš„å…³é”®å­—</p></blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code> ~/.tmux.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> -g prefix C-x<br>unbind C-b<br><span class="hljs-built_in">bind</span> C-x send-prefix<br><span class="hljs-comment">#set swap pane key</span><br>bind-key k select-pane -U<br>bind-key j select-pane -D<br>bind-key h select-pane -L<br>bind-key l select-pane -R<br>set-option -g mouse on<br>setw -g mode-keys vi<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åå…³æ‰sessionï¼Œé‡å¼€å°±èƒ½ç”Ÿæ•ˆäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æˆ–è€…ä¹Ÿå¯ç”¨æ­¤å‘½ä»¤ç”Ÿæ•ˆ</span><br>tmux source-file ~/.tmux.conf<br></code></pre></td></tr></table></figure><p>éƒ¨åˆ†ç»ˆç«¯ä¿®æ”¹åå¯èƒ½æ— æ³•å¤åˆ¶ï¼Œéœ€è¦å®‰è£…<code>xclip</code>ï¼Œå†ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install xclip<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯ç”¨é¼ æ ‡æ”¯æŒ</span><br><span class="hljs-built_in">set</span> -g mouse on<br><span class="hljs-comment"># å¯ç”¨å¤åˆ¶æ¨¡å¼</span><br><span class="hljs-comment"># å…è®¸é¼ æ ‡é€‰æ‹©æ–‡æœ¬å¹¶å¤åˆ¶</span><br><span class="hljs-built_in">set</span> -g set-clipboard on<br><br><span class="hljs-built_in">set</span> -g pane-base-index    1     <span class="hljs-comment"># çª—æ ¼ç¼–å·ä» 1 å¼€å§‹è®¡æ•°</span><br><span class="hljs-built_in">set</span> -g renumber-windows   on    <span class="hljs-comment"># å…³æ‰æŸä¸ªçª—å£åï¼Œç¼–å·é‡æ’</span><br><br><span class="hljs-comment"># å¯ç”¨è¿™ç§æ¨¡å¼åï¼Œä½ å¯ä»¥é€šè¿‡é¼ æ ‡é€‰æ‹©æ¥å¤åˆ¶æ–‡æœ¬</span><br><span class="hljs-built_in">bind</span> -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel <span class="hljs-string">&quot;xclip -in -selection clipboard&quot;</span><br></code></pre></td></tr></table></figure><p>éƒ¨åˆ†ç»ˆç«¯å¯èƒ½ç›´æ¥é¼ æ ‡æ»šè½®å³å¯åœ¨paneä¸­ç¿»é¡µï¼Œéƒ¨åˆ†éœ€è¦é…åˆ<strong>shifté”®</strong>æ‰èƒ½ç¿»é¡µã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git åŸºæœ¬ç”¨æ³•</title>
    <link href="/2024/07/08/git-intro/"/>
    <url>/2024/07/08/git-intro/</url>
    
    <content type="html"><![CDATA[<h1 id="Git-åŸºæœ¬ç”¨æ³•"><a href="#Git-åŸºæœ¬ç”¨æ³•" class="headerlink" title="Git åŸºæœ¬ç”¨æ³•"></a>Git åŸºæœ¬ç”¨æ³•</h1><blockquote><p>gitçš„ç»“æ„å°±åƒä¸€æ£µæ ‘ä¸€æ ·</p><p>mainä¸»å¹²ï¼Œdevï¼Œtestï¼Œissue â€¦ éƒ½æ˜¯åˆ†æ”¯æ ‘æˆ</p></blockquote><h2 id="pull-push"><a href="#pull-push" class="headerlink" title="pull &amp; push"></a>pull &amp; push</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆå§‹åŒ–ä¸€ä¸ªgitä»“</span><br>git init <br>git remote add <span class="hljs-variable">$alias</span> <span class="hljs-variable">$url</span><br>git branch -M master(main)<br><span class="hljs-comment">## æŸ¥çœ‹è¿œç¨‹ä»“åº“</span><br>git remote -v<br>git push -u origin master <br><br><span class="hljs-comment">## è¿œç¨‹åˆ†æ”¯å:æœ¬åœ°åˆ†æ”¯å</span><br><span class="hljs-comment">## æ—§ç‰ˆä¸ºmaster ï¼Œæ–°ç‰ˆé»˜è®¤main</span><br>git pull origin master:master <br><br><span class="hljs-comment">## ä¿®æ”¹gitåœ°å€</span><br>git remote set-url origin <span class="hljs-variable">$url</span><br><span class="hljs-comment">## å·²è·Ÿè¸ªæ–‡ä»¶å–æ¶ˆè·Ÿè¸ªï¼Œé…åˆ.gitignoreï¼Œä¹‹åæ¨é€éƒ½å¿½ç•¥</span><br>git <span class="hljs-built_in">rm</span> -r --cached <span class="hljs-variable">$file</span><br></code></pre></td></tr></table></figure><h2 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">git ls-files <span class="hljs-comment">## æŸ¥çœ‹æš‚å­˜åŒºæ–‡ä»¶</span><br><br>git reset --soft <span class="hljs-comment">## å·¥ä½œåŒºå’Œæš‚å­˜åŒºéƒ½ä¸æ¸…ç©º</span><br>git reset --hard <span class="hljs-comment">## å·¥ä½œåŒºæš‚å­˜åŒºå…¨éƒ¨æ¸…ç©º</span><br>git reset --mixed <span class="hljs-comment">## ä¿ç•™å·¥ä½œåŒºï¼Œæ¸…ç†æš‚å­˜åŒºï¼Œé»˜è®¤é€‰é¡¹</span><br><br>git reset HEAD^ <span class="hljs-comment">## å›é€€åˆ°ä¸Šä¸€æ¬¡æäº¤</span><br><br>git <span class="hljs-built_in">log</span> <span class="hljs-comment">## å…¬å…±æäº¤è®°å½•</span><br>git reflog <span class="hljs-comment">## æœ¬åœ°æ“ä½œè®°å½•</span><br><br><span class="hljs-comment">## ä¸€èˆ¬ä¸å»ºè®®ç”¨resetå›é€€</span><br><span class="hljs-comment">## å¦‚æœç”¨äº†resetå›é€€ï¼Œéœ€è¦å¼ºåˆ¶push</span><br>git <span class="hljs-built_in">log</span>                 <span class="hljs-comment"># æ‰¾åˆ°ç›®æ ‡ commit hash</span><br>git reset --hard &lt;<span class="hljs-built_in">hash</span>&gt;<br>git push -f             <span class="hljs-comment"># å¼ºåˆ¶æ¨é€è¦†ç›–è¿œç¨‹ï¼ˆæ…é‡æ“ä½œï¼‰</span><br></code></pre></td></tr></table></figure><h2 id="switch-checkout"><a href="#switch-checkout" class="headerlink" title="switch&#x2F;checkout"></a>switch&#x2F;checkout</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆ›å»ºä¸€ä¸ªåˆ†æ”¯</span><br>git branch <span class="hljs-variable">$branch</span> <br><span class="hljs-comment">## å¯ä»¥åˆ‡æ¢åˆ†æ”¯ä¹Ÿå¯ä»¥åˆ‡æ¢è‡³æŸæ¬¡æäº¤æˆ–æ¢å¤æŸæ¬¡æäº¤çš„æ–‡ä»¶ï¼Œå¦‚åˆ†æ”¯ä¸æ–‡ä»¶åç›¸åŒä¼šäº§ç”Ÿå†²çªï¼Œé»˜è®¤æ˜¯åˆ‡æ¢åˆ†æ”¯</span><br>git checkout <span class="hljs-variable">$branch</span>(<span class="hljs-variable">$commit</span>) <br><span class="hljs-comment">## åˆ‡æ¢æŸåˆ†æ”¯çš„æŸæ¬¡æäº¤</span><br>git checkout -b <span class="hljs-variable">$branch</span> <span class="hljs-variable">$commit</span> <br><span class="hljs-comment">## ä»…åˆ‡æ¢è‡³æŸåˆ†æ”¯</span><br>git switch <span class="hljs-variable">$branch</span><br><span class="hljs-comment">## è¯¯åˆ é™¤æ–‡ä»¶ï¼Œè¿˜æœªaddæ—¶</span><br><span class="hljs-comment">## æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹ï¼Œæ¢å¤å…¨éƒ¨</span><br>git checkout .<br>git checkout -- *<br><span class="hljs-comment">## æ”¾å¼ƒæŸä¸ªæ–‡ä»¶ï¼Œæ¢å¤æŸä¸ªæ–‡ä»¶</span><br>git checkout -- <span class="hljs-variable">$filename</span><br><span class="hljs-comment">## å¦‚æœä¸€ä¸ªåˆ†æ”¯æäº¤è¿‡åå¯ä»¥ç”¨-dé€‰é¡¹åˆ æ‰åˆ†æ”¯ï¼Œæ²¡æœ‰æäº¤æƒ³åˆ é™¤éœ€ç”¨-Då¼ºåˆ¶åˆ é™¤åˆ†æ”¯</span><br>git branch -d <span class="hljs-variable">$branch</span><br>git branch -D <span class="hljs-variable">$branch</span><br><span class="hljs-comment">## å›¾è¡¨å½¢å¼æŸ¥çœ‹åˆ†æ”¯ç»“æ„</span><br>git <span class="hljs-built_in">log</span> --graph --oneline --decorate --all<br></code></pre></td></tr></table></figure><h2 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…ˆåˆ‡æ¢è‡³mainåˆ†æ”¯</span><br><span class="hljs-comment"># ç„¶åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆå¹¶developåˆ†æ”¯åˆ°mainåˆ†æ”¯</span><br>git merge <span class="hljs-variable">$branch</span><br><span class="hljs-comment">## ä¸¤ä¸ªåˆ†æ”¯ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€å¤„ä½ç½®ä¼šäº§ç”Ÿå†²çª</span><br><span class="hljs-comment">## æŸ¥çœ‹å†²çªå…·ä½“å†…å®¹ï¼Œä¿®æ”¹æ–‡ä»¶ä¸­çš„å†²çªåå†æäº¤</span><br>git diff<br><span class="hljs-comment">## ä¸­æ­¢åˆå¹¶</span><br>git merge --abort<br></code></pre></td></tr></table></figure><h2 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¦‚æœå½“å‰æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œmainå’Œdev</span><br><span class="hljs-comment">## å½“å‰å¤„åœ¨devåˆ†æ”¯æ—¶ï¼Œrebaseä¼šæŠŠdevåˆ†æ”¯æ¥åœ¨mainåˆ†æ”¯æœ€æ–°ä¸€æ¬¡æäº¤å</span><br>git switch dev<br>git rebase main<br><span class="hljs-comment">## å½“å‰å¤„åœ¨mainåˆ†æ”¯æ—¶ï¼Œrebaseä¼šæŠŠmainåˆ†æ”¯æ¥åœ¨devåˆ†æ”¯æœ€æ–°ä¸€æ¬¡æäº¤å</span><br>git switch main<br>git rebase dev<br></code></pre></td></tr></table></figure><h3 id="rebase-æ‰‹åŠ¨ä¿®æ”¹åˆå¹¶æäº¤"><a href="#rebase-æ‰‹åŠ¨ä¿®æ”¹åˆå¹¶æäº¤" class="headerlink" title="rebase æ‰‹åŠ¨ä¿®æ”¹åˆå¹¶æäº¤"></a>rebase æ‰‹åŠ¨ä¿®æ”¹åˆå¹¶æäº¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># commit_id æŒ‡è¦ä¿®æ”¹çš„æŸä¸ªcommitçš„å‰ä¸€ä¸ªå†å²commit</span><br>git rebase -i <span class="hljs-variable">$commit_id</span><br><span class="hljs-comment"># ä¼šè¿›å…¥ä¸€ä¸ªç¼–è¾‘é¡µï¼ŒåŒ…å«è¾“å…¥çš„commit_idçš„ä¸‹ä¸€ä¸ªcommitä¸€ç›´åˆ°HEAD</span><br><br><span class="hljs-comment"># ç±»ä¼¼å¦‚ä¸‹</span><br>pick d1ac219 <span class="hljs-comment"># &#x27;Update post&#x27;</span><br>pick 594574b <span class="hljs-comment"># &#x27;Update post&#x27;</span><br>pick e76b482 <span class="hljs-comment"># update</span><br>pick 32be783 <span class="hljs-comment"># Fix: Modify some content</span><br>pick 416d78e <span class="hljs-comment"># update content</span><br>pick 415c264 <span class="hljs-comment"># update</span><br>pick d1ddbce <span class="hljs-comment"># update</span><br><br><span class="hljs-comment"># é€šè¿‡å°†å†…å®¹å‰çš„pickæ”¹æˆdropæ¥åˆ é™¤æŸæ¬¡commit</span><br><span class="hljs-comment"># å°†æŸäº›commitæ”¹æˆsquashï¼Œæ¥åˆå¹¶æœ€è¿‘çš„å‡ æ¬¡æäº¤</span><br><span class="hljs-comment"># æ­¤ç±»rebaseå¾å‹è¿«è¿œç¨‹ä»“åº“å¼€å¯å¼ºåˆ¶pushæ‰èƒ½æ¨é€</span><br><span class="hljs-comment"># å¦åˆ™åªèƒ½æœ¬åœ°ç”Ÿæ•ˆ</span><br><span class="hljs-comment"># æ¨èç”¨äºæœ¬åœ°åˆå¹¶æäº¤åæ¨é€ï¼Œä¿è¯commitå†…å®¹æ•´æ´ï¼Œå·²æ¨é€å†…å®¹ä¸å»ºè®®ä¿®æ”¹</span><br></code></pre></td></tr></table></figure><h2 id="stash"><a href="#stash" class="headerlink" title="stash"></a>stash</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æš‚å­˜å½“å‰å·¥ä½œåŒºçš„æ‰€æœ‰ä¿®æ”¹</span><br>git stash<br><br><span class="hljs-comment"># æŸ¥çœ‹stashåˆ—è¡¨</span><br>git stash list<br><br><span class="hljs-comment"># æ¢å¤æœ€è¿‘ä¸€æ¬¡stashçš„å†…å®¹</span><br>git stash pop<br><br><span class="hljs-comment"># æ¢å¤æŒ‡å®šçš„stashå†…å®¹</span><br>git stash apply stash@&#123;0&#125;<br></code></pre></td></tr></table></figure><h2 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## æ’¤é”€æŸæ¬¡æäº¤</span><br>git <span class="hljs-built_in">log</span>                 <span class="hljs-comment"># æ‰¾åˆ°ç›®æ ‡ commit hash</span><br>git revert &lt;<span class="hljs-built_in">hash</span>&gt;       <span class="hljs-comment"># è‡ªåŠ¨ç”Ÿæˆæ’¤é”€è¯¥æäº¤å†…å®¹çš„ commit</span><br>git push<br></code></pre></td></tr></table></figure><h2 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry-pick"></a>cherry-pick</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åªåˆå¹¶æŸä¸ªåˆ†æ”¯é‡Œçš„ æŸä¸€æ¬¡æäº¤</span><br><span class="hljs-comment"># åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯ï¼Œæ¯”å¦‚ main</span><br>git checkout main  <br><br><span class="hljs-comment"># æŠŠæŸæ¬¡æäº¤åˆå¹¶è¿‡æ¥ï¼ˆcommit id ç”¨ git log æŸ¥ï¼‰</span><br>git cherry-pick &lt;commit-id&gt;  <br><br><span class="hljs-comment"># æ¨é€åˆ°è¿œç¨‹</span><br><span class="hljs-comment">## å‰ææ˜¯æœ‰æƒé™æ¨é€åˆ°mainåˆ†æ”¯</span><br>git push origin main<br></code></pre></td></tr></table></figure><h2 id="bisect"><a href="#bisect" class="headerlink" title="bisect"></a>bisect</h2><p>äºŒåˆ†æŸ¥æ‰¾æŸæ¬¡æœ‰bugçš„æäº¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å‡è®¾å½“å‰HEADæœ‰é”™è¯¯ï¼Œä½†åœ¨æŸæ¬¡commitæ—¶è¿˜æ˜¯æ­£å¸¸çš„</span><br><span class="hljs-comment"># å¼€å¯äºŒåˆ†æŸ¥æ‰¾</span><br>git bisect start<br><span class="hljs-comment"># æ ‡è®°å½“å‰HEADä¸ºåcommit</span><br>git bisect bad HEAD<br><span class="hljs-comment"># æ ‡è®°å·²çŸ¥æ˜¯å¥½çš„commit</span><br>git bisect good <span class="hljs-variable">$commit_id</span><br><span class="hljs-comment"># æ­¤æ—¶gitä¼šè¾“å‡ºå¥½ä¸åä¸­é—´çš„é‚£ä¸ªcommit</span><br><span class="hljs-comment"># ç„¶åæµ‹è¯•commitï¼Œæ ‡è®°å¥½åï¼Œé‡å¤æ­¥éª¤å³å¯æ‰¾åˆ°å¼•å…¥bugçš„ç¬¬ä¸€ä¸ªæäº¤</span><br><span class="hljs-comment"># ç»“æŸæŸ¥æ‰¾</span><br>git bisect reset<br><br><span class="hljs-comment"># å¦‚æœä¸­é—´çš„æŸæ¬¡æäº¤æ˜¯ä¸å®Œæ•´çš„å·¥ä½œæäº¤å¯ä»¥ä½¿ç”¨skipè·³è¿‡</span><br>git bisect skip<br><br><span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿—</span><br>git bisect <span class="hljs-built_in">log</span><br><span class="hljs-comment"># é‡æ”¾æ—¥å¿—</span><br>git bisect <span class="hljs-built_in">log</span> &gt; bisect.log<br>git bisect replay bisect.log<br><span class="hljs-comment"># æŸ¥çœ‹è¿›åº¦</span><br>git bisect status<br><span class="hljs-comment"># å¯è§†åŒ–æŸ¥çœ‹äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹</span><br>git <span class="hljs-built_in">log</span> --oneline --graph --boundary $(git bisect rev-list --bisect-vars | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;\n&#x27;</span> | grep -E <span class="hljs-string">&#x27;^(BISECT_START|BISECT_BAD|BISECT_GOOD)&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[K8s] Kubernetes Install</title>
    <link href="/2024/07/08/k8s-K8s-Install/"/>
    <url>/2024/07/08/k8s-K8s-Install/</url>
    
    <content type="html"><![CDATA[<h1 id="K8s-Install"><a href="#K8s-Install" class="headerlink" title="K8s Install"></a>K8s Install</h1><h2 id="1-Standard"><a href="#1-Standard" class="headerlink" title="1. Standard"></a>1. Standard</h2><ul><li>2GB or more of RAM</li><li>2CPUs or more</li></ul><h2 id="2-Prepare"><a href="#2-Prepare" class="headerlink" title="2. Prepare"></a>2. Prepare</h2><ul><li><p>You need to install a container runtime into each node in the cluster so that Pods can run there.</p></li><li><p>Certain ports are open on your machines</p><ul><li>systemctl firewalld stop</li></ul></li><li><p>Disable swap</p><ul><li>swapoff -a</li><li>check &#x2F;etc&#x2F;fstab</li></ul></li><li><p>Verify glibc is provide or not in machines</p></li><li><p>Verify the MAC address and product_uuid are unique for every node</p><ul><li>ip link</li><li>ifconfig -a</li><li>cat &#x2F;sys&#x2F;class&#x2F;dmi&#x2F;id&#x2F;product_uuid</li></ul></li><li><p>Check required ports</p><ul><li>nc 127.0.0.1 6443</li></ul></li></ul><h2 id="3-Installing-kubeadm-kubelet-and-kubectl"><a href="#3-Installing-kubeadm-kubelet-and-kubectl" class="headerlink" title="3. Installing kubeadm, kubelet and kubectl"></a>3. Installing kubeadm, kubelet and kubectl</h2><blockquote><p>kubelet version may never exceed the API server version.</p><p>For example, the kubelet running 1.7.0 should be fully compatible with a 1.8.0 API server, but not vice versa.</p></blockquote><h4 id="Red-Hat-based-distributions"><a href="#Red-Hat-based-distributions" class="headerlink" title="Red Hat-based distributions"></a><strong>Red Hat-based distributions</strong></h4><ul><li><p>Set SELinux to <code>permissive</code> mode</p><ul><li>setenforce 0</li><li>sed -i â€˜s&#x2F;^SELINUX&#x3D;enforcing$&#x2F;SELINUX&#x3D;permissive&#x2F;â€˜ &#x2F;etc&#x2F;selinux&#x2F;config</li></ul></li><li><p>Add the Kubernetes <code>yum</code> repository</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key</span><br><span class="hljs-string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></li><li><p>Install kubelet, kubeadm and kubectl, and enable kubelet to ensure itâ€™s automatically started on startup</p><ul><li>yum install -y kubelet kubeadm kubectl â€“disableexcludes&#x3D;kubernetes</li><li>systemctl enable â€“now kubelet</li></ul></li></ul><h4 id="Without-a-package-manager"><a href="#Without-a-package-manager" class="headerlink" title="Without a package manager"></a><strong>Without a package manager</strong></h4><ul><li><p>Install CNI plugins (required for most pod network)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">CNI_PLUGINS_VERSION=<span class="hljs-string">&quot;v1.3.0&quot;</span><br>ARCH=<span class="hljs-string">&quot;amd64&quot;</span><br>DEST=<span class="hljs-string">&quot;/opt/cni/bin&quot;</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$DEST</span>&quot;</span><br>curl -L <span class="hljs-string">&quot;https://github.com/containernetworking/plugins/releases/download/<span class="hljs-variable">$&#123;CNI_PLUGINS_VERSION&#125;</span>/cni-plugins-linux-<span class="hljs-variable">$&#123;ARCH&#125;</span>-<span class="hljs-variable">$&#123;CNI_PLUGINS_VERSION&#125;</span>.tgz&quot;</span> | <span class="hljs-built_in">sudo</span> tar -C <span class="hljs-string">&quot;<span class="hljs-variable">$DEST</span>&quot;</span> -xz<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/cni/net.d/10-containerd-net.conflist &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;cniVersion&quot;: &quot;1.0.0&quot;,</span><br><span class="hljs-string">  &quot;name&quot;: &quot;containerd-net&quot;,</span><br><span class="hljs-string">  &quot;plugins&quot;: [</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;type&quot;: &quot;bridge&quot;,</span><br><span class="hljs-string">      &quot;bridge&quot;: &quot;cni0&quot;,</span><br><span class="hljs-string">      &quot;isGateway&quot;: true,</span><br><span class="hljs-string">      &quot;ipMasq&quot;: true,</span><br><span class="hljs-string">      &quot;promiscMode&quot;: true,</span><br><span class="hljs-string">      &quot;ipam&quot;: &#123;</span><br><span class="hljs-string">        &quot;type&quot;: &quot;host-local&quot;,</span><br><span class="hljs-string">        &quot;ranges&quot;: [</span><br><span class="hljs-string">          [&#123;</span><br><span class="hljs-string">            &quot;subnet&quot;: &quot;10.88.0.0/16&quot;</span><br><span class="hljs-string">          &#125;],</span><br><span class="hljs-string">          [&#123;</span><br><span class="hljs-string">            &quot;subnet&quot;: &quot;2001:4860:4860::/64&quot;</span><br><span class="hljs-string">          &#125;]</span><br><span class="hljs-string">        ],</span><br><span class="hljs-string">        &quot;routes&quot;: [</span><br><span class="hljs-string">          &#123; &quot;dst&quot;: &quot;0.0.0.0/0&quot; &#125;,</span><br><span class="hljs-string">          &#123; &quot;dst&quot;: &quot;::/0&quot; &#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;type&quot;: &quot;portmap&quot;,</span><br><span class="hljs-string">      &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></li><li><p>Define the directory to download command files</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">DOWNLOAD_DIR=<span class="hljs-string">&quot;/usr/local/bin&quot;</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$DOWNLOAD_DIR</span>&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>Install crictl (required for kubeadm &#x2F; Kubelet Container Runtime Interface (CRI))</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">CRICTL_VERSION=<span class="hljs-string">&quot;v1.28.0&quot;</span><br>ARCH=<span class="hljs-string">&quot;amd64&quot;</span><br>curl -L <span class="hljs-string">&quot;https://github.com/kubernetes-sigs/cri-tools/releases/download/<span class="hljs-variable">$&#123;CRICTL_VERSION&#125;</span>/crictl-<span class="hljs-variable">$&#123;CRICTL_VERSION&#125;</span>-linux-<span class="hljs-variable">$&#123;ARCH&#125;</span>.tar.gz&quot;</span> | <span class="hljs-built_in">sudo</span> tar -C <span class="hljs-variable">$DOWNLOAD_DIR</span> -xz<br></code></pre></td></tr></table></figure></li><li><p>Install <code>kubeadm</code>, <code>kubelet</code>, <code>kubectl</code> and add a <code>kubelet</code> systemd service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">RELEASE=<span class="hljs-string">&quot;<span class="hljs-subst">$(curl -sSL https://dl.k8s.io/release/stable.txt)</span>&quot;</span><br>ARCH=<span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$DOWNLOAD_DIR</span><br><span class="hljs-built_in">sudo</span> curl -L --remote-name-all https://dl.k8s.io/release/<span class="hljs-variable">$&#123;RELEASE&#125;</span>/bin/linux/<span class="hljs-variable">$&#123;ARCH&#125;</span>/&#123;kubeadm,kubelet&#125;<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> +x &#123;kubeadm,kubelet&#125;<br><br>RELEASE_VERSION=<span class="hljs-string">&quot;v0.16.2&quot;</span><br>curl -sSL <span class="hljs-string">&quot;https://raw.githubusercontent.com/kubernetes/release/<span class="hljs-variable">$&#123;RELEASE_VERSION&#125;</span>/cmd/krel/templates/latest/kubelet/kubelet.service&quot;</span> | sed <span class="hljs-string">&quot;s:/usr/bin:<span class="hljs-variable">$&#123;DOWNLOAD_DIR&#125;</span>:g&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/systemd/system/kubelet.service<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/kubelet.service.d<br>curl -sSL <span class="hljs-string">&quot;https://raw.githubusercontent.com/kubernetes/release/<span class="hljs-variable">$&#123;RELEASE_VERSION&#125;</span>/cmd/krel/templates/latest/kubeadm/10-kubeadm.conf&quot;</span> | sed <span class="hljs-string">&quot;s:/usr/bin:<span class="hljs-variable">$&#123;DOWNLOAD_DIR&#125;</span>:g&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf<br></code></pre></td></tr></table></figure><blockquote><p>Notes:</p><p>Site raw.githubusercontent.com is 404 â€¦ replace following url</p><p><a href="https://github.com/kubernetes/release/blob/master/cmd/krel/templates/latest/kubelet/kubelet.service">https://github.com/kubernetes/release/blob/master/cmd/krel/templates/latest/kubelet/kubelet.service</a></p><p><a href="https://github.com/kubernetes/release/blob/master/cmd/krel/templates/latest/kubeadm/10-kubeadm.conf">https://github.com/kubernetes/release/blob/master/cmd/krel/templates/latest/kubeadm/10-kubeadm.conf</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/systemd/system/kubelet.service &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br>[Unit]<br>Description=kubelet: The Kubernetes Node Agent<br>Documentation=https://kubernetes.io/docs/<br>Wants=network-online.target<br>After=network-online.target<br><br>[Service]<br>ExecStart=/usr/bin/kubelet<br>Restart=always<br>StartLimitInterval=0<br>RestartSec=10<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/systemd/system/kubelet.service.d/10-kubeadm.conf &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-comment"># Note: This dropin only works with kubeadm and kubelet v1.11+</span><br>[Service]<br>Environment=<span class="hljs-string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span><br>Environment=<span class="hljs-string">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;</span><br><span class="hljs-comment"># This is a file that &quot;kubeadm init&quot; and &quot;kubeadm join&quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span><br>EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env<br><span class="hljs-comment"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span><br><span class="hljs-comment"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span><br>EnvironmentFile=-/etc/sysconfig/kubelet<br>ExecStart=<br>ExecStart=/usr/bin/kubelet <span class="hljs-variable">$KUBELET_KUBECONFIG_ARGS</span> <span class="hljs-variable">$KUBELET_CONFIG_ARGS</span> <span class="hljs-variable">$KUBELET_KUBEADM_ARGS</span> <span class="hljs-variable">$KUBELET_EXTRA_ARGS</span><br>EOF<br></code></pre></td></tr></table></figure></li><li><p>Install and Set Up kubectl on Linux</p><ul><li><p>Install kubectl binary with curl on Linux</p><ol><li><p>Download the latest release with the command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl&quot;</span><br><br><span class="hljs-comment">## View stable version</span><br>curl -L -s https://dl.k8s.io/release/stable.txt<br></code></pre></td></tr></table></figure></li><li><p>Validate the binary (optional)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## Download the kubectl checksum file</span><br>curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl.sha256&quot;</span><br><br><span class="hljs-comment">## Validate the kubectl binary against the checksum file</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(cat kubectl.sha256)</span>  kubectl&quot;</span> | <span class="hljs-built_in">sha256sum</span> --check<br></code></pre></td></tr></table></figure></li><li><p>Install kubectl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl<br></code></pre></td></tr></table></figure></li><li><p>Test to ensure the version you installed is up-to-date</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl version --client<br><span class="hljs-comment">## Or use this for detailed view of version</span><br>kubectl version --client --output=yaml<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Install using native package management</p><ol><li><p>Add the Kubernetes <code>yum</code> repository. If you want to use Kubernetes version different than v1.29, replace v1.29 with the desired minor version in the command below.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># This overwrites any existing configuration in /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=1</span><br><span class="hljs-string">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></li><li><p>Install kubectl using <code>yum</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> yum install -y kubectl<br></code></pre></td></tr></table></figure></li></ol></li></ul></li><li><p>Enable and start <code>kubelet</code></p><ul><li><pre><code class="bash">systemctl enable --now kubelet<figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-title class_">Container</span> runtimes</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-string">`kubeadm init`</span> output error</span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-string">` [ERROR CRI]: container runtime is not running`</span></span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/containerd/containerd/blob/main/docs/getting-started.md</span></span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/containerd/containerd/blob/main/containerd.service</span></span><br><span class="hljs-meta prompt_">&gt;</span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">yum -y install socat conntrack-tools</span><br><br>## 4. Creating a cluster with kubeadm<br><br>```bash<br>kubeadm init   --apiserver-advertise-address=192.168.175.133   --image-repository registry.aliyuncs.com/google_containers   --kubernetes-version v1.29.0   --service-cidr=10.1.0.0/16   --pod-network-cidr=10.244.0.0/16<br><br><br>mkdir -p $HOME/.kube<br>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>sudo chown $(id -u):$(id -g) $HOME/.kube/config<br><br>## if you are the root user, you can run:<br>  export KUBECONFIG=/etc/kubernetes/admin.conf<br></code></pre></td></tr></table></figure></code></pre></li></ul></li></ul><h3 id="Installing-a-Pod-network-add-on"><a href="#Installing-a-Pod-network-add-on" class="headerlink" title="Installing a Pod network add-on"></a>Installing a Pod network add-on</h3><blockquote><p><a href="https://github.com/containerd/containerd/blob/main/script/setup/install-cni">https://github.com/containerd/containerd/blob/main/script/setup/install-cni</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br><span class="hljs-comment">#   Copyright The containerd Authors.</span><br><br><span class="hljs-comment">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment">#   you may not use this file except in compliance with the License.</span><br><span class="hljs-comment">#   You may obtain a copy of the License at</span><br><br><span class="hljs-comment">#       http://www.apache.org/licenses/LICENSE-2.0</span><br><br><span class="hljs-comment">#   Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment">#   See the License for the specific language governing permissions and</span><br><span class="hljs-comment">#   limitations under the License.</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Builds and installs cni plugins to /opt/cni/bin,</span><br><span class="hljs-comment"># and create basic cni config in /etc/cni/net.d.</span><br><span class="hljs-comment"># The commit defined in go.mod</span><br><span class="hljs-comment">#</span><br><span class="hljs-built_in">set</span> -eu -o pipefail<br><br>CNI_COMMIT=<span class="hljs-variable">$&#123;1:-$(go list -f &quot;&#123;&#123;.Version&#125;</span>&#125;<span class="hljs-string">&quot; -m github.com/containernetworking/plugins)&#125;</span><br><span class="hljs-string">CNI_DIR=<span class="hljs-variable">$&#123;DESTDIR:=&#x27;&#x27;&#125;</span>/opt/cni</span><br><span class="hljs-string">CNI_CONFIG_DIR=<span class="hljs-variable">$&#123;DESTDIR&#125;</span>/etc/cni/net.d</span><br><span class="hljs-string">: &quot;</span><span class="hljs-variable">$&#123;CNI_REPO:=https://github.com/containernetworking/plugins.git&#125;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># e2e and Cirrus will fail with &quot;</span><span class="hljs-built_in">sudo</span>: <span class="hljs-built_in">command</span> not found<span class="hljs-string">&quot;</span><br><span class="hljs-string">SUDO=&#x27;&#x27;</span><br><span class="hljs-string">if (( <span class="hljs-variable">$EUID</span> != 0 )); then</span><br><span class="hljs-string">    SUDO=&#x27;sudo&#x27;</span><br><span class="hljs-string">fi</span><br><span class="hljs-string"></span><br><span class="hljs-string">TMPROOT=<span class="hljs-subst">$(mktemp -d)</span></span><br><span class="hljs-string">git clone &quot;</span><span class="hljs-variable">$&#123;CNI_REPO&#125;</span><span class="hljs-string">&quot; &quot;</span><span class="hljs-variable">$&#123;TMPROOT&#125;</span><span class="hljs-string">&quot;/plugins</span><br><span class="hljs-string">pushd &quot;</span><span class="hljs-variable">$&#123;TMPROOT&#125;</span><span class="hljs-string">&quot;/plugins</span><br><span class="hljs-string">git checkout &quot;</span><span class="hljs-variable">$CNI_COMMIT</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">./build_linux.sh</span><br><span class="hljs-string"><span class="hljs-variable">$SUDO</span> mkdir -p <span class="hljs-variable">$CNI_DIR</span></span><br><span class="hljs-string"><span class="hljs-variable">$SUDO</span> cp -r ./bin <span class="hljs-variable">$CNI_DIR</span></span><br><span class="hljs-string"><span class="hljs-variable">$SUDO</span> mkdir -p <span class="hljs-variable">$CNI_CONFIG_DIR</span></span><br><span class="hljs-string"><span class="hljs-variable">$SUDO</span> cat &lt;&lt; EOF | <span class="hljs-variable">$SUDO</span> tee <span class="hljs-variable">$CNI_CONFIG_DIR</span>/10-containerd-net.conflist</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;</span>cniVersion<span class="hljs-string">&quot;: &quot;</span>1.0.0<span class="hljs-string">&quot;,</span><br><span class="hljs-string">  &quot;</span>name<span class="hljs-string">&quot;: &quot;</span>containerd-net<span class="hljs-string">&quot;,</span><br><span class="hljs-string">  &quot;</span>plugins<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span><span class="hljs-built_in">type</span><span class="hljs-string">&quot;: &quot;</span>bridge<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>bridge<span class="hljs-string">&quot;: &quot;</span>cni0<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>isGateway<span class="hljs-string">&quot;: true,</span><br><span class="hljs-string">      &quot;</span>ipMasq<span class="hljs-string">&quot;: true,</span><br><span class="hljs-string">      &quot;</span>promiscMode<span class="hljs-string">&quot;: true,</span><br><span class="hljs-string">      &quot;</span>ipam<span class="hljs-string">&quot;: &#123;</span><br><span class="hljs-string">        &quot;</span><span class="hljs-built_in">type</span><span class="hljs-string">&quot;: &quot;</span>host-local<span class="hljs-string">&quot;,</span><br><span class="hljs-string">        &quot;</span>ranges<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">          [&#123;</span><br><span class="hljs-string">            &quot;</span>subnet<span class="hljs-string">&quot;: &quot;</span>10.88.0.0/16<span class="hljs-string">&quot;</span><br><span class="hljs-string">          &#125;],</span><br><span class="hljs-string">          [&#123;</span><br><span class="hljs-string">            &quot;</span>subnet<span class="hljs-string">&quot;: &quot;</span>2001:4860:4860::/64<span class="hljs-string">&quot;</span><br><span class="hljs-string">          &#125;]</span><br><span class="hljs-string">        ],</span><br><span class="hljs-string">        &quot;</span>routes<span class="hljs-string">&quot;: [</span><br><span class="hljs-string">          &#123; &quot;</span>dst<span class="hljs-string">&quot;: &quot;</span>0.0.0.0/0<span class="hljs-string">&quot; &#125;,</span><br><span class="hljs-string">          &#123; &quot;</span>dst<span class="hljs-string">&quot;: &quot;</span>::/0<span class="hljs-string">&quot; &#125;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span><span class="hljs-built_in">type</span><span class="hljs-string">&quot;: &quot;</span>portmap<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>capabilities<span class="hljs-string">&quot;: &#123;&quot;</span>portMappings<span class="hljs-string">&quot;: true&#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br><span class="hljs-string">popd</span><br><span class="hljs-string">rm -fR &quot;</span><span class="hljs-variable">$&#123;TMPROOT&#125;</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Control-plane-node-isolation"><a href="#Control-plane-node-isolation" class="headerlink" title="Control plane node isolation"></a>Control plane node isolation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## By default, your cluster will not schedule Pods on the control plane nodes for security reasons. If you want to be able to schedule Pods on the control plane nodes, for example for a single machine Kubernetes cluster, run:</span><br>kubectl taint nodes --all node-role.kubernetes.io/control-plane-<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[K8s] Prepare Environment</title>
    <link href="/2024/07/08/k8s-Prepare-Environment/"/>
    <url>/2024/07/08/k8s-Prepare-Environment/</url>
    
    <content type="html"><![CDATA[<h1 id="Prepare-Environment"><a href="#Prepare-Environment" class="headerlink" title="Prepare Environment"></a>Prepare Environment</h1><h2 id="Containerd-Install"><a href="#Containerd-Install" class="headerlink" title="Containerd Install"></a>Containerd Install</h2><blockquote><p>Container Runtimes</p><p>Kubernetes 1.29 requires that you use a runtime that conforms with the <a href="https://kubernetes.io/docs/concepts/overview/components/#container-runtime">Container Runtime Interface</a> (CRI).</p></blockquote><h3 id="1-Installing-containerd"><a href="#1-Installing-containerd" class="headerlink" title="1. Installing containerd"></a>1. Installing containerd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/containerd/containerd/releases/download/v1.7.11/containerd-1.7.11-linux-amd64.tar.gz<br><br>tar -xvf containerd-1.6.26-linux-amd64.tar.gz -C /usr/local/<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/containerd/containerd/blob/main/containerd.service">https://github.com/containerd/containerd/blob/main/containerd.service</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/systemd/system/containerd.service &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-comment"># Copyright The containerd Authors.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"># you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"># You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><br>[Unit]<br>Description=containerd container runtime<br>Documentation=https://containerd.io<br>After=network.target local-fs.target<br><br>[Service]<br>ExecStartPre=-/sbin/modprobe overlay<br>ExecStart=/usr/local/bin/containerd<br><br>Type=notify<br>Delegate=<span class="hljs-built_in">yes</span><br>KillMode=process<br>Restart=always<br>RestartSec=5<br><br><span class="hljs-comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="hljs-comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br>LimitNPROC=infinity<br>LimitCORE=infinity<br><br><span class="hljs-comment"># Comment TasksMax if your systemd version does not supports it.</span><br><span class="hljs-comment"># Only systemd 226 and above support this version.</span><br>TasksMax=infinity<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now containerd<br>systemctl status containerd<br></code></pre></td></tr></table></figure><h3 id="2-Installing-runc"><a href="#2-Installing-runc" class="headerlink" title="2. Installing runc"></a>2. Installing runc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/opencontainers/runc/releases/download/v1.1.11/runc.amd64<br><br>install -m 755 runc.amd64 /usr/local/sbin/runc<br></code></pre></td></tr></table></figure><h3 id="3-Installing-CNI-plugins"><a href="#3-Installing-CNI-plugins" class="headerlink" title="3. Installing CNI plugins"></a>3. Installing CNI plugins</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/containernetworking/plugins/releases/download/v1.4.0/cni-plugins-linux-amd64-v1.4.0.tgz<br><br><span class="hljs-built_in">mkdir</span> -p /opt/cni/bin<br>tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz<br></code></pre></td></tr></table></figure><h3 id="Default-config"><a href="#Default-config" class="headerlink" title="Default config"></a>Default config</h3><blockquote><p>containerd uses a configuration file located in <code>/etc/containerd/config.toml</code> for specifying daemon level options. A sample configuration file can be found <a href="https://github.com/containerd/containerd/blob/main/docs/man/containerd-config.toml.5.md">here</a>.</p><p>The default configuration can be generated via <code>containerd config default &gt; /etc/containerd/config.toml</code>.</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">version</span> = <span class="hljs-number">2</span><br><br><span class="hljs-attr">root</span> = <span class="hljs-string">&quot;/var/lib/containerd&quot;</span><br><span class="hljs-attr">state</span> = <span class="hljs-string">&quot;/run/containerd&quot;</span><br><span class="hljs-attr">oom_score</span> = <span class="hljs-number">0</span><br><span class="hljs-attr">imports</span> = [<span class="hljs-string">&quot;/etc/containerd/runtime_*.toml&quot;</span>, <span class="hljs-string">&quot;./debug.toml&quot;</span>]<br><br><span class="hljs-section">[grpc]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;/run/containerd/containerd.sock&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br><br><span class="hljs-section">[debug]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;/run/containerd/debug.sock&quot;</span><br>  <span class="hljs-attr">uid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">gid</span> = <span class="hljs-number">0</span><br>  <span class="hljs-attr">level</span> = <span class="hljs-string">&quot;info&quot;</span><br><br><span class="hljs-section">[metrics]</span><br>  <span class="hljs-attr">address</span> = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">grpc_histogram</span> = <span class="hljs-literal">false</span><br><br><span class="hljs-section">[cgroup]</span><br>  <span class="hljs-attr">path</span> = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[plugins]</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.monitor.v1.cgroups&quot;]</span><br>    <span class="hljs-attr">no_prometheus</span> = <span class="hljs-literal">false</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.diff-service&quot;]</span><br>    <span class="hljs-attr">default</span> = [<span class="hljs-string">&quot;walking&quot;</span>]<br>  <span class="hljs-section">[plugins.&quot;io.containerd.gc.v1.scheduler&quot;]</span><br>    <span class="hljs-attr">pause_threshold</span> = <span class="hljs-number">0.02</span><br>    <span class="hljs-attr">deletion_threshold</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attr">mutation_threshold</span> = <span class="hljs-number">100</span><br>    <span class="hljs-attr">schedule_delay</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attr">startup_delay</span> = <span class="hljs-string">&quot;100ms&quot;</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.runtime.v2.task&quot;]</span><br>    <span class="hljs-attr">platforms</span> = [<span class="hljs-string">&quot;linux/amd64&quot;</span>]<br>    <span class="hljs-attr">sched_core</span> = <span class="hljs-literal">true</span><br>  <span class="hljs-section">[plugins.&quot;io.containerd.service.v1.tasks-service&quot;]</span><br>    <span class="hljs-attr">blockio_config_file</span> = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">rdt_config_file</span> = <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><h2 id="Install-and-configure-prerequisites"><a href="#Install-and-configure-prerequisites" class="headerlink" title="Install and configure prerequisites"></a>Install and configure prerequisites</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## Forwarding IPv4 and letting iptables see bridged traffic</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="hljs-string">overlay</span><br><span class="hljs-string">br_netfilter</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">sudo</span> modprobe overlay<br><span class="hljs-built_in">sudo</span> modprobe br_netfilter<br><br><span class="hljs-comment">## sysctl params required by setup, params persist across reboots</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables  = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.ipv4.ip_forward                 = 1</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># Apply sysctl params without reboot</span><br><span class="hljs-built_in">sudo</span> sysctl --system<br><br><span class="hljs-comment">## Verify that the br_netfilter, overlay modules are loaded by running the following commands:</span><br>lsmod | grep br_netfilter<br>lsmod | grep overlay<br><br><span class="hljs-comment">## Verify that the net.bridge.bridge-nf-call-iptables, net.bridge.bridge-nf-call-ip6tables, and net.ipv4.ip_forward system variables are set to 1 in your sysctl config by running the following command:</span><br>sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward<br></code></pre></td></tr></table></figure><h2 id="Cgroup-drivers"><a href="#Cgroup-drivers" class="headerlink" title="Cgroup drivers"></a>Cgroup drivers</h2><ul><li><p>cgroupfs</p><ul><li>The <code>cgroupfs</code> driver is <strong>not</strong> recommended when <a href="https://www.freedesktop.org/wiki/Software/systemd/">systemd</a> is the init system because systemd expects a single cgroup manager on the system. Additionally, if you use <a href="https://kubernetes.io/docs/concepts/architecture/cgroups">cgroup v2</a>, use the <code>systemd</code> cgroup driver instead of <code>cgroupfs</code>.</li></ul></li><li><p>systemd</p><ul><li><p>To set <code>systemd</code> as the cgroup driver, edit the <a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/"><code>KubeletConfiguration</code></a> option of <code>cgroupDriver</code> and set it to <code>systemd</code>. For example:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubelet.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeletConfiguration</span><br><span class="hljs-string">...</span><br><span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">systemd</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>Note: Starting with v1.22 and later, when creating a cluster with kubeadm, if the user does not set the cgroupDriver field under KubeletConfiguration, kubeadm defaults it to systemd</p></blockquote></li></ul><h2 id="Container-runtimes"><a href="#Container-runtimes" class="headerlink" title="Container runtimes"></a>Container runtimes</h2><blockquote><p>In this step once youâ€™ve created a valid <code>config.toml</code> configuration file.</p><p>You can find this file under the path <code>/etc/containerd/config.toml</code>.</p><p>On Linux the default CRI socket for containerd is <code>/run/containerd/containerd.sock</code>.</p></blockquote><h3 id="Configuring-the-systemd-cgroup-driver"><a href="#Configuring-the-systemd-cgroup-driver" class="headerlink" title="Configuring the systemd cgroup driver"></a>Configuring the systemd cgroup driver</h3><blockquote><p>The <code>systemd</code> cgroup driver is recommended if you use <a href="https://kubernetes.io/docs/concepts/architecture/cgroups">cgroup v2</a>.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[plugins.<span class="hljs-string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc]<br>  ...<br>  [plugins.<span class="hljs-string">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options]<br>    SystemdCgroup = <span class="hljs-literal">true</span><br>    <br><span class="hljs-built_in">sudo</span> sed -i <span class="hljs-string">&quot;s#SystemdCgroup = false#SystemdCgroup = true#g&quot;</span> /etc/containerd/config.toml<br><span class="hljs-comment">### If you apply this change, make sure to restart containerd:</span><br><span class="hljs-built_in">sudo</span> systemctl restart containerd<br></code></pre></td></tr></table></figure><h3 id="Overriding-the-sandbox-pause-image"><a href="#Overriding-the-sandbox-pause-image" class="headerlink" title="Overriding the sandbox (pause) image"></a>Overriding the sandbox (pause) image</h3><p>In your <a href="https://github.com/containerd/containerd/blob/main/docs/cri/config.md">containerd config</a> you can overwrite the sandbox image by setting the following config:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[plugins.&quot;io.containerd.grpc.v1.cri&quot;]</span><br>  <span class="hljs-attr">sandbox_image</span> = <span class="hljs-string">&quot;registry.k8s.io/pause:3.2&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[plugins.<span class="hljs-string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors]<br><span class="hljs-comment">### add following config in China   [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;k8s.gcr.io&quot;]</span><br>      endpoint = [<span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers&quot;</span>]<br><br><span class="hljs-comment">### This is important if you live in China.</span><br><span class="hljs-built_in">sudo</span> sed -i <span class="hljs-string">&quot;s#registry.k8s.io/pause#registry.cn-hangzhou.aliyuncs.com/google_containers/pause#g&quot;</span> /etc/containerd/config.toml<br><span class="hljs-built_in">sudo</span> systemctl restart containerd<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.22.3<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.22.3<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.22.3<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.22.3<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.0-0<br>ctr images pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.4<br><br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.22.3 k8s.gcr.io/kube-apiserver:v1.22.3<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.22.3 k8s.gcr.io/kube-controller-manager:v1.22.3<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.22.3 k8s.gcr.io/kube-scheduler:v1.22.3<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.22.3 k8s.gcr.io/kube-proxy:v1.22.3<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5 k8s.gcr.io/pause:3.5<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.0-0 k8s.gcr.io/etcd:3.5.0-0<br>ctr images tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.4 k8s.gcr.io/coredns/coredns:v1.8.4<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Multipass åŸºæœ¬ç”¨æ³•åŠå¸¸è§é—®é¢˜</title>
    <link href="/2024/07/08/multipass/"/>
    <url>/2024/07/08/multipass/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä»½MultipassåŸºæœ¬æ“ä½œæ–‡æ¡£ï¼Œä»¥åŠåŒ…å«ä¸€äº›å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚</p><p>Multipass æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–åœ¨æœ¬åœ°ç¯å¢ƒä¸­åˆ›å»ºå’Œç®¡ç† Ubuntu è™šæ‹Ÿæœºã€‚</p><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="https://multipass.run/">Multipass å®˜ç½‘</a></li><li><a href="https://multipass.run/docs">Multipass æ–‡æ¡£</a></li></ul><h1 id="å®‰è£…Multipass"><a href="#å®‰è£…Multipass" class="headerlink" title="å®‰è£…Multipass"></a>å®‰è£…Multipass</h1><ol><li><p><strong>åœ¨ Linux ä¸Šå®‰è£…</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> snap install multipass<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨ macOS ä¸Šå®‰è£…</strong>:<br>ä½¿ç”¨ Homebrew:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">brew install --cask multipass<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨ Windows ä¸Šå®‰è£…</strong>:<br>è®¿é—® <a href="https://multipass.run/">Multipass å®˜ç½‘</a> ä¸‹è½½é€‚ç”¨äº Windows çš„å®‰è£…ç¨‹åºï¼Œå¹¶æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…ã€‚</p></li></ol><h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><ol><li><p><strong>å¯åŠ¨ä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name &lt;instance-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name my-vm<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass list<br></code></pre></td></tr></table></figure></li><li><p><strong>è¿›å…¥è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass shell &lt;instance-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass shell my-vm<br></code></pre></td></tr></table></figure></li><li><p><strong>åœæ­¢è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass stop &lt;instance-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass stop my-vm<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ é™¤è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass delete &lt;instance-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass delete my-vm<br></code></pre></td></tr></table></figure></li><li><p><strong>æ¸…ç†å·²åˆ é™¤çš„è™šæ‹Ÿæœº</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass purge<br></code></pre></td></tr></table></figure></li></ol><h2 id="è¿›é˜¶ç”¨æ³•"><a href="#è¿›é˜¶ç”¨æ³•" class="headerlink" title="è¿›é˜¶ç”¨æ³•"></a>è¿›é˜¶ç”¨æ³•</h2><ol><li><p><strong>æŒ‡å®š Ubuntu ç‰ˆæœ¬</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name &lt;instance-name&gt; &lt;ubuntu-version&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ª Ubuntu 20.04 çš„è™šæ‹Ÿæœº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name my-vm 20.04<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ†é…æ›´å¤šèµ„æºï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name &lt;instance-name&gt; --cpus &lt;number&gt; --mem &lt;size&gt; --disk &lt;size&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåˆ†é… 2 ä¸ª CPUï¼Œ4GB å†…å­˜ï¼Œ20GB ç£ç›˜:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch --name my-vm --cpus 2 --mem 4G --disk 20G<br></code></pre></td></tr></table></figure></li><li><p><strong>å…±äº«æ–‡ä»¶å¤¹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass mount &lt;host-directory&gt; &lt;instance-name&gt;:&lt;target-directory&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå°†æœ¬åœ°ç›®å½• <code>/home/user/projects</code> æŒ‚è½½åˆ°è™šæ‹Ÿæœºçš„ <code>/home/ubuntu/projects</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass mount /home/user/projects my-vm:/home/ubuntu/projects<br></code></pre></td></tr></table></figure></li><li><p><strong>è¿è¡Œå‘½ä»¤</strong>:<br>å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œå‘½ä»¤è€Œä¸è¿›å…¥è™šæ‹Ÿæœºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass <span class="hljs-built_in">exec</span> &lt;instance-name&gt; -- &lt;<span class="hljs-built_in">command</span>&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæ›´æ–°è™šæ‹Ÿæœºä¸­çš„åŒ…åˆ—è¡¨:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass <span class="hljs-built_in">exec</span> my-vm -- <span class="hljs-built_in">sudo</span> apt update<br></code></pre></td></tr></table></figure></li></ol><h1 id="å¯åŠ¨å‰é…ç½®"><a href="#å¯åŠ¨å‰é…ç½®" class="headerlink" title="å¯åŠ¨å‰é…ç½®"></a>å¯åŠ¨å‰é…ç½®</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¼€å¯mountæŒ‚è½½ï¼Œæ–¹ä¾¿æ‹¿æˆ–ä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œé»˜è®¤false</span><br>multipass <span class="hljs-built_in">set</span> local.privileged-mounts=<span class="hljs-literal">true</span><br><span class="hljs-comment">## é€‰æ‹©è™šæ‹Ÿæœºé©±åŠ¨ï¼Œhyperv/virtualbox</span><br><span class="hljs-comment">## winä¸“ä¸šç‰ˆå¯ç”¨hypervï¼Œå®¶åº­ç‰ˆåªèƒ½virtualbox</span><br>multipass <span class="hljs-built_in">set</span> local.driver=hyperv<br><span class="hljs-comment">## è®¾ç½®é»˜è®¤æ“ä½œå®ä¾‹</span><br>multipass get client.primary-name=primary<br></code></pre></td></tr></table></figure><h1 id="å¯åŠ¨å®ä¾‹"><a href="#å¯åŠ¨å®ä¾‹" class="headerlink" title="å¯åŠ¨å®ä¾‹"></a>å¯åŠ¨å®ä¾‹</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass launch -n <span class="hljs-variable">$name</span> -d 10G -m 2G -c 2 --bridged --mount &lt;local-path&gt;:&lt;instance-path&gt;<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœå¯åŠ¨ä¸äº†å¯ä»¥å°è¯•é‡å¯multipass</p></blockquote><h1 id="è°ƒæ•´å®ä¾‹é…ç½®"><a href="#è°ƒæ•´å®ä¾‹é…ç½®" class="headerlink" title="è°ƒæ•´å®ä¾‹é…ç½®"></a>è°ƒæ•´å®ä¾‹é…ç½®</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass stop handsome-ling<br>multipass <span class="hljs-built_in">set</span> local.handsome-ling.cpus=4<br>multipass <span class="hljs-built_in">set</span> local.handsome-ling.disk=60G<br>multipass <span class="hljs-built_in">set</span> local.handsome-ling.memory=7G<br></code></pre></td></tr></table></figure><h1 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åˆ é™¤å¹¶æ¸…é™¤</span><br><span class="hljs-comment">## delete ç›¸å½“äºæŠŠå®ä¾‹è½¬ä¸ºåˆ é™¤çŠ¶æ€ </span><br><span class="hljs-comment">## -p or --purge åˆ é™¤å¹¶æ¸…é™¤</span><br>multipass delete <span class="hljs-variable">$instance</span> -p<br><span class="hljs-comment">## purge</span><br>multipass purge <span class="hljs-variable">$instance</span><br></code></pre></td></tr></table></figure><h1 id="IPv4-N-A"><a href="#IPv4-N-A" class="headerlink" title="IPv4 N&#x2F;A"></a>IPv4 N&#x2F;A</h1><ul><li><p>é‡å¯å®ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass restart <span class="hljs-variable">$instance</span><br></code></pre></td></tr></table></figure></li><li><p>åœæ­¢åå†å¯åŠ¨å®ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass stop <span class="hljs-variable">$instance</span><br>multipass start <span class="hljs-variable">$instance</span><br></code></pre></td></tr></table></figure></li><li><p>é‡å¯multipassæœåŠ¡</p><ul><li>å¯ç›´æ¥æ€è¿›ç¨‹</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">taskkill /f /pid <span class="hljs-variable">$pid</span><br></code></pre></td></tr></table></figure></li><li><p>çŠ¶æ€suspending ï¼Œå°è¯•suspendå®ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass <span class="hljs-built_in">suspend</span> <span class="hljs-variable">$instance</span><br></code></pre></td></tr></table></figure></li><li><p>çŠ¶æ€suspendedï¼Œ shellè¿æ¥å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">multipass shell <span class="hljs-variable">$instance</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Posts</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
